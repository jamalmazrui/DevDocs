<html>

<head>
<meta http-equiv=Content-Type content="text/html; charset=windows-1252">
<meta name=Generator content="Microsoft Word 15 (filtered)">
<title>Learning drupal 9 as a framework:  a practical guide.</title>
<style>
<!--
 /* Font Definitions */
 @font-face
	{font-family:Helvetica;
	panose-1:2 11 6 4 2 2 2 2 2 4;}
@font-face
	{font-family:Courier;
	panose-1:2 7 4 9 2 2 5 2 4 4;}
@font-face
	{font-family:"Tms Rmn";
	panose-1:2 2 6 3 4 5 5 2 3 4;}
@font-face
	{font-family:Helv;
	panose-1:2 11 6 4 2 2 2 3 2 4;}
@font-face
	{font-family:"New York";
	panose-1:2 4 5 3 6 5 6 2 3 4;}
@font-face
	{font-family:System;
	panose-1:0 0 0 0 0 0 0 0 0 0;}
@font-face
	{font-family:Wingdings;
	panose-1:5 0 0 0 0 0 0 0 0 0;}
@font-face
	{font-family:"MS Mincho";
	panose-1:2 2 6 9 4 2 5 8 3 4;}
@font-face
	{font-family:Batang;
	panose-1:2 3 6 0 0 1 1 1 1 1;}
@font-face
	{font-family:SimSun;
	panose-1:2 1 6 0 3 1 1 1 1 1;}
@font-face
	{font-family:PMingLiU;
	panose-1:2 1 6 1 0 1 1 1 1 1;}
@font-face
	{font-family:"MS Gothic";
	panose-1:2 11 6 9 7 2 5 8 2 4;}
@font-face
	{font-family:Dotum;
	panose-1:2 11 6 0 0 1 1 1 1 1;}
@font-face
	{font-family:SimHei;
	panose-1:2 1 6 0 3 1 1 1 1 1;}
@font-face
	{font-family:MingLiU;
	panose-1:2 1 6 9 0 1 1 1 1 1;}
@font-face
	{font-family:Mincho;
	panose-1:2 2 6 9 4 3 5 8 3 5;}
@font-face
	{font-family:Gulim;
	panose-1:2 11 6 0 0 1 1 1 1 1;}
@font-face
	{font-family:Century;
	panose-1:2 4 6 4 5 5 5 2 3 4;}
@font-face
	{font-family:"Angsana New";
	panose-1:2 2 6 3 5 4 5 2 3 4;}
@font-face
	{font-family:"Cordia New";
	panose-1:2 11 3 4 2 2 2 2 2 4;}
@font-face
	{font-family:Mangal;
	panose-1:0 0 4 0 0 0 0 0 0 0;}
@font-face
	{font-family:Latha;
	panose-1:2 0 4 0 0 0 0 0 0 0;}
@font-face
	{font-family:Sylfaen;
	panose-1:1 10 5 2 5 3 6 3 3 3;}
@font-face
	{font-family:Vrinda;
	panose-1:0 0 4 0 0 0 0 0 0 0;}
@font-face
	{font-family:Raavi;
	panose-1:2 0 5 0 0 0 0 0 0 0;}
@font-face
	{font-family:Shruti;
	panose-1:2 0 5 0 0 0 0 0 0 0;}
@font-face
	{font-family:Sendnya;
	panose-1:0 0 4 0 0 0 0 0 0 0;}
@font-face
	{font-family:Gautami;
	panose-1:2 0 5 0 0 0 0 0 0 0;}
@font-face
	{font-family:Tunga;
	panose-1:0 0 4 0 0 0 0 0 0 0;}
@font-face
	{font-family:"Estrangelo Edessa";
	panose-1:0 0 0 0 0 0 0 0 0 0;}
@font-face
	{font-family:"Cambria Math";
	panose-1:2 4 5 3 5 4 6 3 2 4;}
@font-face
	{font-family:"Yu Gothic";
	panose-1:2 11 4 0 0 0 0 0 0 0;}
@font-face
	{font-family:DengXian;
	panose-1:2 1 6 0 3 1 1 1 1 1;}
@font-face
	{font-family:Calibri;
	panose-1:2 15 5 2 2 2 4 3 2 4;}
@font-face
	{font-family:"Calibri Light";
	panose-1:2 15 3 2 2 2 4 3 2 4;}
@font-face
	{font-family:"Palatino Linotype";
	panose-1:2 4 5 2 5 5 5 3 3 4;}
@font-face
	{font-family:Verdana;
	panose-1:2 11 6 4 3 5 4 4 2 4;}
@font-face
	{font-family:"Arial Unicode MS";
	panose-1:2 11 6 4 2 2 2 2 2 4;}
@font-face
	{font-family:"Aptos Display";}
@font-face
	{font-family:Aptos;}
@font-face
	{font-family:"Segoe UI Emoji";
	panose-1:2 11 5 2 4 2 4 2 2 3;}
@font-face
	{font-family:Consolas;
	panose-1:2 11 6 9 2 2 4 3 2 4;}
 /* Style Definitions */
 p.MsoNormal, li.MsoNormal, div.MsoNormal
	{margin-top:0in;
	margin-right:0in;
	margin-bottom:17.3pt;
	margin-left:.5pt;
	text-indent:-.5pt;
	line-height:112%;
	font-size:12.0pt;
	font-family:"Calibri",sans-serif;
	color:black;}
h1
	{mso-style-link:"Heading 1 Char";
	margin-top:0in;
	margin-right:0in;
	margin-bottom:0in;
	margin-left:.5pt;
	text-indent:-.5pt;
	line-height:110%;
	page-break-after:avoid;
	font-size:18.0pt;
	font-family:"Calibri",sans-serif;
	color:black;}
h2
	{mso-style-link:"Heading 2 Char";
	margin-top:0in;
	margin-right:0in;
	margin-bottom:0in;
	margin-left:.5pt;
	text-indent:-.5pt;
	line-height:109%;
	page-break-after:avoid;
	font-size:16.0pt;
	font-family:"Calibri",sans-serif;
	color:black;
	font-weight:normal;}
h3
	{mso-style-link:"Heading 3 Char";
	margin-top:0in;
	margin-right:0in;
	margin-bottom:3.9pt;
	margin-left:.5pt;
	text-indent:-.5pt;
	line-height:110%;
	page-break-after:avoid;
	font-size:14.0pt;
	font-family:"Calibri",sans-serif;
	color:#434343;
	font-weight:normal;}
h4
	{mso-style-link:"Heading 4 Char";
	margin-top:0in;
	margin-right:0in;
	margin-bottom:21.0pt;
	margin-left:.5pt;
	text-indent:-.5pt;
	line-height:114%;
	page-break-after:avoid;
	font-size:12.0pt;
	font-family:"Calibri",sans-serif;
	color:#666666;
	font-weight:normal;}
p.MsoToc1, li.MsoToc1, div.MsoToc1
	{margin-top:0in;
	margin-right:.75pt;
	margin-bottom:8.0pt;
	margin-left:.75pt;
	line-height:107%;
	font-size:11.0pt;
	font-family:"Calibri",sans-serif;
	color:black;}
p.MsoToc2, li.MsoToc2, div.MsoToc2
	{margin-top:0in;
	margin-right:.75pt;
	margin-bottom:8.0pt;
	margin-left:19.25pt;
	text-indent:-.5pt;
	line-height:107%;
	font-size:11.0pt;
	font-family:"Calibri",sans-serif;
	color:black;}
p.MsoToc3, li.MsoToc3, div.MsoToc3
	{margin-top:0in;
	margin-right:.75pt;
	margin-bottom:8.0pt;
	margin-left:.75pt;
	line-height:107%;
	font-size:11.0pt;
	font-family:"Calibri",sans-serif;
	color:black;}
p.MsoToc4, li.MsoToc4, div.MsoToc4
	{margin-top:0in;
	margin-right:.75pt;
	margin-bottom:8.0pt;
	margin-left:.75pt;
	line-height:107%;
	font-size:11.0pt;
	font-family:"Calibri",sans-serif;
	color:black;}
span.Heading4Char
	{mso-style-name:"Heading 4 Char";
	mso-style-link:"Heading 4";
	font-family:"Calibri",sans-serif;
	color:#666666;}
span.Heading2Char
	{mso-style-name:"Heading 2 Char";
	mso-style-link:"Heading 2";
	font-family:"Calibri",sans-serif;
	color:black;}
span.Heading1Char
	{mso-style-name:"Heading 1 Char";
	mso-style-link:"Heading 1";
	font-family:"Calibri",sans-serif;
	color:black;
	font-weight:bold;}
span.Heading3Char
	{mso-style-name:"Heading 3 Char";
	mso-style-link:"Heading 3";
	font-family:"Calibri",sans-serif;
	color:#434343;}
span.msoIns
	{mso-style-name:"";
	text-decoration:underline;
	color:#65B4B4;}
span.msoDel
	{mso-style-name:"";
	text-decoration:line-through;
	color:#FF4B4B;}
.MsoChpDefault
	{font-size:12.0pt;}
.MsoPapDefault
	{margin-bottom:8.0pt;
	line-height:115%;}
 /* Page Definitions */
 @page WordSection1
	{size:596.0pt 842.0pt;
	margin:1.0in 1.0in 1.0in 1.0in;}
div.WordSection1
	{page:WordSection1;}
@page WordSection2
	{size:596.0pt 842.0pt;
	margin:1.0in 72.7pt 72.5pt 1.0in;}
div.WordSection2
	{page:WordSection2;}
 /* List Definitions */
 ol
	{margin-bottom:0in;}
ul
	{margin-bottom:0in;}
-->
</style>

</head>

<body lang=EN-US style='word-wrap:break-word'>

<div class=WordSection1>

<p class=MsoNormal style='margin-top:0in;margin-right:524.0pt;margin-bottom:
0in;margin-left:-1.0in;text-indent:0in;line-height:107%'><img width=794
height=1123 src="Learning%20drupal%209%20as%20a%20framework_files/image001.jpg"><br
clear=ALL>
</p>

</div>

<span style='font-size:12.0pt;line-height:112%;font-family:"Calibri",sans-serif;
color:black'><br clear=all style='page-break-before:always'>
</span>

<div class=WordSection2>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.35pt;
margin-left:-.25pt;line-height:110%'><b>Requirements</b>:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>This is a coding book for programmers. At least one year of
experience as a developer with drupal or a related framework is required. You
must be able to install drupal on a local server.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.35pt;
margin-left:-.25pt;line-height:110%'><b>Description</b></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>This course will teach you advanced concepts of drupal 9,
Object-oriented PHP and symphony components. After the course, you’ll be able
to build robust and scalable software solutions of many kinds.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>In this hands-on course a drupal expert with 10 years
experience with the software will give you a deep-dive in the power that drupal
core has to offer.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:16.5pt;
margin-left:-.25pt;line-height:117%'>Advanced topics like <span
style='background:yellow'>custom entities, entity forms, access control,
events, caching, workflows </span>and many more are discussed <span
style='background:yellow'>while building an actual software</span>.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>With +2400 lines of custom code, the author offers you
powerful and ready-to-use snippets for your next drupal projects.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>Fun fact: you’ll not even be using nodes at all but only
custom entities.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:13.75pt;
margin-left:-.25pt'>Let’s take a deep dive!</p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.9pt;
margin-left:-.25pt;line-height:107%'><i><span style='font-size:9.0pt;
line-height:107%'>First edition: 05/05/2021</span></i></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.9pt;
margin-left:-.25pt;line-height:107%'><i><span style='font-size:9.0pt;
line-height:107%'>Modified edition: 24/06/2021</span></i></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.9pt;
margin-left:-.25pt;line-height:107%'><i><span style='font-size:9.0pt;
line-height:107%'>See changelog at
https://stefvanlooveren.me/courses/drupal-9-framework#changelog</span></i></p>

<p class=MsoToc1><a href="#_Toc247016"><b><span style='color:black;text-decoration:
none'>Foreword</span></b><span style='color:black;text-decoration:none'>                                                                                                                                                                                  </span><span style='color:black;text-decoration:none'><b>4</b></span></a></p>

<p class=MsoToc1><a href="#_Toc247017"><b><span style='color:black;text-decoration:
none'>Part 1: Drupal developer essentials</span></b><span style='color:black;
text-decoration:none'>                                                                                                                               </span><span style='color:black;text-decoration:none'><b>5</b></span></a></p>

<p class=MsoToc2><a href="#_Toc247018"><span style='color:black;text-decoration:
none'>Composer                                                                                                                                                                         </span><span style='color:black;text-decoration:none'>7</span></a></p>

<p class=MsoToc3><a href="#_Toc247019"><span style='color:black;text-decoration:
none'>Basic composer commands                                                                                                                                                </span><span style='color:black;text-decoration:none'>9</span></a></p>

<p class=MsoToc3><a href="#_Toc247020"><span style='color:black;text-decoration:
none'>Comparing with drupal 7 and earlier                                                                                                                           </span><span style='color:black;text-decoration:none'>10</span></a></p>

<p class=MsoToc3><a href="#_Toc247021"><span style='color:black;text-decoration:
none'>Patching with composer                                                                                                                                                   </span><span style='color:black;text-decoration:none'>11</span></a></p>

<p class=MsoToc2><a href="#_Toc247022"><span style='color:black;text-decoration:
none'>Git best practices                                                                                                                                                         </span><span style='color:black;text-decoration:none'>13</span></a></p>

<p class=MsoToc2><a href="#_Toc247023"><span style='color:black;text-decoration:
none'>CLI tools                                                                                                                                                                          </span><span style='color:black;text-decoration:none'>15</span></a></p>

<p class=MsoToc2><a href="#_Toc247024"><span style='color:black;text-decoration:
none'>Development &amp; debug                                                                                                                                              </span><span style='color:black;text-decoration:none'>20</span></a></p>

<p class=MsoToc3><a href="#_Toc247025"><span style='color:black;text-decoration:
none'>Xdebug                                                                                                                                                                                    </span><span style='color:black;text-decoration:none'>22</span></a></p>

<p class=MsoToc3><a href="#_Toc247026"><span style='color:black;text-decoration:
none'>Webprofiler                                                                                                                                                                           </span><span style='color:black;text-decoration:none'>24</span></a></p>

<p class=MsoToc2><a href="#_Toc247027"><span style='color:black;text-decoration:
none'>Configuration management                                                                                                                                     </span><span style='color:black;text-decoration:none'>27</span></a></p>

<p class=MsoToc3><a href="#_Toc247028"><span style='color:black;text-decoration:
none'>Basic configuration management                                                                                                                                  </span><span style='color:black;text-decoration:none'>27</span></a></p>

<p class=MsoToc3><a href="#_Toc247029"><span style='color:black;text-decoration:
none'>Creating custom configuration settings                                                                                                                       </span><span style='color:black;text-decoration:none'>31</span></a></p>

<p class=MsoToc3><a href="#_Toc247030"><span style='color:black;text-decoration:
none'>Different configuration per environment                                                                                                                    </span><span style='color:black;text-decoration:none'>35</span></a></p>

<p class=MsoToc4><a href="#_Toc247031"><span style='color:black;text-decoration:
none'>Scenario A: Install a module on development, but not on production                                                            </span><span style='color:black;text-decoration:none'>36</span></a></p>

<p class=MsoToc4><a href="#_Toc247032"><span style='color:black;text-decoration:
none'>Scenario B: disable caching on development, but not on production                                                              </span><span style='color:black;text-decoration:none'>37</span></a></p>

<p class=MsoToc4><a href="#_Toc247033"><span style='color:black;text-decoration:
none'>Scenario C: enable a module on both development and production, but
ignore itsconfiguration        </span><span
style='color:black;text-decoration:none'>38</span></a></p>

<p class=MsoToc3><a href="#_Toc247034"><span style='color:black;text-decoration:
none'>Reading configuration objects in your code                                                                                                              </span><span style='color:black;text-decoration:none'>40</span></a></p>

<p class=MsoToc1><a href="#_Toc247035"><b><span style='color:black;text-decoration:
none'>Part 2: Project code and set-up</span></b><span style='color:black;
text-decoration:none'>                                                                                                                                     </span><span style='color:black;text-decoration:none'><b>41</b></span></a></p>

<p class=MsoToc2><a href="#_Toc247036"><span style='color:black;text-decoration:
none'>Seed data                                                                                                                                                                       </span><span style='color:black;text-decoration:none'>41</span></a></p>

<p class=MsoToc2><a href="#_Toc247037"><span style='color:black;text-decoration:
none'>Project set-up                                                                                                                                                               </span><span style='color:black;text-decoration:none'>45</span></a></p>

<p class=MsoToc1><a href="#_Toc247038"><b><span style='color:black;text-decoration:
none'>Part 3: Custom entities 101, CRUD operations, workflow states and access</span></b><span
style='color:black;text-decoration:none'>                                              </span><span style='color:black;text-decoration:none'><b>51</b></span></a></p>

<p class=MsoToc2><a href="#_Toc247039"><span style='color:black;text-decoration:
none'>Content entities                                                                                                                                                           </span><span style='color:black;text-decoration:none'>52</span></a></p>

<p class=MsoToc2><a href="#_Toc247040"><span style='color:black;text-decoration:
none'>Building our first content entity                                                                                                                             </span><span style='color:black;text-decoration:none'>53</span></a></p>

<p class=MsoToc2><a href="#_Toc247041"><span style='color:black;text-decoration:
none'>Securing access of our entities                                                                                                                               </span><span style='color:black;text-decoration:none'>58</span></a></p>

<p class=MsoToc2><a href="#_Toc247042"><span style='color:black;text-decoration:
none'>Adding the create/edit/delete forms (CRUD)                                                                                                    </span><span style='color:black;text-decoration:none'>63</span></a></p>

<p class=MsoToc2><a href="#_Toc247043"><span style='color:black;text-decoration:
none'>Views integration of our custom entity to add a listing                                                                                 </span><span style='color:black;text-decoration:none'>69</span></a></p>

<p class=MsoToc2><a href="#_Toc247044"><span style='color:black;text-decoration:
none'>Getting up-to-speed: making the entity fieldable                                                                                            </span><span style='color:black;text-decoration:none'>75</span></a></p>

<p class=MsoToc3><a href="#_Toc247045"><span style='color:black;text-decoration:
none'>Media field with library                                                                                                                                                     </span><span style='color:black;text-decoration:none'>82</span></a></p>

<p class=MsoToc3><a href="#_Toc247046"><span style='color:black;text-decoration:
none'>Adding fields to the custom entity via the UI                                                                                                            </span><span style='color:black;text-decoration:none'>87</span></a></p>

<p class=MsoToc2><a href="#_Toc247047"><span style='color:black;text-decoration:
none'>Adding workflows and moderation to custom entities                                                                                  </span><span style='color:black;text-decoration:none'>92</span></a></p>

<p class=MsoToc2><a href="#_Toc247048"><span style='color:black;text-decoration:
none'>Change entity access based on workflow states                                                                                              </span><span style='color:black;text-decoration:none'>95</span></a></p>

<p class=MsoToc2><a href="#_Toc247049"><span style='color:black;text-decoration:
none'>Adding views plugins: custom fields and operation links                                                                              </span><span style='color:black;text-decoration:none'>96</span></a></p>

<p class=MsoToc2><a href="#_Toc247050"><span style='color:black;text-decoration:
none'>Adding a                                                                                                                                                                       </span><span style='color:black;text-decoration:none'>105</span></a></p>

<p class=MsoToc2><a href="#_Toc247051"><span style='color:black;text-decoration:
none'>custom controller for direct publishing                                                                                                            </span><span style='color:black;text-decoration:none'>105</span></a></p>

<p class=MsoToc2><a href="#_Toc247052"><span style='color:black;text-decoration:
none'>Building an overview page                                                                                                                                    </span><span style='color:black;text-decoration:none'>109</span></a></p>

<p class=MsoToc3><a href="#_Toc247053"><span style='color:black;text-decoration:
none'>Adding a custom views filter based on moderation state                                                                                  </span><span style='color:black;text-decoration:none'>114</span></a></p>

<p class=MsoToc2><a href="#_Toc247054"><span style='color:black;text-decoration:
none'>Optimize the entity teaser with custom variables for twig                                                                        </span><span style='color:black;text-decoration:none'>120</span></a></p>

<p class=MsoToc2><a href="#_Toc247055"><span style='color:black;text-decoration:
none'>Adding css to views                                                                                                                                                  </span><span style='color:black;text-decoration:none'>123</span></a></p>

<p class=MsoToc2><a href="#_Toc247056"><span style='color:black;text-decoration:
none'>Adding a user-friendly multistep form for entity creation                                                                         </span><span style='color:black;text-decoration:none'>127</span></a></p>

<p class=MsoToc3><a href="#_Toc247057"><span style='color:black;text-decoration:
none'>Add custom actions to the form                                                                                                                                  </span><span style='color:black;text-decoration:none'>134</span></a></p>

<p class=MsoToc3><a href="#_Toc247058"><span style='color:black;text-decoration:
none'>Conditional fields in the Form API                                                                                                                              </span><span style='color:black;text-decoration:none'>140</span></a></p>

<p class=MsoToc2><a href="#_Toc247059"><span style='color:black;text-decoration:
none'>Updating our data seeds                                                                                                                                        </span><span style='color:black;text-decoration:none'>142</span></a></p>

<p class=MsoToc1><a href="#_Toc247060"><b><span style='font-size:12.0pt;
line-height:107%;color:black;text-decoration:none'>Part 4: building the
application. Storing, validating and rendering data</span></b><span
style='color:black;text-decoration:none'>                                      </span><b><span style='font-size:12.0pt;line-height:107%;color:black;text-decoration:none'>145</span></b></a></p>

<p class=MsoToc2><a href="#_Toc247061"><span style='color:black;text-decoration:
none'>Add dynamic menu links with Menu plugins                                                                                                  </span><span style='color:black;text-decoration:none'>145</span></a></p>

<p class=MsoToc2><a href="#_Toc247062"><span style='color:black;text-decoration:
none'>Building the offer page with twig: theming a custom content entity                                                    </span><span style='color:black;text-decoration:none'>148</span></a></p>

<p class=MsoToc2><a href="#_Toc247063"><span style='color:black;text-decoration:
none'>Adding a dynamic bidding form to our page with an advanced block plugin                                     </span><span style='color:black;text-decoration:none'>150</span></a></p>

<p class=MsoToc2><a href="#_Toc247064"><span style='color:black;text-decoration:
none'>Adding site-wide css and javascript                                                                                                                    </span><span style='color:black;text-decoration:none'>160</span></a></p>

<p class=MsoToc2><a href="#_Toc247065"><span style='color:black;text-decoration:
none'>Adding a code-only bid entity                                                                                                                              </span><span style='color:black;text-decoration:none'>164</span></a></p>

<p class=MsoToc2><a href="#_Toc247066"><span style='color:black;text-decoration:
none'>Saving the bid entities on form submission                                                                                                    </span><span style='color:black;text-decoration:none'>168</span></a></p>

<p class=MsoToc2><a href="#_Toc247067"><span style='color:black;text-decoration:
none'>Form validation based on highest bids                                                                                                             </span><span style='color:black;text-decoration:none'>170</span></a></p>

<p class=MsoToc2><a href="#_Toc247068"><span style='color:black;text-decoration:
none'>Add dynamic variables to our entity teaser                                                                                                    </span><span style='color:black;text-decoration:none'>173</span></a></p>

<p class=MsoToc2><a href="#_Toc247069"><span style='color:black;text-decoration:
none'>Validating the entity with constraints                                                                                                               </span><span style='color:black;text-decoration:none'>176</span></a></p>

<p class=MsoToc2><a href="#_Toc247070"><span style='color:black;text-decoration:
none'>Displaying all bids in a dynamically rendered table                                                                                      </span><span style='color:black;text-decoration:none'>179</span></a></p>

<p class=MsoToc2><a href="#_Toc247071"><span style='color:black;text-decoration:
none'>Integrating the core revision system into the bidding process to raise a
bid                                      </span><span
style='color:black;text-decoration:none'>185</span></a></p>

<p class=MsoToc2><a href="#_Toc247072"><span style='color:black;text-decoration:
none'>Deleting a bid with a core dialog pop-up                                                                                                         </span><span style='color:black;text-decoration:none'>191</span></a></p>

<p class=MsoToc1><a href="#_Toc247073"><b><span style='color:black;text-decoration:
none'>Part 5: Transitions, Events, Caching and user registration</span></b><span
style='color:black;text-decoration:none'>                                                                               </span><span style='color:black;text-decoration:none'><b>198</b></span></a></p>

<p class=MsoToc2><a href="#_Toc247074"><span style='color:black;text-decoration:
none'>User notifications on transition events                                                                                                             </span><span style='color:black;text-decoration:none'>198</span></a></p>

<p class=MsoToc2><a href="#_Toc247075"><span style='color:black;text-decoration:
none'>Update entire view with custom ajax callback                                                                                               </span><span style='color:black;text-decoration:none'>201</span></a></p>

<p class=MsoToc2><a href="#_Toc247076"><span style='color:black;text-decoration:
none'>OO in practice: deletion of bid and notification entities when an offer
gets deleted                      </span><span
style='color:black;text-decoration:none'>206</span></a></p>

<p class=MsoToc2><a href="#_Toc247077"><span style='color:black;text-decoration:
none'>Caching in-depth                                                                                                                                                       </span><span style='color:black;text-decoration:none'>208</span></a></p>

<p class=MsoToc3><a href="#_Toc247078"><span style='color:black;text-decoration:
none'>Caching of views pages                                                                                                                                                   </span><span style='color:black;text-decoration:none'>209</span></a></p>

<p class=MsoToc3><a href="#_Toc247079"><span style='color:black;text-decoration:
none'>Caching of custom entity pages                                                                                                                                   </span><span style='color:black;text-decoration:none'>210</span></a></p>

<p class=MsoToc3><a href="#_Toc247080"><span style='color:black;text-decoration:
none'>Use of cache contexts and cache tags for caching custom blocks                                                                   </span><span style='color:black;text-decoration:none'>212</span></a></p>

<p class=MsoToc3><a href="#_Toc247081"><span style='color:black;text-decoration:
none'>Use of cacheable dependencies in render arrays                                                                                                  </span><span style='color:black;text-decoration:none'>214</span></a></p>

<p class=MsoToc3><a href="#_Toc247082"><span style='color:black;text-decoration:
none'>Invalidate cache of another entity after saving                                                                                                      </span><span style='color:black;text-decoration:none'>218</span></a></p>

<p class=MsoToc2><a href="#_Toc247083"><span style='color:black;text-decoration:
none'>Dispatch custom Events with an EventSubscriber to redirect users                                                       </span><span style='color:black;text-decoration:none'>220</span></a></p>

<p class=MsoToc2><a href="#_Toc247084"><span style='color:black;text-decoration:
none'>Customize the user registration process with a RouteSubscriber                                                           </span><span style='color:black;text-decoration:none'>224</span></a></p>

<p class=MsoToc2><a href="#_Toc247085"><span style='color:black;text-decoration:
none'>Finishing up the platform                                                                                                                                       </span><span style='color:black;text-decoration:none'>233</span></a></p>

<p class=MsoNormal>&nbsp;</p>

<h1 style='margin-top:0in;margin-right:0in;margin-bottom:7.8pt;margin-left:
-.25pt'><a name="_Toc247016">Foreword</a></h1>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:12.7pt;
margin-left:-.25pt'>The history of drupal as a content management system has
been interesting in many ways. This open-source project hit an incredible 1
million powered websites worldwide in 2014 because of its truly great CMS
features for developers and webmasters.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:12.7pt;
margin-left:-.25pt'>Since then, it has chosen an interesting path. While in
2014 the main competitors were Wordpress and Joomla, the community took the
radical decision of a complete rewrite of the software to meet the challenges
of the future. The result was the release of drupal 8: an object-oriented
framework with Symfony components. It resulted in software that was ready to
meet the high standards of the industry on security, scalability,
cost-effectiveness, and reliability.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:16.5pt;
margin-left:-.25pt;line-height:117%'><span style='background:yellow'>In 2021,
with Drupal 9, it has become an enterprise software for ambitious and
custom-tailored solutions that is comparable with Ruby on Rails and Django.
Especially for startups, it offers a quick-to-market solution.</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>I wrote this course because from my experience the speed of
building custom-tailored solutions with drupal 9 is stunning. A truly huge
advantage is that the security updates come for free. From the community, for
the community. I really like this slogan drupal has had for years: &lt;&lt;
Come for the code, stay for the community &gt;&gt;.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>I’ve been around in the drupal ecosystem for ten years and
have supported in many ways: code contributing, <a
href="https://stefvanlooveren.me/"><span style='color:#1155CC'>blogging</span></a>,
sharing solutions on <a
href="https://drupal.stackexchange.com/users/71941/stef-van-looveren?tab=profile"><span
style='color:#1155CC'>DrupalAnswers</span></a>, and attending conferences. With
this book, I share almost all of the knowledge I’ve built up so far since using
Drupal 8 and 9.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:.8pt;
margin-left:-.25pt'>Allow me to say a few topics that do not get covered in
this book. The ecosystem is so big that I had to let out chapters about these:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:.95pt;
margin-left:.5in;text-indent:-.25in'><span style='font-family:"Arial",sans-serif'>&#9679;<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span>Unit
testing (would need a separate book)</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:.95pt;
margin-left:.5in;text-indent:-.25in'><span style='font-family:"Arial",sans-serif'>&#9679;<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span>Server
set-up (but take a look at Lando!)</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:.95pt;
margin-left:.5in;text-indent:-.25in'><span style='font-family:"Arial",sans-serif'>&#9679;<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span>JSON-API
and webservices (would need a separate book)</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:.95pt;
margin-left:.5in;text-indent:-.25in'><span style='font-family:"Arial",sans-serif'>&#9679;<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span>Drupal
theming guide</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:.5in;text-indent:-.25in'><span style='font-family:"Arial",sans-serif'>&#9679;<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span>How
to install drupal</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>In this hands-on course, we’ll be building a bidding
software platform. While the platform will not be 100% finished, the backbone
and layers are ready to use for your production websites. I hope you enjoy it
as much as I did.</p>

<h1 style='margin-top:0in;margin-right:0in;margin-bottom:1.45pt;margin-left:
-.25pt'><a name="_Toc247017">Part 1: Drupal developer essentials</a></h1>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=600
 style='width:6.25in;border-collapse:collapse'>
 <tr style='height:73.5pt'>
  <td width=59 valign=top style='width:44.25pt;background:#6D9EEB;padding:14.6pt 5.75pt 0in 0in;
  height:73.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:14.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%'>&#128073;</span></p>
  </td>
  <td width=541 style='width:405.75pt;background:#6D9EEB;padding:14.6pt 5.75pt 0in 0in;
  height:73.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:9.2pt;margin-bottom:
  0in;margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%'>You may understand that building larger platforms
  also requires a more thorough development setup. In this section you will
  learn the  more <b>advanced developer tools </b>real-life experts use to
  build their solutions.</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>First, we'll take a look at <b>compose</b>r and how we’ll
manage installation, versioning and upgrades of the core and the modules.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>After this we'll discuss <b>Git</b>. Interesting to know is
that thanks to composer we do not have to add our modules to version control.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>Then I want you to get to know <b>Xdebug</b>, which we will
need to intercept the software at certain breakpoints to take a look at all the
available data at that moment. I use this all the time during PHP development.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'><b>Webprofiler </b>is a tool for using while developing. It
indicates the current route, the load time of the controller and a lot of other
stuff.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>You might have heard of <b>drush </b>before, the cli for
drupal developers. In this course, we’ll get to know this drupal command-line
language a bit better and use it more and more while building custom modules.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:7.05pt;margin-bottom:
30.4pt;margin-left:-.25pt'>Drupal is not meant for a simple blog anymore. The
framework and CMS can be pretty complex and needs to get updated regularly and
without downtime. We will develop the platform in a way that when other
developers of our team run a clean drupal install and import configuration, the
platform is ready on-the-fly. But we do not want an empty box every time, so
we’ll provide some seed data like users, offers, bids etc. that can be imported
on installation.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:15.1pt;margin-bottom:
31.25pt;margin-left:14.0pt;line-height:110%;background:#FFD966'><span
style='font-size:11.0pt;line-height:110%'>We will develop the platform in a way
that when you install, the platform is ready on-the-fly, with real-world
content filled in. No more empty boxes or production data!</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:31.15pt;
margin-left:-.25pt'>In the drupal 7 days, going from staging to production was
hard. Drupal 8 has made a huge progression on this <span style='font-family:
Consolas'>and </span>even made it a strength. That’s why so many enterprises
are now interested in drupal: it got easy to roll in new features in it while
in production. <b>Configuration management </b>is a topic we’ll discuss more in
depth at the end of this chapter.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:15.1pt;margin-bottom:
0in;margin-left:14.0pt;line-height:110%;background:#FFD966'><span
style='font-size:11.0pt;line-height:110%'>Drupal 8 has made a strength out of
its previous weakness: configuration management.</span><br clear=all
style='page-break-before:always'>
</p>

<h2 style='margin-top:0in;margin-right:0in;margin-bottom:19.85pt;margin-left:
-.25pt'><a name="_Toc247018">Composer</a></h2>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>In this section we’ll talk about composer and how it
manages versioning.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'><img width=155 height=190
src="Learning%20drupal%209%20as%20a%20framework_files/image002.gif" align=left
hspace=12><a href="https://getcomposer.org/"><span style='color:#1155CC'>Composer</span></a><u><span
style='color:#1155CC'> </span></u>is an application-level package manager for
PHP. It keeps track of the versions and dependencies of your core drupal,
modules, themes and libraries.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>In short, this will make sure you don’t install something
that is not compatible. In addition to the core drupal installation, every
module or theme can add requirements and dependencies in it’s .info file via a
composer.json file.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>Composer was added in drupal 8 and is mandatory. Make sure
you have it installed globally on your machine.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>Take a look at a basic installation of drupal. Clone the
files of the <a href="https://github.com/drupal/recommended-project"><span
style='color:#1155CC'>drupal/recommended-project</span></a><u><span
style='color:#1155CC'> </span></u>to the folder you would like to use as your
development environment.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:21.9pt;
margin-left:-.25pt'>Make sure you have composer installed, go to your terminal
and type:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:10.6pt;margin-bottom:
23.05pt;margin-left:12.35pt;line-height:112%;background:#F8F8F8'><span
style='font-family:Consolas;color:#333333'>composer create-project
drupal/recommended-project</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>Your terminal will go ahead and download all the required
packages:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:-1.7pt;margin-bottom:
24.25pt;margin-left:1.5pt;text-indent:0in;line-height:107%'><img border=0
width=602 height=490 id="Picture 597"
src="Learning%20drupal%209%20as%20a%20framework_files/image003.jpg"></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:5.4pt;
margin-left:-.25pt'>After this, run</p>

<p class=MsoNormal style='margin-top:0in;margin-right:10.6pt;margin-bottom:
5.85pt;margin-left:5.0pt;line-height:112%;background:#F8F8F8'><span
style='font-family:Consolas;color:#333333'>composer update</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>to make sure you have the latest packages available.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>Using this <i>recommended </i>repository as a starter
point, we avoid dependency problems by using only dependencies that have
already been tested with your version of Drupal.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>The provided <b>composer.json </b>file contains the best
practice way of structuring a drupal project. It will automatically make sure
your modules, themes and libraries get downloaded in the right folder. The
created <b>composer.lock </b>file keeps track of every exact version you have
installed.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>You see a lot of <b>symfony components </b>go to your <i>vendor
</i>map, but drupal also requires quite a lot of other extra packages.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>Now that installation is ready, take a look at the folder
structure we now have:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:.65pt;
margin-left:.5in;text-indent:-.25in'><span style='font-family:"Arial",sans-serif'>&#9679;<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span><b>web
</b>is the webroot of the project where we can see a fresh new drupal 9
installation . This is the folder where your domain name will be pointed to</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:.5in;text-indent:-.25in'><span style='font-family:"Arial",sans-serif'>&#9679;<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span><b>vendor
</b>is the folder with all the dependencies</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>Notice that the <b>composer.json </b>file will always stay
one level above our webroot, thus in the same level as <i>web </i>and <i>vendor</i>.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>It is nice to have the vendor packages separated from the
drupal core. This makes it cleaner in the long run. Also, dependencies are only
accessible from the server because they are a level higher than the web root.</p>

<h3 style='margin-top:0in;margin-right:0in;margin-bottom:18.75pt;margin-left:
-.25pt'><a name="_Toc247019">Basic composer commands</a></h3>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:21.9pt;
margin-left:-.25pt'>Let’s move on with some basic composer commands:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:10.6pt;margin-bottom:
9.3pt;margin-left:5.0pt;line-height:112%;background:#F8F8F8'><span
style='font-family:Consolas;color:#333333'>composer require drupal/redirect</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:-1.7pt;margin-bottom:
24.25pt;margin-left:1.5pt;text-indent:0in;line-height:107%'><img border=0
width=602 height=392 id="Picture 642"
src="Learning%20drupal%209%20as%20a%20framework_files/image004.gif"></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>This will download the redirect module to <b>modules/contrib
</b>and a reference to it gets added to our <b>composer.json </b>and <b>composer.lock
</b>file. If the module has dependencies defined, they will get downloaded and
put in the vendor map.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>To remove it, we run:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:10.6pt;margin-bottom:
9.3pt;margin-left:5.0pt;line-height:112%;background:#F8F8F8'><span
style='font-family:Consolas;color:#333333'>composer remove drupal/redirect</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:-1.7pt;margin-bottom:
24.25pt;margin-left:1.5pt;text-indent:0in;line-height:107%'><img border=0
width=602 height=376 id="Picture 672"
src="Learning%20drupal%209%20as%20a%20framework_files/image005.gif"></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>This removes the module. Always make sure you disabled the
module first in drupal.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:21.9pt;
margin-left:-.25pt'>It is also possible to be more specific:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:10.6pt;margin-bottom:
23.05pt;margin-left:5.0pt;line-height:112%;background:#F8F8F8'><span
style='font-family:Consolas;color:#333333'>composer require drupal/redirect:1.5</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>This will get us a specific version of the module, instead
of the latest one.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:21.9pt;
margin-left:-.25pt'>For a theme, it works the same:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:10.6pt;margin-bottom:
23.05pt;margin-left:5.0pt;line-height:112%;background:#F8F8F8'><span
style='font-family:Consolas;color:#333333'>composer require drupal/bootstrap</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>Thanks to the scaffolding in the composer.json file the
system knows which is the theme directory, it gets placed in the right folder,
which is <b>themes/custom/bootstrap</b>.</p>

<h3 style='margin-top:0in;margin-right:0in;margin-bottom:19.55pt;margin-left:
-.25pt'><a name="_Toc247020">Comparing with drupal 7 and earlier</a></h3>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.35pt;
margin-left:-.25pt;line-height:110%'><b>Why not just download the module from
drupal.org, like we used to do?</b></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:.65pt;
margin-left:-.25pt'>Here’s the deal. If we want to be able to professionally
use drupal as a software platform, you really really have to get comfortable
with composer.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>You’ll definitely get yourself into trouble if you are
ignoring this way of working because <b>mixing the wrong dependencies will get
you bugs </b>soon or late. Second, by using composer you do not have to add all
these modules to version control which <b>will dramatically decrease your git
repository size</b>. Because a server can install everything that is in
composer.json by himself. By this we keep everything clean and in the long-term
it is just the only option to keep the software healthy when it gets bigger.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>In addition: we can even self-host private modules in a
repository of the company and add them as packages. It’s not what we’ll do in
this course, but handy to know this is an option.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:21.9pt;
margin-left:-.25pt'>To update everything you run</p>

<p class=MsoNormal style='margin-top:0in;margin-right:10.6pt;margin-bottom:
23.05pt;margin-left:5.0pt;line-height:112%;background:#F8F8F8'><span
style='font-family:Consolas;color:#333333'>composer update</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:21.9pt;
margin-left:-.25pt'>To update one module only, go ahead and type</p>

<p class=MsoNormal style='margin-top:0in;margin-right:10.6pt;margin-bottom:
23.05pt;margin-left:5.0pt;line-height:112%;background:#F8F8F8'><span
style='font-family:Consolas;color:#333333'>composer update drupal/redirect</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>Some extra helpful commands can be found at <a
href="https://getcomposer.org/"><b><span style='color:#1155CC'>https://getcomposer.org</span></b></a><b>.
</b>It is powerful, stable and well maintained.</p>

<h3 style='margin-top:0in;margin-right:0in;margin-bottom:19.55pt;margin-left:
-.25pt'><a name="_Toc247021">Patching with composer</a></h3>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>Sometimes we need to patch a module. This is the workflow:
first we need an additional package for composer that makes patching possible.
A side note here: since drupal 8 and the use of composer and symfony we got
access to a broad ecosystem of php-contributors. This composer package, that
wasn’t specifically built for drupal, is an example.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:21.9pt;
margin-left:-.25pt'>In our terminal, we type:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:10.6pt;margin-bottom:
23.05pt;margin-left:5.0pt;line-height:112%;background:#F8F8F8'><span
style='font-family:Consolas;color:#333333'>composer require
cweagans/composer-patches</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>Then add this to the <b>composer.json </b>file in the
“extra” section:</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:1.75in'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
  height:1.75in'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#DD1144'>&quot;patches&quot;</span><span style='font-family:
  Consolas;color:#333333'>: {</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:4.3pt;margin-bottom:
  0in;margin-left:0in;text-indent:13.2pt;line-height:116%'><span
  style='font-family:Consolas;color:#333333'>&quot;drupal/redirect&quot;: {
  &quot;Duplicate button in the node&quot;: </span><span style='font-family:
  Consolas;color:#DD1144'>&quot;https://www.drupal.org/files/issues/2020-12-15/remove-duplicate-b
  utton.patch&quot;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:13.2pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-family:Consolas;color:#333333'>}</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:5.4pt;
margin-left:-.25pt'>Now run</p>

<p class=MsoNormal style='margin-top:0in;margin-right:10.6pt;margin-bottom:
6.65pt;margin-left:5.0pt;line-height:112%;background:#F8F8F8'><span
style='font-family:Consolas;color:#333333'>composer install</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:3.5pt;
margin-left:-.25pt'>again. It will remove the module, reïnstall it and let you
know if the patch was correctly applied.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:-1.7pt;margin-bottom:
24.25pt;margin-left:1.5pt;text-indent:0in;line-height:107%'><img border=0
width=602 height=225 id="Picture 785"
src="Learning%20drupal%209%20as%20a%20framework_files/image006.jpg"></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:2.1pt;
margin-left:-.25pt'>If you have created patches yourself, add a patch to a
folder you name <b>patches </b>in your root directory. Your patches section
would look like this:</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:93.0pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
  height:93.0pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#DD1144'>&quot;patches&quot;</span><span style='font-family:
  Consolas;color:#333333'>: {</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.1pt;
  margin-left:13.2pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>&quot;drupal/redirect&quot;: {</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:26.4pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>&quot;Fixing a PHP notice&quot;: </span><span
  style='font-family:Consolas;color:#DD1144'>&quot;patches/redirect-php-notice-fix.patch&quot;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:13.2pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-family:Consolas;color:#333333'>}</span></p>
  </td>
 </tr>
</table>

<h2 style='margin-top:0in;margin-right:0in;margin-bottom:3.35pt;margin-left:
-.25pt'><a name="_Toc247022">Git best practices</a></h2>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>Version control systems are software tools that help a
software team manage changes to source code over time. The current industry
standard is <a href="https://git-scm.com/"><span style='color:#1155CC'>Git</span></a>.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>This course will not be about best practices on git or how
to organize your git workflow in a team. But I’ll provide you some tips on how
to keep our repository small and clean.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>This section will not give you a git introduction, I assume
you know the very basics.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>I would always recommend using version control when
developing software. It is just one of the things you’ll heavily use for the
rest of your career as a software developer.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>In this section I’ll discuss what the best way of working
with git and drupal is.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:.75pt;
margin-left:-.25pt'>In the source code you’ll see there is a <b>.gitignore </b>file
that was added to our code. This file says to git which files need to be
ignored. Below you see the typical drupal folders we want to ignore.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:21.7pt;
margin-left:-.25pt'>The first section are all the directories that get
generated by Composer. Like was said in the previous section, composer helps us
to dramatically reduce our repository size:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:10.6pt;margin-bottom:
1.2pt;margin-left:5.0pt;line-height:107%;background:#F8F8F8'><i><span
style='font-family:Consolas;color:#333333'># Ignore directories generated by
Composer</span></i></p>

<p class=MsoNormal style='margin-top:0in;margin-right:10.6pt;margin-bottom:
.6pt;margin-left:5.0pt;line-height:112%;background:#F8F8F8'><span
style='font-family:Consolas;color:#333333'>/drush/contrib/</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:10.6pt;margin-bottom:
.6pt;margin-left:5.0pt;line-height:112%;background:#F8F8F8'><span
style='font-family:Consolas;color:#333333'>/vendor/</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:10.6pt;margin-bottom:
.6pt;margin-left:5.0pt;line-height:112%;background:#F8F8F8'><span
style='font-family:Consolas;color:#333333'>/web/core/</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:10.6pt;margin-bottom:
.6pt;margin-left:5.0pt;line-height:112%;background:#F8F8F8'><span
style='font-family:Consolas;color:#333333'>/web/modules/contrib/</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:10.6pt;margin-bottom:
.6pt;margin-left:5.0pt;line-height:112%;background:#F8F8F8'><span
style='font-family:Consolas;color:#333333'>/web/themes/contrib/</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:10.6pt;margin-bottom:
.6pt;margin-left:5.0pt;line-height:112%;background:#F8F8F8'><span
style='font-family:Consolas;color:#333333'>/web/profiles/contrib/</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:10.6pt;margin-bottom:
23.05pt;margin-left:5.0pt;line-height:112%;background:#F8F8F8'><span
style='font-family:Consolas;color:#333333'>/web/libraries/</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:21.9pt;
margin-left:-.25pt'>The second section contains all site specific data</p>

<p class=MsoNormal style='margin-top:0in;margin-right:5.3pt;margin-bottom:1.2pt;
margin-left:5.0pt;line-height:107%;background:#F8F8F8'><i><span
style='font-family:Consolas;color:#333333'># Site specific</span></i></p>

<p class=MsoNormal style='margin-top:0in;margin-right:5.3pt;margin-bottom:23.05pt;
margin-left:5.0pt;line-height:112%;background:#F8F8F8'><span style='font-family:
Consolas;color:#333333'>/web/sites/*</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>The following are my IDE files, of course I do not want
them in version control</p>

<p class=MsoNormal style='margin-top:0in;margin-right:5.3pt;margin-bottom:1.2pt;
margin-left:5.0pt;line-height:107%;background:#F8F8F8'><i><span
style='font-family:Consolas;color:#333333'># IDE specific</span></i></p>

<p class=MsoNormal style='margin-top:0in;margin-right:5.3pt;margin-bottom:23.05pt;
margin-left:5.0pt;line-height:112%;background:#F8F8F8'><span style='font-family:
Consolas;color:#333333'>/.idea</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:21.9pt;
margin-left:-.25pt'>Here are a few other typical things to ignore</p>

<p class=MsoNormal style='margin-top:0in;margin-right:10.6pt;margin-bottom:
1.2pt;margin-left:5.0pt;line-height:107%;background:#F8F8F8'><i><span
style='font-family:Consolas;color:#333333'># NPM packages &amp; theming related</span></i></p>

<p class=MsoNormal style='margin-top:0in;margin-right:10.6pt;margin-bottom:
.6pt;margin-left:5.0pt;line-height:112%;background:#F8F8F8'><span
style='font-family:Consolas;color:#333333'>/node_modules/</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:10.6pt;margin-bottom:
23.05pt;margin-left:5.0pt;line-height:112%;background:#F8F8F8'><span
style='font-family:Consolas;color:#333333'>*.css.map</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:30.4pt;
margin-left:-.25pt'>I would like to emphasize on how composer and git are the
two main ingredients for creating a whole new way of working in comparison with
the older drupal way.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:15.1pt;margin-bottom:
30.5pt;margin-left:14.0pt;line-height:110%;background:#FFD966'><span
style='font-size:11.0pt;line-height:110%'>Composer is key for downloading
packages and avoiding conflicts when upgrading, git is there for keeping track
of history in changes of our custom modules, configuration and theme code.</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>It’s time to move on to the next section.<br clear=all
style='page-break-before:always'>
</p>

<h2 style='margin-top:0in;margin-right:0in;margin-bottom:3.35pt;margin-left:
-.25pt'><a name="_Toc247023">CLI tools</a></h2>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'><a href="https://www.drush.org/latest/"><span
style='color:#1155CC'>Drush</span></a><u><span style='color:#1155CC'> </span></u>is
a command line shell and Unix scripting interface for Drupal. It is the most
used cli, and although there is a second and similar one, called <a
href="https://drupalconsole.com/"><span style='color:#1155CC'>drupal console</span></a>,
drush is the most popular by far.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:21.75pt;
margin-left:-.25pt'>You can start by adding drush  as a dependency in our <b>composer.json
</b>by requiring the package:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:10.6pt;margin-bottom:
23.05pt;margin-left:5.0pt;line-height:112%;background:#F8F8F8'><span
style='font-family:Consolas;color:#333333'>composer require drush/drush</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>A note here: if you are running your site in the sites
folder, and not the standard sites/default folder, or running a multi-site
installation you have to go to the sites folder of your installation.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:140.85pt;margin-bottom:
.8pt;margin-left:-.25pt;line-height:232%'>If your website is inside <b>web/sites/mysite</b>,
you would do <span style='font-family:Consolas;color:#333333;background:#F8F8F8'>cd
web/sites/mysite</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:21.9pt;
margin-left:-.25pt'>This way, drush knows which site you’re talking about. To
install a module</p>

<p class=MsoNormal style='margin-top:0in;margin-right:10.6pt;margin-bottom:
23.05pt;margin-left:5.0pt;line-height:112%;background:#F8F8F8'><span
style='font-family:Consolas;color:#333333'>drush en views</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>While drush is the “standard”, drupal console is
interesting in some cases as well. Because it was introduced with the adoption
of symfony, it is less opinionated about drupal than drush. Console is both a
building tool as a debug tool. There is a lot of similar functionality, but I
like to share this nice feature console has. You can get all information of a
route with a simple command.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>First:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:17.7pt;
margin-left:0in;text-indent:0in;line-height:107%'><span style='font-family:
Consolas;color:#333333;background:#F8F8F8'>Composer require drupal/console</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:21.9pt;
margin-left:-.25pt'>Debug a route like this:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:10.6pt;margin-bottom:
23.05pt;margin-left:5.0pt;line-height:112%;background:#F8F8F8'><span
style='font-family:Consolas;color:#333333'>drupal debug:router
entity.user_role.edit_form</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:5.4pt;
margin-left:-.25pt'>This will return:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:10.6pt;margin-bottom:
23.05pt;margin-left:12.35pt;line-height:112%;background:#F8F8F8'><span
style='font-family:Consolas;color:#333333'>Route          
entity.user_role.edit_form</span></p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:274.5pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
  height:274.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:6.6pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>Path           
  /admin/people/roles/manage/{user_role}</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:6.6pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>Defaults</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:13.2pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>_entity_form   user_role.default</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:13.2pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>_title         Edit role</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:6.6pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>Requirements</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:13.2pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>_entity_access user_role.update</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:109.85pt;margin-bottom:
  0in;margin-left:13.2pt;text-indent:-6.6pt;line-height:117%'><span
  style='font-family:Consolas;color:#333333'>Options compiler_class
  Drupal\Core\Routing\RouteCompiler utf8           1 parameters     user_role: </span><span
  style='font-family:Consolas;color:#0086B3'>type</span><span style='font-family:
  Consolas;color:#333333'>: </span><span style='font-family:Consolas;
  color:#DD1144'>'entity:user_role' </span><span style='font-family:Consolas;
  color:#333333'>converter:</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:17.7pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>drupal.proxy_original_service.paramconverter.configentity_admin</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:13.2pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>_admin_route   1</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:13.2pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>_access_checks access_check.entity</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>This is great. With one command, all of the routes info
gets returned.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:21.75pt;
margin-left:-.25pt'>Another example is debugging of services containers. Let’s
lookup all the service containers we can find for sessions:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:10.6pt;margin-bottom:
23.05pt;margin-left:5.0pt;line-height:112%;background:#F8F8F8'><span
style='font-family:Consolas;color:#333333'>drupal debug:container|grep session</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:0in;
margin-left:-.25pt'>This will return:</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=598
 style='width:448.5pt;margin-left:2.25pt;border-collapse:collapse'>
 <tr style='height:258.0pt'>
  <td width=598 style='width:448.5pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
  height:258.0pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:6.6pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>cache_context.session</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:6.6pt;text-indent:-6.6pt;line-height:116%'><span
  style='font-family:Consolas;color:#333333'>Drupal\Core\Cache\Context\SessionCacheContext
  cache_context.session.exists</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:6.6pt;text-indent:-6.6pt;line-height:116%'><span
  style='font-family:Consolas;color:#333333'>Drupal\Core\Cache\Context\SessionExistsCacheContext
  http_middleware.session</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:160.4pt;margin-bottom:
  0in;margin-left:6.6pt;text-indent:-6.6pt;line-height:116%'><span
  style='font-family:Consolas;color:#333333'>Drupal\Core\StackMiddleware\Session
  session</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:8.65pt;margin-bottom:
  0in;margin-left:6.6pt;text-indent:-6.6pt;line-height:116%'><span
  style='font-family:Consolas;color:#333333'>Symfony\Component\HttpFoundation\Session\Session
  session.flash_bag</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:6.6pt;text-indent:-6.6pt;line-height:116%'><span
  style='font-family:Consolas;color:#333333'>Symfony\Component\HttpFoundation\Session\Flash\FlashBag
  session_configuration</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:21.85pt;margin-bottom:
  0in;margin-left:6.6pt;text-indent:-6.6pt;line-height:116%'><span
  style='font-family:Consolas;color:#333333'>Drupal\Core\Session\SessionConfiguration
  session_handler.storage</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:41.65pt;margin-bottom:
  0in;margin-left:6.6pt;text-indent:-6.6pt;line-height:107%'><span
  style='font-family:Consolas;color:#333333'>Drupal\Core\Session\SessionHandler
  session_handler.write_safe</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:34.75pt;margin-bottom:
.4pt;margin-left:11.1pt;text-indent:-6.6pt;line-height:112%;background:#F8F8F8'><span
style='font-family:Consolas;color:#333333'>Drupal\Core\Session\WriteSafeSessionHandler
session_manager</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:34.75pt;margin-bottom:
.4pt;margin-left:11.1pt;text-indent:-6.6pt;line-height:112%;background:#F8F8F8'><span
style='font-family:Consolas;color:#333333'>Drupal\Core\Session\SessionManager
session_manager.metadata_bag</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:34.75pt;margin-bottom:
23.05pt;margin-left:5.0pt;line-height:112%;background:#F8F8F8'><span
style='font-family:Consolas;color:#333333'>Drupal\Core\Session\MetadataBag</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>Almost all of the things come from drupal core, but also
some are symfony components. Interesting, right? Digging a little makes the
layers more visible.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:.8pt;
margin-left:-.25pt'>Apart from debugging, we can use console to generate custom
modules, controllers, … etc.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>I’ll show this by generating a custom module called <b>offer,</b>,
the name of our platform. It will ask us a few things.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:21.9pt;
margin-left:-.25pt'>Fyi: the drupal console will always ask for a valid uri,
like</p>

<p class=MsoNormal style='margin-top:0in;margin-right:10.6pt;margin-bottom:
23.05pt;margin-left:5.0pt;line-height:112%;background:#F8F8F8'><span
style='font-family:Consolas;color:#333333'>drupal generate:module
--uri=mysite.test</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:2.1pt;
margin-left:-.25pt'>Let’s generate our first module:</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:340.5pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
  height:340.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:17.7pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>bash$ drupal generate:module --uri=mysite.test</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:17.7pt;
  margin-left:6.6pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>// Welcome to the Drupal module generator</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:6.6pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>Enter the new module name:</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:17.7pt;
  margin-left:6.6pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>&gt; Offer</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:6.6pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>Enter the module machine name [offer]:</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:17.7pt;
  margin-left:6.6pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>&gt;</span>&nbsp;</p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:6.6pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>Enter the module Path [sites/modules/custom]:</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:17.7pt;
  margin-left:6.6pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>&gt;</span>&nbsp;</p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:6.6pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>Enter module description [My Awesome Module]:</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:17.7pt;
  margin-left:6.6pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>&gt; Main module for the offer platform</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:6.6pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>Enter package name [Custom]:</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:222.0pt;margin-bottom:
  0in;margin-left:6.6pt;text-indent:0in;line-height:107%'><span
  style='font-family:Consolas;color:#333333'>&gt; Offer Enter Drupal Core
  version [9.x]:</span></p>
  </td>
 </tr>
 <tr style='height:7.25in'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
  height:7.25in'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:18.6pt;
  margin-left:6.6pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>&gt; 9.x</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:6.6pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>Do you want to generate a .module file? (yes/no)
  [yes]:</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:17.7pt;
  margin-left:6.6pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>&gt;</span>&nbsp;</p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:6.6pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>Define module as feature (yes/no) [no]:</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:18.6pt;
  margin-left:6.6pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>&gt; no</span></p>
  <p class=MsoNormal style='margin:0in;text-indent:6.6pt;line-height:116%'><span
  style='font-family:Consolas;color:#333333'>Do you want to add a composer.json
  file to your module? (yes/no) [yes]:</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:18.6pt;
  margin-left:6.6pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>&gt; no</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:50.5pt;margin-bottom:
  17.4pt;margin-left:6.6pt;text-indent:0in;line-height:116%'><span
  style='font-family:Consolas;color:#333333'>Would you like to add module
  dependencies? (yes/no) [no]: &gt; no</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:43.9pt;margin-bottom:
  17.4pt;margin-left:6.6pt;text-indent:0in;line-height:116%'><span
  style='font-family:Consolas;color:#333333'>Do you want to generate a unit </span><span
  style='font-family:Consolas;color:#0086B3'>test </span><span
  style='font-family:Consolas;color:#333333'>class? (yes/no) [yes]: &gt; no</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:6.6pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>Do you want to generate a themeable template?
  (yes/no) [yes]:</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:18.6pt;
  margin-left:6.6pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>&gt; no</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:43.9pt;margin-bottom:
  16.5pt;margin-left:6.6pt;text-indent:0in;line-height:116%'><span
  style='font-family:Consolas;color:#333333'>Do you want to proceed with the
  operation? (yes/no) [yes]: &gt; yes</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>Generated or updated files</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:6.6pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>Generation path: /var/www/html/web</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:19.8pt;text-indent:-13.2pt;line-height:107%'><span
  style='font-family:Consolas;color:#333333'>1<span style='font:7.0pt "Times New Roman"'>&nbsp;
  </span></span><span style='font-family:Consolas;color:#333333'>-
  /sites/modules/custom/offer/offer.info.yml</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:34.2pt;
  margin-left:19.8pt;text-indent:-13.2pt;line-height:107%'><span
  style='font-family:Consolas;color:#333333'>2<span style='font:7.0pt "Times New Roman"'>&nbsp;
  </span></span><span style='font-family:Consolas;color:#333333'>-
  /sites/modules/custom/offer/offer.module</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:6.6pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>Generated lines: 29</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>Some other commands you might find interesting:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:0in;
margin-left:-.25pt'>Creation of nodes:</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:109.5pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
  height:109.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.1pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>drupal create:nodes article \</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.1pt;
  margin-left:13.2pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>--</span><span style='font-family:Consolas;
  color:#0086B3'>limit</span><span style='font-family:Consolas;color:#333333'>=</span><span
  style='font-family:Consolas;color:#DD1144'>&quot;5&quot; </span><span
  style='font-family:Consolas;color:#333333'>\</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.1pt;
  margin-left:13.2pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>--title-words=</span><span style='font-family:Consolas;
  color:#DD1144'>&quot;5&quot; </span><span style='font-family:Consolas;
  color:#333333'>\</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:13.2pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>--time-range=</span><span style='font-family:Consolas;
  color:#DD1144'>&quot;1&quot; </span><span style='font-family:Consolas;
  color:#333333'>\</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:13.2pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>--revision \</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:13.2pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>--language=</span><span style='font-family:Consolas;
  color:#DD1144'>&quot;und&quot;</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:0in;
margin-left:-.25pt'>Exporting the configuration of a content type to a module</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:1.75in'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
  height:1.75in'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>drupal config:</span><span style='font-family:Consolas;
  color:#0086B3'>export</span><span style='font-family:Consolas;color:#333333'>:entity
  node_type page \</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:149.45pt;margin-bottom:
  .9pt;margin-left:0in;text-indent:13.2pt;line-height:116%'><span
  style='font-family:Consolas;color:#333333'>--module=</span><span
  style='font-family:Consolas;color:#DD1144'>&quot;demo&quot; </span><span
  style='font-family:Consolas;color:#333333'>drupal config:</span><span
  style='font-family:Consolas;color:#0086B3'>export</span><span
  style='font-family:Consolas;color:#333333'>:entity node_type page \</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:13.2pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>--module=</span><span style='font-family:Consolas;
  color:#DD1144'>&quot;demo&quot; </span><span style='font-family:Consolas;
  color:#333333'>\</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:13.2pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>--optional-config \</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:13.2pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>--remove-uuid \</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:13.2pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>--remove-config-hash</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:185.2pt;margin-bottom:
2.1pt;margin-left:-.25pt'>(more on configuration in a later chapter) Generate a
custom block:</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:175.5pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
  height:175.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.1pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>drupal generate:plugin:block  \</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.1pt;
  margin-left:13.2pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>--module=</span><span style='font-family:Consolas;
  color:#DD1144'>&quot;modulename&quot; </span><span style='font-family:Consolas;
  color:#333333'>\</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.1pt;
  margin-left:13.2pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>--class=</span><span style='font-family:Consolas;
  color:#DD1144'>&quot;DefaultBlock&quot; </span><span style='font-family:Consolas;
  color:#333333'>\</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.1pt;
  margin-left:13.2pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>--label=</span><span style='font-family:Consolas;
  color:#DD1144'>&quot;Default block&quot; </span><span style='font-family:
  Consolas;color:#333333'>\</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.1pt;
  margin-left:13.2pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>--plugin-id=</span><span style='font-family:Consolas;
  color:#DD1144'>&quot;default_block&quot; </span><span style='font-family:
  Consolas;color:#333333'>\</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:13.2pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>--theme-region=</span><span style='font-family:Consolas;
  color:#DD1144'>&quot;header&quot; </span><span style='font-family:Consolas;
  color:#333333'>\</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.1pt;
  margin-left:13.2pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>--inputs=</span><span style='font-family:Consolas;
  color:#DD1144'>'&quot;name&quot;:&quot;inputtext&quot;,
  &quot;type&quot;:&quot;text_format&quot;,</span></p>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:116%'><span
  style='font-family:Consolas;color:#DD1144'>&quot;label&quot;:&quot;InputText&quot;,
  &quot;options&quot;:&quot;&quot;, &quot;description&quot;:&quot;Just an input
  text&quot;, &quot;maxlength&quot;:&quot;&quot;,
  &quot;size&quot;:&quot;&quot;, &quot;default_value&quot;:&quot;&quot;,</span></p>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-family:Consolas;color:#DD1144'>&quot;weight&quot;:&quot;0&quot;,
  &quot;fieldset&quot;:&quot;&quot;'</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>In this course we will make a choice for drush. But we
discussed some interesting drupal console commands as well. Make sure you check
the official docs for more commands for console at <a
href="https://drupalconsole.com/docs"><span style='color:#1155CC'>https://drupalconsole.com/docs</span></a><u><span
style='color:#1155CC'> </span></u>and for drush at <a
href="https://www.drush.org/latest"><span style='color:#1155CC'>https://www.drush.org/latest</span></a></p>

<h2 style='margin-top:0in;margin-right:0in;margin-bottom:3.35pt;margin-left:
-.25pt'><a name="_Toc247024">Development &amp; debug</a></h2>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>In this section we’ll talk about debugging techniques
experts use while programming in drupal. These tools help you to get real deep
into the layers of the software, and will accelerate quick development of
custom modular development.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>We’ll discuss <b>Xcode </b>and <b>Webprofiler</b>, but
first some typical drupal development setup tricks.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:2.1pt;
margin-left:-.25pt'>You enable “development mode” for a drupal site like this
with console::</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:505.5pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
  height:505.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:17.7pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>bash-5.0$ drupal site:mode dev --uri=mysite.test</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:6.6pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>Configuration name: system.performance</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:13.2pt;text-indent:-6.6pt;line-height:122%'><span
  style='font-family:Consolas;color:#333333'>-------------------------
  ---------------- ---------------Configuration key         Original Value  
  Override Value</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:43.9pt;margin-bottom:
  0in;margin-left:13.2pt;text-indent:-6.6pt;line-height:122%'><span
  style='font-family:Consolas;color:#333333'>-------------------------
  ---------------- ---------------cache.page.use_internal  </span><span
  style='font-family:Consolas;color:teal'>false </span><span style='font-family:
  Consolas;color:#333333'>css.preprocess  </span><span style='font-family:Consolas;
  color:teal'>false false </span><span style='font-family:Consolas;color:#333333'>css.gzip </span><span
  style='font-family:Consolas;color:teal'>true false </span><span
  style='font-family:Consolas;color:#333333'>js.preprocess   </span><span
  style='font-family:Consolas;color:teal'>false false </span><span
  style='font-family:Consolas;color:#333333'>js.gzip   </span><span
  style='font-family:Consolas;color:teal'>true false </span><span
  style='font-family:Consolas;color:#333333'>response.gzip   </span><span
  style='font-family:Consolas;color:teal'>false</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:17.7pt;
  margin-left:6.6pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>------------------------- ----------------
  ----------------</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:6.6pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>Configuration name: views.settings</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:6.6pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>-------------------------------- ----------------</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.1pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>----------------</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%'>      </span><span style='font-family:Consolas;
  color:#333333'>Configuration key                Original Value    Override
  Value</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:4.3pt;margin-bottom:
  .9pt;margin-left:0in;text-indent:6.6pt;line-height:116%'><span
  style='font-family:Consolas;color:#333333'>--------------------------------
  -------------------------------</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:13.2pt;text-indent:0in;line-height:122%'><span style='font-family:
  Consolas;color:#333333'>ui.show.sql_query.enabled </span><span
  style='font-family:Consolas;color:teal'>false true </span><span
  style='font-family:Consolas;color:#333333'>ui.show.performance_statistics </span><span
  style='font-family:Consolas;color:teal'>false true</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:6.6pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>-------------------------------- ----------------</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:17.7pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>----------------</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:6.6pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>Configuration name: system.logging</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:6.6pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>------------------- ---------------- ----------------</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:13.2pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>Configuration key   Original Value   Override Value</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:10.9pt;margin-bottom:
  0in;margin-left:13.2pt;text-indent:-6.6pt;line-height:107%'><span
  style='font-family:Consolas;color:#333333'>-------------------
  ---------------- ---------------error_level         hide             all</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:10.6pt;margin-bottom:
34.45pt;margin-left:12.35pt;line-height:112%;background:#F8F8F8'><span
style='font-family:Consolas;color:#333333'>------------------- ----------------
----------------</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:10.6pt;margin-bottom:
33.5pt;margin-left:11.85pt;text-indent:6.6pt;line-height:112%;background:#F8F8F8'><span
style='font-family:Consolas;color:#333333'>Services files </span><span
style='font-family:Consolas;color:#DD1144'>&quot;/var/www/html/web/sites/mysite/services.yml&quot;
</span><span style='font-family:Consolas;color:#333333'>was overwritten</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:10.6pt;margin-bottom:
1.45pt;margin-left:12.35pt;line-height:112%;background:#F8F8F8'><span
style='font-family:Consolas;color:#333333'>New services settings</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:10.6pt;margin-bottom:
1.15pt;margin-left:18.45pt;text-indent:-6.6pt;line-height:112%;background:#F8F8F8'><span
style='font-family:Consolas;color:#333333'>------------------------------------------
------------- ------Service                                    Parameter Value</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:10.6pt;margin-bottom:
.15pt;margin-left:18.45pt;text-align:justify;text-justify:inter-ideograph;
text-indent:-6.6pt;line-height:121%;background:#F8F8F8'><span style='font-family:
Consolas;color:#333333'>------------------------------------------
------------- ------http.response.debug_cacheability_headers </span><span
style='font-family:Consolas;color:teal'>true </span><span style='font-family:
Consolas;color:#333333'>twig.config                                auto_reload </span><span
style='font-family:Consolas;color:teal'>true </span><span style='font-family:
Consolas;color:#333333'>twig.config                                cache </span><span
style='font-family:Consolas;color:teal'>false </span><span style='font-family:
Consolas;color:#333333'>twig.config                                debug </span><span
style='font-family:Consolas;color:teal'>true</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:10.6pt;margin-bottom:
33.6pt;margin-left:12.35pt;line-height:112%;background:#F8F8F8'><span
style='font-family:Consolas;color:#333333'>------------------------------------------
------------- -------</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:10.6pt;margin-bottom:
15.65pt;margin-left:12.35pt;line-height:238%;background:#F8F8F8'><span
style='font-family:Consolas;color:#333333'>// cache:rebuild Rebuilding
cache(s), </span><span style='font-family:Consolas;color:#0086B3'>wait </span><span
style='font-family:Consolas;color:#333333'>a moment please.</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:10.6pt;margin-bottom:
23.05pt;margin-left:12.35pt;line-height:112%;background:#F8F8F8'><span
style='font-family:Consolas;color:#333333'>[OK] Done clearing cache(s).</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:2.1pt;
margin-left:-.25pt'>Let’s take a look at the services.yml under sites/mysite:</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:109.5pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
  height:109.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.1pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>parameters:</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:17.5pt;margin-bottom:
  0in;margin-left:19.8pt;text-indent:0in;line-height:122%'><span
  style='font-family:Consolas;color:#DD1144'>http.response.debug_cacheability_headers:
  </span><span style='font-family:Consolas;color:teal'>true </span><span
  style='font-family:Consolas;color:#DD1144'>twig.config: { </span><span
  style='font-family:Consolas;color:#333333'>debug: </span><span
  style='font-family:Consolas;color:teal'>true</span><span style='font-family:
  Consolas;color:#DD1144'>, </span><span style='font-family:Consolas;
  color:#333333'>auto_reload: </span><span style='font-family:Consolas;
  color:teal'>true</span><span style='font-family:Consolas;color:#DD1144'>, </span><span
  style='font-family:Consolas;color:#333333'>cache: </span><span
  style='font-family:Consolas;color:teal'>false </span><span style='font-family:
  Consolas;color:#DD1144'>}</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:235.2pt;margin-bottom:
  0in;margin-left:19.8pt;text-indent:-19.8pt;line-height:122%'><span
  style='font-family:Consolas;color:#333333'>services: </span><span
  style='font-family:Consolas;color:#DD1144'>cache.backend.null: { </span><span
  style='font-family:Consolas;color:#333333'>class:</span></p>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-family:Consolas;color:#DD1144'>Drupal\Core\Cache\NullBackendFactory
  }</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>This will disable all entity caching and twig caching so we
do not have to bother about it while developing.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:21.9pt;
margin-left:-.25pt'>To re-enable production mode:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:10.6pt;margin-bottom:
23.05pt;margin-left:5.0pt;line-height:112%;background:#F8F8F8'><span
style='font-family:Consolas;color:#333333'>drupal site:mode prod
--uir=mysite.test</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:.95pt;
margin-left:-.25pt'>If you don’t want to use drupal console for this you can</p>

<p class=MsoNormal style='margin-top:0in;margin-right:40.15pt;margin-bottom:
17.4pt;margin-left:18.5pt;line-height:110%'><span style='font-family:"Arial",sans-serif'>&#9679;
</span>copy <b>example.settings.local.php </b>in <b>sites/ </b>folder to <b>settings.local.php
</b><span style='font-family:"Arial",sans-serif'>&#9679; </span>Put it in your <b>sites/mysite/
</b>folder.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:22.7pt;
margin-left:-.25pt'>After doing this, uncomment the following in <b>settings.php</b>:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:20.5pt;margin-bottom:
.75pt;margin-left:5.0pt;line-height:112%;background:#F8F8F8'><b><span
style='font-family:Consolas;color:#333333'>if </span></b><span
style='font-family:Consolas;color:#333333'>(file_exists($app_root . </span><span
style='font-family:Consolas;color:#DD1144'>'/' </span><span style='font-family:
Consolas;color:#333333'>. $site_path . </span><span style='font-family:Consolas;
color:#DD1144'>'/settings.local.php'</span><span style='font-family:Consolas;
color:#333333'>)) { <b>include </b>$app_root . </span><span style='font-family:
Consolas;color:#DD1144'>'/' </span><span style='font-family:Consolas;
color:#333333'>. $site_path . </span><span style='font-family:Consolas;
color:#DD1144'>'/settings.local.php'</span><span style='font-family:Consolas;
color:#333333'>;</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:20.5pt;margin-bottom:
23.05pt;margin-left:5.0pt;line-height:112%;background:#F8F8F8'><span
style='font-family:Consolas;color:#333333'>}</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:5.4pt;
margin-left:-.25pt'>And uncomment this:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:7.3pt;margin-bottom:.6pt;
margin-left:5.0pt;line-height:112%;background:#F8F8F8'><span style='font-family:
Consolas;color:#333333'>$settings[</span><span style='font-family:Consolas;
color:#DD1144'>'container_yamls'</span><span style='font-family:Consolas;
color:#333333'>][] = DRUPAL_ROOT .</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:7.3pt;margin-bottom:23.25pt;
margin-left:5.0pt;line-height:112%;background:#F8F8F8'><span style='font-family:
Consolas;color:#DD1144'>'/sites/development.services.yml'</span><span
style='font-family:Consolas;color:#333333'>;</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>The end result is the same as running development mode in
drupal console.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:.15pt;
margin-left:-.25pt'>More info about development set-up on the official
drupal.org website:</p>

<p class=MsoNormal style='margin-bottom:18.3pt;line-height:110%'><a
href="https://www.drupal.org/node/2598914"><span style='color:#1155CC'>https://www.drupal.org/node/2598914</span></a></p>

<h3 style='margin-top:0in;margin-right:0in;margin-bottom:19.55pt;margin-left:
-.25pt'><a name="_Toc247025">Xdebug</a></h3>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>A real eye opener for me after a few years of programming
with PHP was intercepting code with <b>Xdebug</b>. Most IDE’s have integration
with Xdebug.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>I use <a href="https://www.jetbrains.com/idea/"><span
style='color:#1155CC'>IntelliJ</span></a><u><span style='color:#1155CC'> </span></u>and
have <a href="https://xdebug.org/"><span style='color:#1155CC'>Xdebug</span></a><u><span
style='color:#1155CC'> </span></u>connected with the IDE. This way, I can put
my breakpoint anywhere in code and when I refresh the browser it intercepts the
request and it keeps hanging right at my breakpoint. From there, I can take a
look at my available variables, objects, etc.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:24.25pt;
margin-left:1.5pt;text-indent:0in;line-height:107%'><img border=0 width=599
height=514 id="Picture 241801"
src="Learning%20drupal%209%20as%20a%20framework_files/image007.gif"></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>The interceptor stops exactly where I set my breakpoint. In
my dummy line $a = ‘b’; I see that my $mail variable is correct. So I can
proceed coding further.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>This kind of debugging is not only great for variables or
objects. It can also give you a lot of knowledge about which stuff gets
rendered in which order.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:.95pt;
margin-left:-.25pt'>Some installation resources on debugging with Xdebug for
php:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.15pt;
margin-left:35.25pt;text-indent:-.25in;line-height:110%'><span
style='font-family:"Arial",sans-serif'>&#9679;<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><a href="https://xdebug.org/"><span style='color:#1155CC'>Xdebug.org</span></a></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.15pt;
margin-left:35.25pt;text-indent:-.25in;line-height:110%'><span
style='font-family:"Arial",sans-serif'>&#9679;<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><a
href="http://www.jetbrains.com/phpstorm/webhelp/configuring-xdebug.html"><span
style='color:#1155CC'>www.jetbrains.com/phpstorm/webhelp/configuring-xdebug.html</span></a></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.15pt;
margin-left:35.25pt;text-indent:-.25in;line-height:110%'><span
style='font-family:"Arial",sans-serif'>&#9679;<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><a
href="https://7thzero.com/blog/configure-phpstorm-for-local-php-web-application-debugging"><span
style='color:#1155CC'>https://7thzero.com/blog/configure-phpstorm-for-local-php-web-application-d
</span></a><a
href="https://7thzero.com/blog/configure-phpstorm-for-local-php-web-application-debugging"><span
style='color:#1155CC'>ebugging</span></a></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.15pt;
margin-left:35.25pt;text-indent:-.25in;line-height:110%'><span
style='font-family:"Arial",sans-serif'>&#9679;<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><a
href="https://www.jetbrains.com/help/phpstorm/debugging-with-phpstorm-ultimate-guide.html"><span
style='color:#1155CC'>https://www.jetbrains.com/help/phpstorm/debugging-with-phpstorm-ultimate
</span></a><a
href="https://www.jetbrains.com/help/phpstorm/debugging-with-phpstorm-ultimate-guide.html"><span
style='color:#1155CC'>-guide.html</span></a></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.15pt;
margin-left:35.25pt;text-indent:-.25in;line-height:110%'><span
style='font-family:"Arial",sans-serif'>&#9679;<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><a href="https://www.youtube.com/watch?v=rqDDJfG6ip4"><span
style='color:#1155CC'>https://www.youtube.com/watch?v=rqDDJfG6ip4</span></a><u><span
style='color:#1155CC'> </span></u>(Advanced Debugging in</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:36.5pt'>PhpStorm - PhpStorm Video Tutorial)</p>

<h3 style='margin-top:0in;margin-right:0in;margin-bottom:19.55pt;margin-left:
-.25pt'><a name="_Toc247026">Webprofiler</a></h3>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:21.75pt;
margin-left:-.25pt'>Drupal’s well known Devel module contains a toolbar
especially for developers. Let’s install the module and enable Webprofiler.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:10.6pt;margin-bottom:
23.05pt;margin-left:5.0pt;line-height:112%;background:#F8F8F8'><span
style='font-family:Consolas;color:#333333'>composer require drupal/devel</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:21.9pt;
margin-left:-.25pt'>Once you have devel, install it via /admin/modules or with
drush:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:10.6pt;margin-bottom:
23.05pt;margin-left:5.0pt;line-height:112%;background:#F8F8F8'><span
style='font-family:Consolas;color:#333333'>drush en devel webprofiler -y</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>After enabling the module, you’ll get a toolbar at the
bottom of your page on every request.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:3.5pt;
margin-left:-.25pt'>The  toolbar gives me a ton of information about the
current request. The one I use a lot is the Route name and Controller method
used:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:24.25pt;
margin-left:1.5pt;text-indent:0in;line-height:107%'><img border=0 width=532
height=139 id="Picture 1693"
src="Learning%20drupal%209%20as%20a%20framework_files/image008.jpg"></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>Take a look at the current controller. We can see what the
current controller name is, and which method is used.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>The “Devel menu”, the second button in the row, offers a
lot of options:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:24.25pt;
margin-left:1.5pt;text-indent:0in;line-height:107%'><img border=0 width=414
height=477 id="Picture 1703"
src="Learning%20drupal%209%20as%20a%20framework_files/image009.jpg"></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:3.35pt;
margin-left:-.25pt'>The “Routes info” page, for example, let’s you lookup any
registered route for debugging. This is the debug for the /admin/content page::</p>

<p class=MsoNormal style='margin-top:0in;margin-right:-1.7pt;margin-bottom:
0in;margin-left:1.5pt;text-indent:0in;line-height:107%'><img border=0
width=602 height=319 id="Picture 1705"
src="Learning%20drupal%209%20as%20a%20framework_files/image010.jpg"></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:.9pt;
margin-left:-.25pt'>On the <i>Configure </i>page of this submodule</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:30.5pt;
margin-left:-.25pt'>(<b>/admin/config/development/devel/webprofiler</b>) there
is even more information to display.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:15.1pt;margin-bottom:
0in;margin-left:14.0pt;line-height:110%;background:#FFD966'><span
style='font-size:11.0pt;line-height:110%'>In the webprofiler toolbar you can
check Events, Routing en Services. Click on an icon and go to the profiler
reports page. Click around to see all routes, events, etc. that are registered.</span><br
clear=all style='page-break-before:always'>
</p>

<h2 style='margin-top:0in;margin-right:0in;margin-bottom:3.35pt;margin-left:
-.25pt'><a name="_Toc247027">Configuration management</a></h2>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>Drupal 8 radically changed the way configuration is handled
in comparison with the previous versions. Because this is a rather important
topic to get, we start with some theoretical information on how drupal stores
its configuration.</p>

<h3 style='margin-top:0in;margin-right:0in;margin-bottom:32.8pt;margin-left:
-.25pt'><a name="_Toc247028">Basic configuration management</a></h3>

<p class=MsoNormal style='margin-top:0in;margin-right:15.1pt;margin-bottom:
31.25pt;margin-left:14.0pt;line-height:110%;background:#FFD966'><span
style='font-size:11.0pt;line-height:110%'>Drupal uses a standard format for all
site configuration—whether configuration of Drupal core components, or
installed modules. This means that Drupal configuration can be exported and
imported as YAML, which allows for staging of configuration changes, deploying
configuration between sites, and easy version control.</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:.65pt;
margin-left:-.25pt'>Since drupal 8 configuration and content are separated.
Configuration can be seen as literally ALL the settings of your platform. Some
examples:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:.95pt;
margin-left:.5in;text-indent:-.25in'><span style='font-family:"Arial",sans-serif'>&#9679;<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span>Site
name and slogan</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:.95pt;
margin-left:.5in;text-indent:-.25in'><span style='font-family:"Arial",sans-serif'>&#9679;<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span>Which
modules are enabled</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:.95pt;
margin-left:.5in;text-indent:-.25in'><span style='font-family:"Arial",sans-serif'>&#9679;<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span>The
settings of each module</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:.95pt;
margin-left:.5in;text-indent:-.25in'><span style='font-family:"Arial",sans-serif'>&#9679;<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span>Placement
of your blocks, block settings</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:.95pt;
margin-left:.5in;text-indent:-.25in'><span style='font-family:"Arial",sans-serif'>&#9679;<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span>All
your views settings</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:.95pt;
margin-left:.5in;text-indent:-.25in'><span style='font-family:"Arial",sans-serif'>&#9679;<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span>Your
entity types and fields</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:.95pt;
margin-left:.5in;text-indent:-.25in'><span style='font-family:"Arial",sans-serif'>&#9679;<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span>Your
google TagManager code</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:.5in;text-indent:-.25in'><span style='font-family:"Arial",sans-serif'>&#9679;<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span>…
and so on</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:3.35pt;
margin-left:-.25pt'>A visualisation of the difference in storing configuration
in drupal 8 + 9 in comparison with earlier versions. Drupal moved from
database-driven configuration in drupal 7 and earlier to configuration-driven
in drupal 8.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:-1.7pt;margin-bottom:
0in;margin-left:1.5pt;text-indent:0in;line-height:107%'><img border=0
width=602 height=239 id="Picture 1773"
src="Learning%20drupal%209%20as%20a%20framework_files/image011.jpg"></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:31.4pt;
margin-left:-.25pt'>The configuration storage exists of an Active store and a
Sync store. The <b>Active store </b>is the current configuration that exists in
your database. It can be different from the <b>Sync store</b>, which are
yaml-files in a directory. We use this to import and export configuration
between a development, staging and production version of websites.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:14.7pt;margin-bottom:
31.5pt;margin-left:14.75pt;line-height:112%;background:#FFD966'>Configuration
management is shipped with drupal core by the <b>config </b>module. It provides
import/export functionality for site configuration. Moreover it allows to <b>deploy
configuration from one environment to another</b>, provided they are the same
site.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:3.5pt;
margin-left:-.25pt'>We can export the configuration to yaml-files in a folder
we choose. I prefer to keep configuration in the root, so our root folder
becomes:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:24.25pt;
margin-left:1.5pt;text-indent:0in;line-height:107%'><img border=0 width=161
height=214 id="Picture 1829"
src="Learning%20drupal%209%20as%20a%20framework_files/image012.jpg"></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:21.9pt;
margin-left:-.25pt'>We define the configuration folder in <b>settings.php</b>..
Look for the</p>

<p class=MsoNormal style='margin-top:0in;margin-right:4.0pt;margin-bottom:22.45pt;
margin-left:5.0pt;line-height:112%;background:#F8F8F8'><span style='font-family:
Consolas;color:#333333'>$settings[</span><span style='font-family:Consolas;
color:#DD1144'>'config_sync_directory'</span><span style='font-family:Consolas;
color:#333333'>]</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:22.75pt;
margin-left:-.25pt'>and set it to:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:4.0pt;margin-bottom:23.25pt;
margin-left:5.0pt;line-height:112%;background:#F8F8F8'><span style='font-family:
Consolas;color:#333333'>$settings[</span><span style='font-family:Consolas;
color:#DD1144'>'config_sync_directory'</span><span style='font-family:Consolas;
color:#333333'>] = </span><span style='font-family:Consolas;color:#DD1144'>'../config/global'</span><span
style='font-family:Consolas;color:#333333'>;</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:21.75pt;
margin-left:-.25pt'>Export all our current configuration with drush (drush cex
is an alias for drush config-export)::</p>

<p class=MsoNormal style='margin-top:0in;margin-right:10.6pt;margin-bottom:
23.05pt;margin-left:5.0pt;line-height:112%;background:#F8F8F8'><span
style='font-family:Consolas;color:#333333'>drush cex</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:3.35pt;
margin-left:-.25pt'>Your terminal will return an overview of all the
differences between your active storage (your database) and your sync storage
(your config folder). Because your config folder is currently empty, it will
list every setting your website has.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:-1.7pt;margin-bottom:
24.25pt;margin-left:1.5pt;text-indent:0in;line-height:107%'><img border=0
width=602 height=448 id="Picture 1868"
src="Learning%20drupal%209%20as%20a%20framework_files/image013.jpg"></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:22.75pt;
margin-left:-.25pt'>Answer with ‘yes’ or hit Enter key.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:10.6pt;margin-bottom:
36.2pt;margin-left:4.5pt;text-indent:6.6pt;line-height:112%;background:#F8F8F8'><b><span
style='font-family:Consolas;color:#008800'>[success] </span></b><span
style='font-family:Consolas;color:#333333'>Configuration successfully exported
to ../config/global.</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:15.1pt;margin-bottom:
32.35pt;margin-left:14.0pt;line-height:110%;background:#FFD966'><span
style='font-size:11.0pt;line-height:110%'>Our config folder now contains all
the configuration our website has. If we’d create a clean drupal installation
with the same composer file and config folder, run ‘composer install’ and
import our configuration we have a complete software platform with all
functionalities ready. Except for the content, but we will use a custom drush
command for that.</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>We use configuration management for bringing configuration
from <b>website staging </b>to <b>website production</b>. Below is a schematic
representation of the configuration management process:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:-1.7pt;margin-bottom:
24.25pt;margin-left:1.5pt;text-indent:0in;line-height:107%'><img border=0
width=602 height=185 id="Picture 1932"
src="Learning%20drupal%209%20as%20a%20framework_files/image014.jpg"></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:2.1pt;
margin-left:-.25pt'>The structure of a configuration file, for example <b>system.site.yml</b>,
looks like this:</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:142.5pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
  height:142.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:169.25pt;margin-bottom:
  .2pt;margin-left:0in;text-indent:0in;line-height:121%'><span
  style='font-family:Consolas;color:#333333'>uuid: </span><span
  style='font-family:Consolas;color:#DD1144'>e4a14ea3-a3fc-4e6f-b11a-e14fe1d8xxx
  </span><span style='font-family:Consolas;color:#333333'>name: </span><span
  style='font-family:Consolas;color:#DD1144'>Offer platform </span><span
  style='font-family:Consolas;color:#333333'>mail: </span><span
  style='font-family:Consolas;color:#DD1144'>noreply@offerplatform.mysite </span><span
  style='font-family:Consolas;color:#333333'>slogan: </span><span
  style='font-family:Consolas;color:#DD1144'>'' </span><span style='font-family:
  Consolas;color:#333333'>page:</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:307.8pt;margin-bottom:
  0in;margin-left:13.2pt;text-indent:0in;line-height:107%'><span
  style='font-family:Consolas;color:teal'>403</span><span style='font-family:
  Consolas;color:#DD1144'>: '' </span><span style='font-family:Consolas;
  color:teal'>404</span><span style='font-family:Consolas;color:#DD1144'>: '' </span><span
  style='font-family:Consolas;color:#333333'>front: </span><span
  style='font-family:Consolas;color:#DD1144'>/user/login</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:21.7pt;
margin-left:-.25pt'>Let’s change the slogan and see what happens. We can log in
and fill it in at <b>/admin/config/system/site-information</b>, but we can also
do it in the terminal with drush:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:10.6pt;margin-bottom:
36.35pt;margin-left:5.0pt;line-height:112%;background:#F8F8F8'><span
style='font-family:Consolas;color:#333333'>bash$ drush cset system.site slogan=</span><span
style='font-family:Consolas;color:#DD1144'>'Offer platform'</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:15.1pt;margin-bottom:
35.75pt;margin-left:14.0pt;line-height:110%;background:#FFD966'><span
style='font-size:11.0pt;line-height:110%'>Note that this change only lives in
the database (active store) for now. For every change we make, we have to make
sure that if you like to keep the change or move the change to production you
have to export the configuration to the config folder (sync store).</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:10.6pt;margin-bottom:
23.05pt;margin-left:5.0pt;line-height:112%;background:#F8F8F8'><span
style='font-family:Consolas;color:#333333'>drupal cex</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:21.9pt;
margin-left:-.25pt'>In production we can then run:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:10.6pt;margin-bottom:
23.05pt;margin-left:5.0pt;line-height:112%;background:#F8F8F8'><span
style='font-family:Consolas;color:#333333'>drupal cim</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:-1.7pt;margin-bottom:
24.25pt;margin-left:1.5pt;text-indent:0in;line-height:107%'><img border=0
width=602 height=419 id="Picture 1971"
src="Learning%20drupal%209%20as%20a%20framework_files/image015.jpg"></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:30.4pt;
margin-left:-.25pt'>Putting configuration in yaml files is a smart thing to do.
By running a config import command on production, all the new settings get
imported and the site is updated. A huge improvement with earlier drupal
versions, where we would have to do pretty advanced stuff for something simple
as updating some settings.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:15.1pt;margin-bottom:
27.85pt;margin-left:14.0pt;line-height:110%;background:#FFD966'><span
style='font-size:11.0pt;line-height:110%'>This may look a very easy example,
but it is an extremely scalable functionality. Whether it is only a simple
change like a site name, or multiple entities, fields and module settings,
configuration management will do the heavy lifting.</span></p>

<h3 style='margin-top:0in;margin-right:0in;margin-bottom:19.8pt;margin-left:
-.25pt'><a name="_Toc247029">Creating custom configuration settings</a></h3>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:.3in;
margin-left:-.25pt'>Drupal core and (almost) every module come with
configuration files. Most of these have settings that can be edited in the <b>/admin/config
</b>section of the site. Let’s add a custom settings form for a Google
Tagmanager code, a typical thing we would like to have on a software platform.
If you use drupal console you can do the following:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:10.6pt;margin-bottom:
23.05pt;margin-left:5.0pt;line-height:112%;background:#F8F8F8'><span
style='font-family:Consolas;color:#333333'>bash$ drupal generate:form:config
--uri=mysite.local</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:17.4pt;
margin-left:-.25pt;line-height:112%'><span style='color:#333333'>First, add a
module to <b>custom/modules </b>with the following structure:</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.1pt;
margin-left:18.5pt;line-height:112%'><span style='font-family:"Arial",sans-serif;
color:#333333'>&#9679; </span><span style='color:#333333'>offer</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:17.4pt;
margin-left:54.5pt;line-height:112%'><span style='font-family:"Arial",sans-serif;
color:#333333'>&#9675; </span><span style='color:#333333'>offer.info.yml</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:5.2pt;
margin-left:-.25pt;line-height:112%'><span style='color:#333333'>In the <b>offer.info.yml
</b>file, add:</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:185.8pt;margin-bottom:
.8pt;margin-left:5.0pt;line-height:111%;background:#F8F8F8'><span
style='font-size:11.0pt;line-height:111%;font-family:Consolas;color:#333333'>name:
</span><span style='font-size:11.0pt;line-height:111%;font-family:Consolas;
color:#DD1144'>offer </span><span style='font-size:11.0pt;line-height:111%;
font-family:Consolas;color:#333333'>type: </span><span style='font-size:11.0pt;
line-height:111%;font-family:Consolas;color:#DD1144'>module </span><span
style='font-size:11.0pt;line-height:111%;font-family:Consolas;color:#333333'>description:
</span><span style='font-size:11.0pt;line-height:111%;font-family:Consolas;
color:#DD1144'>offer entity </span><span style='font-size:11.0pt;line-height:
111%;font-family:Consolas;color:#333333'>core: </span><span style='font-size:
11.0pt;line-height:111%;font-family:Consolas;color:teal'>8.</span><span
style='font-size:11.0pt;line-height:111%;font-family:Consolas;color:#DD1144'>x</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:185.8pt;margin-bottom:
23.3pt;margin-left:5.0pt;line-height:111%;background:#F8F8F8'><span
style='font-size:11.0pt;line-height:111%;font-family:Consolas;color:#333333'>core_version_requirement:
</span><span style='font-size:11.0pt;line-height:111%;font-family:Consolas;
color:#DD1144'>^8 || ^9</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:21.9pt;
margin-left:-.25pt'>Enable the module with drush:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:10.6pt;margin-bottom:
1.45pt;margin-left:8.65pt;line-height:112%;background:#F8F8F8'><span
style='font-family:Consolas;color:#333333'>bash$ drush en offer -y</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:10.6pt;margin-bottom:
23.05pt;margin-left:8.65pt;line-height:112%;background:#F8F8F8'><span
style='font-family:Consolas;color:#008800'>[success] </span><span
style='font-family:Consolas;color:#333333'>Successfully enabled: offer</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>We add a file <b>offer/src/Form/CustomConfigForm.php </b>to
build the configform. I started from a default extension of <i>ConfigFormBase()
</i>and made sure the value gets saved to the right configuration file key in
the submitForm() function.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>To the <i>buildForm() </i>method I add a section for saving
a textarea with a snippet.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:2.1pt;
margin-left:-.25pt'>The final code of our form:</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:295.5pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
  height:295.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:270.5pt;margin-bottom:
  0in;margin-left:0in;text-indent:6.05pt;line-height:230%'><span
  style='font-size:11.0pt;line-height:230%;font-family:Consolas;color:#333333'>&lt;?php
  namespace Drupal\offer\Form;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:2.75in;margin-bottom:
  15.0pt;margin-left:0in;text-indent:0in;line-height:115%'><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>use
  Drupal\Core\Form\ConfigFormBase; use Drupal\Core\Form\FormStateInterface;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>/**</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:18.15pt;text-indent:-12.1pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>Class
  CustomConfigForm.</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:155.7pt;margin-bottom:
  15.0pt;margin-left:0in;text-indent:0in;line-height:115%'><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>*/
  class CustomConfigForm extends ConfigFormBase {</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>/**</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:18.15pt;text-indent:-12.1pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>{@inheritdoc}</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:161.75pt;margin-bottom:
  0in;margin-left:6.05pt;text-indent:6.05pt;line-height:121%'><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>*/
  protected <b>function </b></span><b><span style='font-size:11.0pt;line-height:
  121%;font-family:Consolas;color:#990000'>getEditableConfigNames</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>()
  { </span><span style='font-size:11.0pt;line-height:121%;font-family:Consolas;
  color:#0086B3'>return </span><span style='font-size:11.0pt;line-height:121%;
  font-family:Consolas;color:#333333'>[</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:30.2pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'offer.customconfig'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>,</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>];</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.55pt;margin-bottom:0in;
margin-left:-1.0in;text-indent:0in;line-height:107%'>&nbsp;</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:670.5pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
  height:670.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:15.95pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>/**</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:24.2pt;text-indent:-12.1pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>{@inheritdoc}</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:252.4pt;margin-bottom:
  0in;margin-left:6.05pt;text-indent:6.05pt;line-height:121%'><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>*/
  public <b>function </b></span><b><span style='font-size:11.0pt;line-height:
  121%;font-family:Consolas;color:#990000'>getFormId</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>()
  { </span><span style='font-size:11.0pt;line-height:121%;font-family:Consolas;
  color:#0086B3'>return </span><span style='font-size:11.0pt;line-height:121%;
  font-family:Consolas;color:#DD1144'>'custom_config_form'</span><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:15.95pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>/**</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:24.2pt;text-indent:-12.1pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>{@inheritdoc}</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:10.65pt;margin-bottom:
  0in;margin-left:6.05pt;text-indent:6.05pt;line-height:121%'><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>*/
  public <b>function </b>buildForm(array </span><span style='font-size:11.0pt;
  line-height:121%;font-family:Consolas;color:teal'>$form</span><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>,
  FormStateInterface </span><span style='font-size:11.0pt;line-height:121%;
  font-family:Consolas;color:teal'>$form_state</span><span style='font-size:
  11.0pt;line-height:121%;font-family:Consolas;color:#333333'>)</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>{</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:15.95pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:teal'>$config </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>=
  </span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:teal'>$this</span><span style='font-size:11.0pt;line-height:107%;
  font-family:Consolas;color:#333333'>-&gt;config(</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'offer.customconfig'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>);</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:teal'>$form</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>[</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'analytics'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>]
  = array(</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:30.2pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'#type' </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>=&gt;
  </span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#DD1144'>'details'</span><span style='font-size:11.0pt;line-height:
  107%;font-family:Consolas;color:#333333'>,</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:30.2pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'#title' </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>=&gt;
  </span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:teal'>$this</span><span style='font-size:11.0pt;line-height:107%;
  font-family:Consolas;color:#333333'>-&gt;t(</span><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'Marketing &amp;
  analytics'</span><span style='font-size:11.0pt;line-height:107%;font-family:
  Consolas;color:#333333'>),</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:30.2pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'#open' </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>=&gt;
  TRUE,</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>);</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:teal'>$form</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>[</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'analytics'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>][</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'tagmanager'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>]
  = [</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:30.2pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'#type' </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>=&gt;
  </span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#DD1144'>'textarea'</span><span style='font-size:11.0pt;line-height:
  107%;font-family:Consolas;color:#333333'>,</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:30.2pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'#title' </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>=&gt;
  </span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:teal'>$this</span><span style='font-size:11.0pt;line-height:107%;
  font-family:Consolas;color:#333333'>-&gt;t(</span><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'Tagmanager code'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>),</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:30.2pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'#default_value' </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>=&gt;
  </span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:teal'>$config</span><span style='font-size:11.0pt;line-height:107%;
  font-family:Consolas;color:#333333'>-&gt;get(</span><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'tagmanager'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>),</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:30.2pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'#maxlength' </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>=&gt;
  NULL,</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:16.8pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>];</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#0086B3'>return </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>parent::buildForm(</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:teal'>$form</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>,
  </span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:teal'>$form_state</span><span style='font-size:11.0pt;line-height:107%;
  font-family:Consolas;color:#333333'>);</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:15.95pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>/**</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>* {@inheritdoc}</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:77.1pt;margin-bottom:
  0in;margin-left:6.05pt;text-indent:6.05pt;line-height:121%'><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>*/
  public <b>function </b>submitForm(array &amp;</span><span style='font-size:
  11.0pt;line-height:121%;font-family:Consolas;color:teal'>$form</span><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>,
  FormStateInterface</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:185.9pt;margin-bottom:
  14.2pt;margin-left:18.15pt;text-indent:-18.15pt;line-height:121%'><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:teal'>$form_state</span><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>)
  { parent::submitForm(</span><span style='font-size:11.0pt;line-height:121%;
  font-family:Consolas;color:teal'>$form</span><span style='font-size:11.0pt;
  line-height:121%;font-family:Consolas;color:#333333'>, </span><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:teal'>$form_state</span><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>);</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:teal'>$this</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>-&gt;config(</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'offer.customconfig'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>)</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:30.2pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>-&gt;</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#0086B3'>set</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>(</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'tagmanager'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>,
  </span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:teal'>$form_state</span><span style='font-size:11.0pt;line-height:107%;
  font-family:Consolas;color:#333333'>-&gt;getValue(</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'tagmanager'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>))</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:30.2pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>-&gt;save();</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:15.95pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:21.9pt;
margin-left:-.25pt'>We now need to add <b>offer.links.menu.yml </b>to add the
menu links in our back-end:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:50.15pt;margin-bottom:
1.45pt;margin-left:8.65pt;line-height:112%;background:#F8F8F8'><span
style='font-family:Consolas;color:#333333'>offer.config:</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:50.15pt;margin-bottom:
23.05pt;margin-left:8.65pt;line-height:112%;background:#F8F8F8'><span
style='font-family:Consolas;color:#333333'>title: </span><span
style='font-family:Consolas;color:#DD1144'>'Offer global settings' </span><span
style='font-family:Consolas;color:#333333'>route_name: offer.config
description: </span><span style='font-family:Consolas;color:#DD1144'>'Global
settings for the offer platform' </span><span style='font-family:Consolas;
color:#333333'>parent: system.admin_config_system weight: 99</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:2.1pt;
margin-left:-.25pt'>Then add a <b>offer.routing.yml </b>file to register the
controller and route to the form:</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:1.75in'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
  height:1.75in'>
  <p class=MsoNormal style='margin-top:0in;margin-right:162.65pt;margin-bottom:
  .45pt;margin-left:6.6pt;text-indent:-6.6pt;line-height:119%'><span
  style='font-family:Consolas;color:#333333'>offer.config: path: </span><span
  style='font-family:Consolas;color:#DD1144'>'/admin/config/offer/adminsettings'
  </span><span style='font-family:Consolas;color:#333333'>defaults:</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.1pt;
  margin-left:19.8pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>_form: </span><span style='font-family:Consolas;
  color:#DD1144'>'\Drupal\offer\Form\CustomConfigForm'</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:70.25pt;margin-bottom:
  .9pt;margin-left:6.6pt;text-indent:13.2pt;line-height:116%'><span
  style='font-family:Consolas;color:#333333'>_title: </span><span
  style='font-family:Consolas;color:#DD1144'>'Offer platform global settings' </span><span
  style='font-family:Consolas;color:#333333'>requirements:</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:19.8pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>_permission: </span><span style='font-family:Consolas;
  color:#DD1144'>'administer site configuration'</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:.05in;
margin-left:-.25pt'>Clear caches and head over to <b>/admin/config</b></p>

<p class=MsoNormal style='margin-top:0in;margin-right:-1.7pt;margin-bottom:
24.25pt;margin-left:1.5pt;text-indent:0in;line-height:107%'><img border=0
width=602 height=309 id="Picture 2326"
src="Learning%20drupal%209%20as%20a%20framework_files/image016.jpg"></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>We see our custom menu link appearing under the “system”
section. When we click we see our form:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:-1.7pt;margin-bottom:
24.25pt;margin-left:1.5pt;text-indent:0in;line-height:107%'><img border=0
width=601 height=336 id="Picture 2377"
src="Learning%20drupal%209%20as%20a%20framework_files/image017.jpg"></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>When we save a value and export our configuration, we’ll
see a file called <b>offer.customconfig.yml </b>containing a key: ‘tagmanager’.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>Note that we could add a <b>config/install </b>folder to
the offer module. This way, we can add a default setting for our tagmanager
when enabling the module here. This is optional.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>Creating custom configuration gives good insight in the
behavior of configuration. It is possible to create modules with prepared
configuration files shipped in its config folder.</p>

<h3 style='margin-top:0in;margin-right:0in;margin-bottom:19.55pt;margin-left:
-.25pt'><a name="_Toc247030">Different configuration per environment</a></h3>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>Because configuration management is the backbone of a good
deployment process we need to dig a little deeper into the possibilities.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>We talked about the Webprofiler module in an earlier
section. This is typically something we only want in a development environment.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:1.85pt;
margin-left:-.25pt'>But there are more use cases where difference between
configuration matters. Here are four examples. Note that in reality we would
have a staging environment as well, but let’s assume we only have development
and production:</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=603
 style='width:452.15pt;margin-left:.4pt;border-collapse:collapse'>
 <tr style='height:26.9pt'>
  <td width=31 valign=top style='width:23.15pt;border:solid #BF9000 1.0pt;
  background:#BF9000;padding:0in 5.75pt 0in 6.25pt;height:26.9pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:8.0pt;
  margin-left:0in;text-indent:0in;line-height:107%'>&nbsp;</p>
  </td>
  <td width=152 style='width:114.0pt;border:solid #BF9000 1.0pt;border-left:
  none;background:#BF9000;padding:0in 5.75pt 0in 6.25pt;height:26.9pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  10.0pt;line-height:107%'>Functionality</span></p>
  </td>
  <td width=133 style='width:100.0pt;border:solid #BF9000 1.0pt;border-left:
  none;background:#BF9000;padding:0in 5.75pt 0in 6.25pt;height:26.9pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  10.0pt;line-height:107%'>Environment:</span></p>
  </td>
  <td width=132 style='width:99.0pt;border:solid #BF9000 1.0pt;border-left:
  none;background:#BF9000;padding:0in 5.75pt 0in 6.25pt;height:26.9pt'>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-size:10.0pt;line-height:107%'>Environment:</span></p>
  </td>
  <td width=155 style='width:116.0pt;border:solid #BF9000 1.0pt;border-left:
  none;background:#BF9000;padding:0in 5.75pt 0in 6.25pt;height:26.9pt'>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-size:10.0pt;line-height:107%'>Solution</span></p>
  </td>
 </tr>
 <tr style='height:26.15pt'>
  <td width=31 valign=top style='width:23.15pt;border:solid #BF9000 1.0pt;
  border-top:none;background:#BF9000;padding:0in 5.75pt 0in 6.25pt;height:26.15pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:8.0pt;
  margin-left:0in;text-indent:0in;line-height:107%'>&nbsp;</p>
  </td>
  <td width=152 valign=top style='width:114.0pt;border-top:none;border-left:
  none;border-bottom:solid #BF9000 1.0pt;border-right:solid #BF9000 1.0pt;
  background:#BF9000;padding:0in 5.75pt 0in 6.25pt;height:26.15pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:8.0pt;
  margin-left:0in;text-indent:0in;line-height:107%'>&nbsp;</p>
  </td>
  <td width=133 style='width:100.0pt;border-top:none;border-left:none;
  border-bottom:solid #BF9000 1.0pt;border-right:solid #BF9000 1.0pt;
  background:#BF9000;padding:0in 5.75pt 0in 6.25pt;height:26.15pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  10.0pt;line-height:107%'>Development</span></p>
  </td>
  <td width=132 style='width:99.0pt;border-top:none;border-left:none;
  border-bottom:solid #BF9000 1.0pt;border-right:solid #BF9000 1.0pt;
  background:#BF9000;padding:0in 5.75pt 0in 6.25pt;height:26.15pt'>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-size:10.0pt;line-height:107%'>Production</span></p>
  </td>
  <td width=155 valign=top style='width:116.0pt;border-top:none;border-left:
  none;border-bottom:solid #BF9000 1.0pt;border-right:solid #BF9000 1.0pt;
  background:#BF9000;padding:0in 5.75pt 0in 6.25pt;height:26.15pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:8.0pt;
  margin-left:0in;text-indent:0in;line-height:107%'>&nbsp;</p>
  </td>
 </tr>
 <tr style='height:38.0pt'>
  <td width=31 valign=top style='width:23.15pt;border:solid #BF9000 1.0pt;
  border-top:none;background:#FFE599;padding:0in 5.75pt 0in 6.25pt;height:38.0pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:.15pt;text-indent:0in;line-height:107%'><b><span
  style='font-size:10.0pt;line-height:107%'>A</span></b></p>
  </td>
  <td width=152 valign=top style='width:114.0pt;border-top:none;border-left:
  none;border-bottom:solid #BF9000 1.0pt;border-right:solid #BF9000 1.0pt;
  background:#FFE599;padding:0in 5.75pt 0in 6.25pt;height:38.0pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  10.0pt;line-height:107%'>Devel + Webprofiler</span></p>
  </td>
  <td width=133 valign=top style='width:100.0pt;border-top:none;border-left:
  none;border-bottom:solid #BF9000 1.0pt;border-right:solid #BF9000 1.0pt;
  background:#FFE599;padding:0in 5.75pt 0in 6.25pt;height:38.0pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  10.0pt;line-height:107%'>Enabled</span></p>
  </td>
  <td width=132 valign=top style='width:99.0pt;border-top:none;border-left:
  none;border-bottom:solid #BF9000 1.0pt;border-right:solid #BF9000 1.0pt;
  background:#FFE599;padding:0in 5.75pt 0in 6.25pt;height:38.0pt'>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-size:10.0pt;line-height:107%'>Disabled</span></p>
  </td>
  <td width=155 style='width:116.0pt;border-top:none;border-left:none;
  border-bottom:solid #BF9000 1.0pt;border-right:solid #BF9000 1.0pt;
  background:#FFE599;padding:0in 5.75pt 0in 6.25pt;height:38.0pt'>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-size:10.0pt;line-height:107%'>Settings.php (config exclude)</span></p>
  </td>
 </tr>
 <tr style='height:50.0pt'>
  <td width=31 valign=top style='width:23.15pt;border:solid #BF9000 1.0pt;
  border-top:none;background:#FFE599;padding:0in 5.75pt 0in 6.25pt;height:50.0pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:.15pt;text-indent:0in;line-height:107%'><b><span
  style='font-size:10.0pt;line-height:107%'>B</span></b></p>
  </td>
  <td width=152 valign=top style='width:114.0pt;border-top:none;border-left:
  none;border-bottom:solid #BF9000 1.0pt;border-right:solid #BF9000 1.0pt;
  background:#FFE599;padding:0in 5.75pt 0in 6.25pt;height:50.0pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  10.0pt;line-height:107%'>Caching</span></p>
  </td>
  <td width=133 valign=top style='width:100.0pt;border-top:none;border-left:
  none;border-bottom:solid #BF9000 1.0pt;border-right:solid #BF9000 1.0pt;
  background:#FFE599;padding:0in 5.75pt 0in 6.25pt;height:50.0pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  10.0pt;line-height:107%'>Disabled</span></p>
  </td>
  <td width=132 valign=top style='width:99.0pt;border-top:none;border-left:
  none;border-bottom:solid #BF9000 1.0pt;border-right:solid #BF9000 1.0pt;
  background:#FFE599;padding:0in 5.75pt 0in 6.25pt;height:50.0pt'>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-size:10.0pt;line-height:107%'>Enabled</span></p>
  </td>
  <td width=155 style='width:116.0pt;border-top:none;border-left:none;
  border-bottom:solid #BF9000 1.0pt;border-right:solid #BF9000 1.0pt;
  background:#FFE599;padding:0in 5.75pt 0in 6.25pt;height:50.0pt'>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-size:10.0pt;line-height:107%'>developer.services.yml file +
  settings.php (settings override)</span></p>
  </td>
 </tr>
 <tr style='height:50.9pt'>
  <td width=31 valign=top style='width:23.15pt;border:solid #BF9000 1.0pt;
  border-top:none;background:#FFE599;padding:0in 5.75pt 0in 6.25pt;height:50.9pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:.15pt;text-indent:0in;line-height:107%'><b><span
  style='font-size:10.0pt;line-height:107%'>C</span></b></p>
  </td>
  <td width=152 valign=top style='width:114.0pt;border-top:none;border-left:
  none;border-bottom:solid #BF9000 1.0pt;border-right:solid #BF9000 1.0pt;
  background:#FFE599;padding:0in 5.75pt 0in 6.25pt;height:50.9pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  10.0pt;line-height:107%'>Webform module and webforms fields</span></p>
  </td>
  <td width=133 style='width:100.0pt;border-top:none;border-left:none;
  border-bottom:solid #BF9000 1.0pt;border-right:solid #BF9000 1.0pt;
  background:#FFE599;padding:0in 5.75pt 0in 6.25pt;height:50.9pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  10.0pt;line-height:107%'>Enabled, bit not saved as configuration</span></p>
  </td>
  <td width=132 style='width:99.0pt;border-top:none;border-left:none;
  border-bottom:solid #BF9000 1.0pt;border-right:solid #BF9000 1.0pt;
  background:#FFE599;padding:0in 5.75pt 0in 6.25pt;height:50.9pt'>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-size:10.0pt;line-height:107%'>Enabled, but not saved as
  configuration</span></p>
  </td>
  <td width=155 valign=top style='width:116.0pt;border-top:none;border-left:
  none;border-bottom:solid #BF9000 1.0pt;border-right:solid #BF9000 1.0pt;
  background:#FFE599;padding:0in 5.75pt 0in 6.25pt;height:50.9pt'>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-size:10.0pt;line-height:107%'>Config filter module</span></p>
  </td>
 </tr>
</table>

<h4 style='margin-left:-.25pt'><a name="_Toc247031">Scenario A: Install a
module on development, but not on production.</a></h4>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>Since drupal 8.8 there is a core setting to exclude a
module without any contrib modules.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>The first step is to install <i>devel </i>and <i>webprofiler
</i>module and make sure your sync store is up-to-date by doing <i>drush
config-export -y</i>.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:21.9pt;
margin-left:-.25pt'>Then add this to your <b>settings.php file:</b></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:23.45pt;
margin-left:12.35pt;line-height:110%;background:#F8F8F8'><span
style='font-family:Consolas'>$settings['config_exclude_modules'] = ['devel',
'webprofiler'];</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:3.5pt;
margin-left:-.25pt'>After you’ve setup the modules you would like to exclude
from your configuration, export your config again:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:1.5pt;text-indent:0in;line-height:107%'><img border=0 width=589
height=281 id="Picture 241805"
src="Learning%20drupal%209%20as%20a%20framework_files/image018.gif"></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>You see that all of the configuration that was added by
devel and webprofiler gets removed from the sync store. On a production site,
there will be no devel and webprofiler.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:21.65pt;
margin-left:-.25pt'>We could go further and also make sure there is no devel
module in our modules folder on production. For this, we would want to exclude
it from our <b>composer.json </b>file by using the <i>--dev </i>flag. We would
do the following. Note that it is best to do this while setting up your
environments the first time:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:23.45pt;
margin-left:5.0pt;line-height:110%;background:#F8F8F8'><span style='font-family:
Consolas'>$ composer require --dev drupal/devel</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:2.1pt;
margin-left:-.25pt'>This results in those dependencies being added into the
composer.json file under require-dev:</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:53.25pt'>
  <td width=601 valign=top style='width:450.75pt;background:#F8F8F8;padding:
  7.85pt 5.75pt 0in 5.25pt;height:53.25pt'>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-family:Consolas'>&quot;require-dev&quot;: {</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:13.2pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas'>&quot;drupal/devel&quot;: &quot;^4.0&quot;</span></p>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-family:Consolas'>}</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:21.9pt;
margin-left:-.25pt'>If you install the site without your dev modules you then
would use:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:37.45pt;
margin-left:5.0pt;line-height:110%;background:#F8F8F8'><span style='font-family:
Consolas'>$ composer install --no-dev</span></p>

<h4 style='margin-left:-.25pt'><a name="_Toc247032">Scenario B: disable caching
on development, but not on production.</a></h4>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:22.5pt;
margin-left:-.25pt'>You saw a lot of this in the <u><span style='color:#1155CC'>development
&amp; debug </span></u>chapter. Some can be solved by adding a
development.services.yml file. But the following can be done by overwriting
configuration on development. So in this case you enable all the caching
mechanisms in your configuration (sync store) but you overwrite them locally in
your <b>settings.local.php</b>:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.75pt;
margin-left:5.0pt;line-height:110%;background:#F8F8F8'><span style='font-family:
Consolas'>$config['system.performance']['css']['preprocess'] = FALSE;</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:23.45pt;
margin-left:5.0pt;line-height:110%;background:#F8F8F8'><span style='font-family:
Consolas'>$config['system.performance']['js']['preprocess'] = FALSE;</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:21.75pt;
margin-left:-.25pt'>Uncomment these lines to disable the render cache and
disable dynamic page cache:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.9pt;
margin-left:5.0pt;line-height:110%;background:#F8F8F8'><span style='font-family:
Consolas'>$settings['cache']['bins']['render'] = 'cache.backend.null';
$settings['cache']['bins']['dynamic_page_cache'] =</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.9pt;
margin-left:5.0pt;line-height:110%;background:#F8F8F8'><span style='font-family:
Consolas'>'cache.backend.null';</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:23.45pt;
margin-left:5.0pt;line-height:110%;background:#F8F8F8'><span style='font-family:
Consolas'>$settings['cache']['bins']['page'] = 'cache.backend.null';</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>Disabling caching has some drawbacks. The whole site
responds slower, and rebuilding all caches takes a while too. Doing this a lot,
and all those seconds waiting for a response add up. For an approach to
developing with the cache enabled, see <a
href="https://www.dx-experts.nl/blog/2017/drupal-8-development-caching/"><span
style='color:#1155CC'>Drupal 8 development with caching on</span></a>.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:21.7pt;
margin-left:-.25pt'>One bonus tip I can give you is to enable verbose error
messaging on your local development. By doing this you get rich error messages
instead of the default “something went wrong” message:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:10.6pt;margin-bottom:
37.15pt;margin-left:5.0pt;line-height:112%;background:#F8F8F8'><span
style='font-family:Consolas;color:#333333'>$config['system.logging']['error_level']
= 'verbose';</span></p>

<h4 style='margin-left:-.25pt'><a name="_Toc247033">Scenario C: enable a module
on both development and production, but ignore its configuration.</a></h4>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>A real-life scenario you will be confronted with is when
webmasters have access to modules that <i>create </i>configuration in your
active store. An example is the <a href="https://www.drupal.org/project/webform"><span
style='color:#1155CC'>webform </span></a>module. Every form, form field or
setting a webmaster adds will create additional configuration. The risk here is
that when a developer deploys his development changes, and this configuration,
he risks removing a newly created form.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>The solution for this scenario is the <a
href="https://www.drupal.org/project/config_filter"><span style='color:#1155CC'>config
filter</span></a><u><span style='color:#1155CC'> </span></u>module. With this
module you can tell both your development and production environment to ignore <i>parts
</i>of your configuration.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'><b>First</b>, install and enable the module on both
development and production.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'><b>Second</b>, go to <b>/admin/config/development/configuration/ignore.
</b>There is a textarea where you can add the keys of the configuration you
would like to ignore.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:-1.7pt;margin-bottom:
24.25pt;margin-left:1.5pt;text-indent:0in;line-height:107%'><img border=0
width=602 height=252 id="Picture 2637"
src="Learning%20drupal%209%20as%20a%20framework_files/image019.jpg"></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>Add <i>webform.* </i>to the textarea and save.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:3.4pt;
margin-left:-.25pt'><b>Third</b>, export your configuration and import it on
production. This is important: both environments need to have the module
installed before you can start ignoring certain config.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:24.25pt;
margin-left:1.5pt;text-indent:0in;line-height:107%'><img border=0 width=588
height=229 id="Picture 241806"
src="Learning%20drupal%209%20as%20a%20framework_files/image020.gif"></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.7pt;margin-bottom:30.55pt;
margin-left:-.25pt;line-height:111%'><b>Fourth, </b>enable the webform module
and start adding forms. If you now export your content, it <u>will still export
your yaml files BUT your production will not read them when you import them</u>.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:15.1pt;margin-bottom:
0in;margin-left:14.0pt;line-height:110%;background:#FFD966'><span
style='font-size:11.0pt;line-height:110%'>The <b>config filter </b>module is
great, but you must get comfortable using it. Start with easy configuration. I
would also recommend either to ignore the entire module or not ignoring it.
Ignoring parts of configuration is possible, but can be dangerous.</span></p>

<h3 style='margin-top:0in;margin-right:0in;margin-bottom:19.55pt;margin-left:
-.25pt'><a name="_Toc247034">Reading configuration objects in your code</a></h3>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>We know that our active configuration resides in the
database. Often we want to read out configuration in our custom code. Below is
a snippet on how to read out the google tagmanager snippet we’ve created in our
<u><span style='color:#1155CC'>previous chapter about custom configuration</span></u>:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:2.1pt;
margin-left:-.25pt'>With this example snippet you make the variables available
in your page.twig.html file. You can use <i>hook_preprocess_hook() </i>in your <b>mytheme.theme
</b>file or like below In your <b>mymodule.module </b>file:</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:1.75in'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
  height:1.75in'>
  <p class=MsoNormal style='margin-top:0in;margin-right:195.65pt;margin-bottom:
  0in;margin-left:6.6pt;text-indent:-6.6pt;line-height:116%'><i><span
  style='font-family:Consolas;color:#999988'>/** * Implements
  hook_preprocess_html().</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:123.05pt;margin-bottom:
  0in;margin-left:0in;text-indent:6.6pt;line-height:119%'><i><span
  style='font-family:Consolas;color:#999988'>*/ </span></i><b><span
  style='font-family:Consolas;color:#333333'>function </span></b><b><span
  style='font-family:Consolas;color:#990000'>MYMODULE_preprocess_html</span></b><span
  style='font-family:Consolas;color:#333333'>(&amp;$variables) { $variables[</span><span
  style='font-family:Consolas;color:#DD1144'>'tagmanager'</span><span
  style='font-family:Consolas;color:#333333'>] =</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>\Drupal::config(</span><span style='font-family:Consolas;
  color:#DD1144'>'offer.customconfig'</span><span style='font-family:Consolas;
  color:#333333'>)-&gt;get(</span><span style='font-family:Consolas;color:#DD1144'>'tagmanager'</span><span
  style='font-family:Consolas;color:#333333'>);</span></p>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-family:Consolas;color:#333333'>}</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:21.75pt;
margin-left:-.25pt'>Now, in your html.html.twig file of your theme, just use
the following in your <i>&lt;head&gt; </i>section:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:22.95pt;
margin-left:5.25pt;text-indent:0in;line-height:107%;background:#F8F8F8'><span
style='font-family:Consolas;color:teal'>{{ tagmanager }}</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>Clear caches and the snippet will appear.</p>

<h1 style='margin-top:0in;margin-right:0in;margin-bottom:16.85pt;margin-left:
-.25pt'><a name="_Toc247035">Part 2: Project code and set-up</a></h1>

<h2 style='margin-top:0in;margin-right:0in;margin-bottom:3.35pt;margin-left:
-.25pt'><a name="_Toc247036">Seed data</a></h2>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>Before we start setting up the project, I would like to
talk about so-called <i>seed data</i>.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>Drupal now has become an option for platforms that were
typically built with tailor-made software solutions.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>But one thing it lacks is <b>seed data</b>. Seed data is
data that you populate the database with at the time it is created. You use
seeding to provide initial values for lookup lists, for demo purposes, proof of
concepts and of course for development.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>We always want to achieve the following: a new developer
comes into our team and installs everything that is in the composer file. After
this, he imports the configuration (more on configuration later).</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>But then there is an empty software platform. Pretty
annoying for debugging and programming.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:.8pt;
margin-left:-.25pt'>What we did in the earlier drupal days, was use a database
with production data. This is in many ways a bad practice:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:.65pt;
margin-left:.5in;text-indent:-.25in'><span style='font-family:"Arial",sans-serif'>&#9679;<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span><b>Privacy</b>:
when people put their data into a platform, they do not want their data to be
visible for every developer. We should avoid this.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:.5in;text-indent:-.25in'><span style='font-family:"Arial",sans-serif'>&#9679;<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span><b>Security</b>:
what about sending out emails to production customers  by accident. Ask 10
developers and 5 of them will tell you this happened some time.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>While there are some things we can do, console for example
has a content generation function, we’ll do this with a custom console command.
I prefer realistic seed data instead of Lorem ipsum. Let’s start by writing a
class.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:17.4pt;
margin-left:-.25pt;line-height:110%'>To <b>modules\custom\offer\src </b>we add
a directory called <b>SeedData</b>. We add a file called <b>SeedDataGenerator.php
t</b>o <b>modules\custom\offer\src\SeedData.</b></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>The class will for now just create a dummy user. In the
project files it has become a large function to import all of our entity data
with dummy users, offers and bids.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>For now we’ll just add a test user. in This is what our
class looks like:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.55pt;margin-bottom:0in;
margin-left:-1.0in;text-indent:0in;line-height:107%'>&nbsp;</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:687.0pt'>
  <td width=601 valign=top style='width:450.75pt;background:#F8F8F8;padding:
  0in 5.75pt 0in 5.25pt;height:687.0pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:228.6pt;margin-bottom:
  0in;margin-left:0in;text-indent:0in;line-height:239%'><b><span
  style='font-family:Consolas;color:#999999'>&lt;?php </span></b><b><span
  style='font-family:Consolas;color:#333333'>namespace </span></b><b><span
  style='font-family:Consolas;color:#990000'>Drupal</span></b><span
  style='font-family:Consolas;color:#333333'>\</span><b><span style='font-family:
  Consolas;color:#990000'>offer</span></b><span style='font-family:Consolas;
  color:#333333'>\</span><b><span style='font-family:Consolas;color:#990000'>SeedData</span></b><span
  style='font-family:Consolas;color:#333333'>; <b>use </b></span><b><span
  style='font-family:Consolas;color:#990000'>Drupal</span></b><span
  style='font-family:Consolas;color:#333333'>\</span><b><span style='font-family:
  Consolas;color:#990000'>user</span></b><span style='font-family:Consolas;
  color:#333333'>\</span><b><span style='font-family:Consolas;color:#990000'>Entity</span></b><span
  style='font-family:Consolas;color:#333333'>\</span><b><span style='font-family:
  Consolas;color:#990000'>User</span></b><span style='font-family:Consolas;
  color:#333333'>;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:0in;text-indent:0in;line-height:107%'><i><span style='font-family:
  Consolas;color:#999988'>/**</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.1pt;
  margin-left:.55in;text-indent:-19.8pt;line-height:107%'><span
  style='font-family:Consolas;color:#999988'>*<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;
  </span></span><i><span style='font-family:Consolas;color:#999988'>Class
  SeedGenerator</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:.55in;text-indent:-19.8pt;line-height:107%'><span
  style='font-family:Consolas;color:#999988'>*<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;
  </span></span><i><span style='font-family:Consolas;color:#DD1144'>@package </span></i><i><span
  style='font-family:Consolas;color:#999988'>Drupal\offer</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.1pt;
  margin-left:6.6pt;text-indent:0in;line-height:107%'><i><span
  style='font-family:Consolas;color:#999988'>*/</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:17.7pt;
  margin-left:0in;text-indent:0in;line-height:107%'><b><span style='font-family:
  Consolas;color:#333333'>Class </span></b><b><span style='font-family:Consolas;
  color:#445588'>SeedDataGenerator </span></b><span style='font-family:Consolas;
  color:#333333'>{</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:195.65pt;margin-bottom:
  .9pt;margin-left:19.8pt;text-indent:-6.6pt;line-height:116%'><i><span
  style='font-family:Consolas;color:#999988'>/** * Function to create the Seed
  data</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:.55in;text-indent:-19.8pt;line-height:107%'><span
  style='font-family:Consolas;color:#999988'>*<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;
  </span></span><i><span style='font-family:Consolas;color:#DD1144'>@param </span></i><i><span
  style='font-family:Consolas;color:#999988'>string $entity</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.1pt;
  margin-left:.55in;text-indent:-19.8pt;line-height:107%'><span
  style='font-family:Consolas;color:#999988'>*<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;
  </span></span><i><span style='font-family:Consolas;color:#999988'>The type of
  entity that needs to be created.</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:.55in;text-indent:-19.8pt;line-height:107%'><span
  style='font-family:Consolas;color:#999988'>*<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;
  </span></span><i><span style='font-family:Consolas;color:#DD1144'>@return </span></i><i><span
  style='font-family:Consolas;color:#999988'>integer $count</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:.55in;text-indent:-19.8pt;line-height:107%'><span
  style='font-family:Consolas;color:#999988'>*<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;
  </span></span><i><span style='font-family:Consolas;color:#999988'>The number
  of entities created.</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:195.65pt;margin-bottom:
  16.5pt;margin-left:13.2pt;text-indent:6.6pt;line-height:122%'><i><span
  style='font-family:Consolas;color:#999988'>*/ </span></i><b><span
  style='font-family:Consolas;color:#333333'>public function </span></b><b><span
  style='font-family:Consolas;color:#990000'>Generate</span></b><span
  style='font-family:Consolas;color:#333333'>($entity) {</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:18.6pt;
  margin-left:26.4pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>$count = </span><span style='font-family:Consolas;
  color:teal'>0</span><span style='font-family:Consolas;color:#333333'>;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:268.2pt;margin-bottom:
  0in;margin-left:.55in;text-indent:-13.2pt;line-height:122%'><b><span
  style='font-family:Consolas;color:#333333'>switch </span></b><span
  style='font-family:Consolas;color:#333333'>($entity) { <b>case </b></span><span
  style='font-family:Consolas;color:#DD1144'>'user'</span><span
  style='font-family:Consolas;color:#333333'>:</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:52.8pt;text-indent:0in;line-height:107%'><i><span
  style='font-family:Consolas;color:#999988'>// USER SEEDS</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:52.8pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>$user = User::create();</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:52.8pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>$user-&gt;setUsername(</span><span style='font-family:
  Consolas;color:#DD1144'>'test'</span><span style='font-family:Consolas;
  color:#333333'>);</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:52.8pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>$user-&gt;setPassword(</span><span style='font-family:
  Consolas;color:#DD1144'>'test'</span><span style='font-family:Consolas;
  color:#333333'>);</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:52.8pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>$user-&gt;setEmail(</span><span style='font-family:
  Consolas;color:#DD1144'>'test@mail.com'</span><span style='font-family:Consolas;
  color:#333333'>);</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:241.8pt;margin-bottom:
  0in;margin-left:52.8pt;text-indent:0in;line-height:119%'><span
  style='font-family:Consolas;color:#333333'>$user-&gt;activate();
  $user-&gt;enforceIsNew(); <b>if</b>($user-&gt;save()) { $count += </span><span
  style='font-family:Consolas;color:teal'>1</span><span style='font-family:
  Consolas;color:#333333'>; <b>return </b>$count;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:340.8pt;margin-bottom:
  0in;margin-left:52.8pt;text-indent:0in;line-height:116%'><span
  style='font-family:Consolas;color:#333333'>} <b>break</b>;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:334.2pt;margin-bottom:
  0in;margin-left:26.4pt;text-indent:0in;line-height:107%'><span
  style='font-family:Consolas;color:#333333'>} <b>return null</b>;</span></p>
  </td>
 </tr>
 <tr style='height:43.5pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
  height:43.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:13.2pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-family:Consolas;color:#333333'>}</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>Proceed with adding a drush command that will trigger the
class:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:2.1pt;
margin-left:-.25pt'>Add <b>custom/offer/src/Commands/SeedGeneratorCommand.php </b>and
configure further. The final file looks like this:</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:489.0pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
  height:489.0pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:222.0pt;margin-bottom:
  0in;margin-left:0in;text-indent:0in;line-height:239%'><b><span
  style='font-family:Consolas;color:#999999'>&lt;?php </span></b><b><span
  style='font-family:Consolas;color:#333333'>namespace </span></b><b><span
  style='font-family:Consolas;color:#990000'>Drupal</span></b><span
  style='font-family:Consolas;color:#333333'>\</span><b><span style='font-family:
  Consolas;color:#990000'>offer</span></b><span style='font-family:Consolas;
  color:#333333'>\</span><b><span style='font-family:Consolas;color:#990000'>Commands</span></b><span
  style='font-family:Consolas;color:#333333'>;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:149.45pt;margin-bottom:
  15.6pt;margin-left:0in;text-indent:0in;line-height:122%'><b><span
  style='font-family:Consolas;color:#333333'>use </span></b><b><span
  style='font-family:Consolas;color:#990000'>Drush</span></b><span
  style='font-family:Consolas;color:#333333'>\</span><b><span style='font-family:
  Consolas;color:#990000'>Commands</span></b><span style='font-family:Consolas;
  color:#333333'>\</span><b><span style='font-family:Consolas;color:#990000'>DrushCommands</span></b><span
  style='font-family:Consolas;color:#333333'>; <b>use </b></span><b><span
  style='font-family:Consolas;color:#990000'>Drupal</span></b><span
  style='font-family:Consolas;color:#333333'>\</span><b><span style='font-family:
  Consolas;color:#990000'>offer</span></b><span style='font-family:Consolas;
  color:#333333'>\</span><b><span style='font-family:Consolas;color:#990000'>SeedData</span></b><span
  style='font-family:Consolas;color:#333333'>\</span><b><span style='font-family:
  Consolas;color:#990000'>SeedDataGenerator</span></b><span style='font-family:
  Consolas;color:#333333'>; <b>use </b></span><b><span style='font-family:Consolas;
  color:#990000'>Drush</span></b><span style='font-family:Consolas;color:#333333'>\</span><b><span
  style='font-family:Consolas;color:#990000'>Drush</span></b><span
  style='font-family:Consolas;color:#333333'>;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:0in;text-indent:0in;line-height:107%'><i><span style='font-family:
  Consolas;color:#999988'>/**</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.1pt;
  margin-left:19.8pt;text-indent:19.8pt;line-height:107%'><span
  style='font-family:Consolas;color:#999988'>*<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  </span></span><i><span style='font-family:Consolas;color:#999988'>Class
  SeedGeneratorCommand</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:19.8pt;text-indent:19.8pt;line-height:107%'><span
  style='font-family:Consolas;color:#999988'>*<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  </span></span><i><span style='font-family:Consolas;color:#DD1144'>@package </span></i><i><span
  style='font-family:Consolas;color:#999988'>Drupal\offer\Commands</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:109.85pt;margin-bottom:
  15.6pt;margin-left:0in;text-indent:6.6pt;line-height:122%'><i><span
  style='font-family:Consolas;color:#999988'>*/ </span></i><b><span
  style='font-family:Consolas;color:#333333'>class </span></b><b><span
  style='font-family:Consolas;color:#445588'>SeedGeneratorCommand </span></b><b><span
  style='font-family:Consolas;color:#333333'>extends </span></b><b><span
  style='font-family:Consolas;color:#445588'>DrushCommands </span></b><span
  style='font-family:Consolas;color:#333333'>{</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.1pt;
  margin-left:13.2pt;text-indent:0in;line-height:107%'><i><span
  style='font-family:Consolas;color:#999988'>/**</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:19.8pt;text-indent:19.8pt;line-height:116%'><span
  style='font-family:Consolas;color:#999988'>*<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  </span></span><i><span style='font-family:Consolas;color:#999988'>Runs the
  OfferCreateSeeds command. Will create all data for the Offer platform.</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.1pt;
  margin-left:19.8pt;text-indent:0in;line-height:107%'><i><span
  style='font-family:Consolas;color:#999988'>*</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.1pt;
  margin-left:19.8pt;text-indent:19.8pt;line-height:107%'><span
  style='font-family:Consolas;color:#999988'>*<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  </span></span><i><span style='font-family:Consolas;color:#DD1144'>@command </span></i><i><span
  style='font-family:Consolas;color:#999988'>offer-create-seeds</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.1pt;
  margin-left:19.8pt;text-indent:19.8pt;line-height:107%'><span
  style='font-family:Consolas;color:#999988'>*<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  </span></span><i><span style='font-family:Consolas;color:#DD1144'>@aliases </span></i><i><span
  style='font-family:Consolas;color:#999988'>offercs</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:19.8pt;text-indent:19.8pt;line-height:107%'><span
  style='font-family:Consolas;color:#999988'>*<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  </span></span><i><span style='font-family:Consolas;color:#DD1144'>@usage </span></i><i><span
  style='font-family:Consolas;color:#999988'>drush offer-create-seeds</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:19.8pt;text-indent:19.8pt;line-height:107%'><span
  style='font-family:Consolas;color:#999988'>*<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  </span></span><i><span style='font-family:Consolas;color:#999988'>Display
  'Seed data created'</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:189.05pt;margin-bottom:
  0in;margin-left:13.2pt;text-indent:6.6pt;line-height:122%'><i><span
  style='font-family:Consolas;color:#999988'>*/ </span></i><b><span
  style='font-family:Consolas;color:#333333'>public function </span></b><b><span
  style='font-family:Consolas;color:#990000'>OfferCreateSeeds</span></b><span
  style='font-family:Consolas;color:#333333'>() {</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:26.4pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>$seed = <b>new </b>SeedDataGenerator();</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.1pt;
  margin-left:26.4pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>$count = $seed-&gt;Generate(</span><span
  style='font-family:Consolas;color:#DD1144'>'user'</span><span
  style='font-family:Consolas;color:#333333'>);</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:26.4pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>Drush::output()-&gt;writeln($count . </span><span
  style='font-family:Consolas;color:#DD1144'>' user(s) created'</span><span
  style='font-family:Consolas;color:#333333'>);</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:13.2pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-family:Consolas;color:#333333'>}</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>One more thing. Add a file <b>custom/offer/offer.services.yml
</b>and add:</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:93.0pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
  height:93.0pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>services:</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:6.6pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>offer.commands:</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:57.1pt;margin-bottom:
  0in;margin-left:19.8pt;text-indent:0in;line-height:116%'><span
  style='font-family:Consolas;color:#333333'>class:
  \Drupal\offer\Commands\SeedGeneratorCommand tags:</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:33.0pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>- { name: drush.command }</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:22.6pt;
margin-left:-.25pt'>That’s it! Clear cache and see if our system has registered
our command. Lookup all available commands for our offer module like this:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:10.6pt;margin-bottom:
.6pt;margin-left:5.0pt;line-height:112%;background:#F8F8F8'><span
style='font-family:Consolas;color:#333333'>bash$ drush list | grep </span><span
style='font-family:Consolas;color:#DD1144'>'offer'</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:10.6pt;margin-bottom:
1.45pt;margin-left:5.0pt;line-height:112%;background:#F8F8F8'><span
style='font-family:Consolas;color:#333333'>offer-create-seeds
(offercs)               Runs the</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:10.6pt;margin-bottom:
23.05pt;margin-left:5.0pt;line-height:112%;background:#F8F8F8'><span
style='font-family:Consolas;color:#333333'>OfferCreateSeeds </span><span
style='font-family:Consolas;color:#0086B3'>command</span><span
style='font-family:Consolas;color:#333333'>. Will create all data for the Offer
platform.</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:.75pt;
margin-left:-.25pt'>This is nice. This way we can add commands for every module
in our system. Developers can “grep” for every name of the module and see all
the commands it has.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:21.75pt;
margin-left:-.25pt'>Let’s run the command. If everything goes well we would
create a new user with the command:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:241.5pt;margin-bottom:
23.05pt;margin-left:5.0pt;line-height:112%;background:#F8F8F8'><span
style='font-family:Consolas;color:#333333'>bash$ drush offer-create-seeds </span><span
style='font-family:Consolas;color:#38761D'>1 user(s) created</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:30.45pt;
margin-left:-.25pt'>We see we have imported the test user. <span
style='background:yellow'>We’re forever done with using production databases</span>.
Extending the class after each entity we create won’t take long and we’ll just
add 2 to 5 items per entity type.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:15.1pt;margin-bottom:
31.25pt;margin-left:14.0pt;line-height:110%;background:#FFD966'><span
style='font-size:11.0pt;line-height:110%'>This will become easier with every
project you’ll start. This way, we truly separated configuration from content,
a necessary step to advanced software development!.</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:22.4pt;
margin-left:-.25pt'>With drush it is easy to start playing to create and delete
content. If you have created your user(s), you can easily delete them as well.
Just type this in your terminal:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:14.7pt;margin-bottom:
31.5pt;margin-left:5.0pt;line-height:112%;background:#F8F8F8'><span
style='font-family:Consolas;color:#333333'>bash$ </span>drush entity:delete
&lt;entityType&gt;</p>

<p class=MsoNormal style='margin-top:0in;margin-right:-1.7pt;margin-bottom:
24.25pt;margin-left:1.5pt;text-indent:0in;line-height:107%'><img border=0
width=602 height=288 id="Picture 3165"
src="Learning%20drupal%209%20as%20a%20framework_files/image021.jpg"></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>Note that this will not delete the admin user, luckily!</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:21.95pt;
margin-left:-.25pt'>Let’s move on with setting up the project files</p>

<h2 style='margin-top:0in;margin-right:0in;margin-bottom:3.35pt;margin-left:
-.25pt'><a name="_Toc247037">Project set-up</a></h2>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>This chapter is your installation guide on how to set up
the project code. Look at the last page of the book for the link to download
the files.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>The following steps are needed to set up the platform:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:.8pt;
margin-left:.5in;text-indent:-.25in'>1.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>Past the project files into a directory. Make sure the <i>web </i>and <i>drush
</i>folder are in the root of the project.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:.9pt;
margin-left:.5in;text-indent:-.25in'>2.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>Make sure your local domain is pointed to the <b><i>web </i></b>folder</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:.65pt;
margin-left:.5in;text-indent:-.25in'>3.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>Run <span style='background:yellow'>composer install </span>in the root
of your installation. This will download all the required packages for the
platform, and add the map structure.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:.9pt;
margin-left:.5in;text-indent:-.25in'>4.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>Fill in your database credentials via the UI and install your drupal
site.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:22.6pt;
margin-left:.5in;text-indent:-.25in'>5.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>In your settings.php, as read in the <u><span style='color:#1155CC'>configuration
management </span></u>chapter, at the bottom add</p>

<p class=MsoNormal style='margin-top:0in;margin-right:4.0pt;margin-bottom:1.45pt;
margin-left:5.0pt;line-height:112%;background:#F8F8F8'><span style='font-family:
Consolas;color:#333333'>$settings[</span><span style='font-family:Consolas;
color:#DD1144'>'config_sync_directory'</span><span style='font-family:Consolas;
color:#333333'>] = </span><span style='font-family:Consolas;color:#DD1144'>'../config/global'</span><span
style='font-family:Consolas;color:#333333'>;</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:0in;
margin-left:.5in;text-indent:-.25in'>6.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>Run <span style='background:yellow'>drush config-import -y </span>to
enable the required modules and import all configuration that comes with them</p>

<p class=MsoNormal style='margin-top:0in;margin-right:-37.7pt;margin-bottom:
7.75pt;margin-left:37.5pt;text-indent:0in;line-height:107%'><img border=0
width=602 height=523 id="Picture 3187"
src="Learning%20drupal%209%20as%20a%20framework_files/image022.jpg"></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:0in;
margin-left:.5in;text-indent:-.25in'>7.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>Run <span style='background:yellow'>drush offer-create-seeds </span>to
import all of your dummy content</p>

<p class=MsoNormal style='margin-top:0in;margin-right:-1.7pt;margin-bottom:
24.25pt;margin-left:1.5pt;text-indent:0in;line-height:107%'><img border=0
width=603 height=433 id="Picture 3196"
src="Learning%20drupal%209%20as%20a%20framework_files/image023.jpg"></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>Clear the caches. You now have the full platforms
ready-to-go that should look like this:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:-1.7pt;margin-bottom:
24.25pt;margin-left:1.5pt;text-indent:0in;line-height:107%'><img border=0
width=602 height=441 id="Picture 3207"
src="Learning%20drupal%209%20as%20a%20framework_files/image024.jpg"></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>Go to <b>/user/register </b>to register and directly log in
with user “test” and password “test. Place a bid on an offer to see how it
works.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:-1.7pt;margin-bottom:
24.25pt;margin-left:1.5pt;text-indent:0in;line-height:107%'><img border=0
width=602 height=407 id="Picture 3221"
src="Learning%20drupal%209%20as%20a%20framework_files/image025.jpg"></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:.05in;
margin-left:-.25pt'>Click on “<b>My offers</b>” to add your own offer via a
multi-step interface.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:-1.7pt;margin-bottom:
24.25pt;margin-left:1.5pt;text-indent:0in;line-height:107%'><img border=0
width=602 height=368 id="Picture 3223"
src="Learning%20drupal%209%20as%20a%20framework_files/image026.jpg"></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>In the following chapters we will be building the platform
(modules, settings, …) from scratch, step by step. You can use this course in
two ways:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:2.2pt;margin-bottom:1.45pt;
margin-left:27.0pt;text-indent:-.25in;line-height:107%'>1.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><b>Learn
by reading </b>the chapters and looking into the final platform and code</p>

<p class=MsoNormal style='margin-top:0in;margin-right:2.2pt;margin-bottom:2.1pt;
margin-left:27.0pt;text-indent:-.25in'>2.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><b>Learn by doing</b>: follow the course and create every file yourself.
There are only a few additional things that were added to the final code, which
is discussed at the end of this course. This second way is probably the most
effective way to learn!</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=600
 style='width:6.25in;border-collapse:collapse'>
 <tr style='height:55.5pt'>
  <td width=48 valign=top style='width:.5in;background:#E2E3E5;padding:14.6pt 5.75pt 0in 8.25pt;
  height:55.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:6.0pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%'>&#128187;</span></p>
  </td>
  <td width=552 style='width:5.75in;background:#E2E3E5;padding:14.6pt 5.75pt 0in 8.25pt;
  height:55.5pt'>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%'>If you follow this course <b>by
  doing </b>you will now and then see a grey box like this with additional info
  like when to enable a new module etc.</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:6.35pt;margin-bottom:
0in;margin-left:-.25pt'>Having problems setting up the platform? Click the link
below for some troubleshooting and how to contact me: <a
href="https://stefvanlooveren.me/troubleshooting"><span style='color:#1155CC'>https://stefvanlooveren.me/troubleshooting</span></a><br
clear=all style='page-break-before:always'>
</p>

<h1 style='margin-left:-.25pt'><a name="_Toc247038">Part 3: Custom entities
101, CRUD operations, workflow states and access</a></h1>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=600
 style='width:6.25in;border-collapse:collapse'>
 <tr style='height:163.5pt'>
  <td width=59 valign=top style='width:44.25pt;background:#6D9EEB;padding:14.6pt 5.75pt 0in 0in;
  height:163.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:14.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%'>&#128073;</span></p>
  </td>
  <td width=541 style='width:405.75pt;background:#6D9EEB;padding:14.6pt 5.75pt 0in 0in;
  height:163.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:9.85pt;margin-bottom:
  13.7pt;margin-left:0in;text-indent:0in;line-height:104%'><span
  style='font-size:11.0pt;line-height:104%'>In this <b>3rd part </b>of the
  course you will learn everything concerning <b>custom entities</b>. At the
  end you will able to create your own entities, master how to add
  functionality using <b>annotations </b>to add <b>views support</b>, make the
  entities <b>fieldable</b>, add a <b>workflow </b>with transitions and
  importantly, detailed <b>access handling</b>.</span></p>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%'>On a software point of view this
  teaches you how to add data entry points using <b>form modes </b>and <b>view
  modes</b>. You will be able to create <b>multistep forms </b>for user
  friendly user input (CRUD) using drupal’s typical field api and the core <b>media
  </b>module for images.</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>With our setup ready and the theory covered, it is time to
get up speed with our platform. In this section we’ll dive into the main core
concepts we’ll need to start adding data into our software. We start with
diving into a very interesting core concept: entities.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:.7pt;
margin-left:-.25pt'>A brief history: since drupal 7 the software contains
generic data models that can be extended for specific purposes. Some examples
in core are:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:1.05pt;
margin-left:.5in;text-indent:-.25in'><span style='font-family:"Arial",sans-serif'>&#9679;<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span>Nodes</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:1.05pt;
margin-left:.5in;text-indent:-.25in'><span style='font-family:"Arial",sans-serif'>&#9679;<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span>Blocks</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:1.0pt;
margin-left:.5in;text-indent:-.25in'><span style='font-family:"Arial",sans-serif'>&#9679;<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span>Comments</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:1.05pt;
margin-left:.5in;text-indent:-.25in'><span style='font-family:"Arial",sans-serif'>&#9679;<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span>Taxonomy</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:.5in;text-indent:-.25in'><span style='font-family:"Arial",sans-serif'>&#9679;<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span>Users</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:.75pt;
margin-left:-.25pt'>Drupal became famous because of its <b>‘fieldable’ </b>functionality
of these entities. Whether it is a user or a comment, they can easily be
extended by extra fields in the same way:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:1.0pt;
margin-left:.5in;text-indent:-.25in'><span style='font-family:"Arial",sans-serif'>&#9679;<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span>List
items</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:1.0pt;
margin-left:.5in;text-indent:-.25in'><span style='font-family:"Arial",sans-serif'>&#9679;<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span>Textfield</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:1.0pt;
margin-left:.5in;text-indent:-.25in'><span style='font-family:"Arial",sans-serif'>&#9679;<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span>Entity
references</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:1.05pt;
margin-left:.5in;text-indent:-.25in'><span style='font-family:"Arial",sans-serif'>&#9679;<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span>Media</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:1.1pt;
margin-left:.5in;text-indent:-.25in'><span style='font-family:"Arial",sans-serif'>&#9679;<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span>Link
field</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.4pt;
margin-left:.5in;text-indent:-.25in;line-height:107%'><span style='font-family:
"Arial",sans-serif'>&#9679;<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;
</span></span>…</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>Moreover these fields are translatable and can have
multiple instances as well (multifield).</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:21.7pt;
margin-left:-.25pt'>I believe there is no other software that has such a strong
fieldable model as drupal 9. <span style='background:yellow'>This makes me
prefer drupal over a solely Symfony or Django platform in the majority of use
cases</span>. I hope I can show you why in this course.</p>

<h2 style='margin-top:0in;margin-right:0in;margin-bottom:16.55pt;margin-left:
-.25pt'><a name="_Toc247039">Content entities</a></h2>

<p class=MsoNormal style='margin-top:0in;margin-right:15.1pt;margin-bottom:
31.25pt;margin-left:14.0pt;line-height:110%;background:#FFD966'><span
style='font-size:11.0pt;line-height:110%'>A content entity is a generic
fieldable model that is defined in code. It inherits all functionality from the
base Entity model defined in drupal core.</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>Take a look at <b>core/modules/user/src/Entity/User.php </b>and
click further on the classes the current class you are in extends:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:.9pt;
margin-left:36.5pt'>class User extends <b>ContentEntityBase </b>implements
UserInterface</p>

<p class=MsoNormal align=center style='margin-top:0in;margin-right:12.65pt;
margin-bottom:1.45pt;margin-left:.5pt;text-align:center;line-height:107%'>-&gt;
abstract class ContentEntityBase extends <b>EntityBase</b></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:108.5pt'>-&gt; abstract class EntityBase implements <b>EntityInterface</b></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>This Object-oriented way of data-modelling makes sense. All
the classes that inherit from EntityBase get a ton of functionality for free:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:.95pt;
margin-left:.5in;text-indent:-.25in'><span style='font-family:"Arial",sans-serif'>&#9679;<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span>Makes
the entity <b>fieldable </b>if desired (start adding fields via the ui
on-the-go)</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:.95pt;
margin-left:.5in;text-indent:-.25in'><span style='font-family:"Arial",sans-serif'>&#9679;<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span>Makes
the entity <b>translatable, </b>if desired</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:2.35pt;
margin-left:.5in;text-indent:-.25in;line-height:110%'><span style='font-family:
"Arial",sans-serif'>&#9679;<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;
</span></span>I<b>nherits various generic methods </b>for obtaining data</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:.8pt;
margin-left:.5in;text-indent:-.25in'><span style='font-family:"Arial",sans-serif'>&#9679;<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span>Can
make use of the core <b>workflow </b>(for moderation status of the entities:
draft, published, expired, ...)</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:.8pt;
margin-left:.5in;text-indent:-.25in'><span style='font-family:"Arial",sans-serif'>&#9679;<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span>Can
make use of the powerful core <b>revisioning </b>system (keeps a history of the
entity on every change)</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:.95pt;
margin-left:.5in;text-indent:-.25in'><span style='font-family:"Arial",sans-serif'>&#9679;<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span>Create,
read, update, and delete (<b>CRUD</b>) functionality with the desired security.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:.5in;text-indent:-.25in'><span style='font-family:"Arial",sans-serif'>&#9679;<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span><b>Views
</b>integration by default. <a
href="https://www.drupal.org/docs/8/core/modules/views"><span style='color:
#1155CC'>Views</span></a><u><span style='color:#1155CC'> </span></u>is the core
module for creating lists with filtering, search etc.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:19.0pt;
margin-left:-.25pt'>The following generic methods for content entities are
provided in core:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.05pt;
margin-left:5.0pt;line-height:110%;background:#F8F8F8'><span style='font-size:
9.0pt;line-height:110%;font-family:Consolas;color:#333333'>Entity::create()</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.05pt;
margin-left:5.0pt;line-height:110%;background:#F8F8F8'><span style='font-size:
9.0pt;line-height:110%;font-family:Consolas;color:#333333'>Entity::load()</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.05pt;
margin-left:5.0pt;line-height:110%;background:#F8F8F8'><span style='font-size:
9.0pt;line-height:110%;font-family:Consolas;color:#333333'>Entity::save()</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.05pt;
margin-left:5.0pt;line-height:110%;background:#F8F8F8'><span style='font-size:
9.0pt;line-height:110%;font-family:Consolas;color:#333333'>Entity::id()</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.05pt;
margin-left:5.0pt;line-height:110%;background:#F8F8F8'><span style='font-size:
9.0pt;line-height:110%;font-family:Consolas;color:#333333'>Entity::bundle()</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.05pt;
margin-left:5.0pt;line-height:110%;background:#F8F8F8'><span style='font-size:
9.0pt;line-height:110%;font-family:Consolas;color:#333333'>Entity::isNew()</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:26.45pt;
margin-left:5.0pt;line-height:110%;background:#F8F8F8'><span style='font-size:
9.0pt;line-height:110%;font-family:Consolas;color:#333333'>Entity::label()</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>An entity is purely defined in code, <u>unless</u>:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:.65pt;
margin-left:.5in;text-indent:-.25in'><span style='font-family:"Arial",sans-serif'>&#9679;<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span>We
add bundles to the entity (f.e. Node entity has bundle ‘article’, ‘page’ in the
standard profile). This is not what we will do in this course.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:.5in;text-indent:-.25in'><span style='font-family:"Arial",sans-serif'>&#9679;<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span>We
add fieldable functionality to the entity (this is an option when creating
content entities) to add fields via the interface. We will do this in this
course.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:21.05pt;
margin-left:-.25pt;line-height:117%'><span style='background:yellow'>When one
of the previous conditions is met, the extra configuration gets stored in the
database and comes with yaml files when exporting configuration.</span></p>

<h2 style='margin-left:-.25pt'><a name="_Toc247040">Building our first content
entity</a></h2>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=600
 style='width:6.25in;border-collapse:collapse'>
 <tr style='height:69.0pt'>
  <td width=59 valign=top style='width:44.25pt;background:#6D9EEB;padding:14.6pt 5.75pt 0in 0in;
  height:69.0pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:14.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%'>&#128073;</span></p>
  </td>
  <td width=541 style='width:405.75pt;background:#6D9EEB;padding:14.6pt 5.75pt 0in 0in;
  height:69.0pt'>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%'>This section teaches you how to
  define a custom entity and create it in the database. At the end you will be
  able to create your own custom entity with custom tailored <b>base fields </b>and
  </span><a
  href="https://www.drupal.org/docs/administering-a-drupal-site/node-revisions"><b><span
  style='font-size:11.0pt;line-height:107%;color:#1155CC'>revisions</span></b></a><b><u><span
  style='font-size:11.0pt;line-height:107%;color:#1155CC'> </span></u></b><span
  style='font-size:11.0pt;line-height:107%'>support.</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:19.0pt;
margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:11.0pt;
line-height:107%'><img border=0 width=602 height=506
src="Learning%20drupal%209%20as%20a%20framework_files/image027.gif"></span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:17.4pt;
margin-left:-.25pt;line-height:112%'><span style='color:#333333'>The first
question that gets raised is why would we use custom content entities. Isn’t
the core node entity with it’s subtypes (bundles) enough?</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:17.4pt;
margin-left:-.25pt;line-height:112%'><span style='color:#333333'>If we’d have a
simple website with just some blog posts and a portfolio, I’d always recommend
to use the core Node content entity. It is the de facto out-of-the-box solution
for this.</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:17.4pt;
margin-left:-.25pt;line-height:112%'><span style='color:#333333'>But our
platform aims to have full control over all pages that create, edit and delete
content, as well as the overviews. Custom entities give us more power to define
our own access functions.</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:17.4pt;
margin-left:-.25pt;line-height:112%'><span style='color:#333333'>We build a
platform that allows users to create offers as well as to make a bid on offers.
It would not make sense to use Nodes with bundles like this:</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.4pt;
margin-left:-.25pt;line-height:110%'><b><span style='color:#333333'>Entity Node</span></b></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.4pt;
margin-left:12.45pt;line-height:110%'><b><span style='color:#333333'>Bundle </span></b><span
style='color:#333333'>Offer</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:17.65pt;
margin-left:12.4pt;line-height:110%'><b><span style='color:#333333'>Bundle </span></b><span
style='color:#333333'>Bid</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:17.4pt;
margin-left:-.25pt;line-height:112%'><span style='color:#333333'>I’d have to
add numerous access checks to make sure users only get access to their own
Offer entities and only their own Bids because they are from the same Entity.
Drupal’s node behaviour wasn’t really meant to separate access between these
kind of node types as well. No, instead we do:</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.4pt;
margin-left:-.25pt;line-height:110%'><b><span style='color:#333333'>Entity
Offer</span></b></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.4pt;
margin-left:-.25pt;line-height:110%'><b><span style='color:#333333'>Entity Bid</span></b></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:31.9pt;
margin-left:-.25pt;line-height:110%'><b><span style='color:#333333'>...</span></b></p>

<p class=MsoNormal style='margin-top:0in;margin-right:7.8pt;margin-bottom:30.75pt;
margin-left:14.25pt;text-indent:0in;background:#FFD966'><span style='color:
#333333'>Proper modelling of our data is crucial. The <b>Entity API </b>provides
us all the tools for doing this.</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:17.4pt;
margin-left:-.25pt;line-height:112%'><span style='color:#333333'>We start with
creating a content entity ‘Offer’.</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.15pt;
margin-left:-.25pt;line-height:112%'><span style='color:#333333'>A file named <b>Offer.php
</b>file inside <b>modules/custom/offer/src/Entity </b>will define our entity.
Copy this code to define the entity:</span></p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:130.5pt'>
  <td width=601 valign=top style='width:450.75pt;background:#F8F8F8;padding:
  7.65pt 5.75pt 0in 5.25pt;height:130.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><b><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999999'>&lt;?php</span></b></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:0in;text-indent:0in;line-height:107%'><i><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>/**</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:12.1pt;text-indent:-12.1pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>@file</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:12.1pt;text-indent:-12.1pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>Contains
  \Drupal\offer\Entity\Offer.</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:258.45pt;margin-bottom:
  0in;margin-left:0in;text-indent:0in;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*/
  </span></i><b><span style='font-size:11.0pt;line-height:107%;font-family:
  Consolas;color:#333333'>namespace </span></b><b><span style='font-size:11.0pt;
  line-height:107%;font-family:Consolas;color:#990000'>Drupal</span></b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#990000'>offer</span></b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#990000'>Entity</span></b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>;</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.55pt;margin-bottom:0in;
margin-left:-1.0in;text-indent:0in;line-height:107%'>&nbsp;</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:685.5pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 16.4pt 0in 5.25pt;
  height:685.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:126.9pt;margin-bottom:
  14.2pt;margin-left:0in;text-indent:0in;line-height:121%'><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>use
  </span></b><b><span style='font-size:11.0pt;line-height:121%;font-family:
  Consolas;color:#990000'>Drupal</span></b><span style='font-size:11.0pt;
  line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>Core</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>Entity</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>EditorialContentEntityBase</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>;
  <b>use </b></span><b><span style='font-size:11.0pt;line-height:121%;
  font-family:Consolas;color:#990000'>Drupal</span></b><span style='font-size:
  11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>Core</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>Field</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>BaseFieldDefinition</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>;
  <b>use </b></span><b><span style='font-size:11.0pt;line-height:121%;
  font-family:Consolas;color:#990000'>Drupal</span></b><span style='font-size:
  11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>Core</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>Entity</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>EntityTypeInterface</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>;
  <b>use </b></span><b><span style='font-size:11.0pt;line-height:121%;
  font-family:Consolas;color:#990000'>Drupal</span></b><span style='font-size:
  11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>Core</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>Entity</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>ContentEntityInterface</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>;
  <b>use </b></span><b><span style='font-size:11.0pt;line-height:121%;
  font-family:Consolas;color:#990000'>Drupal</span></b><span style='font-size:
  11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>Core</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>Entity</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>EntityStorageInterface</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><i><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>/**</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  </span></span><i><span style='font-size:11.0pt;line-height:107%;font-family:
  Consolas;color:#999988'>Defines the offer entity.</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:0in;text-indent:0in;line-height:107%'><i><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  </span></span><i><span style='font-size:11.0pt;line-height:107%;font-family:
  Consolas;color:#DD1144'>@ingroup </span></i><i><span style='font-size:11.0pt;
  line-height:107%;font-family:Consolas;color:#999988'>offer</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:0in;text-indent:0in;line-height:107%'><i><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  </span></span><i><span style='font-size:11.0pt;line-height:107%;font-family:
  Consolas;color:#DD1144'>@ContentEntityType</span></i><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>(</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  </span></span><i><span style='font-size:11.0pt;line-height:107%;font-family:
  Consolas;color:#999988'>id = &quot;offer&quot;,</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  </span></span><i><span style='font-size:11.0pt;line-height:107%;font-family:
  Consolas;color:#999988'>label = </span></i><i><span style='font-size:11.0pt;
  line-height:107%;font-family:Consolas;color:#DD1144'>@Translation</span></i><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>(&quot;Offer&quot;),</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  </span></span><i><span style='font-size:11.0pt;line-height:107%;font-family:
  Consolas;color:#999988'>base_table = &quot;offer&quot;,</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  </span></span><i><span style='font-size:11.0pt;line-height:107%;font-family:
  Consolas;color:#999988'>data_table = &quot;offer_field_data&quot;,</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  </span></span><i><span style='font-size:11.0pt;line-height:107%;font-family:
  Consolas;color:#999988'>revision_table = &quot;offer_revision&quot;,</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  </span></span><i><span style='font-size:11.0pt;line-height:107%;font-family:
  Consolas;color:#999988'>revision_data_table =
  &quot;offer_field_revision&quot;,</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  </span></span><i><span style='font-size:11.0pt;line-height:107%;font-family:
  Consolas;color:#999988'>entity_keys = {</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  </span></span><i><span style='font-size:11.0pt;line-height:107%;font-family:
  Consolas;color:#999988'>&quot;id&quot; = &quot;id&quot;,</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  </span></span><i><span style='font-size:11.0pt;line-height:107%;font-family:
  Consolas;color:#999988'>&quot;uuid&quot; = &quot;uuid&quot;,</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  </span></span><i><span style='font-size:11.0pt;line-height:107%;font-family:
  Consolas;color:#999988'>&quot;label&quot; = &quot;title&quot;,</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  </span></span><i><span style='font-size:11.0pt;line-height:107%;font-family:
  Consolas;color:#999988'>&quot;revision&quot; = &quot;vid&quot;,</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  </span></span><i><span style='font-size:11.0pt;line-height:107%;font-family:
  Consolas;color:#999988'>&quot;status&quot; = &quot;status&quot;,</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  </span></span><i><span style='font-size:11.0pt;line-height:107%;font-family:
  Consolas;color:#999988'>&quot;published&quot; = &quot;status&quot;,</span></i></p>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:115%'><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  </span></span><i><span style='font-size:11.0pt;line-height:115%;font-family:
  Consolas;color:#999988'>&quot;uid&quot; = &quot;uid&quot;,*    
  &quot;owner&quot; = &quot;uid&quot;,</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  </span></span><i><span style='font-size:11.0pt;line-height:107%;font-family:
  Consolas;color:#999988'>},</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  </span></span><i><span style='font-size:11.0pt;line-height:107%;font-family:
  Consolas;color:#999988'>revision_metadata_keys = {</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  </span></span><i><span style='font-size:11.0pt;line-height:107%;font-family:
  Consolas;color:#999988'>&quot;revision_user&quot; = &quot;revision_uid&quot;,</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  </span></span><i><span style='font-size:11.0pt;line-height:107%;font-family:
  Consolas;color:#999988'>&quot;revision_created&quot; =
  &quot;revision_timestamp&quot;,</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  </span></span><i><span style='font-size:11.0pt;line-height:107%;font-family:
  Consolas;color:#999988'>&quot;revision_log_message&quot; =
  &quot;revision_log&quot;</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  </span></span><i><span style='font-size:11.0pt;line-height:107%;font-family:
  Consolas;color:#999988'>},</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:7.9pt;
  margin-left:0in;text-indent:0in;line-height:176%'><span style='font-size:
  11.0pt;line-height:176%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  </span></span><i><span style='font-size:11.0pt;line-height:176%;font-family:
  Consolas;color:#999988'>)*/ </span></i><b><span style='font-size:11.0pt;
  line-height:176%;font-family:Consolas;color:#333333'>class </span></b><b><span
  style='font-size:11.0pt;line-height:176%;font-family:Consolas;color:#445588'>Offer
  </span></b><b><span style='font-size:11.0pt;line-height:176%;font-family:
  Consolas;color:#333333'>extends </span></b><b><span style='font-size:11.0pt;
  line-height:176%;font-family:Consolas;color:#445588'>EditorialContentEntityBase
  </span></b><span style='font-size:11.0pt;line-height:176%;font-family:Consolas;
  color:#333333'>{</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>public
  static function </span></b><b><span style='font-size:11.0pt;line-height:107%;
  font-family:Consolas;color:#990000'>baseFieldDefinitions</span></b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>(EntityTypeInterface</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$entity_type) {</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:15.0pt;
  margin-left:0in;text-align:justify;text-justify:inter-ideograph;text-indent:
  18.15pt;line-height:115%'><span style='font-size:11.0pt;line-height:115%;
  font-family:Consolas;color:#333333'>$fields = <b>parent</b>::baseFieldDefinitions($entity_type);
  </span><i><span style='font-size:11.0pt;line-height:115%;font-family:Consolas;
  color:#999988'>// provides id and uuid fields</span></i></p>
  <p class=MsoNormal align=center style='margin-top:0in;margin-right:0in;
  margin-bottom:.95pt;margin-left:18.15pt;text-align:center;text-indent:0in;
  line-height:107%'><span style='font-size:11.0pt;line-height:107%;font-family:
  Consolas;color:#333333'>$fields[</span><span style='font-size:11.0pt;
  line-height:107%;font-family:Consolas;color:#DD1144'>'user_id'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>]
  = BaseFieldDefinition::create(</span><span style='font-size:11.0pt;
  line-height:107%;font-family:Consolas;color:#DD1144'>'entity_reference'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>)</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:30.2pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>-&gt;setLabel(t(</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'User'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>))</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.55pt;margin-bottom:0in;
margin-left:-1.0in;text-indent:0in;line-height:107%'>&nbsp;</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:685.5pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
  height:685.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>-&gt;setDescription(t(</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'The
  user that created the offer.'</span><span style='font-size:11.0pt;line-height:
  107%;font-family:Consolas;color:#333333'>))</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>-&gt;setSetting(</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'target_type'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>,
  </span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#DD1144'>'user'</span><span style='font-size:11.0pt;line-height:107%;
  font-family:Consolas;color:#333333'>)</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>-&gt;setSetting(</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'handler'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>,
  </span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#DD1144'>'default'</span><span style='font-size:11.0pt;line-height:
  107%;font-family:Consolas;color:#333333'>)</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>-&gt;setDisplayOptions(</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'view'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>,
  [</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:24.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'label' </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>=&gt;
  </span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#DD1144'>'hidden'</span><span style='font-size:11.0pt;line-height:107%;
  font-family:Consolas;color:#333333'>,</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:24.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'type' </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>=&gt;
  </span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#DD1144'>'author'</span><span style='font-size:11.0pt;line-height:107%;
  font-family:Consolas;color:#333333'>,</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:24.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'weight' </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>=&gt;
  </span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:teal'>0</span><span style='font-size:11.0pt;line-height:107%;
  font-family:Consolas;color:#333333'>,</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>])</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>-&gt;setDisplayOptions(</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'form'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>,
  [</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:24.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'type' </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>=&gt;
  </span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#DD1144'>'entity_reference_autocomplete'</span><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>,</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:24.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'weight' </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>=&gt;
  </span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:teal'>5</span><span style='font-size:11.0pt;line-height:107%;
  font-family:Consolas;color:#333333'>,</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:24.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'settings' </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>=&gt;
  [</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:36.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'match_operator' </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>=&gt;
  </span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#DD1144'>'CONTAINS'</span><span style='font-size:11.0pt;line-height:
  107%;font-family:Consolas;color:#333333'>,</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:36.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'size' </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>=&gt;
  </span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#DD1144'>'60'</span><span style='font-size:11.0pt;line-height:107%;
  font-family:Consolas;color:#333333'>,</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:36.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'autocomplete_type'
  </span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#333333'>=&gt; </span><span style='font-size:11.0pt;line-height:107%;
  font-family:Consolas;color:#DD1144'>'tags'</span><span style='font-size:11.0pt;
  line-height:107%;font-family:Consolas;color:#333333'>,</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:36.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'placeholder' </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>=&gt;
  </span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#DD1144'>''</span><span style='font-size:11.0pt;line-height:107%;
  font-family:Consolas;color:#333333'>,</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:24.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>],</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>])</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>-&gt;setDisplayConfigurable(</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'form'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>,
  <b>TRUE</b>)</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:15.95pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>-&gt;setDisplayConfigurable(</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'view'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>,
  <b>TRUE</b>);</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$fields[</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'title'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>]
  = BaseFieldDefinition::create(</span><span style='font-size:11.0pt;
  line-height:107%;font-family:Consolas;color:#DD1144'>'string'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>)</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>-&gt;setLabel(t(</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'Title'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>))</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>-&gt;setDescription(t(</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'The
  title of the offer'</span><span style='font-size:11.0pt;line-height:107%;
  font-family:Consolas;color:#333333'>))</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>-&gt;setSettings([</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:24.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'max_length' </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>=&gt;
  </span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:teal'>150</span><span style='font-size:11.0pt;line-height:107%;
  font-family:Consolas;color:#333333'>,</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:24.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'text_processing'
  </span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#333333'>=&gt; </span><span style='font-size:11.0pt;line-height:107%;
  font-family:Consolas;color:teal'>0</span><span style='font-size:11.0pt;
  line-height:107%;font-family:Consolas;color:#333333'>,</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>])</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>-&gt;setDefaultValue(</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>''</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>)</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>-&gt;setDisplayOptions(</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'view'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>,
  [</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:24.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'label' </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>=&gt;
  </span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#DD1144'>'above'</span><span style='font-size:11.0pt;line-height:107%;
  font-family:Consolas;color:#333333'>,</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:24.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'type' </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>=&gt;
  </span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#DD1144'>'string'</span><span style='font-size:11.0pt;line-height:107%;
  font-family:Consolas;color:#333333'>,</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:24.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'weight' </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>=&gt;
  </span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:teal'>-4</span><span style='font-size:11.0pt;line-height:107%;
  font-family:Consolas;color:#333333'>,</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>])</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>-&gt;setDisplayOptions(</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'form'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>,
  [</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:24.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'type' </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>=&gt;
  </span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#DD1144'>'string_textfield'</span><span style='font-size:11.0pt;
  line-height:107%;font-family:Consolas;color:#333333'>,</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:24.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'weight' </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>=&gt;
  </span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:teal'>-4</span><span style='font-size:11.0pt;line-height:107%;
  font-family:Consolas;color:#333333'>,</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>])</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>-&gt;setDisplayConfigurable(</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'form'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>,
  <b>TRUE</b>)</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:15.95pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>-&gt;setDisplayConfigurable(</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'view'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>,
  <b>TRUE</b>);</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$fields[</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'message'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>]
  = BaseFieldDefinition::create(</span><span style='font-size:11.0pt;
  line-height:107%;font-family:Consolas;color:#DD1144'>'string_long'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>)</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>-&gt;setLabel(t(</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'Message'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>))</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>-&gt;setRequired(<b>TRUE</b>)</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>-&gt;setDisplayOptions(</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'form'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>,
  [</span></p>
  </td>
 </tr>
 <tr style='height:475.5pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
  height:475.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:42.3pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'type' </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>=&gt;
  </span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#DD1144'>'string_textarea'</span><span style='font-size:11.0pt;
  line-height:107%;font-family:Consolas;color:#333333'>,</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:42.3pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'weight' </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>=&gt;
  </span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:teal'>4</span><span style='font-size:11.0pt;line-height:107%;
  font-family:Consolas;color:#333333'>,</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:42.3pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'settings' </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>=&gt;
  [</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:54.4pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'rows' </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>=&gt;
  </span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:teal'>12</span><span style='font-size:11.0pt;line-height:107%;
  font-family:Consolas;color:#333333'>,</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:42.3pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>],</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:30.2pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>])</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:30.2pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>-&gt;setDisplayConfigurable(</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'form'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>,
  <b>TRUE</b>)</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:30.2pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>-&gt;setDisplayOptions(</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'view'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>,
  [</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:234.25pt;margin-bottom:
  0in;margin-left:42.3pt;text-indent:0in;line-height:121%'><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#DD1144'>'type'
  </span><span style='font-size:11.0pt;line-height:121%;font-family:Consolas;
  color:#333333'>=&gt; </span><span style='font-size:11.0pt;line-height:121%;
  font-family:Consolas;color:#DD1144'>'string'</span><span style='font-size:
  11.0pt;line-height:121%;font-family:Consolas;color:#333333'>, </span><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#DD1144'>'weight'
  </span><span style='font-size:11.0pt;line-height:121%;font-family:Consolas;
  color:#333333'>=&gt; </span><span style='font-size:11.0pt;line-height:121%;
  font-family:Consolas;color:teal'>0</span><span style='font-size:11.0pt;
  line-height:121%;font-family:Consolas;color:#333333'>,</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:42.3pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'label' </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>=&gt;
  </span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#DD1144'>'above'</span><span style='font-size:11.0pt;line-height:107%;
  font-family:Consolas;color:#333333'>,</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:30.2pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>])</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:15.95pt;
  margin-left:30.2pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>-&gt;setDisplayConfigurable(</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'view'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>,
  <b>TRUE</b>);</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$fields[</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'status'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>]
  = BaseFieldDefinition::create(</span><span style='font-size:11.0pt;
  line-height:107%;font-family:Consolas;color:#DD1144'>'boolean'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>)</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:30.2pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>-&gt;setLabel(t(</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'Publishing
  status'</span><span style='font-size:11.0pt;line-height:107%;font-family:
  Consolas;color:#333333'>))</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:4.6pt;margin-bottom:
  0in;margin-left:0in;text-indent:30.2pt;line-height:115%'><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>-&gt;setDescription(t(</span><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#DD1144'>'A
  boolean indicating whether the Offer entity is published.'</span><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>))</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:15.95pt;
  margin-left:30.2pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>-&gt;setDefaultValue(<b>TRUE</b>);</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$fields[</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'created'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>]
  = BaseFieldDefinition::create(</span><span style='font-size:11.0pt;
  line-height:107%;font-family:Consolas;color:#DD1144'>'created'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>)</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:30.2pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>-&gt;setLabel(t(</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'Created'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>))</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:15.95pt;
  margin-left:30.2pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>-&gt;setDescription(t(</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'The
  time that the entity was created.'</span><span style='font-size:11.0pt;
  line-height:107%;font-family:Consolas;color:#333333'>));</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$fields[</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'changed'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>]
  = BaseFieldDefinition::create(</span><span style='font-size:11.0pt;
  line-height:107%;font-family:Consolas;color:#DD1144'>'changed'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>)</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:30.2pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>-&gt;setLabel(t(</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'Changed'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>))</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:16.8pt;
  margin-left:30.2pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>-&gt;setDescription(t(</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'The
  time that the entity was last edited.'</span><span style='font-size:11.0pt;
  line-height:107%;font-family:Consolas;color:#333333'>));</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>return
  </span></b><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#333333'>$fields;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>After clearing cache our entity is created and two extra
database tables were added:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:57.25pt;
margin-left:1.5pt;text-indent:0in;line-height:107%'><img border=0 width=469
height=682 id="Picture 4239"
src="Learning%20drupal%209%20as%20a%20framework_files/image028.jpg"></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:21.85pt;
margin-left:-.25pt'>Now let’s proceed with the CRUD operations. For every
offer, we’d like to have an add, edit and delete form. But first, we secure the
access.</p>

<h2 style='margin-left:-.25pt'><a name="_Toc247041">Securing access of our
entities</a></h2>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=600
 style='width:6.25in;border-collapse:collapse'>
 <tr style='height:42.0pt'>
  <td width=59 style='width:44.25pt;background:#6D9EEB;padding:0in 5.75pt 0in 0in;
  height:42.0pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:14.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%'>&#128073;</span></p>
  </td>
  <td width=541 style='width:405.75pt;background:#6D9EEB;padding:0in 5.75pt 0in 0in;
  height:42.0pt'>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%'>In this important section you will
  be taught how <b>entity access </b>works. At the end</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:15.1pt;margin-bottom:
31.25pt;margin-left:44.75pt;line-height:110%;background:#6D9EEB'><span
style='font-size:11.0pt;line-height:110%'>of the section you will be able to
create custom permissions for users and translate it towards your entity. In
the use case of this project it means that authors can only see/edit/delete
their <u>own </u>created entities.</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>There is something worth noticing about our entities. While
the author of the entity will be the owner (thanks to the <i>PreCreate() </i>function
in our Offer entity) he has no exclusive access towards viewing, or even
editing and deleting the entity.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>While drupal will typically provide separate “view”,
“create”, “edit” and “delete” options we will (for now) make this 1 single
permission: <b><i>administer own offers</i></b>.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>But we did not specify which access this means towards the
entity itself. Let us make sure that everyone with this access can create
offers and more importantly that they can only edit and delete their own offers
and not those of others.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:22.95pt;
margin-left:-.25pt;line-height:110%'>First, add a file <b>modules/custom/offer/offer.permissions.yml
</b>with the following:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:188.7pt;margin-bottom:
22.9pt;margin-left:11.1pt;text-indent:-6.6pt;line-height:112%;background:#F8F8F8'><span
style='font-family:Consolas'>administer own </span><span style='font-family:
Consolas;color:#333333'>offers: title: </span><span style='font-family:Consolas;
color:#DD1144'>'Create/edit/delete own offers'</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:2.1pt;
margin-left:-.25pt'>Second, add the following methods to the <b>custom/offer/src/Offer
</b>class at the bottom, these are two methods that are used quite a lot. The
first one is to make sure the user id gets stored as the author of the entity, 
The other ones are typical methods to quickly get info about the author of an
entity:</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:250.5pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
  height:250.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><i><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>/**</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:18.15pt;text-indent:-12.1pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>{</span></i><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>@inheritdoc</span></i><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>}</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:18.15pt;text-indent:-12.1pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>Makes
  the current user the owner of the entity</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:107.35pt;margin-bottom:
  0in;margin-left:0in;text-indent:6.05pt;line-height:121%'><i><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#999988'>*/
  </span></i><b><span style='font-size:11.0pt;line-height:121%;font-family:
  Consolas;color:#333333'>public static function </span></b><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>preCreate</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>(EntityStorageInterface</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.8pt;
  margin-left:12.1pt;text-indent:-12.1pt;line-height:115%'><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>$storage_controller,
  array &amp;$values) { <b>parent</b>::preCreate($storage_controller, $values);</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$values += <b>array</b>(</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:149.65pt;margin-bottom:
  0in;margin-left:12.1pt;text-indent:12.1pt;line-height:115%'><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#DD1144'>'user_id'
  </span><span style='font-size:11.0pt;line-height:115%;font-family:Consolas;
  color:#333333'>=&gt; \Drupal::currentUser()-&gt;id(), );</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:15.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><i><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>/**</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:18.15pt;text-indent:-12.1pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>{</span></i><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>@inheritdoc</span></i><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>}</span></i></p>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*/</span></i></p>
  </td>
 </tr>
 <tr style='height:160.5pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
  height:160.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:0in;text-indent:0in;line-height:107%'><b><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>public function </span></b><b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#990000'>getOwner</span></b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>()
  {</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>return
  $this</span></b><span style='font-size:11.0pt;line-height:107%;font-family:
  Consolas;color:#333333'>-&gt;get(</span><span style='font-size:11.0pt;
  line-height:107%;font-family:Consolas;color:#DD1144'>'user_id'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>)-&gt;entity;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:15.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><i><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>/**</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><i><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>* {</span></i><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>@inheritdoc</span></i><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>}</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:258.45pt;margin-bottom:
  0in;margin-left:0in;text-indent:0in;line-height:121%'><i><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#999988'>*/
  </span></i><b><span style='font-size:11.0pt;line-height:121%;font-family:
  Consolas;color:#333333'>public function </span></b><b><span style='font-size:
  11.0pt;line-height:121%;font-family:Consolas;color:#990000'>getOwnerId</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>()
  {</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>return
  $this</span></b><span style='font-size:11.0pt;line-height:107%;font-family:
  Consolas;color:#333333'>-&gt;get(</span><span style='font-size:11.0pt;
  line-height:107%;font-family:Consolas;color:#DD1144'>'user_id'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>)-&gt;target_id;</span></p>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.05pt;
margin-left:-.25pt;line-height:117%'>In the end we want full CRUD access for
our authenticated users. <span style='background:yellow'>When accessing an
entity in drupal, there are 4 operations that can be requested</span>:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:1.05pt;
margin-left:.5in;text-indent:-.25in'><span style='font-family:"Arial",sans-serif'>&#9679;<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span>view</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:1.05pt;
margin-left:.5in;text-indent:-.25in'><span style='font-family:"Arial",sans-serif'>&#9679;<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span>update</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:1.1pt;
margin-left:.5in;text-indent:-.25in'><span style='font-family:"Arial",sans-serif'>&#9679;<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span>edit</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:.5in;text-indent:-.25in'><span style='font-family:"Arial",sans-serif'>&#9679;<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span>delete</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:.3in;
margin-left:-.25pt'>Add the following to the <a
href="https://www.drupal.org/docs/8/api/entity-api/structure-of-an-entity-annotation"><span
style='color:#1155CC'>annotations</span></a><u><span style='color:#1155CC'> </span></u>of
your entity inside the <b>modules/custom/offer/src/Entity/Offer.php </b>file:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:33.7pt;margin-bottom:
1.45pt;margin-left:30.9pt;text-indent:-26.4pt;line-height:112%;background:#F8F8F8'><span
style='font-family:Consolas;color:#333333'>*<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span style='font-family:Consolas;color:#333333'>handlers = {</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:33.7pt;margin-bottom:
23.05pt;margin-left:30.9pt;text-indent:-26.4pt;line-height:112%;background:
#F8F8F8'><span style='font-family:Consolas;color:#333333'>*<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span
style='font-family:Consolas;color:#DD1144'>&quot;access&quot; </span><span
style='font-family:Consolas;color:#333333'>= </span><span style='font-family:
Consolas;color:#DD1144'>&quot;Drupal\offer\OfferAccessControlHandler&quot;</span><span
style='font-family:Consolas;color:#333333'>, *   }</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:.9pt;
margin-left:-.25pt'>This file will handle access towards our entity. Add a file
called</p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.35pt;
margin-left:-.25pt;line-height:110%'><b>OfferAccessControlHandler.php </b>inside
<b>modules/custom/offer/src</b>:</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:220.5pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
  height:220.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:300.75pt;margin-bottom:
  0in;margin-left:0in;text-indent:0in;line-height:237%'><b><span
  style='font-size:11.0pt;line-height:237%;font-family:Consolas;color:#999999'>&lt;?php
  </span></b><b><span style='font-size:11.0pt;line-height:237%;font-family:
  Consolas;color:#333333'>namespace </span></b><b><span style='font-size:11.0pt;
  line-height:237%;font-family:Consolas;color:#990000'>Drupal</span></b><span
  style='font-size:11.0pt;line-height:237%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:237%;font-family:Consolas;color:#990000'>offer</span></b><span
  style='font-size:11.0pt;line-height:237%;font-family:Consolas;color:#333333'>;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:137.55pt;margin-bottom:
  14.2pt;margin-left:0in;text-indent:0in;line-height:121%'><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>use
  </span></b><b><span style='font-size:11.0pt;line-height:121%;font-family:
  Consolas;color:#990000'>Drupal</span></b><span style='font-size:11.0pt;
  line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>Core</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>Access</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>AccessResult</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>;
  <b>use </b></span><b><span style='font-size:11.0pt;line-height:121%;
  font-family:Consolas;color:#990000'>Drupal</span></b><span style='font-size:
  11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>Core</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>Entity</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>EntityAccessControlHandler</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>;
  <b>use </b></span><b><span style='font-size:11.0pt;line-height:121%;
  font-family:Consolas;color:#990000'>Drupal</span></b><span style='font-size:
  11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>Core</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>Entity</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>EntityInterface</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>;
  <b>use </b></span><b><span style='font-size:11.0pt;line-height:121%;
  font-family:Consolas;color:#990000'>Drupal</span></b><span style='font-size:
  11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>Core</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>Session</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>AccountInterface</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:0in;text-indent:0in;line-height:107%'><i><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>/**</span></i></p>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:115%'><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  </span></span><i><span style='font-size:11.0pt;line-height:115%;font-family:
  Consolas;color:#999988'>Access controller for the offer entity. Controls
  create/edit/delete access for entity and fields.</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:0in;text-indent:0in;line-height:107%'><i><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*</span></i></p>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  </span></span><i><span style='font-size:11.0pt;line-height:107%;font-family:
  Consolas;color:#DD1144'>@see </span></i><i><span style='font-size:11.0pt;
  line-height:107%;font-family:Consolas;color:#999988'>\Drupal\offer\Entity\Offer.</span></i></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.55pt;margin-bottom:0in;
margin-left:-1.0in;text-indent:0in;line-height:107%'>&nbsp;</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:685.5pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 10.35pt 0in 5.25pt;
  height:685.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:24.15pt;margin-bottom:
  14.2pt;margin-left:0in;text-indent:0in;line-height:121%'><i><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#999988'>*/
  </span></i><b><span style='font-size:11.0pt;line-height:121%;font-family:
  Consolas;color:#333333'>class </span></b><b><span style='font-size:11.0pt;
  line-height:121%;font-family:Consolas;color:#445588'>OfferAccessControlHandler
  </span></b><b><span style='font-size:11.0pt;line-height:121%;font-family:
  Consolas;color:#333333'>extends </span></b><b><span style='font-size:11.0pt;
  line-height:121%;font-family:Consolas;color:#445588'>EntityAccessControlHandler
  </span></b><span style='font-size:11.0pt;line-height:121%;font-family:Consolas;
  color:#333333'>{</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>/**</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:12.1pt;text-indent:12.1pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>{</span></i><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>@inheritdoc</span></i><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>}</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:12.1pt;text-indent:12.1pt;line-height:115%'><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#999988'>Link
  the activities to the permissions. checkAccess is called with the</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:12.1pt;text-indent:12.1pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>$operation
  as defined in the routing.yml file.</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:24.15pt;margin-bottom:
  0in;margin-left:6.05pt;text-indent:6.05pt;line-height:121%'><i><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#999988'>*/
  </span></i><b><span style='font-size:11.0pt;line-height:121%;font-family:
  Consolas;color:#333333'>protected function </span></b><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>checkAccess</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>(EntityInterface
  $entity, $operation,</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:15.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>AccountInterface
  $account) {</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:16.8pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$access =
  AccessResult::forbidden();</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:265.9pt;margin-bottom:
  0in;margin-left:30.25pt;text-indent:-12.1pt;line-height:121%'><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>switch
  </span></b><span style='font-size:11.0pt;line-height:121%;font-family:Consolas;
  color:#333333'>($operation) { <b>case </b></span><span style='font-size:11.0pt;
  line-height:121%;font-family:Consolas;color:#DD1144'>'view'</span><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>:</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:42.3pt;text-indent:0in;line-height:107%'><b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>if
  </span></b><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#333333'>($account-&gt;hasPermission(</span><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'administer own
  offers'</span><span style='font-size:11.0pt;line-height:107%;font-family:
  Consolas;color:#333333'>)) {</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:54.4pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$access =
  AccessResult::allowedIf($account-&gt;id() ==</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$entity-&gt;getOwnerId())-&gt;cachePerUser()-&gt;addCacheableDependency($entity);</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:350.5pt;margin-bottom:
  .8pt;margin-left:42.3pt;text-indent:0in;line-height:115%'><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>}
  <b>break</b>;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:60.45pt;margin-bottom:
  0in;margin-left:42.3pt;text-indent:-12.1pt;line-height:121%'><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>case
  </span></b><span style='font-size:11.0pt;line-height:121%;font-family:Consolas;
  color:#DD1144'>'update'</span><span style='font-size:11.0pt;line-height:121%;
  font-family:Consolas;color:#333333'>: </span><i><span style='font-size:11.0pt;
  line-height:121%;font-family:Consolas;color:#999988'>// Shows the edit
  buttons in operations </span></i><b><span style='font-size:11.0pt;line-height:
  121%;font-family:Consolas;color:#333333'>if </span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>($account-&gt;hasPermission(</span><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#DD1144'>'administer
  own offers'</span><span style='font-size:11.0pt;line-height:121%;font-family:
  Consolas;color:#333333'>)) {</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:54.4pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$access =
  AccessResult::allowedIf($account-&gt;id() ==</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$entity-&gt;getOwnerId())-&gt;cachePerUser()-&gt;addCacheableDependency($entity);</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:350.5pt;margin-bottom:
  .8pt;margin-left:42.3pt;text-indent:0in;line-height:115%'><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>}
  <b>break</b>;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:48.35pt;margin-bottom:
  0in;margin-left:42.3pt;text-indent:-12.1pt;line-height:121%'><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>case
  </span></b><span style='font-size:11.0pt;line-height:121%;font-family:Consolas;
  color:#DD1144'>'edit'</span><span style='font-size:11.0pt;line-height:121%;
  font-family:Consolas;color:#333333'>: </span><i><span style='font-size:11.0pt;
  line-height:121%;font-family:Consolas;color:#999988'>// Lets me in on the
  edit-page of the entity </span></i><b><span style='font-size:11.0pt;
  line-height:121%;font-family:Consolas;color:#333333'>if </span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>($account-&gt;hasPermission(</span><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#DD1144'>'administer
  own offers'</span><span style='font-size:11.0pt;line-height:121%;font-family:
  Consolas;color:#333333'>)) {</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:54.4pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$access =
  AccessResult::allowedIf($account-&gt;id() ==</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$entity-&gt;getOwnerId())-&gt;cachePerUser()-&gt;addCacheableDependency($entity);</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:350.5pt;margin-bottom:
  .8pt;margin-left:42.3pt;text-indent:0in;line-height:115%'><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>}
  <b>break</b>;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:30.2pt;text-indent:0in;line-height:107%'><b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>case
  </span></b><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#DD1144'>'delete'</span><span style='font-size:11.0pt;line-height:107%;
  font-family:Consolas;color:#333333'>: </span><i><span style='font-size:11.0pt;
  line-height:107%;font-family:Consolas;color:#999988'>// Shows the delete
  buttons + access to delete this</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:60.45pt;margin-bottom:
  0in;margin-left:42.3pt;text-align:justify;text-justify:inter-ideograph;
  text-indent:-42.3pt;line-height:121%'><i><span style='font-size:11.0pt;
  line-height:121%;font-family:Consolas;color:#999988'>entity </span></i><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>if
  </span></b><span style='font-size:11.0pt;line-height:121%;font-family:Consolas;
  color:#333333'>($account-&gt;hasPermission(</span><span style='font-size:
  11.0pt;line-height:121%;font-family:Consolas;color:#DD1144'>'administer own
  offers'</span><span style='font-size:11.0pt;line-height:121%;font-family:
  Consolas;color:#333333'>)) {</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:54.4pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$access =
  AccessResult::allowedIf($account-&gt;id() ==</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$entity-&gt;getOwnerId())-&gt;cachePerUser()-&gt;addCacheableDependency($entity);</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:350.5pt;margin-bottom:
  0in;margin-left:42.3pt;text-indent:0in;line-height:115%'><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>}
  <b>break</b>;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:16.8pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>return
  </span></b><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#333333'>$access;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  </td>
 </tr>
 <tr style='height:265.5pt'>
  <td width=601 valign=bottom style='width:450.75pt;background:#F8F8F8;
  padding:0in 10.35pt 0in 5.25pt;height:265.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>/**</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:12.1pt;text-indent:12.1pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>{</span></i><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>@inheritdoc</span></i><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>}</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:12.1pt;text-indent:12.1pt;line-height:115%'><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#999988'>Separate
  from the checkAccess because the entity does not yet exist, it</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:12.1pt;text-indent:12.1pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>will
  be created during the 'add' process.</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:12.1pt;margin-bottom:
  0in;margin-left:6.05pt;text-indent:6.05pt;line-height:121%'><i><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#999988'>*/
  </span></i><b><span style='font-size:11.0pt;line-height:121%;font-family:
  Consolas;color:#333333'>protected function </span></b><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>checkCreateAccess</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>(AccountInterface
  $account, array</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:18.15pt;text-indent:-18.15pt;line-height:121%'><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>$context,
  $entity_bundle = NULL) { <b>return </b>AccessResult::allowedIfHasPermission($account,
  </span><span style='font-size:11.0pt;line-height:121%;font-family:Consolas;
  color:#DD1144'>'administer own</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:374.7pt;margin-bottom:
  15.0pt;margin-left:6.05pt;text-indent:-6.05pt;line-height:115%'><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#DD1144'>offers'</span><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>);
  }</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:15.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999999'>?&gt;</span></b></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:15.1pt;margin-bottom:
32.35pt;margin-left:14.0pt;line-height:110%;background:#FFD966'><span
style='font-size:11.0pt;line-height:110%'>This access controller gives us a
variety of power towards our entity. We now have full control in code on who
can access different modes of our entity.</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:1.9pt;
margin-left:-.25pt'>If you take a closer look, it is here that we integrate our
permission (administer own offers) with our view/edit/update/delete access. As
an extra we add a check to make sure there is only access to own entities.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:19.0pt;
margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:11.0pt;
line-height:107%'><img border=0 width=602 height=251
src="Learning%20drupal%209%20as%20a%20framework_files/image029.gif"></span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>In a later stage of the software, we can create different
user roles for which entire access to the CRUD section can be granted with one
click.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:21.7pt;
margin-left:-.25pt'>With our entity access completely nailed, <span
style='background:yellow'>we are about to use these access checks in our
routing and crud forms</span>. Let’s move on to the next chapter!</p>

<h2 style='margin-left:-.25pt'><a name="_Toc247042">Adding the
create/edit/delete forms (CRUD)</a></h2>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=600
 style='width:6.25in;border-collapse:collapse'>
 <tr style='height:69.0pt'>
  <td width=55 valign=top style='width:40.9pt;background:#6D9EEB;padding:14.6pt 5.75pt 0in 3.4pt;
  height:69.0pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:10.9pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%'>&#128073;</span></p>
  </td>
  <td width=546 style='width:409.15pt;background:#6D9EEB;padding:14.6pt 5.75pt 0in 3.4pt;
  height:69.0pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:9.65pt;margin-bottom:
  0in;margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%'>This section highlights the entity CRUD (create,
  read, edit, delete) process. At the end you will have learnt the ins and outs
  of how to show a user an <b>entity form </b>for <b>creation, editing and
  deleting </b>of a <b>custom entity</b>.</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:20.75pt;
margin-left:-.25pt'>For our <a
href="https://en.wikipedia.org/wiki/Create,_read,_update_and_delete"><span
style='color:#1155CC'>CRUD</span></a><u><span style='color:#1155CC'> </span></u>operations,
the system needs to know where to put them. Let’s update our <b>modules/custom/offer/src/Entity/offer.php
</b>once again by adding the forms and links:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.45pt;
margin-left:52.85pt;text-indent:-48.35pt;line-height:110%;background:#F8F8F8'><span
style='font-size:11.0pt;line-height:110%;font-family:Consolas;color:#333333'>*<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><i><span style='font-size:11.0pt;line-height:110%;font-family:
Consolas;color:#333333'>handlers = {</span></i></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.75pt;
margin-left:52.85pt;text-indent:-48.35pt;line-height:107%;background:#F8F8F8'><span
style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>*<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><i><span style='font-size:11.0pt;line-height:107%;font-family:
Consolas;color:#DD1144'>&quot;access&quot; </span></i><i><span
style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>= </span></i><i><span
style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>&quot;Drupal\offer\OfferAccessControlHandler&quot;</span></i><i><span
style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>,</span></i></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.75pt;
margin-left:52.85pt;text-indent:-48.35pt;line-height:107%;background:#F8F8F8'><span
style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>*<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><i><span style='font-size:11.0pt;line-height:107%;font-family:
Consolas;color:#DD1144'>&quot;form&quot; </span></i><i><span style='font-size:
11.0pt;line-height:107%;font-family:Consolas;color:#333333'>= {</span></i></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.75pt;
margin-left:52.85pt;text-indent:-48.35pt;line-height:107%;background:#F8F8F8'><span
style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>*<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><i><span style='font-size:11.0pt;line-height:107%;font-family:
Consolas;color:#DD1144'>&quot;add&quot; </span></i><i><span style='font-size:
11.0pt;line-height:107%;font-family:Consolas;color:#333333'>= </span></i><i><span
style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>&quot;Drupal\offer\Form\OfferForm&quot;</span></i><i><span
style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>,</span></i></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.75pt;
margin-left:52.85pt;text-indent:-48.35pt;line-height:107%;background:#F8F8F8'><span
style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>*<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><i><span style='font-size:11.0pt;line-height:107%;font-family:
Consolas;color:#DD1144'>&quot;edit&quot; </span></i><i><span style='font-size:
11.0pt;line-height:107%;font-family:Consolas;color:#333333'>= </span></i><i><span
style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>&quot;Drupal\offer\Form\OfferForm&quot;</span></i><i><span
style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>,</span></i></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.75pt;
margin-left:52.85pt;text-indent:-48.35pt;line-height:107%;background:#F8F8F8'><span
style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>*<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><i><span style='font-size:11.0pt;line-height:107%;font-family:
Consolas;color:#DD1144'>&quot;delete&quot; </span></i><i><span
style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>= </span></i><i><span
style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>&quot;Drupal\offer\Form\OfferDeleteForm&quot;</span></i><i><span
style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>,</span></i></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.45pt;
margin-left:52.85pt;text-indent:-48.35pt;line-height:110%;background:#F8F8F8'><span
style='font-size:11.0pt;line-height:110%;font-family:Consolas;color:#333333'>*<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><i><span style='font-size:11.0pt;line-height:110%;font-family:
Consolas;color:#333333'>},</span></i></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.45pt;
margin-left:52.85pt;text-indent:-48.35pt;line-height:110%;background:#F8F8F8'><span
style='font-size:11.0pt;line-height:110%;font-family:Consolas;color:#333333'>*<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><i><span style='font-size:11.0pt;line-height:110%;font-family:
Consolas;color:#333333'>},</span></i></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.45pt;
margin-left:52.85pt;text-indent:-48.35pt;line-height:110%;background:#F8F8F8'><span
style='font-size:11.0pt;line-height:110%;font-family:Consolas;color:#333333'>*<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><i><span style='font-size:11.0pt;line-height:110%;font-family:
Consolas;color:#333333'>links = {</span></i></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.75pt;
margin-left:52.85pt;text-indent:-48.35pt;line-height:107%;background:#F8F8F8'><span
style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>*<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><i><span style='font-size:11.0pt;line-height:107%;font-family:
Consolas;color:#DD1144'>&quot;canonical&quot; </span></i><i><span
style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>= </span></i><i><span
style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>&quot;/offers/{offer}&quot;</span></i><i><span
style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>,</span></i></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.75pt;
margin-left:52.85pt;text-indent:-48.35pt;line-height:107%;background:#F8F8F8'><span
style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>*<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><i><span style='font-size:11.0pt;line-height:107%;font-family:
Consolas;color:#DD1144'>&quot;delete-form&quot; </span></i><i><span
style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>= </span></i><i><span
style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>&quot;/offer/{offer}/delete&quot;</span></i><i><span
style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>,</span></i></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.75pt;
margin-left:52.85pt;text-indent:-48.35pt;line-height:107%;background:#F8F8F8'><span
style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>*<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><i><span style='font-size:11.0pt;line-height:107%;font-family:
Consolas;color:#DD1144'>&quot;edit-form&quot; </span></i><i><span
style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>= </span></i><i><span
style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>&quot;/offer/{offer}/edit&quot;</span></i><i><span
style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>,</span></i></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.75pt;
margin-left:52.85pt;text-indent:-48.35pt;line-height:107%;background:#F8F8F8'><span
style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>*<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><i><span style='font-size:11.0pt;line-height:107%;font-family:
Consolas;color:#DD1144'>&quot;create&quot; </span></i><i><span
style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>= </span></i><i><span
style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>&quot;/offer/create&quot;</span></i><i><span
style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>,</span></i></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:24.2pt;
margin-left:52.85pt;text-indent:-48.35pt;line-height:110%;background:#F8F8F8'><span
style='font-size:11.0pt;line-height:110%;font-family:Consolas;color:#333333'>*<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><i><span style='font-size:11.0pt;line-height:110%;font-family:
Consolas;color:#333333'>},</span></i></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>You may understand what we’re adding here. The links are
the routes we want to use for CRUD operations on our offer entity. Inside the
handlers directory we placed the add/edit and delete form statements.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:2.1pt;
margin-left:-.25pt'>These routes to not exist yet, so we define them in <b>modules/custom/offer/offer.routing.yml</b></p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:100.5pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
  height:100.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:300.75pt;margin-bottom:
  .4pt;margin-left:6.05pt;text-indent:-6.05pt;line-height:118%'><span
  style='font-size:11.0pt;line-height:118%;font-family:Consolas;color:#DD1144'>offer.add:
  </span><span style='font-size:11.0pt;line-height:118%;font-family:Consolas;
  color:#333333'>path: </span><span style='font-size:11.0pt;line-height:118%;
  font-family:Consolas;color:#DD1144'>'/offers/create' </span><span
  style='font-size:11.0pt;line-height:118%;font-family:Consolas;color:#333333'>defaults:</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>_entity_form: </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>offer.add</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:228.2pt;margin-bottom:
  0in;margin-left:6.05pt;text-indent:12.1pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>_title:
  </span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#DD1144'>'Add offer' </span><span style='font-size:11.0pt;line-height:
  107%;font-family:Consolas;color:#333333'>requirements:</span></p>
  </td>
 </tr>
 <tr style='height:385.5pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
  height:385.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:15.95pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>_entity_create_access:
  </span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#DD1144'>'offer'</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>entity.offer.edit_form:</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:210.1pt;margin-bottom:
  .8pt;margin-left:6.05pt;text-indent:0in;line-height:115%'><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>path:
  </span><span style='font-size:11.0pt;line-height:115%;font-family:Consolas;
  color:#DD1144'>'/offers/{offer}/edit' </span><span style='font-size:11.0pt;
  line-height:115%;font-family:Consolas;color:#333333'>defaults:</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>_entity_form: </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>offer.edit</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:222.15pt;margin-bottom:
  .8pt;margin-left:6.05pt;text-indent:12.1pt;line-height:115%'><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>_title:
  </span><span style='font-size:11.0pt;line-height:115%;font-family:Consolas;
  color:#DD1144'>'Edit offer' </span><span style='font-size:11.0pt;line-height:
  115%;font-family:Consolas;color:#333333'>requirements:</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:15.95pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>_entity_access: </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'offer.edit'</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>entity.offer.delete_form:</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:2.75in;margin-bottom:
  .8pt;margin-left:6.05pt;text-indent:0in;line-height:115%'><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>path:
  </span><span style='font-size:11.0pt;line-height:115%;font-family:Consolas;
  color:#DD1144'>'/offers/{offer}/delete' </span><span style='font-size:11.0pt;
  line-height:115%;font-family:Consolas;color:#333333'>defaults:</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>_entity_form: </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>offer.delete</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:210.1pt;margin-bottom:
  .8pt;margin-left:6.05pt;text-indent:12.1pt;line-height:115%'><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>_title:
  </span><span style='font-size:11.0pt;line-height:115%;font-family:Consolas;
  color:#DD1144'>'Delete offer' </span><span style='font-size:11.0pt;
  line-height:115%;font-family:Consolas;color:#333333'>requirements:</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:15.95pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>_entity_access: </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'offer.delete'</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:270.5pt;margin-bottom:
  .4pt;margin-left:6.05pt;text-indent:-6.05pt;line-height:118%'><span
  style='font-size:11.0pt;line-height:118%;font-family:Consolas;color:#DD1144'>entity.offer.canonical:
  </span><span style='font-size:11.0pt;line-height:118%;font-family:Consolas;
  color:#333333'>path: </span><span style='font-size:11.0pt;line-height:118%;
  font-family:Consolas;color:#DD1144'>'/offer/{offer}' </span><span
  style='font-size:11.0pt;line-height:118%;font-family:Consolas;color:#333333'>defaults:</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>_entity_view: </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'offer'</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:252.4pt;margin-bottom:
  .8pt;margin-left:6.05pt;text-indent:12.1pt;line-height:115%'><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>_title:
  </span><span style='font-size:11.0pt;line-height:115%;font-family:Consolas;
  color:#DD1144'>'Offer' </span><span style='font-size:11.0pt;line-height:115%;
  font-family:Consolas;color:#333333'>requirements:</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>_entity_access: </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'offer.view'</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>Check the <i>_entity_access </i>parameters. These will
check the access conditions inside <b>OfferAccessControlHandler </b>(checkAccess
and checkCreateAccess). By this, we control exactly who can access the
/offers/create form for example.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:2.1pt;
margin-left:-.25pt'>Now we’ll add a generic form for adding and editing. It
inherits from <i>ContentEntityForm: </i><b>custom/offer/src/Form/OfferForm.php</b>:</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:175.5pt'>
  <td width=601 valign=top style='width:450.75pt;background:#F8F8F8;padding:
  0in 5.75pt 0in 5.25pt;height:175.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><b><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999999'>&lt;?php</span></b></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:0in;text-indent:0in;line-height:107%'><i><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>/**</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:12.1pt;text-indent:-12.1pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>@file</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:12.1pt;text-indent:-12.1pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>Contains
  Drupal\offer\Form\OfferForm.</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:270.5pt;margin-bottom:
  0in;margin-left:0in;text-indent:0in;line-height:237%'><i><span
  style='font-size:11.0pt;line-height:237%;font-family:Consolas;color:#999988'>*/
  </span></i><b><span style='font-size:11.0pt;line-height:237%;font-family:
  Consolas;color:#333333'>namespace </span></b><b><span style='font-size:11.0pt;
  line-height:237%;font-family:Consolas;color:#990000'>Drupal</span></b><span
  style='font-size:11.0pt;line-height:237%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:237%;font-family:Consolas;color:#990000'>offer</span></b><span
  style='font-size:11.0pt;line-height:237%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:237%;font-family:Consolas;color:#990000'>Form</span></b><span
  style='font-size:11.0pt;line-height:237%;font-family:Consolas;color:#333333'>;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:173.8pt;margin-bottom:
  0in;margin-left:0in;text-indent:0in;line-height:107%'><b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>use
  </span></b><b><span style='font-size:11.0pt;line-height:107%;font-family:
  Consolas;color:#990000'>Drupal</span></b><span style='font-size:11.0pt;
  line-height:107%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#990000'>Core</span></b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#990000'>Entity</span></b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#990000'>ContentEntityForm</span></b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>;
  <b>use </b></span><b><span style='font-size:11.0pt;line-height:107%;
  font-family:Consolas;color:#990000'>Drupal</span></b><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#990000'>Core</span></b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#990000'>Form</span></b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#990000'>FormStateInterface</span></b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>;</span></p>
  </td>
 </tr>
 <tr style='height:430.5pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
  height:430.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><i><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>/**</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:18.15pt;text-indent:-12.1pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>Form
  controller for the offer entity edit forms.</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:0in;text-indent:0in;line-height:107%'><i><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:18.15pt;text-indent:-12.1pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>@ingroup
  </span></i><i><span style='font-size:11.0pt;line-height:107%;font-family:
  Consolas;color:#999988'>content_entity_example</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:179.85pt;margin-bottom:
  14.2pt;margin-left:0in;text-indent:0in;line-height:121%'><i><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#999988'>*/
  </span></i><b><span style='font-size:11.0pt;line-height:121%;font-family:
  Consolas;color:#333333'>class </span></b><b><span style='font-size:11.0pt;
  line-height:121%;font-family:Consolas;color:#445588'>OfferForm </span></b><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>extends
  </span></b><b><span style='font-size:11.0pt;line-height:121%;font-family:
  Consolas;color:#445588'>ContentEntityForm </span></b><span style='font-size:
  11.0pt;line-height:121%;font-family:Consolas;color:#333333'>{</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>/**</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:18.15pt;text-indent:-12.1pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>{</span></i><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>@inheritdoc</span></i><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>}</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:10.65pt;margin-bottom:
  0in;margin-left:6.05pt;text-indent:6.05pt;line-height:121%'><i><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#999988'>*/
  </span></i><b><span style='font-size:11.0pt;line-height:121%;font-family:
  Consolas;color:#333333'>public function </span></b><b><span style='font-size:
  11.0pt;line-height:121%;font-family:Consolas;color:#990000'>buildForm</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>(array
  $form, FormStateInterface $form_state)</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>{</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:119.4pt;margin-bottom:
  0in;margin-left:18.15pt;text-indent:0in;line-height:121%'><i><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#999988'>/*
  </span></i><i><span style='font-size:11.0pt;line-height:121%;font-family:
  Consolas;color:#DD1144'>@var </span></i><i><span style='font-size:11.0pt;
  line-height:121%;font-family:Consolas;color:#999988'>$entity
  \Drupal\offer\Entity\Offer */ </span></i><span style='font-size:11.0pt;
  line-height:121%;font-family:Consolas;color:#333333'>$form = <b>parent</b>::buildForm($form,
  $form_state); <b>return </b>$form;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:15.95pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>/**</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:18.15pt;text-indent:-12.1pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>{</span></i><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>@inheritdoc</span></i><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>}</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:28.75pt;margin-bottom:
  0in;margin-left:6.05pt;text-indent:6.05pt;line-height:118%'><i><span
  style='font-size:11.0pt;line-height:118%;font-family:Consolas;color:#999988'>*/
  </span></i><b><span style='font-size:11.0pt;line-height:118%;font-family:
  Consolas;color:#333333'>public function </span></b><b><span style='font-size:
  11.0pt;line-height:118%;font-family:Consolas;color:#990000'>save</span></b><span
  style='font-size:11.0pt;line-height:118%;font-family:Consolas;color:#333333'>(array
  $form, FormStateInterface $form_state) { </span><i><span style='font-size:
  11.0pt;line-height:118%;font-family:Consolas;color:#999988'>// Redirect to
  offer list after save.</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$form_state-&gt;setRedirect(</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'entity.offer.collection'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>);</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$entity = <b>$this</b>-&gt;getEntity();</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$entity-&gt;save();</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:15.95pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>Clear cache and head to <u>/offers/create</u>. There it is!
We’ve gotten ourselves access to the create and edit mode of this entity.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:-1.7pt;margin-bottom:
0in;margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
11.0pt;line-height:107%'><img border=0 width=606 height=915
src="Learning%20drupal%209%20as%20a%20framework_files/image030.gif"></span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:19.0pt;
margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:11.0pt;
line-height:107%'><img border=0 width=602 height=283
src="Learning%20drupal%209%20as%20a%20framework_files/image031.gif"></span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>At <u>/offers/1/edit </u>you should see your created entity
in an edit form with your submitted values filled in.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:2.1pt;
margin-left:-.25pt'>Apart from the overview page, a missing step towards full
CRUD operations is the delete form. We’ve already added the definition in our
entity and routing, so now add <b>custom/offer/src/Form/OfferDeleteForm.php</b>:</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:340.5pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
  height:340.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:15.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><b><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999999'>&lt;?php</span></b></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:0in;text-indent:0in;line-height:107%'><i><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>/**</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:12.1pt;text-indent:-12.1pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>@file</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:12.1pt;text-indent:-12.1pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>Contains
  \Drupal\offer\Form\OfferDeleteForm.</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:270.5pt;margin-bottom:
  0in;margin-left:0in;text-indent:0in;line-height:237%'><i><span
  style='font-size:11.0pt;line-height:237%;font-family:Consolas;color:#999988'>*/
  </span></i><b><span style='font-size:11.0pt;line-height:237%;font-family:
  Consolas;color:#333333'>namespace </span></b><b><span style='font-size:11.0pt;
  line-height:237%;font-family:Consolas;color:#990000'>Drupal</span></b><span
  style='font-size:11.0pt;line-height:237%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:237%;font-family:Consolas;color:#990000'>offer</span></b><span
  style='font-size:11.0pt;line-height:237%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:237%;font-family:Consolas;color:#990000'>Form</span></b><span
  style='font-size:11.0pt;line-height:237%;font-family:Consolas;color:#333333'>;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:125.45pt;margin-bottom:
  14.2pt;margin-left:0in;text-indent:0in;line-height:121%'><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>use
  </span></b><b><span style='font-size:11.0pt;line-height:121%;font-family:
  Consolas;color:#990000'>Drupal</span></b><span style='font-size:11.0pt;
  line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>Core</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>Entity</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>ContentEntityConfirmFormBase</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>;
  <b>use </b></span><b><span style='font-size:11.0pt;line-height:121%;
  font-family:Consolas;color:#990000'>Drupal</span></b><span style='font-size:
  11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>Core</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>Form</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>FormStateInterface</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>;
  <b>use </b></span><b><span style='font-size:11.0pt;line-height:121%;
  font-family:Consolas;color:#990000'>Drupal</span></b><span style='font-size:
  11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>Core</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>Url</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:0in;text-indent:0in;line-height:107%'><i><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>/**</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:12.1pt;text-indent:-12.1pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>Provides
  a form for deleting a content_entity_example entity.</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:0in;text-indent:0in;line-height:107%'><i><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:12.1pt;text-indent:-12.1pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>@ingroup
  </span></i><i><span style='font-size:11.0pt;line-height:107%;font-family:
  Consolas;color:#999988'>offer</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:77.1pt;margin-bottom:
  14.2pt;margin-left:0in;text-indent:0in;line-height:121%'><i><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#999988'>*/
  </span></i><b><span style='font-size:11.0pt;line-height:121%;font-family:
  Consolas;color:#333333'>class </span></b><b><span style='font-size:11.0pt;
  line-height:121%;font-family:Consolas;color:#445588'>OfferDeleteForm </span></b><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>extends
  </span></b><b><span style='font-size:11.0pt;line-height:121%;font-family:
  Consolas;color:#445588'>ContentEntityConfirmFormBase </span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>{</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>/**</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:12.1pt;text-indent:-12.1pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>{</span></i><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>@inheritdoc</span></i><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>}</span></i></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.55pt;margin-bottom:0in;
margin-left:-1.0in;text-indent:0in;line-height:107%'>&nbsp;</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:655.5pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
  height:655.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:77.1pt;margin-bottom:
  0in;margin-left:6.05pt;text-indent:6.05pt;line-height:121%'><i><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#999988'>*/
  </span></i><b><span style='font-size:11.0pt;line-height:121%;font-family:
  Consolas;color:#333333'>public function </span></b><b><span style='font-size:
  11.0pt;line-height:121%;font-family:Consolas;color:#990000'>getQuestion</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>()
  { <b>return $this</b>-&gt;t(</span><span style='font-size:11.0pt;line-height:
  121%;font-family:Consolas;color:#DD1144'>'Are you sure you want to delete
  %name?'</span><span style='font-size:11.0pt;line-height:121%;font-family:
  Consolas;color:#333333'>,</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><b><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>array</span></b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>(</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'%name'
  </span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#333333'>=&gt; <b>$this</b>-&gt;entity-&gt;label()));</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:15.95pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>/**</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:24.2pt;text-indent:-12.1pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>{</span></i><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>@inheritdoc</span></i><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>}</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:24.2pt;text-indent:-12.1pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>If
  the delete command is canceled, return to the offer.</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:59.0pt;margin-bottom:
  0in;margin-left:12.1pt;text-indent:6.05pt;line-height:121%'><i><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#999988'>*/
  </span></i><b><span style='font-size:11.0pt;line-height:121%;font-family:
  Consolas;color:#333333'>public function </span></b><b><span style='font-size:
  11.0pt;line-height:121%;font-family:Consolas;color:#990000'>getCancelUrl</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>()
  { <b>return </b>Url::fromRoute(</span><span style='font-size:11.0pt;
  line-height:121%;font-family:Consolas;color:#DD1144'>'entity.offer.edit_form'</span><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>,
  [</span><span style='font-size:11.0pt;line-height:121%;font-family:Consolas;
  color:#DD1144'>'offer' </span><span style='font-size:11.0pt;line-height:121%;
  font-family:Consolas;color:#333333'>=&gt;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><b><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$this</span></b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>-&gt;entity-&gt;id()]);</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:30.95pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>/**</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:24.2pt;text-indent:-12.1pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>{</span></i><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>@inheritdoc</span></i><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>}</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:228.2pt;margin-bottom:
  0in;margin-left:6.05pt;text-indent:6.05pt;line-height:121%'><i><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#999988'>*/
  </span></i><b><span style='font-size:11.0pt;line-height:121%;font-family:
  Consolas;color:#333333'>public function </span></b><b><span style='font-size:
  11.0pt;line-height:121%;font-family:Consolas;color:#990000'>getConfirmText</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>()
  { <b>return $this</b>-&gt;t(</span><span style='font-size:11.0pt;line-height:
  121%;font-family:Consolas;color:#DD1144'>'Delete'</span><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>);</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:15.95pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>/**</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:24.2pt;text-indent:-12.1pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>{</span></i><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>@inheritdoc</span></i><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>}</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:24.2pt;text-indent:-12.1pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>Delete
  the entity</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:77.1pt;margin-bottom:
  0in;margin-left:6.05pt;text-indent:6.05pt;line-height:121%'><i><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#999988'>*/
  </span></i><b><span style='font-size:11.0pt;line-height:121%;font-family:
  Consolas;color:#333333'>public function </span></b><b><span style='font-size:
  11.0pt;line-height:121%;font-family:Consolas;color:#990000'>submitForm</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>(array
  &amp;$form, FormStateInterface</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$form_state) {</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$entity = <b>$this</b>-&gt;getEntity();</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:15.95pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$entity-&gt;delete();</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:89.2pt;margin-bottom:
  .8pt;margin-left:30.25pt;text-indent:-12.1pt;line-height:115%'><b><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>$this</span></b><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>-&gt;logger(</span><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#DD1144'>'offer'</span><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>)-&gt;notice(</span><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#DD1144'>'deleted
  %title.'</span><span style='font-size:11.0pt;line-height:115%;font-family:
  Consolas;color:#333333'>, <b>array</b>(</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:167.75pt;margin-bottom:
  0in;margin-left:30.2pt;text-indent:12.1pt;line-height:115%'><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#DD1144'>'%title'
  </span><span style='font-size:11.0pt;line-height:115%;font-family:Consolas;
  color:#333333'>=&gt; <b>$this</b>-&gt;entity-&gt;label(), ));</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>//
  Redirect to offer list after delete.</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$form_state-&gt;setRedirect(</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'entity.offer.collection'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>);</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:15.95pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:3.5pt;
margin-left:-.25pt'>We are now able to delete an offer with a confirmation form
before deleting. If you tried creating an entity via the create form, you will
now be able to visit <u>offers/1/delete</u>.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:24.25pt;
margin-left:1.5pt;text-indent:0in;line-height:107%'><img border=0 width=517
height=249 id="Picture 5446"
src="Learning%20drupal%209%20as%20a%20framework_files/image032.jpg"></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:20.8pt;
margin-left:-.25pt'>We get an error after deletion because again, we get
redirected towards the collection of this entity:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:76.6pt;margin-bottom:
24.05pt;margin-left:5.0pt;line-height:111%;background:#F8F8F8'><span
style='font-size:11.0pt;line-height:111%;font-family:Consolas;color:#333333'>$form_state-&gt;setRedirect(</span><span
style='font-size:11.0pt;line-height:111%;font-family:Consolas;color:#DD1144'>'entity.offer.collection'</span><span
style='font-size:11.0pt;line-height:111%;font-family:Consolas;color:#333333'>);</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:21.75pt;
margin-left:-.25pt'>The error happens because the entity has not defined a
collection (“listing”) class yet. Typically, drupal offers an <a
href="https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21EntityListBuilder.php/class/EntityListBuilder/8.2.x"><span
style='color:#1155CC'>entity listing</span></a><u><span style='color:#1155CC'> </span></u>functionality
for entities that get defined in a list builder. Personally I think there is a
better option because the ux and flexibility are not that great. Also, there is
a much more powerful option for this. We will use the core <a
href="https://drupal.org/project/views"><span style='color:#1155CC'>Views</span></a><u><span
style='color:#1155CC'> </span></u>module to offer a listing of our entities in
the next chapter to fix the error and finalize our CRUD operations.</p>

<h2 style='margin-left:-.25pt'><a name="_Toc247043">Views integration of our
custom entity to add a listing</a></h2>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=600
 style='width:6.25in;border-collapse:collapse'>
 <tr style='height:69.0pt'>
  <td width=59 valign=top style='width:44.25pt;background:#6D9EEB;padding:14.6pt 5.75pt 0in 0in;
  height:69.0pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:14.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%'>&#128073;</span></p>
  </td>
  <td width=541 style='width:405.75pt;background:#6D9EEB;padding:14.6pt 5.75pt 0in 0in;
  height:69.0pt'>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%'>In this section we go over the
  possibility of adding <b>views support </b>for <b>custom entities</b>. At the
  end you will be able to create powerful listings with views in the same way
  you can do with nodes.</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:.15pt;
margin-left:-.25pt'>bash-5.0$ drush en views views_ui</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>[success] Successfully enabled: views, views_ui</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=600
 style='width:6.25in;border-collapse:collapse'>
 <tr style='height:114.75pt'>
  <td width=600 valign=top style='width:6.25in;background:#E2E3E5;padding:16.9pt 5.75pt 0in 14.25pt;
  height:114.75pt'>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%'>&#128187; Enable the <b>views </b></span>and
  <b>views_ui </b>module.</p>
  <table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=521
   style='width:390.75pt;margin-left:30.0pt;border-collapse:collapse'>
   <tr style='height:43.5pt'>
    <td width=521 style='width:390.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
    height:43.5pt'>
    <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:
    2.1pt;margin-left:0in;text-indent:0in;line-height:107%'><span
    style='font-family:Consolas;color:#333333'>bash$ drush en views views_ui</span></p>
    <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
    style='font-family:Consolas;color:#008800'>[success] </span><span
    style='font-family:Consolas;color:#333333'>Successfully enabled: views,
    views_ui</span></p>
    </td>
   </tr>
  </table>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:8.0pt;
  margin-left:0in;text-indent:0in;line-height:107%'></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>First, to ensure that our entities have integration with
views we have to add an annotation with a link to the class.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:20.8pt;
margin-left:-.25pt'>In our <b>custom/offer/src/Entity/Offer.php </b>we add the
views integration in the annotations like this:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.45pt;
margin-left:52.85pt;text-indent:-48.35pt;line-height:110%;background:#F8F8F8'><span
style='font-size:11.0pt;line-height:110%;font-family:Consolas;color:#333333'>*<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><i><span style='font-size:11.0pt;line-height:110%;font-family:
Consolas;color:#333333'>handlers = {</span></i></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.75pt;
margin-left:52.85pt;text-indent:-48.35pt;line-height:107%;background:#F8F8F8'><span
style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>*<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><i><span style='font-size:11.0pt;line-height:107%;font-family:
Consolas;color:#DD1144'>&quot;access&quot; </span></i><i><span
style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>= </span></i><i><span
style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>&quot;Drupal\offer\OfferAccessControlHandler&quot;</span></i><i><span
style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>,</span></i></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.75pt;
margin-left:52.85pt;text-indent:-48.35pt;line-height:107%;background:#F8F8F8'><span
style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>*<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><i><span style='font-size:11.0pt;line-height:107%;font-family:
Consolas;color:#DD1144'>&quot;views_data&quot; </span></i><i><span
style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>= </span></i><i><span
style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>&quot;Drupal\offer\OfferViewsData&quot;</span></i><i><span
style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>,</span></i></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.75pt;
margin-left:52.85pt;text-indent:-48.35pt;line-height:107%;background:#F8F8F8'><span
style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>*<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><i><span style='font-size:11.0pt;line-height:107%;font-family:
Consolas;color:#DD1144'>&quot;form&quot; </span></i><i><span style='font-size:
11.0pt;line-height:107%;font-family:Consolas;color:#333333'>= {</span></i></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.75pt;
margin-left:52.85pt;text-indent:-48.35pt;line-height:107%;background:#F8F8F8'><span
style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>*<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><i><span style='font-size:11.0pt;line-height:107%;font-family:
Consolas;color:#DD1144'>&quot;add&quot; </span></i><i><span style='font-size:
11.0pt;line-height:107%;font-family:Consolas;color:#333333'>= </span></i><i><span
style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>&quot;Drupal\offer\Form\OfferForm&quot;</span></i><i><span
style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>,</span></i></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.75pt;
margin-left:52.85pt;text-indent:-48.35pt;line-height:107%;background:#F8F8F8'><span
style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>*<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><i><span style='font-size:11.0pt;line-height:107%;font-family:
Consolas;color:#DD1144'>&quot;edit&quot; </span></i><i><span style='font-size:
11.0pt;line-height:107%;font-family:Consolas;color:#333333'>= </span></i><i><span
style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>&quot;Drupal\offer\Form\OfferForm&quot;</span></i><i><span
style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>,</span></i></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.75pt;
margin-left:52.85pt;text-indent:-48.35pt;line-height:107%;background:#F8F8F8'><span
style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>*<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><i><span style='font-size:11.0pt;line-height:107%;font-family:
Consolas;color:#DD1144'>&quot;delete&quot; </span></i><i><span
style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>= </span></i><i><span
style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>&quot;Drupal\offer\Form\OfferDeleteForm&quot;</span></i><i><span
style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>,</span></i></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.45pt;
margin-left:52.85pt;text-indent:-48.35pt;line-height:110%;background:#F8F8F8'><span
style='font-size:11.0pt;line-height:110%;font-family:Consolas;color:#333333'>*<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><i><span style='font-size:11.0pt;line-height:110%;font-family:
Consolas;color:#333333'>},</span></i></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:24.2pt;
margin-left:52.85pt;text-indent:-48.35pt;line-height:110%;background:#F8F8F8'><span
style='font-size:11.0pt;line-height:110%;font-family:Consolas;color:#333333'>*<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><i><span style='font-size:11.0pt;line-height:110%;font-family:
Consolas;color:#333333'>},</span></i></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.35pt;
margin-left:-.25pt;line-height:110%'>To the <b>modules/custom/offer/src/OfferViewsData.php</b>,
add this code:</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:265.5pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
  height:265.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:240.3pt;margin-bottom:
  0in;margin-left:0in;text-indent:0in;line-height:237%'><b><span
  style='font-size:11.0pt;line-height:237%;font-family:Consolas;color:#999999'>&lt;?php
  </span></b><b><span style='font-size:11.0pt;line-height:237%;font-family:
  Consolas;color:#333333'>namespace </span></b><b><span style='font-size:11.0pt;
  line-height:237%;font-family:Consolas;color:#990000'>Drupal</span></b><span
  style='font-size:11.0pt;line-height:237%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:237%;font-family:Consolas;color:#990000'>offer</span></b><span
  style='font-size:11.0pt;line-height:237%;font-family:Consolas;color:#333333'>;
  <b>use </b></span><b><span style='font-size:11.0pt;line-height:237%;
  font-family:Consolas;color:#990000'>Drupal</span></b><span style='font-size:
  11.0pt;line-height:237%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:237%;font-family:Consolas;color:#990000'>views</span></b><span
  style='font-size:11.0pt;line-height:237%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:237%;font-family:Consolas;color:#990000'>EntityViewsData</span></b><span
  style='font-size:11.0pt;line-height:237%;font-family:Consolas;color:#333333'>;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><i><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>/**</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  </span></span><i><span style='font-size:11.0pt;line-height:107%;font-family:
  Consolas;color:#999988'>Provides views data for Offer entities.</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:14.6pt;
  margin-left:0in;text-indent:0in;line-height:118%'><span style='font-size:
  11.0pt;line-height:118%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  </span></span><i><span style='font-size:11.0pt;line-height:118%;font-family:
  Consolas;color:#999988'>*/ </span></i><b><span style='font-size:11.0pt;
  line-height:118%;font-family:Consolas;color:#333333'>class </span></b><b><span
  style='font-size:11.0pt;line-height:118%;font-family:Consolas;color:#445588'>OfferViewsData
  </span></b><b><span style='font-size:11.0pt;line-height:118%;font-family:
  Consolas;color:#333333'>extends </span></b><b><span style='font-size:11.0pt;
  line-height:118%;font-family:Consolas;color:#445588'>EntityViewsData </span></b><span
  style='font-size:11.0pt;line-height:118%;font-family:Consolas;color:#333333'>{</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>/**</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  </span></span><i><span style='font-size:11.0pt;line-height:107%;font-family:
  Consolas;color:#999988'>Returns the Views data for the entity.</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:240.3pt;margin-bottom:
  0in;margin-left:6.05pt;text-indent:6.05pt;line-height:121%'><i><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#999988'>*/
  </span></i><b><span style='font-size:11.0pt;line-height:121%;font-family:
  Consolas;color:#333333'>public function </span></b><b><span style='font-size:
  11.0pt;line-height:121%;font-family:Consolas;color:#990000'>getViewsData</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>()
  {</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$data = <b>parent</b>::getViewsData();</span></p>
  </td>
 </tr>
 <tr style='height:55.5pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
  height:55.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>return
  </span></b><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#333333'>$data;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:.75pt;
margin-left:-.25pt'>Clear caches and head to <i><u>admin/structure/views/add</u></i>.
When adding a new view, we can now select “offer” as an entity to make a
listing. This is pretty powerful, we get full access to all of views finest
functionality:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:1.0pt;
margin-left:.5in;text-indent:-.25in'><span style='font-family:"Arial",sans-serif'>&#9679;<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span>Quickly
make (advanced) listings</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:1.05pt;
margin-left:.5in;text-indent:-.25in'><span style='font-family:"Arial",sans-serif'>&#9679;<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span>Search</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:1.0pt;
margin-left:.5in;text-indent:-.25in'><span style='font-family:"Arial",sans-serif'>&#9679;<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span>Filtering</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:1.0pt;
margin-left:.5in;text-indent:-.25in'><span style='font-family:"Arial",sans-serif'>&#9679;<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span>Pagination</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:1.1pt;
margin-left:.5in;text-indent:-.25in'><span style='font-family:"Arial",sans-serif'>&#9679;<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span>Bulk
operations</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.4pt;
margin-left:.5in;text-indent:-.25in;line-height:107%'><span style='font-family:
"Arial",sans-serif'>&#9679;<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;
</span></span>…</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>But for now, we make an easy listing of our entities.<br
clear=all style='page-break-before:always'>
</p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:24.25pt;
margin-left:1.5pt;text-indent:0in;line-height:107%'><img border=0 width=421
height=818 id="Picture 5627"
src="Learning%20drupal%209%20as%20a%20framework_files/image033.jpg"></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>We add title, edit and a delete button as fields.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:-1.7pt;margin-bottom:
55.0pt;margin-left:1.5pt;text-indent:0in;line-height:107%'><img border=0
width=602 height=284 id="Picture 5657"
src="Learning%20drupal%209%20as%20a%20framework_files/image034.jpg"></p>

<p class=MsoNormal style='margin-top:0in;margin-right:15.1pt;margin-bottom:
12.45pt;margin-left:13.5pt;text-indent:0in;line-height:107%;background:#FFD966'><b>Important</b></p>

<p class=MsoNormal style='margin-top:0in;margin-right:15.1pt;margin-bottom:
13.0pt;margin-left:14.0pt;line-height:110%;background:#FFD966'><span
style='font-size:11.0pt;line-height:110%'>Views is an extremely powerful tool.
But think about it as a querying interface and a tool for building easy and
advanced entity listings. If your entities are secured like we did with the
offers, this does not mean they can not appear in views listings for other
users.</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:15.1pt;margin-bottom:
12.95pt;margin-left:14.0pt;line-height:110%;background:#FFD966'><span
style='font-size:11.0pt;line-height:110%'>For that, always make sure you only
show entities that have the logged in user as author (<i>Advanced &gt;
Contextual filter &gt; User &gt; Provide default value &gt; User id from logged
in user</i>). Of course, if you make the users author of their own entities
like we are doing.</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:15.1pt;margin-bottom:
17.7pt;margin-left:14.0pt;line-height:110%;background:#FFD966'><span
style='font-size:11.0pt;line-height:110%'>Also, check for permissions on the
listing. In this case, we gave permission to users that have “administer own
offers“ (Create/edit/delete own offers) permission.</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:24.25pt;
margin-left:1.5pt;text-indent:0in;line-height:107%'><img border=0 width=540
height=217 id="Picture 5659"
src="Learning%20drupal%209%20as%20a%20framework_files/image035.jpg"></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>We’ve got our listing! We will tweak it further in a later
chapter, but this is the functionality we want at this moment.</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=600
 style='width:6.25in;border-collapse:collapse'>
 <tr style='height:571.5pt'>
  <td width=600 valign=top style='width:6.25in;background:#E2E3E5;padding:16.5pt 5.75pt 0in 14.25pt;
  height:571.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:30.0pt;text-indent:-30.0pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%'>&#128187; Time to get our CRUD
  operations complete by adding our entity listing to as the collection of this
  entity. To <b>offer/offer.routing.yml</b>, add:</span></p>
  <table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=521
   style='width:390.75pt;margin-left:30.0pt;border-collapse:collapse'>
   <tr style='height:70.5pt'>
    <td width=521 style='width:390.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
    height:70.5pt'>
    <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:
    1.8pt;margin-left:0in;text-indent:0in;line-height:107%'><span
    style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>entity.offer.collection:</span></p>
    <p class=MsoNormal style='margin-top:0in;margin-right:198.4pt;margin-bottom:
    .8pt;margin-left:12.1pt;text-indent:0in;line-height:115%'><span
    style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>path:
    </span><span style='font-size:11.0pt;line-height:115%;font-family:Consolas;
    color:#DD1144'>'/offers' </span><span style='font-size:11.0pt;line-height:
    115%;font-family:Consolas;color:#333333'>requirements:</span></p>
    <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:
    0in;margin-left:24.15pt;text-indent:0in;line-height:107%'><span
    style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>_permission:
    </span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
    color:#DD1144'>'administer own offers'</span></p>
    </td>
   </tr>
  </table>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:12.5pt;
  margin-left:30.0pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%'>Test by adding, editing and deleting an offer. But
  rebuild caches first!</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:30.0pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%'>Export your configuration now</span></p>
  <table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=521
   style='width:390.75pt;margin-left:30.0pt;border-collapse:collapse'>
   <tr style='height:25.5pt'>
    <td width=521 style='width:390.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
    height:25.5pt'>
    <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
    style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>drush
    cex -y</span></p>
    </td>
   </tr>
  </table>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.5pt;
  margin-left:32.7pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%'>and look for <b>views.view.offers.yml</b>. Copy the
  file to</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:30.0pt;text-indent:0in;line-height:107%'><b><span
  style='font-size:11.0pt;line-height:107%'>modules/custom/offer/config/install</span></b><span
  style='font-size:11.0pt;line-height:107%'>.</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:10.15pt;margin-bottom:
  15.75pt;margin-left:30.0pt;text-indent:0in;line-height:111%'><span
  style='font-size:11.0pt;line-height:111%'>This will keep our view inside our
  offers module and on next installation, the view will be installed.</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:30.0pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%'>To our <b>offer.info.yml </b>file, we add:</span></p>
  <table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=521
   style='width:390.75pt;margin-left:30.0pt;border-collapse:collapse'>
   <tr style='height:40.5pt'>
    <td width=521 style='width:390.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
    height:40.5pt'>
    <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:
    .95pt;margin-left:0in;text-indent:0in;line-height:107%'><span
    style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>dependencies:</span></p>
    <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:
    0in;margin-left:6.05pt;text-indent:0in;line-height:107%'><span
    style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>-
    drupal:</span><span style='font-size:11.0pt;line-height:107%;font-family:
    Consolas;color:#DD1144'>views</span></p>
    </td>
   </tr>
  </table>
  <p class=MsoNormal style='margin-top:0in;margin-right:9.4pt;margin-bottom:
  0in;margin-left:30.0pt;text-indent:0in;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%'>We’ll disable the module and
  reïnstall to see if it all works. Delete our entities first like this:</span></p>
  <table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=521
   style='width:390.75pt;margin-left:30.0pt;border-collapse:collapse'>
   <tr style='height:100.5pt'>
    <td width=521 style='width:390.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
    height:100.5pt'>
    <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:
    1.8pt;margin-left:0in;text-indent:0in;line-height:107%'><span
    style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>bash$
    drush entity:delete offer</span></p>
    <p class=MsoNormal style='margin-top:0in;margin-right:107.75pt;margin-bottom:
    .8pt;margin-left:0in;text-indent:0in;line-height:115%'><span
    style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#008800'>[success]
    </span><span style='font-size:11.0pt;line-height:115%;font-family:Consolas;
    color:#333333'>Deleted offer entity Ids: 1, 2 bash$ drush pmu offer</span></p>
    <p class=MsoNormal style='margin-top:0in;margin-right:101.75pt;margin-bottom:
    .8pt;margin-left:0in;text-indent:0in;line-height:115%'><span
    style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#008800'>[success]
    </span><span style='font-size:11.0pt;line-height:115%;font-family:Consolas;
    color:#333333'>Successfully uninstalled: offer bash$ drush en offer</span></p>
    <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
    style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#008800'>[success]
    </span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
    color:#333333'>Successfully enabled: offer</span></p>
    </td>
   </tr>
  </table>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:8.0pt;
  margin-left:0in;text-indent:0in;line-height:107%'></p>
  </td>
 </tr>
</table>

<p class=MsoNormal align=right style='margin-top:0in;margin-right:21.95pt;
margin-bottom:32.75pt;margin-left:.5pt;text-align:right;line-height:110%;
background:#FFD966'><span style='font-size:11.0pt;line-height:110%'>We have now
full CRUD operations up and working in a generic and reusable module.</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>To make our lives a bit more comfortable, we add a menu
link to the toolbar for direct access. To <b>custom/modules/offer/offer.links.menu.yml
</b>add:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:114.25pt;margin-bottom:
1.25pt;margin-left:8.4pt;line-height:111%;background:#F8F8F8'><span
style='font-size:11.0pt;line-height:111%;font-family:Consolas;color:#DD1144'>offer.toolbar.my_offers:</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:114.25pt;margin-bottom:
23.8pt;margin-left:8.4pt;line-height:111%;background:#F8F8F8'><span
style='font-size:11.0pt;line-height:111%;font-family:Consolas;color:#333333'>title:
</span><span style='font-size:11.0pt;line-height:111%;font-family:Consolas;
color:#DD1144'>'My offers' </span><span style='font-size:11.0pt;line-height:
111%;font-family:Consolas;color:#333333'>route_name: </span><span
style='font-size:11.0pt;line-height:111%;font-family:Consolas;color:#DD1144'>entity.offer.collection
</span><span style='font-size:11.0pt;line-height:111%;font-family:Consolas;
color:#333333'>parent: </span><span style='font-size:11.0pt;line-height:111%;
font-family:Consolas;color:#DD1144'>system.admin </span><span style='font-size:
11.0pt;line-height:111%;font-family:Consolas;color:#333333'>weight: </span><span
style='font-size:11.0pt;line-height:111%;font-family:Consolas;color:teal'>99</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:.05in;
margin-left:-.25pt'>This shows a link to the “My offers” overview page in the
toolbar.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:21.75pt;
margin-left:1.5pt;text-indent:0in;line-height:107%'><img border=0 width=222
height=61 id="Picture 5813"
src="Learning%20drupal%209%20as%20a%20framework_files/image036.jpg"></p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=600
 style='width:6.25in;border-collapse:collapse'>
 <tr style='height:58.5pt'>
  <td width=59 valign=top style='width:44.25pt;background:#E2E3E5;padding:14.6pt 5.75pt 0in 0in;
  height:58.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:14.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%'>&#128187;</span></p>
  </td>
  <td width=541 style='width:405.75pt;background:#E2E3E5;padding:14.6pt 5.75pt 0in 0in;
  height:58.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:.7pt;margin-bottom:
  0in;margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%'>Give authenticated users access to the toolbar first
  (via permissions), but note that this is only for the development phase of
  the platform.</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:2.1pt;
margin-left:-.25pt'>Next, this listing needs a big “Add an offer” button.
Drupal has a system for this. Add <b>offer.links.action.yml </b>and add:</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:85.5pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
  height:85.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>offer.add_offer:</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:264.45pt;margin-bottom:
  .4pt;margin-left:12.1pt;text-indent:0in;line-height:118%'><span
  style='font-size:11.0pt;line-height:118%;font-family:Consolas;color:#333333'>route_name:
  </span><span style='font-size:11.0pt;line-height:118%;font-family:Consolas;
  color:#DD1144'>offer.add </span><span style='font-size:11.0pt;line-height:
  118%;font-family:Consolas;color:#333333'>title: </span><span
  style='font-size:11.0pt;line-height:118%;font-family:Consolas;color:#DD1144'>'Add
  an offer' </span><span style='font-size:11.0pt;line-height:118%;font-family:
  Consolas;color:#333333'>appears_on:</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:24.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#990073'>- </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>entity.offer.collection</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:.05in;
margin-left:-.25pt'>Clear caches and we now have our action button:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:-1.7pt;margin-bottom:
26.6pt;margin-left:1.5pt;text-indent:0in;line-height:107%'><img border=0
width=602 height=96 id="Picture 5815"
src="Learning%20drupal%209%20as%20a%20framework_files/image037.jpg"></p>

<h2 style='margin-left:-.25pt'><a name="_Toc247044">Getting up-to-speed: making
the entity fieldable</a></h2>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=600
 style='width:6.25in;border-collapse:collapse'>
 <tr style='height:82.5pt'>
  <td width=59 valign=top style='width:44.25pt;background:#6D9EEB;padding:14.6pt 5.75pt 0in 0in;
  height:82.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:14.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%'>&#128073;</span></p>
  </td>
  <td width=541 style='width:405.75pt;background:#6D9EEB;padding:14.6pt 5.75pt 0in 0in;
  height:82.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:8.15pt;margin-bottom:
  0in;margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%'>This section is about making your custom entity
  fieldable. At the end you will be able to connect you <b>custom entity </b>with
  the power of the <b>drupal user-interface for adding fields, form modes and
  view modes</b>. At the end you will be able to add fields to your entity via
  the UI and manage the display. The created fields will</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:15.1pt;margin-bottom:
31.2pt;margin-left:44.75pt;line-height:110%;background:#6D9EEB'><span
style='font-size:11.0pt;line-height:110%'>be exportable as configuration.</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>As told earlier, the entity data structure in drupal made
the software famous. We can extend our custom entity with this dynamic and
extremely feature-rich UI.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:.95pt;
margin-left:-.25pt'>Advantages of working this way are:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:.65pt;
margin-left:.5in;text-indent:-.25in'><span style='font-family:"Arial",sans-serif'>&#9679;<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span><b>Definition
and naming can be done in the UI</b>. You get access to powerful fields with
features as autocomplete entity reference, multifield, private files,</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:.95pt;
margin-left:36.5pt'>...</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:.8pt;
margin-left:.5in;text-indent:-.25in'><span style='font-family:"Arial",sans-serif'>&#9679;<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span>Create
<b>view modes </b>of the entity via the UI (a teaser and full entity view for
example) and set the display of each field</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:.5in;text-indent:-.25in'><span style='font-family:"Arial",sans-serif'>&#9679;<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span>Manage
<b>form modes </b>(configure the appearance of the add and edit form via the
UI)</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:.95pt;
margin-left:-.25pt'>With that UI, we can add the desired fields to our entity
by just clicking:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:1.0pt;
margin-left:.5in;text-indent:-.25in'><span style='font-family:"Arial",sans-serif'>&#9679;<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span>Images</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:1.0pt;
margin-left:.5in;text-indent:-.25in'><span style='font-family:"Arial",sans-serif'>&#9679;<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span>A
PDF upload</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:1.0pt;
margin-left:.5in;text-indent:-.25in'><span style='font-family:"Arial",sans-serif'>&#9679;<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span>Description</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:1.05pt;
margin-left:.5in;text-indent:-.25in'><span style='font-family:"Arial",sans-serif'>&#9679;<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span>Short
text</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:1.05pt;
margin-left:.5in;text-indent:-.25in'><span style='font-family:"Arial",sans-serif'>&#9679;<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span>Tags</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:.5in;text-indent:-.25in'><span style='font-family:"Arial",sans-serif'>&#9679;<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span>…
There are <a
href="https://www.drupal.org/project/project_module?f%5B0%5D=&amp;f%5B1%5D=&amp;f%5B2%5D=im_vid_3%3A20224&amp;f%5B3%5D=sm_core_compatibility%3A9&amp;f%5B4%5D=sm_field_project_type%3Afull&amp;f%5B5%5D=&amp;f%5B6%5D=&amp;text=&amp;solrsort=iss_project_release_usage+desc&amp;op=Search"><span
style='color:#1155CC'>hundreds of modules</span></a><u><span style='color:#1155CC'>
</span></u>available that define all sorts of fields!</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:20.65pt;
margin-left:-.25pt'>Note that we already have a description defined in our <b>Offer.php
</b>entity structure. We’re about to delete it. We’ll delete our entities first
and uninstall again:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:140.45pt;margin-bottom:
.8pt;margin-left:5.0pt;line-height:111%;background:#F8F8F8'><span
style='font-size:11.0pt;line-height:111%;font-family:Consolas;color:#333333'>bash$
drush entity:delete offer </span><span style='font-size:11.0pt;line-height:
111%;font-family:Consolas;color:#008800'>[success] </span><span
style='font-size:11.0pt;line-height:111%;font-family:Consolas;color:#333333'>Deleted
offer entity Ids: 1, 2 bash$ drush pmu offer</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:140.45pt;margin-bottom:
24.05pt;margin-left:5.0pt;line-height:111%;background:#F8F8F8'><span
style='font-size:11.0pt;line-height:111%;font-family:Consolas;color:#008800'>[success]
</span><span style='font-size:11.0pt;line-height:111%;font-family:Consolas;
color:#333333'>Successfully uninstalled: offer</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.65pt;
margin-left:-.25pt;line-height:107%'>Now <b>remove </b>the <i>$fields['message']
</i>from the <i>BaseFieldDefinitions </i>in your <b>Offer.php </b>entity file.</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=600
 style='width:6.25in;border-collapse:collapse'>
 <tr style='height:117.0pt'>
  <td width=600 valign=top style='width:6.25in;background:#E2E3E5;padding:16.65pt 5.75pt 0in 14.25pt;
  height:117.0pt'>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%'>&#128187; </span>make sure the core
  <b>field_ui </b>module is enabled.</p>
  <table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=521
   style='width:390.75pt;margin-left:30.0pt;border-collapse:collapse'>
   <tr style='height:40.5pt'>
    <td width=521 style='width:390.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
    height:40.5pt'>
    <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:
    1.8pt;margin-left:0in;text-indent:0in;line-height:107%'><span
    style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>bash$
    drush en field_ui</span></p>
    <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
    style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#008800'>[success]
    </span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
    color:#333333'>Successfully enabled: field_ui</span></p>
    </td>
   </tr>
  </table>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:8.0pt;
  margin-left:0in;text-indent:0in;line-height:107%'></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:21.55pt;
margin-left:-.25pt'>To the annotations in <b>modules/custom/offer/src/Entity/Offer.php
</b>add a fiel_ui_base_route key:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.75pt;
margin-left:4.5pt;text-indent:0in;line-height:107%;background:#F8F8F8'><span
style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>*<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><i><span
style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>&quot;create&quot;
</span></i><i><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
color:#333333'>= </span></i><i><span style='font-size:11.0pt;line-height:107%;
font-family:Consolas;color:#DD1144'>&quot;/offer/c...</span></i></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.45pt;
margin-left:4.5pt;text-indent:0in;line-height:110%;background:#F8F8F8'><span
style='font-size:11.0pt;line-height:110%;font-family:Consolas;color:#333333'>*<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><i><span
style='font-size:11.0pt;line-height:110%;font-family:Consolas;color:#333333'>},</span></i></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:25.8pt;
margin-left:4.5pt;text-indent:0in;line-height:115%;background:#F8F8F8'><span
style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>*<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><b><i><span
style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>field_ui_base_route
= </span></i></b><b><i><span style='font-size:11.0pt;line-height:115%;
font-family:Consolas;color:#DD1144'>&quot;entity.offer.settings&quot;</span></i></b><b><i><span
style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>, </span></i></b><i><span
style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>*  
revision_me</span></i><i><span style='font-size:11.0pt;line-height:115%;
font-family:"Arial",sans-serif;color:#333333'>…</span></i><i><span
style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>.</span></i></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:.75pt;
margin-left:-.25pt'>The route <b>entity.offer.settings </b>will be the landing
page of the ui settings of our entity. If we configure this route to <u>/admin/structure/offer</u>,
the following routes will become available automatically:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.7pt;margin-bottom:1.05pt;
margin-left:.5in;text-indent:-.25in;line-height:111%'><span style='font-family:
"Arial",sans-serif'>&#9679;<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><u>admin/structure/offer/fields </u>(fields ui)</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.7pt;margin-bottom:1.05pt;
margin-left:.5in;text-indent:-.25in;line-height:111%'><span style='font-family:
"Arial",sans-serif'>&#9679;<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><u>admin/structure/offer/form-display </u>(add form display)</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.7pt;margin-bottom:17.3pt;
margin-left:.5in;text-indent:-.25in'><span style='font-family:"Arial",sans-serif'>&#9679;<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span><u>admin/structure/offer/display
</u>(view modes display management)</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>The settings landing page is usually a settings form. While
we will not use additional settings in this form, let’s keep the good practice
and add this route as a form.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.35pt;
margin-left:-.25pt;line-height:110%'>To <b>modules/custom/offer/routing.yml </b>we
add:</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:115.5pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
  height:115.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>entity.offer.settings:</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:204.05pt;margin-bottom:
  .8pt;margin-left:6.05pt;text-indent:0in;line-height:115%'><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>path:
  </span><span style='font-size:11.0pt;line-height:115%;font-family:Consolas;
  color:#DD1144'>'admin/structure/offer' </span><span style='font-size:11.0pt;
  line-height:115%;font-family:Consolas;color:#333333'>defaults:</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>_form: </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'\Drupal\offer\Form\OfferSettingsForm'</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:2.75in;margin-bottom:
  .8pt;margin-left:6.05pt;text-indent:12.1pt;line-height:115%'><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>_title:
  </span><span style='font-size:11.0pt;line-height:115%;font-family:Consolas;
  color:#DD1144'>'Offer settings' </span><span style='font-size:11.0pt;
  line-height:115%;font-family:Consolas;color:#333333'>requirements:</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>_role: </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'administer
  own offers'</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.35pt;
margin-left:-.25pt;line-height:110%'>To <b>modules/custom/offer/src/Form/OfferSettingsForm</b>:</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:175.5pt'>
  <td width=601 valign=top style='width:450.75pt;background:#F8F8F8;padding:
  0in 5.75pt 0in 5.25pt;height:175.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><b><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999999'>&lt;?php</span></b></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:0in;text-indent:0in;line-height:107%'><i><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>/**</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:12.1pt;text-indent:-12.1pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>@file</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:12.1pt;text-indent:-12.1pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>Contains
  \Drupal\offer\Form\OfferSettingsForm.</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:270.5pt;margin-bottom:
  0in;margin-left:0in;text-indent:0in;line-height:237%'><i><span
  style='font-size:11.0pt;line-height:237%;font-family:Consolas;color:#999988'>*/
  </span></i><b><span style='font-size:11.0pt;line-height:237%;font-family:
  Consolas;color:#333333'>namespace </span></b><b><span style='font-size:11.0pt;
  line-height:237%;font-family:Consolas;color:#990000'>Drupal</span></b><span
  style='font-size:11.0pt;line-height:237%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:237%;font-family:Consolas;color:#990000'>offer</span></b><span
  style='font-size:11.0pt;line-height:237%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:237%;font-family:Consolas;color:#990000'>Form</span></b><span
  style='font-size:11.0pt;line-height:237%;font-family:Consolas;color:#333333'>;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:2.75in;margin-bottom:
  0in;margin-left:0in;text-indent:0in;line-height:107%'><b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>use
  </span></b><b><span style='font-size:11.0pt;line-height:107%;font-family:
  Consolas;color:#990000'>Drupal</span></b><span style='font-size:11.0pt;
  line-height:107%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#990000'>Core</span></b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#990000'>Form</span></b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#990000'>FormBase</span></b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>;
  <b>use </b></span><b><span style='font-size:11.0pt;line-height:107%;
  font-family:Consolas;color:#990000'>Drupal</span></b><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#990000'>Core</span></b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#990000'>Form</span></b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#990000'>FormStateInterface</span></b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>;</span></p>
  </td>
 </tr>
 <tr style='height:580.5pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
  height:580.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><i><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>/**</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:36.25pt;text-indent:-24.15pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>Class
  OfferSettingsForm.</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:0in;text-indent:0in;line-height:107%'><i><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:36.25pt;text-indent:-24.15pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>@package
  </span></i><i><span style='font-size:11.0pt;line-height:107%;font-family:
  Consolas;color:#999988'>Drupal\offer\Form</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:0in;text-indent:0in;line-height:107%'><i><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:36.25pt;text-indent:-24.15pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>@ingroup
  </span></i><i><span style='font-size:11.0pt;line-height:107%;font-family:
  Consolas;color:#999988'>offer</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:185.9pt;margin-bottom:
  0in;margin-left:0in;text-indent:0in;line-height:121%'><i><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#999988'>*/
  </span></i><b><span style='font-size:11.0pt;line-height:121%;font-family:
  Consolas;color:#333333'>class </span></b><b><span style='font-size:11.0pt;
  line-height:121%;font-family:Consolas;color:#445588'>OfferSettingsForm </span></b><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>extends
  </span></b><b><span style='font-size:11.0pt;line-height:121%;font-family:
  Consolas;color:#445588'>FormBase </span></b><span style='font-size:11.0pt;
  line-height:121%;font-family:Consolas;color:#333333'>{</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>/**</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:36.25pt;text-indent:-24.15pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>Returns
  a unique string identifying the form.</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:36.25pt;text-indent:-24.15pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>@return
  </span></i><i><span style='font-size:11.0pt;line-height:107%;font-family:
  Consolas;color:#999988'>string</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:36.25pt;text-indent:-24.15pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>The
  unique string identifying the form.</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:258.45pt;margin-bottom:
  0in;margin-left:6.05pt;text-indent:6.05pt;line-height:121%'><i><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#999988'>*/
  </span></i><b><span style='font-size:11.0pt;line-height:121%;font-family:
  Consolas;color:#333333'>public function </span></b><b><span style='font-size:
  11.0pt;line-height:121%;font-family:Consolas;color:#990000'>getFormId</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>()
  { <b>return </b></span><span style='font-size:11.0pt;line-height:121%;
  font-family:Consolas;color:#DD1144'>'offer_settings'</span><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:15.95pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>/**</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:36.25pt;text-indent:-24.15pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>{</span></i><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>@inheritdoc</span></i><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>}</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:77.1pt;margin-bottom:
  0in;margin-left:6.05pt;text-indent:6.05pt;line-height:121%'><i><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#999988'>*/
  </span></i><b><span style='font-size:11.0pt;line-height:121%;font-family:
  Consolas;color:#333333'>public function </span></b><b><span style='font-size:
  11.0pt;line-height:121%;font-family:Consolas;color:#990000'>submitForm</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>(array
  &amp;$form, FormStateInterface</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$form_state) {</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>//
  Empty implementation of the abstract submit class.</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:15.95pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>/**</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:36.25pt;text-indent:-24.15pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>{</span></i><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>@inheritdoc</span></i><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>}</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:10.65pt;margin-bottom:
  0in;margin-left:6.05pt;text-indent:6.05pt;line-height:121%'><i><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#999988'>*/
  </span></i><b><span style='font-size:11.0pt;line-height:121%;font-family:
  Consolas;color:#333333'>public function </span></b><b><span style='font-size:
  11.0pt;line-height:121%;font-family:Consolas;color:#990000'>buildForm</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>(array
  $form, FormStateInterface $form_state)</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>{</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:16.7pt;margin-bottom:
  0in;margin-left:0in;text-indent:18.15pt;line-height:119%'><span
  style='font-size:11.0pt;line-height:119%;font-family:Consolas;color:#333333'>$form[</span><span
  style='font-size:11.0pt;line-height:119%;font-family:Consolas;color:#DD1144'>'offer_settings'</span><span
  style='font-size:11.0pt;line-height:119%;font-family:Consolas;color:#333333'>][</span><span
  style='font-size:11.0pt;line-height:119%;font-family:Consolas;color:#DD1144'>'#markup'</span><span
  style='font-size:11.0pt;line-height:119%;font-family:Consolas;color:#333333'>]
  = </span><span style='font-size:11.0pt;line-height:119%;font-family:Consolas;
  color:#DD1144'>'Settings form for offer. We don\'t need additional entity
  settings. Manage field settings with the tabs above.'</span><span
  style='font-size:11.0pt;line-height:119%;font-family:Consolas;color:#333333'>;
  <b>return </b>$form;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:15.95pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>We want to do this clean, with adding a link on the <u>admin/structure
</u>page to our offer settings form. With the webprofiler toolbar (see <u><span
style='color:#1155CC'>developer tools</span></u>) we check the route name for
admin/structure.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:19.0pt;
margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:11.0pt;
line-height:107%'><img border=0 width=602 height=445
src="Learning%20drupal%209%20as%20a%20framework_files/image038.gif"></span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>We discovered the route name is <i>system.admin.structure</i>.
We’ll use it next as a parent for our settings link.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:21.15pt;
margin-left:-.25pt;line-height:110%'>Next, we add a file named <b>custom/offer/offer.links.menu.yml</b>:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:146.5pt;margin-bottom:
.8pt;margin-left:8.4pt;line-height:111%;background:#F8F8F8'><span
style='font-size:11.0pt;line-height:111%;font-family:Consolas;color:#333333'>offer.admin.structure.settings:</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:146.5pt;margin-bottom:
9.4pt;margin-left:7.9pt;text-align:justify;text-justify:inter-ideograph;
text-indent:0in;line-height:107%;background:#F8F8F8'><span style='font-size:
11.0pt;line-height:107%;font-family:Consolas;color:#333333'>title: Offer
settings description: </span><span style='font-size:11.0pt;line-height:107%;
font-family:Consolas;color:#DD1144'>'Configure Offer entity' </span><span
style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>route_name: 
entity.offer.settings parent: system.admin_structure</span></p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=600
 style='width:6.25in;border-collapse:collapse'>
 <tr style='height:55.5pt'>
  <td width=59 valign=top style='width:44.25pt;background:#E2E3E5;padding:14.6pt 5.75pt 0in 0in;
  height:55.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:14.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%'>&#128187;</span></p>
  </td>
  <td width=541 style='width:405.75pt;background:#E2E3E5;padding:14.6pt 5.75pt 0in 0in;
  height:55.5pt'>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%'>Always clear the caches after
  adding/editing new routes, menu links or other YAML config!</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:24.25pt;
margin-left:1.5pt;text-indent:0in;line-height:107%'><img border=0 width=580
height=541 id="Picture 6252"
src="Learning%20drupal%209%20as%20a%20framework_files/image039.jpg"></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:2.1pt;
margin-left:-.25pt'>The link appeared in our structure tree, and the build-up
is the same way as “content types”, which we know from the Node entity.</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=600
 style='width:6.25in;border-collapse:collapse'>
 <tr style='height:139.5pt'>
  <td width=600 style='width:6.25in;background:#E2E3E5;padding:0in 5.75pt 0in 14.25pt;
  height:139.5pt'>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%'>&#128187; If you still see “Content
  types”, the time is here to uninstall the Node entity type:</span></p>
  <table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=521
   style='width:390.75pt;margin-left:30.0pt;border-collapse:collapse'>
   <tr style='height:40.5pt'>
    <td width=521 style='width:390.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
    height:40.5pt'>
    <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:
    1.8pt;margin-left:0in;text-indent:0in;line-height:107%'><span
    style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>bash$
    drush pmu node</span></p>
    <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
    style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#008800'>[success]
    </span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
    color:#333333'>Successfully uninstalled: node</span></p>
    </td>
   </tr>
  </table>
  <p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:
  0in;margin-left:30.0pt;text-indent:0in;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%'>If you export config, this will
  delete some default settings from the node entity type as well.</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:19.0pt;
margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:11.0pt;
line-height:107%'><img border=0 width=600 height=651 id="Group 178706"
src="Learning%20drupal%209%20as%20a%20framework_files/image040.gif"></span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:.3in;
margin-left:-.25pt'>Finally, we add a “local tasks”-link to the settings page.
This will activate the tasks tabs above to get the structure that is known when
administering nodes. By this I mean the “Edit”, “Manage fields”, “Manage form
display” and “Manage display” tabs. To <b>modules/custom/offer/offer.links.task.yml</b>,
add:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:142.55pt;margin-bottom:
1.45pt;margin-left:5.0pt;line-height:112%;background:#F8F8F8'><i><span
style='font-family:Consolas;color:#999988'># Activates the tabs on the entity
admin pages (/admin/structure/offer) </span></i><span style='font-family:Consolas;
color:#DD1144'>offer.settings_tab: </span><span style='font-family:Consolas;
color:#333333'>route_name: </span><span style='font-family:Consolas;color:#DD1144'>entity.offer.settings
</span><span style='font-family:Consolas;color:#333333'>title: </span><span
style='font-family:Consolas;color:#DD1144'>'Settings' </span><span
style='font-family:Consolas;color:#333333'>base_route: </span><span
style='font-family:Consolas;color:#DD1144'>entity.offer.settings</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:1.65pt;
margin-left:-.25pt'>We re-enable the module and see the desired entity ui
extensions on <u>admin/structure/offer</u>.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:-1.7pt;margin-bottom:
24.25pt;margin-left:1.5pt;text-indent:0in;line-height:107%'><img border=0
width=602 height=184 id="Picture 6341"
src="Learning%20drupal%209%20as%20a%20framework_files/image041.jpg"></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>Cool! Time to get up to speed by adding some fields.</p>

<h3 style='margin-left:-.25pt'><a name="_Toc247045">Media field with library</a></h3>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=600
 style='width:6.25in;border-collapse:collapse'>
 <tr style='height:55.5pt'>
  <td width=59 valign=top style='width:44.25pt;background:#6D9EEB;padding:14.6pt 5.75pt 0in 0in;
  height:55.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:14.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%'>&#128073;</span></p>
  </td>
  <td width=541 style='width:405.75pt;background:#6D9EEB;padding:14.6pt 5.75pt 0in 0in;
  height:55.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:4.0pt;margin-bottom:
  0in;margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%'>This section shows how to add a media field to your
  entity, using the media library, and to only show media items you have
  uploaded.</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:33.05pt;
margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:11.0pt;
line-height:107%'><img border=0 width=602 height=270
src="Learning%20drupal%209%20as%20a%20framework_files/image042.gif"></span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:15.1pt;margin-bottom:
32.35pt;margin-left:14.0pt;line-height:110%;background:#FFD966'><span
style='font-size:11.0pt;line-height:110%'>A real advantage of drupal is that
time-consuming development practices like file uploads and managing a file
library are easily installed with some clicks.</span></p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=600
 style='width:6.25in;border-collapse:collapse'>
 <tr style='height:111.0pt'>
  <td width=59 valign=top style='width:44.25pt;background:#E2E3E5;padding:14.6pt 5.75pt 0in 0in;
  height:111.0pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:14.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%'>&#128187;</span></p>
  </td>
  <td width=541 style='width:405.75pt;background:#E2E3E5;padding:14.6pt 5.75pt 0in 0in;
  height:111.0pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:16.5pt;
  margin-left:0in;text-indent:0in'>Define a media type at <u>Structure &gt;
  Media types &gt; Add media Type </u>and choose this:</p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.7pt;
  margin-left:0in;text-indent:0in;line-height:107%'><b>Name</b>: Image</p>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><b>Media
  source</b>: Image</p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:3.35pt;
margin-left:-.25pt'>After saving the media type, you’ll discover ‘Image’ is a
bundle of entity media. It has fields which are preconfigured at <u>admin/structure/media/manage/image/fields</u><i>.
</i>In this case, the entity has an image field that is shipped with the media
source: image.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:-1.7pt;margin-bottom:
24.25pt;margin-left:1.5pt;text-indent:0in;line-height:107%'><img border=0
width=602 height=279 id="Picture 6379"
src="Learning%20drupal%209%20as%20a%20framework_files/image043.jpg"></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:.15pt;
margin-left:-.25pt'>We tweak the image field at</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'><u>/admin/structure/media/manage/image/fields/media.image.field_media_image
</u>with some settings, so resizing is automatically done when a file is too
large.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:-1.7pt;margin-bottom:
0in;margin-left:1.5pt;text-indent:0in;line-height:107%'><img border=0
width=602 height=852 id="Picture 6389"
src="Learning%20drupal%209%20as%20a%20framework_files/image044.jpg"></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:19.0pt;
margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:11.0pt;
line-height:107%'><img border=0 width=602 height=741
src="Learning%20drupal%209%20as%20a%20framework_files/image045.gif"></span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>Save and head back to our offer create form (<i><u>/offers/create</u></i>)
we now have a widget with a media library that works for us out-of-the box!</p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:21.75pt;
margin-left:1.5pt;text-indent:0in;line-height:107%'><img border=0 width=486
height=449 id="Picture 6503"
src="Learning%20drupal%209%20as%20a%20framework_files/image046.jpg"></p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=600
 style='width:6.25in;border-collapse:collapse'>
 <tr style='height:178.5pt'>
  <td width=59 valign=top style='width:44.25pt;background:#E2E3E5;padding:14.6pt 5.75pt 0in 0in;
  height:178.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:14.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%'>&#128187;</span></p>
  </td>
  <td width=541 style='width:405.75pt;background:#E2E3E5;padding:14.6pt 5.75pt 0in 0in;
  height:178.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:9.7pt;margin-bottom:
  15.0pt;margin-left:0in;text-indent:0in;line-height:117%'><span
  style='font-size:11.0pt;line-height:117%'>You’ll notice that when adding
  media items to your library, also media items of others are visible. This is
  because the media library is using a view to display the content. At <u>/admin/structure/views/view/media_library
  </u><b>add the same contextual filter as we did with the offers view</b>:
  contextual filters &gt; media:authored by &gt; provide default value &gt;
  User ID from logged in user.</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.5pt;
  margin-left:0in;text-indent:0in;line-height:107%'><b><span style='font-size:
  11.0pt;line-height:107%'>Important! </span></b><span style='font-size:11.0pt;
  line-height:107%'>Do this for every display mode:</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.5pt;
  margin-left:0in;text-indent:0in;line-height:107%'><u><span style='font-size:
  11.0pt;line-height:107%'>/admin/structure/views/view/media_library/edit/page</span></u></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.5pt;
  margin-left:0in;text-indent:0in;line-height:107%'><u><span style='font-size:
  11.0pt;line-height:107%'>/admin/structure/views/view/media_library/edit/widget</span></u></p>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><u><span
  style='font-size:11.0pt;line-height:107%'>/admin/structure/views/view/media_library/edit/widget_table</span></u></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'><span style='background:yellow'>This will <i>only </i>make
sure we don’t see media items from other users inside our library. </span>Media
entities are not secured further in this course. If you would like more
security, you could overwrite the Media module <i>AccesControlHandler() </i>by
adding a <i>offer_entity_access() </i>hook to your <b>modules/custom/offer/offer.module</b>.
You could also use private files for uploads.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>But we’ll leave this public, as this is not a feature that
is needed.</p>

<h3 style='margin-left:-.25pt'><a name="_Toc247046">Adding fields to the custom
entity via the UI</a></h3>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=600
 style='width:6.25in;border-collapse:collapse'>
 <tr style='height:69.0pt'>
  <td width=59 valign=top style='width:44.25pt;background:#6D9EEB;padding:14.6pt 5.75pt 0in 0in;
  height:69.0pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:14.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%'>&#128073;</span></p>
  </td>
  <td width=541 style='width:405.75pt;background:#6D9EEB;padding:14.6pt 5.75pt 0in 0in;
  height:69.0pt'>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%'>In this section, the author shows
  how to add a textarea with a rich-text editor (CKEditor) so that users have a
  few options to optimize their content. Further, a price field and an options
  field.</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:18.6pt;
margin-left:-.25pt'>Drupal ships with a core CKEditor module, which is the
industry standard for rich text editing. We want to add a description field to
our entity.</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=600
 style='width:6.25in;border-collapse:collapse'>
 <tr style='height:118.5pt'>
  <td width=600 valign=top style='width:6.25in;background:#E2E3E5;padding:16.6pt 5.75pt 0in 14.25pt;
  height:118.5pt'>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%'>&#128187; </span>Enable the <b>ckeditor
  </b>module:</p>
  <table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=521
   style='width:390.75pt;margin-left:30.0pt;border-collapse:collapse'>
   <tr style='height:43.5pt'>
    <td width=521 style='width:390.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
    height:43.5pt'>
    <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:
    2.1pt;margin-left:0in;text-indent:0in;line-height:107%'><span
    style='font-family:Consolas;color:#333333'>bash$ drush en ckeditor -y</span></p>
    <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
    style='font-family:Consolas;color:#008800'>[success] </span><span
    style='font-family:Consolas;color:#333333'>Successfully enabled: ckeditor</span></p>
    </td>
   </tr>
  </table>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:8.0pt;
  margin-left:0in;text-indent:0in;line-height:107%'></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:.65pt;
margin-left:-.25pt'>For authenticated users to be able to use the editor, go to
<u>/admin/config/content/formats </u>&gt; add text format:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:.9pt;
margin-left:-.25pt'><b>Name </b>(Html)</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:.9pt;
margin-left:-.25pt'><b>Roles </b>(Authenticated users)</p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.35pt;
margin-left:-.25pt;line-height:110%'><b>Text editor </b>(CKeditor)</p>

<p class=MsoNormal style='margin-top:0in;margin-right:-1.7pt;margin-bottom:
24.25pt;margin-left:1.5pt;text-indent:0in;line-height:107%'><img border=0
width=602 height=369 id="Picture 6598"
src="Learning%20drupal%209%20as%20a%20framework_files/image047.jpg"></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>Now choose the rich text buttons you’d like to enable and
save.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>We’ll add a description field for our offer at <u>/admin/structure/offer/fields
</u><i>&gt; add field</i></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:.9pt;
margin-left:-.25pt'><b>Add a new field </b>(Text, formatted, long)</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:.9pt;
margin-left:-.25pt'><b>Add a label </b>(Description)</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'><b>Description </b>(Be as complete as possible about your
offer)</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:2.1pt;
margin-left:-.25pt'>Next, we want the users to choose between a minimum price
or without a minimum price.</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=600
 style='width:6.25in;border-collapse:collapse'>
 <tr style='height:118.5pt'>
  <td width=600 valign=top style='width:6.25in;background:#E2E3E5;padding:16.65pt 5.75pt 0in 14.25pt;
  height:118.5pt'>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%'>&#128187; </span>We enable the core
  options module for this:</p>
  <table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=521
   style='width:390.75pt;margin-left:30.0pt;border-collapse:collapse'>
   <tr style='height:43.5pt'>
    <td width=521 style='width:390.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
    height:43.5pt'>
    <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:
    2.1pt;margin-left:0in;text-indent:0in;line-height:107%'><span
    style='font-family:Consolas;color:#333333'>bash$ drush en options</span></p>
    <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
    style='font-family:Consolas;color:#008800'>[success] </span><span
    style='font-family:Consolas;color:#333333'>Successfully enabled: options</span></p>
    </td>
   </tr>
  </table>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:8.0pt;
  margin-left:0in;text-indent:0in;line-height:107%'></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:4.05in;margin-bottom:
3.8pt;margin-left:-.25pt'><b>Add a new field </b>(Text, list) <b>Add a label </b>(Offer
type) <b>Allowed values list</b>: with_minimum|Set minimum price no_minimum|No
minimum price</p>

<p class=MsoNormal style='margin-top:0in;margin-right:-37.7pt;margin-bottom:
24.25pt;margin-left:37.5pt;text-indent:0in;line-height:107%'><img border=0
width=602 height=404 id="Picture 6640"
src="Learning%20drupal%209%20as%20a%20framework_files/image048.jpg"></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'><b>Description </b>(Set the type of offer)</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>If a user wants to ask for a minimum price, he needs a
field to enter the price. We’ll add a last field for this:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:.9pt;
margin-left:-.25pt'><b>Add a new field </b>(Number, decimal)</p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.35pt;
margin-left:-.25pt;line-height:110%'><b>Add a label </b>(Price)</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:.9pt;
margin-left:-.25pt'><b>Add a description </b>(Your minimum price (in $))</p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.35pt;
margin-left:-.25pt;line-height:110%'><b>Minimum </b>(0)</p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.35pt;
margin-left:-.25pt;line-height:110%'><b>Suffix </b>($)</p>

<p class=MsoNormal style='margin-top:0in;margin-right:-1.7pt;margin-bottom:
24.25pt;margin-left:1.5pt;text-indent:0in;line-height:107%'><img border=0
width=602 height=547 id="Picture 6670"
src="Learning%20drupal%209%20as%20a%20framework_files/image049.jpg"></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:.9pt;
margin-left:-.25pt'>The fields appear automatically in the entity creation form
at <u>/offers/create</u>. Via</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'><u>/admin/structure/offer/form-display </u>we can
manipulate order and display settings.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:24.25pt;
margin-left:1.5pt;text-indent:0in;line-height:107%'><img border=0 width=574
height=702 id="Picture 6683"
src="Learning%20drupal%209%20as%20a%20framework_files/image050.jpg"></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>We have now added all fields to our offer entities. We
learned that besides fields defined in code, there is also a way to add them
via the UI. For the first time, this will create extra configuration via
configuration management for our offer entity. Export it with drush to see
which files are created.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:-1.7pt;margin-bottom:
26.6pt;margin-left:1.5pt;text-indent:0in;line-height:107%'><img border=0
width=602 height=367 id="Picture 6736"
src="Learning%20drupal%209%20as%20a%20framework_files/image051.jpg"></p>

<h2 style='margin-left:-.25pt'><a name="_Toc247047">Adding workflows and
moderation to custom entities</a></h2>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=600
 style='width:6.25in;border-collapse:collapse'>
 <tr style='height:69.0pt'>
  <td width=59 valign=top style='width:44.25pt;background:#6D9EEB;padding:14.6pt 5.75pt 0in 0in;
  height:69.0pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:14.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%'>&#128073;</span></p>
  </td>
  <td width=541 style='width:405.75pt;background:#6D9EEB;padding:14.6pt 5.75pt 0in 0in;
  height:69.0pt'>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%'>This section teaches you the power
  of using workflows. We extend our <b>custom entity </b>with a state of <b>Draft,
  Published </b>and <b>Expired</b>. Based on these states, the published state
  (yes/no) is set..</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:18.6pt;
margin-left:-.25pt'>After years of building, the <b>workflows </b>and <b>content
moderation </b>modules were added to core. <span style='background:yellow'>These
enormous powerful modules give us the chance to add workflow states like
“draft”, “review” and “published” </span>to our entities. Additionally we can
give permissions to the different states or add actions when states change.</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=600
 style='width:6.25in;border-collapse:collapse'>
 <tr style='height:135.0pt'>
  <td width=600 valign=top style='width:6.25in;background:#E2E3E5;padding:16.65pt 5.75pt 0in 14.25pt;
  height:135.0pt'>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%'>&#128187; </span>We enable the core
  options module for this:</p>
  <table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=521
   style='width:390.75pt;margin-left:30.0pt;border-collapse:collapse'>
   <tr style='height:60.0pt'>
    <td width=521 style='width:390.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
    height:60.0pt'>
    <p class=MsoNormal style='margin-top:0in;margin-right:30.05pt;margin-bottom:
    0in;margin-left:0in;text-indent:0in;line-height:107%'><span
    style='font-family:Consolas;color:#333333'>bash$ drush en workflows,
    content_moderation </span><span style='font-family:Consolas;color:#008800'>[success]
    </span><span style='font-family:Consolas;color:#333333'>Successfully
    enabled: workflows, content_moderation</span></p>
    </td>
   </tr>
  </table>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:8.0pt;
  margin-left:0in;text-indent:0in;line-height:107%'></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>In our project, we want to add the following <b>moderation
states</b>:</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=599
 style='width:449.15pt;margin-left:.4pt;border-collapse:collapse'>
 <tr style='height:26.15pt'>
  <td width=152 style='width:114.15pt;border:solid #BF9000 1.0pt;background:
  #BF9000;padding:0in 5.75pt 0in 6.25pt;height:26.15pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  10.0pt;line-height:107%'>Moderation state</span></p>
  </td>
  <td width=132 style='width:99.0pt;border:solid #BF9000 1.0pt;border-left:
  none;background:#BF9000;padding:0in 5.75pt 0in 6.25pt;height:26.15pt'>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-size:10.0pt;line-height:107%'>Is published?</span></p>
  </td>
  <td width=315 style='width:236.0pt;border:solid #BF9000 1.0pt;border-left:
  none;background:#BF9000;padding:0in 5.75pt 0in 6.25pt;height:26.15pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:.75pt;text-indent:0in;line-height:107%'><span style='font-size:
  10.0pt;line-height:107%'>Description</span></p>
  </td>
 </tr>
 <tr style='height:28.0pt'>
  <td width=152 style='width:114.15pt;border:solid #BF9000 1.0pt;border-top:
  none;background:#FFE599;padding:0in 5.75pt 0in 6.25pt;height:28.0pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  10.0pt;line-height:107%'>Draft</span></p>
  </td>
  <td width=132 style='width:99.0pt;border-top:none;border-left:none;
  border-bottom:solid #BF9000 1.0pt;border-right:solid #BF9000 1.0pt;
  background:#FFE599;padding:0in 5.75pt 0in 6.25pt;height:28.0pt'>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-size:10.0pt;line-height:107%'>No</span></p>
  </td>
  <td width=315 style='width:236.0pt;border-top:none;border-left:none;
  border-bottom:solid #BF9000 1.0pt;border-right:solid #BF9000 1.0pt;
  background:#FFE599;padding:0in 5.75pt 0in 6.25pt;height:28.0pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:.75pt;text-indent:0in;line-height:107%'><span style='font-size:
  10.0pt;line-height:107%'>only authors can view their own drafts</span></p>
  </td>
 </tr>
 <tr style='height:27.0pt'>
  <td width=152 style='width:114.15pt;border:solid #BF9000 1.0pt;border-top:
  none;background:#FFE599;padding:0in 5.75pt 0in 6.25pt;height:27.0pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  10.0pt;line-height:107%'>Published</span></p>
  </td>
  <td width=132 style='width:99.0pt;border-top:none;border-left:none;
  border-bottom:solid #BF9000 1.0pt;border-right:solid #BF9000 1.0pt;
  background:#FFE599;padding:0in 5.75pt 0in 6.25pt;height:27.0pt'>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-size:10.0pt;line-height:107%'>Yes</span></p>
  </td>
  <td width=315 style='width:236.0pt;border-top:none;border-left:none;
  border-bottom:solid #BF9000 1.0pt;border-right:solid #BF9000 1.0pt;
  background:#FFE599;padding:0in 5.75pt 0in 6.25pt;height:27.0pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:.75pt;text-indent:0in;line-height:107%'><span style='font-size:
  10.0pt;line-height:107%'>accessible for everyone, bidding enabled</span></p>
  </td>
 </tr>
 <tr style='height:28.0pt'>
  <td width=152 style='width:114.15pt;border:solid #BF9000 1.0pt;border-top:
  none;background:#FFE599;padding:0in 5.75pt 0in 6.25pt;height:28.0pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  10.0pt;line-height:107%'>Expired</span></p>
  </td>
  <td width=132 style='width:99.0pt;border-top:none;border-left:none;
  border-bottom:solid #BF9000 1.0pt;border-right:solid #BF9000 1.0pt;
  background:#FFE599;padding:0in 5.75pt 0in 6.25pt;height:28.0pt'>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-size:10.0pt;line-height:107%'>Yes</span></p>
  </td>
  <td width=315 style='width:236.0pt;border-top:none;border-left:none;
  border-bottom:solid #BF9000 1.0pt;border-right:solid #BF9000 1.0pt;
  background:#FFE599;padding:0in 5.75pt 0in 6.25pt;height:28.0pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:.75pt;text-indent:0in;line-height:107%'><span style='font-size:
  10.0pt;line-height:107%'>visible for everyone, bidding disabled</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:.95pt;
margin-left:-.25pt'>Further, we want to use Workflow for the following <b>transitions</b>:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:.5in;text-indent:-.25in'><span style='font-family:"Arial",sans-serif'>&#9679;
</span>When an offer goes to an expired status, we want to send an email to all
users who have made a bid on the offer.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>Via <u>admin/config/workflow/workflows </u>we add a
workflow called ‘Offer workflow’.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:.9pt;
margin-left:-.25pt'><b>Label </b>(Offer workflow)</p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:17.65pt;
margin-left:-.25pt;line-height:110%'><b>Content moderation </b>(Worfklow type)</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:3.35pt;
margin-left:-.25pt'>Under <b>the states tab</b>, draft and published are
default shipped with the content moderation module. We need to add ‘Expired’.
Click ‘Add a new state’:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:-1.7pt;margin-bottom:
0in;margin-left:1.5pt;text-indent:0in;line-height:107%'><img border=0
width=602 height=435 id="Picture 6800"
src="Learning%20drupal%209%20as%20a%20framework_files/image052.jpg"></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:2.1pt;
margin-left:-.25pt'>Under <b>the transitions tab</b>, we see “Create new draft”
and “Publish” are already enabled. We add “Make expired” by clicking the “Add a
new transition” button.</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=600
 style='width:6.25in;border-collapse:collapse'>
 <tr style='height:42.0pt'>
  <td width=59 style='width:44.25pt;background:#E2E3E5;padding:0in 5.75pt 0in 0in;
  height:42.0pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:14.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%'>&#128187;</span></p>
  </td>
  <td width=541 style='width:405.75pt;background:#E2E3E5;padding:0in 5.75pt 0in 0in;
  height:42.0pt'>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%'>Use the machine name “expired”
  here. We will need this for our events later.</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:-.2pt;margin-bottom:24.25pt;
margin-left:1.5pt;text-indent:0in;line-height:107%'><img border=0 width=600
height=636 id="Picture 6835"
src="Learning%20drupal%209%20as%20a%20framework_files/image053.jpg"></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>Finally, in the <b>this workflow applies to </b>- tab,
select the offer entity. The <b>default moderation state </b>should be set to
Draft.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>Via <u>/admin/people/permissions </u>set the permission for
transitions to authenticated users:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:-1.7pt;margin-bottom:
24.25pt;margin-left:1.5pt;text-indent:0in;line-height:107%'><img border=0
width=602 height=167 id="Picture 6870"
src="Learning%20drupal%209%20as%20a%20framework_files/image054.jpg"></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:.05in;
margin-left:-.25pt'>It will activate a transition button on the edit forms:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:38.3pt;
margin-left:1.5pt;text-indent:0in;line-height:107%'><img border=0 width=283
height=229 id="Picture 6872"
src="Learning%20drupal%209%20as%20a%20framework_files/image055.jpg"></p>

<p class=MsoNormal style='margin-top:0in;margin-right:15.1pt;margin-bottom:
31.0pt;margin-left:14.0pt;line-height:110%;background:#FFD966'><span
style='font-size:11.0pt;line-height:110%'>In this chapter we learned to add
workflow and transition to our entity. Via the the UI we can set up these
pretty advanced workflows. In the rest of this course we’ll discover what we
can do with them in terms of access, visibility, etc.</span></p>

<h2 style='margin-left:-.25pt'><a name="_Toc247048">Change entity access based
on workflow states</a></h2>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=600
 style='width:6.25in;border-collapse:collapse'>
 <tr style='height:55.5pt'>
  <td width=59 valign=top style='width:44.25pt;background:#6D9EEB;padding:14.6pt 5.75pt 0in 0in;
  height:55.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:14.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%'>&#128073;</span></p>
  </td>
  <td width=541 style='width:405.75pt;background:#6D9EEB;padding:14.6pt 5.75pt 0in 0in;
  height:55.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:9.5pt;margin-bottom:
  0in;margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%'>This short section aims to change the existing
  access on our <b>custom entity </b>to an access based on <b>workflow state </b>of
  the entity.</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:.9pt;
margin-left:-.25pt'>At this moment, offer entities are only viewable for the
owner (creator) of the offer.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>Of course we want our offers to be visible for everyone
once it is in a published state.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.35pt;
margin-left:-.25pt;line-height:110%'>We head back over to <b>custom/offer/src/Entity/OfferAccessControlHandler.php
</b>and change the ‘view’ state from:</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:100.5pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
  height:100.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:0in;text-indent:0in;line-height:107%'><b><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>case </span></b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'view'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>:</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>if
  </span></b><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#333333'>($account-&gt;hasPermission(</span><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'administer own
  offers'</span><span style='font-size:11.0pt;line-height:107%;font-family:
  Consolas;color:#333333'>)) {</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$access =
  AccessResult::allowedIf($account-&gt;id() ==</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$entity-&gt;getOwnerId())-&gt;cachePerUser()-&gt;addCacheableDependency($entity);</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:391.4pt;margin-bottom:
  0in;margin-left:6.05pt;text-indent:0in;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}
  <b>break</b>;</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:2.1pt;
margin-left:-.25pt'>to:</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:220.5pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
  height:220.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><b><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>case </span></b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'view'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>:</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>//
  owners of the offer can always view</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:113.4pt;margin-bottom:
  0in;margin-left:18.15pt;text-indent:-12.1pt;line-height:115%'><b><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>if
  </span></b><span style='font-size:11.0pt;line-height:115%;font-family:Consolas;
  color:#333333'>($account-&gt;id() == $entity-&gt;getOwnerId()) { $access =</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.8pt;
  margin-left:0in;text-indent:0in;line-height:115%'><span style='font-size:
  11.0pt;line-height:115%;font-family:Consolas;color:#333333'>AccessResult::allowed()-&gt;cachePerUser()-&gt;addCacheableDependency($entity)
  ;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>} <b>else </b>{</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>//
  Other users only when published or expired</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$allowed = [</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'published'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>,
  </span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#DD1144'>'expired'</span><span style='font-size:11.0pt;line-height:
  107%;font-family:Consolas;color:#333333'>];</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$access =</span></p>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:115%'><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>AccessResult::allowedIf(in_array($entity-&gt;get(</span><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#DD1144'>'moderation_state'</span><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>)-&gt;getSt
  ring(), $allowed))-&gt;addCacheableDependency($entity);</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:391.4pt;margin-bottom:
  0in;margin-left:6.05pt;text-indent:0in;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}
  <b>break</b>;</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:30.4pt;
margin-left:-.25pt'>This will make my offer visible, even for anonymous
visitors of our platform if the offer is in the published or expired state.
With a second check, we ensure authors (owners) can see their offers anytime
(in all states). <span style='background:yellow'>This way, we secured the draft
(unpublished) state for outside viewers</span>.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:15.1pt;margin-bottom:
53.4pt;margin-left:14.0pt;line-height:110%;background:#FFD966'><span
style='font-size:11.0pt;line-height:110%'>While permissions in drupal are often
based on a <b>permission </b>level via admin/permission, we extended it now
with <b>ownership </b>and <b>workflow </b>of an entity. This allows us very
specific and advanced control.</span></p>

<h2 style='margin-left:-.25pt'><a name="_Toc247049">Adding views plugins:
custom fields and operation links</a></h2>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=600
 style='width:6.25in;border-collapse:collapse'>
 <tr style='height:82.5pt'>
  <td width=59 valign=top style='width:44.25pt;background:#6D9EEB;padding:14.6pt 5.75pt 0in 0in;
  height:82.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:14.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%'>&#128073;</span></p>
  </td>
  <td width=541 style='width:405.75pt;background:#6D9EEB;padding:14.6pt 5.75pt 0in 0in;
  height:82.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:11.05pt;margin-bottom:
  0in;margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%'>This section is meant to teach you how to add <b>custom
  fields </b>to your <b>views</b>. At the end you will be able to show custom
  output in views listings like tables. More specifically you will master how
  to add your own <b>operation links </b>in a <b>dropbutton </b>to add a direct
  publishing button, for example.</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:2.1pt;
margin-left:-.25pt'>Our entity already has views access defined. We can now
extend <b>custom/offer/src/OfferViewsData.php </b>with custom fields. First we
want to add a nice badge to the table to show the moderation states:</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:460.5pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
  height:460.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:240.3pt;margin-bottom:
  0in;margin-left:0in;text-indent:0in;line-height:237%'><b><span
  style='font-size:11.0pt;line-height:237%;font-family:Consolas;color:#999999'>&lt;?php
  </span></b><b><span style='font-size:11.0pt;line-height:237%;font-family:
  Consolas;color:#333333'>namespace </span></b><b><span style='font-size:11.0pt;
  line-height:237%;font-family:Consolas;color:#990000'>Drupal</span></b><span
  style='font-size:11.0pt;line-height:237%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:237%;font-family:Consolas;color:#990000'>offer</span></b><span
  style='font-size:11.0pt;line-height:237%;font-family:Consolas;color:#333333'>;
  <b>use </b></span><b><span style='font-size:11.0pt;line-height:237%;
  font-family:Consolas;color:#990000'>Drupal</span></b><span style='font-size:
  11.0pt;line-height:237%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:237%;font-family:Consolas;color:#990000'>views</span></b><span
  style='font-size:11.0pt;line-height:237%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:237%;font-family:Consolas;color:#990000'>EntityViewsData</span></b><span
  style='font-size:11.0pt;line-height:237%;font-family:Consolas;color:#333333'>;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><i><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>/**</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  </span></span><i><span style='font-size:11.0pt;line-height:107%;font-family:
  Consolas;color:#999988'>Provides views data for Offer entities.</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:14.6pt;
  margin-left:0in;text-indent:0in;line-height:118%'><span style='font-size:
  11.0pt;line-height:118%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  </span></span><i><span style='font-size:11.0pt;line-height:118%;font-family:
  Consolas;color:#999988'>*/ </span></i><b><span style='font-size:11.0pt;
  line-height:118%;font-family:Consolas;color:#333333'>class </span></b><b><span
  style='font-size:11.0pt;line-height:118%;font-family:Consolas;color:#445588'>OfferViewsData
  </span></b><b><span style='font-size:11.0pt;line-height:118%;font-family:
  Consolas;color:#333333'>extends </span></b><b><span style='font-size:11.0pt;
  line-height:118%;font-family:Consolas;color:#445588'>EntityViewsData </span></b><span
  style='font-size:11.0pt;line-height:118%;font-family:Consolas;color:#333333'>{</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>/**</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  </span></span><i><span style='font-size:11.0pt;line-height:107%;font-family:
  Consolas;color:#999988'>Returns the Views data for the entity.</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:240.3pt;margin-bottom:
  0in;margin-left:6.05pt;text-indent:6.05pt;line-height:121%'><i><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#999988'>*/
  </span></i><b><span style='font-size:11.0pt;line-height:121%;font-family:
  Consolas;color:#333333'>public function </span></b><b><span style='font-size:
  11.0pt;line-height:121%;font-family:Consolas;color:#990000'>getViewsData</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>()
  {</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:16.8pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$data = <b>parent</b>::getViewsData();</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$data[</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'offer'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>][</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'offer_entity_moderation_state_views_field'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>]
  = [</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:30.2pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'title' </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>=&gt;
  t(</span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#DD1144'>'Moderation status'</span><span style='font-size:11.0pt;
  line-height:107%;font-family:Consolas;color:#333333'>),</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:30.2pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'field' </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>=&gt;
  <b>array</b>(</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:42.3pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'title' </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>=&gt;
  t(</span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#DD1144'>'Moderation status'</span><span style='font-size:11.0pt;
  line-height:107%;font-family:Consolas;color:#333333'>),</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:42.3pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'help' </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>=&gt;
  t(</span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#DD1144'>'Shows the state of the offer entity.'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>),</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:42.3pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'id' </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>=&gt;
  </span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#DD1144'>'offer_entity_moderation_state_views_field'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>,</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:385.35pt;margin-bottom:
  15.8pt;margin-left:18.15pt;text-indent:12.1pt;line-height:115%'><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>),
  ];</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>return
  </span></b><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#333333'>$data;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:21.65pt;
margin-left:-.25pt'>For this to work, we need to add a views plugin. Add a file
to <b>custom/offer/src/Plugin/views/field/OfferEntityModerationState.php. </b>This
provides us many functions, for which we won’t go into detail. But take a look
at what we did at the render() function. There we load the value of the
moderation state and return it.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:13.9pt;
margin-left:5.0pt;line-height:107%;background:#F8F8F8'><b><span
style='font-family:Consolas;color:#999999'>&lt;?php</span></b></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.55pt;margin-bottom:0in;
margin-left:-1.0in;text-indent:0in;line-height:107%'>&nbsp;</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:687.0pt'>
  <td width=601 valign=bottom style='width:450.75pt;background:#F8F8F8;
  padding:0in 5.75pt .1in 5.25pt;height:687.0pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:18.6pt;
  margin-left:0in;text-indent:0in;line-height:107%'><b><span style='font-family:
  Consolas;color:#333333'>namespace </span></b><b><span style='font-family:
  Consolas;color:#990000'>Drupal</span></b><span style='font-family:Consolas;
  color:#333333'>\</span><b><span style='font-family:Consolas;color:#990000'>offer</span></b><span
  style='font-family:Consolas;color:#333333'>\</span><b><span style='font-family:
  Consolas;color:#990000'>Plugin</span></b><span style='font-family:Consolas;
  color:#333333'>\</span><b><span style='font-family:Consolas;color:#990000'>views</span></b><span
  style='font-family:Consolas;color:#333333'>\</span><b><span style='font-family:
  Consolas;color:#990000'>field</span></b><span style='font-family:Consolas;
  color:#333333'>;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:70.25pt;margin-bottom:
  15.6pt;margin-left:0in;text-indent:0in;line-height:122%'><b><span
  style='font-family:Consolas;color:#333333'>use </span></b><b><span
  style='font-family:Consolas;color:#990000'>Drupal</span></b><span
  style='font-family:Consolas;color:#333333'>\</span><b><span style='font-family:
  Consolas;color:#990000'>views</span></b><span style='font-family:Consolas;
  color:#333333'>\</span><b><span style='font-family:Consolas;color:#990000'>Plugin</span></b><span
  style='font-family:Consolas;color:#333333'>\</span><b><span style='font-family:
  Consolas;color:#990000'>views</span></b><span style='font-family:Consolas;
  color:#333333'>\</span><b><span style='font-family:Consolas;color:#990000'>field</span></b><span
  style='font-family:Consolas;color:#333333'>\</span><b><span style='font-family:
  Consolas;color:#990000'>FieldPluginBase</span></b><span style='font-family:
  Consolas;color:#333333'>; <b>use </b></span><b><span style='font-family:Consolas;
  color:#990000'>Drupal</span></b><span style='font-family:Consolas;color:#333333'>\</span><b><span
  style='font-family:Consolas;color:#990000'>views</span></b><span
  style='font-family:Consolas;color:#333333'>\</span><b><span style='font-family:
  Consolas;color:#990000'>ResultRow</span></b><span style='font-family:Consolas;
  color:#333333'>; <b>use </b></span><b><span style='font-family:Consolas;
  color:#990000'>Drupal</span></b><span style='font-family:Consolas;color:#333333'>\</span><b><span
  style='font-family:Consolas;color:#990000'>views</span></b><span
  style='font-family:Consolas;color:#333333'>\</span><b><span style='font-family:
  Consolas;color:#990000'>Plugin</span></b><span style='font-family:Consolas;
  color:#333333'>\</span><b><span style='font-family:Consolas;color:#990000'>views</span></b><span
  style='font-family:Consolas;color:#333333'>\</span><b><span style='font-family:
  Consolas;color:#990000'>display</span></b><span style='font-family:Consolas;
  color:#333333'>\</span><b><span style='font-family:Consolas;color:#990000'>DisplayPluginBase</span></b><span
  style='font-family:Consolas;color:#333333'>; <b>use </b></span><b><span
  style='font-family:Consolas;color:#990000'>Drupal</span></b><span
  style='font-family:Consolas;color:#333333'>\</span><b><span style='font-family:
  Consolas;color:#990000'>views</span></b><span style='font-family:Consolas;
  color:#333333'>\</span><b><span style='font-family:Consolas;color:#990000'>ViewExecutable</span></b><span
  style='font-family:Consolas;color:#333333'>;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.1pt;
  margin-left:0in;text-indent:0in;line-height:107%'><i><span style='font-family:
  Consolas;color:#999988'>/**</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.9pt;
  margin-left:0in;text-indent:0in;line-height:116%'><span style='font-family:
  Consolas;color:#999988'>*<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  </span></span><i><span style='font-family:Consolas;color:#999988'>A handler
  to provide a field that is completely custom by the administrator. *</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#999988'>*<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  </span></span><i><span style='font-family:Consolas;color:#DD1144'>@ingroup </span></i><i><span
  style='font-family:Consolas;color:#999988'>views_field_handlers</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.1pt;
  margin-left:0in;text-indent:0in;line-height:107%'><i><span style='font-family:
  Consolas;color:#999988'>*</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#999988'>*<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  </span></span><i><span style='font-family:Consolas;color:#DD1144'>@ViewsField</span></i><i><span
  style='font-family:Consolas;color:#999988'>(&quot;offer_entity_moderation_state_views_field&quot;)</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:57.1pt;margin-bottom:
  15.6pt;margin-left:0in;text-indent:0in;line-height:122%'><i><span
  style='font-family:Consolas;color:#999988'>*/ </span></i><b><span
  style='font-family:Consolas;color:#333333'>class </span></b><b><span
  style='font-family:Consolas;color:#445588'>OfferEntityModerationState </span></b><b><span
  style='font-family:Consolas;color:#333333'>extends </span></b><b><span
  style='font-family:Consolas;color:#445588'>FieldPluginBase </span></b><span
  style='font-family:Consolas;color:#333333'>{</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:281.4pt;margin-bottom:
  0in;margin-left:13.2pt;text-indent:-6.6pt;line-height:116%'><i><span
  style='font-family:Consolas;color:#999988'>/** * The current display.</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.1pt;
  margin-left:13.2pt;text-indent:0in;line-height:107%'><i><span
  style='font-family:Consolas;color:#999988'>*</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#999988'>*<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  </span></span><i><span style='font-family:Consolas;color:#DD1144'>@var </span></i><i><span
  style='font-family:Consolas;color:#999988'>string</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#999988'>*<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  </span></span><i><span style='font-family:Consolas;color:#999988'>The current
  display of the view.</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:261.6pt;margin-bottom:
  15.6pt;margin-left:6.6pt;text-indent:6.6pt;line-height:122%'><i><span
  style='font-family:Consolas;color:#999988'>*/ </span></i><b><span
  style='font-family:Consolas;color:#333333'>protected </span></b><span
  style='font-family:Consolas;color:#333333'>$currentDisplay;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:4.55in;margin-bottom:
  0in;margin-left:13.2pt;text-indent:-6.6pt;line-height:116%'><i><span
  style='font-family:Consolas;color:#999988'>/** * {</span></i><i><span
  style='font-family:Consolas;color:#DD1144'>@inheritdoc</span></i><i><span
  style='font-family:Consolas;color:#999988'>}</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:37.3pt;margin-bottom:
  0in;margin-left:6.6pt;text-indent:6.6pt;line-height:122%'><i><span
  style='font-family:Consolas;color:#999988'>*/ </span></i><b><span
  style='font-family:Consolas;color:#333333'>public function </span></b><b><span
  style='font-family:Consolas;color:#990000'>init</span></b><span
  style='font-family:Consolas;color:#333333'>(ViewExecutable $view,
  DisplayPluginBase</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:83.45pt;margin-bottom:
  0in;margin-left:19.8pt;text-indent:-19.8pt;line-height:116%'><span
  style='font-family:Consolas;color:#333333'>$display, array &amp;$options =
  NULL) { <b>parent</b>::init($view, $display, $options); <b>$this</b>-&gt;currentDisplay
  = $view-&gt;current_display;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:17.7pt;
  margin-left:6.6pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:4.55in;margin-bottom:
  0in;margin-left:13.2pt;text-indent:-6.6pt;line-height:116%'><i><span
  style='font-family:Consolas;color:#999988'>/** * {</span></i><i><span
  style='font-family:Consolas;color:#DD1144'>@inheritdoc</span></i><i><span
  style='font-family:Consolas;color:#999988'>}</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:228.6pt;margin-bottom:
  0in;margin-left:6.6pt;text-indent:6.6pt;line-height:122%'><i><span
  style='font-family:Consolas;color:#999988'>*/ </span></i><b><span
  style='font-family:Consolas;color:#333333'>public function </span></b><b><span
  style='font-family:Consolas;color:#990000'>usesGroupBy</span></b><span
  style='font-family:Consolas;color:#333333'>() { <b>return FALSE</b>;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:6.6pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>}</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.55pt;margin-bottom:0in;
margin-left:-1.0in;text-indent:0in;line-height:107%'>&nbsp;</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:456.0pt'>
  <td width=601 colspan=2 valign=bottom style='width:450.75pt;background:#F8F8F8;
  padding:0in 5.75pt 0in 0in;height:456.0pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:4.55in;margin-bottom:
  0in;margin-left:13.2pt;text-indent:-6.6pt;line-height:116%'><i><span
  style='font-family:Consolas;color:#999988'>/** * {</span></i><i><span
  style='font-family:Consolas;color:#DD1144'>@inheritdoc</span></i><i><span
  style='font-family:Consolas;color:#999988'>}</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:268.2pt;margin-bottom:
  0in;margin-left:6.6pt;text-indent:6.6pt;line-height:122%'><i><span
  style='font-family:Consolas;color:#999988'>*/ </span></i><b><span
  style='font-family:Consolas;color:#333333'>public function </span></b><b><span
  style='font-family:Consolas;color:#990000'>query</span></b><span
  style='font-family:Consolas;color:#333333'>() {</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:19.8pt;text-indent:0in;line-height:107%'><i><span
  style='font-family:Consolas;color:#999988'>// Do nothing -- to override the
  parent query.</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:17.7pt;
  margin-left:6.6pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:4.55in;margin-bottom:
  0in;margin-left:13.2pt;text-indent:-6.6pt;line-height:116%'><i><span
  style='font-family:Consolas;color:#999988'>/** * {</span></i><i><span
  style='font-family:Consolas;color:#DD1144'>@inheritdoc</span></i><i><span
  style='font-family:Consolas;color:#999988'>}</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:195.65pt;margin-bottom:
  0in;margin-left:6.6pt;text-indent:6.6pt;line-height:122%'><i><span
  style='font-family:Consolas;color:#999988'>*/ </span></i><b><span
  style='font-family:Consolas;color:#333333'>protected function </span></b><b><span
  style='font-family:Consolas;color:#990000'>defineOptions</span></b><span
  style='font-family:Consolas;color:#333333'>() {</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.1pt;
  margin-left:19.8pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>$options = <b>parent</b>::defineOptions();</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:37.3pt;margin-bottom:
  0in;margin-left:19.8pt;text-indent:0in;line-height:122%'><span
  style='font-family:Consolas;color:#333333'>$options[</span><span
  style='font-family:Consolas;color:#DD1144'>'hide_alter_empty'</span><span
  style='font-family:Consolas;color:#333333'>] = [</span><span
  style='font-family:Consolas;color:#DD1144'>'default' </span><span
  style='font-family:Consolas;color:#333333'>=&gt; <b>FALSE</b>]; <b>return </b>$options;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:17.7pt;
  margin-left:6.6pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:4.55in;margin-bottom:
  0in;margin-left:13.2pt;text-indent:-6.6pt;line-height:116%'><i><span
  style='font-family:Consolas;color:#999988'>/** * {</span></i><i><span
  style='font-family:Consolas;color:#DD1144'>@inheritdoc</span></i><i><span
  style='font-family:Consolas;color:#999988'>}</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:149.45pt;margin-bottom:
  0in;margin-left:6.6pt;text-indent:6.6pt;line-height:122%'><i><span
  style='font-family:Consolas;color:#999988'>*/ </span></i><b><span
  style='font-family:Consolas;color:#333333'>public function </span></b><b><span
  style='font-family:Consolas;color:#990000'>render</span></b><span
  style='font-family:Consolas;color:#333333'>(ResultRow $values) {</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:57.1pt;margin-bottom:
  0in;margin-left:19.8pt;text-indent:0in;line-height:119%'><span
  style='font-family:Consolas;color:#333333'>$entity = $values-&gt;_entity;
  $state = $entity-&gt;get(</span><span style='font-family:Consolas;color:#DD1144'>'moderation_state'</span><span
  style='font-family:Consolas;color:#333333'>)-&gt;getString(); <b>return </b>$state;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:17.7pt;
  margin-left:6.6pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-family:Consolas;color:#333333'>}</span></p>
  </td>
 </tr>
 <tr style='height:82.5pt'>
  <td width=59 valign=top style='width:44.25pt;background:#E2E3E5;padding:0in 5.75pt 0in 0in;
  height:82.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:14.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%'>&#128187;</span></p>
  </td>
  <td width=542 valign=top style='width:406.5pt;background:#E2E3E5;padding:
  0in 5.75pt 0in 0in;height:82.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:3.5pt;margin-bottom:
  0in;margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%'>Clear caches and add the moderation state to the
  offer views table. Also, make sure you remove the “Published status =
  TRUE”-filter from the views filters so draft offers also appear in the
  listing.</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:19.0pt;
margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:11.0pt;
line-height:107%'><img border=0 width=600 height=385 id="Group 184699"
src="Learning%20drupal%209%20as%20a%20framework_files/image056.gif"></span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:.05in;
margin-left:-.25pt'>Now our listing shows the moderation status as well at <u>/offers</u>:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:-1.7pt;margin-bottom:
24.25pt;margin-left:1.5pt;text-indent:0in;line-height:107%'><img border=0
width=602 height=331 id="Picture 7423"
src="Learning%20drupal%209%20as%20a%20framework_files/image057.jpg"></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>Let’s move on with a second field. What I always advise
people when doing custom applications with drupal, is to use the power of the
core <a
href="https://www.drupal.org/docs/drupal-apis/render-api/render-arrays#:~:text=%22Render%20Arrays%22%20or%20%22Renderable,integrated%20with%20the%20Theme%20API."><span
style='color:#1155CC'>render arrays</span></a>. There are so many core things
you can render, like dropdowns, tables, links, …</p>

<p class=MsoNormal style='margin-top:0in;margin-right:15.1pt;margin-bottom:
32.35pt;margin-left:14.0pt;line-height:110%;background:#FFD966'><span
style='font-size:11.0pt;line-height:110%'>A render array is an associative
array which conforms to the standards and data structures used in </span><a
href="https://api.drupal.org/api/drupal/core!lib!Drupal!Core!Render!theme.api.php/group/theme_render/8"><span
style='font-size:11.0pt;line-height:110%;color:#1155CC'>Drupal's Render API</span></a><span
style='font-size:11.0pt;line-height:110%'>. The Render API is also integrated
with the Theme API.</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'><span style='background:yellow'>The advantage of using them
is they stay consistent when upgrading</span>. Plus when you change your layout
with a theme from the community, you are sure they will look nice as well.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:2.1pt;
margin-left:-.25pt'>We want to make another custom views plugin field that
shows a <b>dropbutton </b>for editing and deleting. This makes our table a bit
more compact. When an offer  is still in draft mode, we also want a “Publish”
option added to the dropbutton. We start by extending the <b>custom/offer/src/OfferViewsData.php
</b><i>getViewsData() </i>function with a new field:</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:159.0pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 36.45pt 0in 5.25pt;
  height:159.0pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.1pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>$data[</span><span style='font-family:Consolas;
  color:#DD1144'>'offer'</span><span style='font-family:Consolas;color:#333333'>][</span><span
  style='font-family:Consolas;color:#DD1144'>'offer_dynamic_operation_links'</span><span
  style='font-family:Consolas;color:#333333'>] = [</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.1pt;
  margin-left:6.6pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#DD1144'>'title' </span><span style='font-family:Consolas;
  color:#333333'>=&gt; t(</span><span style='font-family:Consolas;color:#DD1144'>'Dynamic
  operations'</span><span style='font-family:Consolas;color:#333333'>),</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.1pt;
  margin-left:6.6pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#DD1144'>'field' </span><span style='font-family:Consolas;
  color:#333333'>=&gt; <b>array</b>(</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.1pt;
  margin-left:19.8pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#DD1144'>'title' </span><span style='font-family:Consolas;
  color:#333333'>=&gt; t(</span><span style='font-family:Consolas;color:#DD1144'>'Dynamic
  operations'</span><span style='font-family:Consolas;color:#333333'>),</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.9pt;
  margin-left:0in;text-align:justify;text-justify:inter-ideograph;text-indent:
  19.8pt;line-height:116%'><span style='font-family:Consolas;color:#DD1144'>'help'
  </span><span style='font-family:Consolas;color:#333333'>=&gt; t(</span><span
  style='font-family:Consolas;color:#DD1144'>'Shows a dropbutton with dynamic
  operations for offers.'</span><span style='font-family:Consolas;color:#333333'>),</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:112.15pt;margin-bottom:
  0in;margin-left:6.6pt;text-indent:13.2pt;line-height:116%'><span
  style='font-family:Consolas;color:#DD1144'>'id' </span><span
  style='font-family:Consolas;color:#333333'>=&gt; </span><span
  style='font-family:Consolas;color:#DD1144'>'offer_dynamic_operation_links'</span><span
  style='font-family:Consolas;color:#333333'>, ),</span></p>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-family:Consolas;color:#333333'>];</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:.15pt;
margin-left:-.25pt'>After this, we need to add a new views plugin:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.35pt;
margin-left:-.25pt;line-height:110%'><b>custom/offer/src/Plugin/views/field/OfferDynamicOperationLinks.php.</b></p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:205.5pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
  height:205.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:185.9pt;margin-bottom:
  0in;margin-left:0in;text-indent:0in;line-height:237%'><b><span
  style='font-size:11.0pt;line-height:237%;font-family:Consolas;color:#999999'>&lt;?php
  </span></b><b><span style='font-size:11.0pt;line-height:237%;font-family:
  Consolas;color:#333333'>namespace </span></b><b><span style='font-size:11.0pt;
  line-height:237%;font-family:Consolas;color:#990000'>Drupal</span></b><span
  style='font-size:11.0pt;line-height:237%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:237%;font-family:Consolas;color:#990000'>offer</span></b><span
  style='font-size:11.0pt;line-height:237%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:237%;font-family:Consolas;color:#990000'>Plugin</span></b><span
  style='font-size:11.0pt;line-height:237%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:237%;font-family:Consolas;color:#990000'>views</span></b><span
  style='font-size:11.0pt;line-height:237%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:237%;font-family:Consolas;color:#990000'>field</span></b><span
  style='font-size:11.0pt;line-height:237%;font-family:Consolas;color:#333333'>;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:101.3pt;margin-bottom:
  14.2pt;margin-left:0in;text-indent:0in;line-height:121%'><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>use
  </span></b><b><span style='font-size:11.0pt;line-height:121%;font-family:
  Consolas;color:#990000'>Drupal</span></b><span style='font-size:11.0pt;
  line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>views</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>Plugin</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>views</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>field</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>FieldPluginBase</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>;
  <b>use </b></span><b><span style='font-size:11.0pt;line-height:121%;
  font-family:Consolas;color:#990000'>Drupal</span></b><span style='font-size:
  11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>views</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>ResultRow</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>;
  <b>use </b></span><b><span style='font-size:11.0pt;line-height:121%;
  font-family:Consolas;color:#990000'>Drupal</span></b><span style='font-size:
  11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>views</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>Plugin</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>views</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>display</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>DisplayPluginBase</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>;
  <b>use </b></span><b><span style='font-size:11.0pt;line-height:121%;
  font-family:Consolas;color:#990000'>Drupal</span></b><span style='font-size:
  11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>views</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>ViewExecutable</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>;
  <b>use </b></span><b><span style='font-size:11.0pt;line-height:121%;
  font-family:Consolas;color:#990000'>Drupal</span></b><span style='font-size:
  11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>core</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>Url</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:0in;text-indent:0in;line-height:107%'><i><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>/**</span></i></p>
  <p class=MsoNormal style='margin:0in;text-indent:6.05pt;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*
  A handler to provide a field that is completely custom by the administrator.</span></i></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.55pt;margin-bottom:0in;
margin-left:-1.0in;text-indent:0in;line-height:107%'>&nbsp;</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:685.5pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
  height:685.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:42.3pt;text-indent:-24.15pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>@ingroup
  </span></i><i><span style='font-size:11.0pt;line-height:107%;font-family:
  Consolas;color:#999988'>views_field_handlers</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:42.3pt;text-indent:-24.15pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>@ViewsField</span></i><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>(&quot;offer_dynamic_operation_links&quot;)</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:101.3pt;margin-bottom:
  14.6pt;margin-left:0in;text-indent:6.05pt;line-height:118%'><i><span
  style='font-size:11.0pt;line-height:118%;font-family:Consolas;color:#999988'>*/
  </span></i><b><span style='font-size:11.0pt;line-height:118%;font-family:
  Consolas;color:#333333'>class </span></b><b><span style='font-size:11.0pt;
  line-height:118%;font-family:Consolas;color:#445588'>OfferDynamicOperationLinks
  </span></b><b><span style='font-size:11.0pt;line-height:118%;font-family:
  Consolas;color:#333333'>extends </span></b><b><span style='font-size:11.0pt;
  line-height:118%;font-family:Consolas;color:#445588'>FieldPluginBase </span></b><span
  style='font-size:11.0pt;line-height:118%;font-family:Consolas;color:#333333'>{</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>/**</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:42.3pt;text-indent:-24.15pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>The
  current display.</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:42.3pt;text-indent:-24.15pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>@var
  </span></i><i><span style='font-size:11.0pt;line-height:107%;font-family:
  Consolas;color:#999988'>string</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:42.3pt;text-indent:-24.15pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>The
  current display of the view.</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:270.5pt;margin-bottom:
  14.2pt;margin-left:12.1pt;text-indent:6.05pt;line-height:121%'><i><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#999988'>*/
  </span></i><b><span style='font-size:11.0pt;line-height:121%;font-family:
  Consolas;color:#333333'>protected </span></b><span style='font-size:11.0pt;
  line-height:121%;font-family:Consolas;color:#333333'>$currentDisplay;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>/**</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:42.3pt;text-indent:-24.15pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>{</span></i><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>@inheritdoc</span></i><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>}</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:4.6pt;margin-bottom:
  0in;margin-left:12.1pt;text-indent:6.05pt;line-height:121%'><i><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#999988'>*/
  </span></i><b><span style='font-size:11.0pt;line-height:121%;font-family:
  Consolas;color:#333333'>public function </span></b><b><span style='font-size:
  11.0pt;line-height:121%;font-family:Consolas;color:#990000'>init</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>(ViewExecutable
  $view, DisplayPluginBase $display,</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>array
  &amp;$options = NULL)</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:131.5pt;margin-bottom:
  0in;margin-left:24.2pt;text-indent:-12.1pt;line-height:115%'><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>{
  <b>parent</b>::init($view, $display, $options); <b>$this</b>-&gt;currentDisplay
  = $view-&gt;current_display;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:15.95pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>/**</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:42.3pt;text-indent:-24.15pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>{</span></i><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>@inheritdoc</span></i><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>}</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:252.4pt;margin-bottom:
  0in;margin-left:12.1pt;text-indent:6.05pt;line-height:121%'><i><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#999988'>*/
  </span></i><b><span style='font-size:11.0pt;line-height:121%;font-family:
  Consolas;color:#333333'>public function </span></b><b><span style='font-size:
  11.0pt;line-height:121%;font-family:Consolas;color:#990000'>usesGroupBy</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>()</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:337.0pt;margin-bottom:
  0in;margin-left:24.2pt;text-indent:-12.1pt;line-height:121%'><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>{
  <b>return FALSE</b>;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:15.95pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>/**</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:42.3pt;text-indent:-24.15pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>{</span></i><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>@inheritdoc</span></i><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>}</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:288.65pt;margin-bottom:
  0in;margin-left:12.1pt;text-indent:6.05pt;line-height:121%'><i><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#999988'>*/
  </span></i><b><span style='font-size:11.0pt;line-height:121%;font-family:
  Consolas;color:#333333'>public function </span></b><b><span style='font-size:
  11.0pt;line-height:121%;font-family:Consolas;color:#990000'>query</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>()</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>{</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:24.15pt;text-indent:0in;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>//
  Do nothing -- to override the parent query.</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:15.95pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>/**</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:42.3pt;text-indent:-24.15pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>{</span></i><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>@inheritdoc</span></i><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>}</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*/</span></i></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.55pt;margin-bottom:0in;
margin-left:-1.0in;text-indent:0in;line-height:107%'>&nbsp;</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:685.5pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
  height:685.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>protected
  function </span></b><b><span style='font-size:11.0pt;line-height:107%;
  font-family:Consolas;color:#990000'>defineOptions</span></b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>()</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>{</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:24.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$options = <b>parent</b>::defineOptions();</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:65.05pt;margin-bottom:
  0in;margin-left:24.15pt;text-indent:0in;line-height:121%'><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>$options[</span><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#DD1144'>'hide_alter_empty'</span><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>]
  = [</span><span style='font-size:11.0pt;line-height:121%;font-family:Consolas;
  color:#DD1144'>'default' </span><span style='font-size:11.0pt;line-height:
  121%;font-family:Consolas;color:#333333'>=&gt; <b>FALSE</b>]; <b>return </b>$options;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:15.95pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>/**</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*
  {</span></i><i><span style='font-size:11.0pt;line-height:107%;font-family:
  Consolas;color:#DD1144'>@inheritdoc</span></i><i><span style='font-size:11.0pt;
  line-height:107%;font-family:Consolas;color:#999988'>}</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:179.85pt;margin-bottom:
  0in;margin-left:12.1pt;text-indent:6.05pt;line-height:121%'><i><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#999988'>*/
  </span></i><b><span style='font-size:11.0pt;line-height:121%;font-family:
  Consolas;color:#333333'>public function </span></b><b><span style='font-size:
  11.0pt;line-height:121%;font-family:Consolas;color:#990000'>render</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>(ResultRow
  $values)</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>{</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:24.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$entity =
  $values-&gt;_entity;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:16.8pt;
  margin-left:24.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$state =
  $entity-&gt;get(</span><span style='font-size:11.0pt;line-height:107%;
  font-family:Consolas;color:#DD1144'>'moderation_state'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>)-&gt;getString();</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:288.65pt;margin-bottom:
  0in;margin-left:36.25pt;text-indent:-12.1pt;line-height:121%'><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>switch
  </span></b><span style='font-size:11.0pt;line-height:121%;font-family:Consolas;
  color:#333333'>($state) { <b>case </b></span><span style='font-size:11.0pt;
  line-height:121%;font-family:Consolas;color:#DD1144'>'draft'</span><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>:</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:48.35pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$operations[</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'publish'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>]
  = [</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:60.45pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'title' </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>=&gt;
  <b>$this</b>-&gt;t(</span><span style='font-size:11.0pt;line-height:107%;
  font-family:Consolas;color:#DD1144'>'Publish'</span><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>),</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:60.45pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'url' </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>=&gt;
  Url::fromRoute(</span><span style='font-size:11.0pt;line-height:107%;
  font-family:Consolas;color:#DD1144'>'entity.offer.edit_form'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>,
  [</span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#DD1144'>'offer' </span><span style='font-size:11.0pt;line-height:107%;
  font-family:Consolas;color:#333333'>=&gt;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:343.05pt;margin-bottom:
  0in;margin-left:48.35pt;text-indent:-48.35pt;line-height:115%'><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>$entity-&gt;id()])
  ]; <b>break</b>;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:15.95pt;
  margin-left:24.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:24.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$operations[</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'edit'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>]
  = [</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:36.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'title' </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>=&gt;
  <b>$this</b>-&gt;t(</span><span style='font-size:11.0pt;line-height:107%;
  font-family:Consolas;color:#DD1144'>'Edit'</span><span style='font-size:11.0pt;
  line-height:107%;font-family:Consolas;color:#333333'>),</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:36.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'url' </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>=&gt;
  Url::fromRoute(</span><span style='font-size:11.0pt;line-height:107%;
  font-family:Consolas;color:#DD1144'>'entity.offer.edit_form'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>,
  [</span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#DD1144'>'offer' </span><span style='font-size:11.0pt;line-height:107%;
  font-family:Consolas;color:#333333'>=&gt;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$entity-&gt;id()])</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:15.95pt;
  margin-left:24.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>];</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:24.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$operations[</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'delete'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>]
  = [</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:36.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'title' </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>=&gt;
  <b>$this</b>-&gt;t(</span><span style='font-size:11.0pt;line-height:107%;
  font-family:Consolas;color:#DD1144'>'Delete'</span><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>),</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:36.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'url' </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>=&gt;
  Url::fromRoute(</span><span style='font-size:11.0pt;line-height:107%;
  font-family:Consolas;color:#DD1144'>'entity.offer.delete_form'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>,
  [</span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#DD1144'>'offer' </span><span style='font-size:11.0pt;line-height:107%;
  font-family:Consolas;color:#333333'>=&gt;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$entity-&gt;id()])</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:15.95pt;
  margin-left:24.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>];</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:24.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$dropbutton = [</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:36.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'#type' </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>=&gt;
  </span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#DD1144'>'dropbutton'</span><span style='font-size:11.0pt;line-height:
  107%;font-family:Consolas;color:#333333'>,</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:36.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'#links' </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>=&gt;
  $operations</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:252.4pt;margin-bottom:
  0in;margin-left:24.15pt;text-indent:0in;line-height:237%'><span
  style='font-size:11.0pt;line-height:237%;font-family:Consolas;color:#333333'>];
  <b>return </b>render($dropbutton);</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:76.6pt;margin-bottom:
25.5pt;margin-left:5.0pt;line-height:111%;background:#F8F8F8'><span
style='font-size:11.0pt;line-height:111%;font-family:Consolas;color:#333333'>}</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:35.5pt;
margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:11.0pt;
line-height:107%'><img border=0 width=600 height=475
src="Learning%20drupal%209%20as%20a%20framework_files/image058.gif"></span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>After we save, you see we’ve added dynamic dropdown buttons
based on the entity state. When an entity has the ‘draft’ state, a publish
button is visible. <b>At this moment, the ‘Publish’ button is just linked to
the edit page</b>. In the next chapter we’ll add a custom controller in order
for this to work.</p>

<h2 style='margin-left:-.25pt'><a name="_Toc247050">Adding a</a></h2>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:27.75pt;
margin-left:1.5pt;text-indent:0in;line-height:107%'><img border=0 width=595
height=324 id="Picture 8006"
src="Learning%20drupal%209%20as%20a%20framework_files/image059.jpg"></p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=600
 style='width:6.25in;border-collapse:collapse'>
 <tr style='height:58.5pt'>
  <td width=59 valign=top style='width:44.25pt;background:#E2E3E5;padding:14.6pt 5.75pt 0in 0in;
  height:58.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:14.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%'>&#128187;</span></p>
  </td>
  <td width=541 style='width:405.75pt;background:#E2E3E5;padding:14.6pt 5.75pt 0in 0in;
  height:58.5pt'>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%'>Now all our actions are in the
  Actions column, we can delete the Edit and Delete column in views as well.</span></p>
  </td>
 </tr>
</table>

<h2 style='margin-left:-.25pt'><a name="_Toc247051">custom controller for
direct publishing</a></h2>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=600
 style='width:6.25in;border-collapse:collapse'>
 <tr style='height:69.0pt'>
  <td width=59 valign=top style='width:44.25pt;background:#6D9EEB;padding:14.6pt 5.75pt 0in 0in;
  height:69.0pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:14.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%'>&#128073;</span></p>
  </td>
  <td width=541 style='width:405.75pt;background:#6D9EEB;padding:14.6pt 5.75pt 0in 0in;
  height:69.0pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:3.8pt;margin-bottom:
  0in;margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%'>This section focuses on adding a custom controller.
  At the end you will master the possibilities of <b>routing </b>in drupal,
  know how <b>parameter upcasting </b>works and how to <b>validate </b>the
  slug.</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>The ‘publish’ button is pointed to the edit page. We would
like to provide a direct publish controller, with redirect to the published
offer.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.35pt;
margin-left:-.25pt;line-height:110%'>First, to <b>custom/offer/offer.routing.yml
</b>we add:</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:93.0pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
  height:93.0pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.1pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>offer.publish:</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:169.25pt;margin-bottom:
  0in;margin-left:6.6pt;text-indent:0in;line-height:116%'><span
  style='font-family:Consolas;color:#333333'>path: </span><span
  style='font-family:Consolas;color:#DD1144'>'/offers/publish/{offer}' </span><span
  style='font-family:Consolas;color:#333333'>defaults:</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:19.8pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>_controller:</span></p>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-family:Consolas;color:#DD1144'>'\Drupal\offer\Controller\OfferPublishController::Render'</span></p>
  </td>
 </tr>
 <tr style='height:142.5pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
  height:142.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:123.05pt;margin-bottom:
  0in;margin-left:6.6pt;text-indent:13.2pt;line-height:116%'><span
  style='font-family:Consolas;color:#333333'>_title_callback: </span><span
  style='font-family:Consolas;color:#DD1144'>'Publish offer' </span><span
  style='font-family:Consolas;color:#333333'>requirements:</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:19.8pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>_custom_access:</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:63.65pt;margin-bottom:
  0in;margin-left:6.6pt;text-indent:-6.6pt;line-height:116%'><span
  style='font-family:Consolas;color:#DD1144'>'\Drupal\offer\Controller\OfferPublishController::Access'
  </span><span style='font-family:Consolas;color:#333333'>options: parameters:</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:33.0pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>offer:</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:46.2pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>type: entity:offer</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:2.5pt;
margin-left:-.25pt'>Let’s go over the different keys of the snippet:</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=579
 style='width:434.15pt;margin-left:.4pt;border-collapse:collapse'>
 <tr style='height:26.15pt'>
  <td width=146 style='width:109.15pt;border:solid #BF9000 1.0pt;background:
  #BF9000;padding:9.2pt 7.1pt 0in 6.4pt;height:26.15pt'>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-size:10.0pt;line-height:107%'>Key</span></p>
  </td>
  <td width=433 style='width:325.0pt;border:solid #BF9000 1.0pt;border-left:
  none;background:#BF9000;padding:9.2pt 7.1pt 0in 6.4pt;height:26.15pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:.4pt;text-indent:0in;line-height:107%'><span style='font-size:
  10.0pt;line-height:107%'>Explanation</span></p>
  </td>
 </tr>
 <tr style='height:28.0pt'>
  <td width=146 style='width:109.15pt;border:solid #BF9000 1.0pt;border-top:
  none;background:#FFE599;padding:9.2pt 7.1pt 0in 6.4pt;height:28.0pt'>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%'>offer.publish</span></p>
  </td>
  <td width=433 style='width:325.0pt;border-top:none;border-left:none;
  border-bottom:solid #BF9000 1.0pt;border-right:solid #BF9000 1.0pt;
  background:#FFE599;padding:9.2pt 7.1pt 0in 6.4pt;height:28.0pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:.4pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%'>This is the uri that gets registered in drupal for
  this page.</span></p>
  </td>
 </tr>
 <tr style='height:41.0pt'>
  <td width=146 valign=top style='width:109.15pt;border:solid #BF9000 1.0pt;
  border-top:none;background:#FFE599;padding:9.2pt 7.1pt 0in 6.4pt;height:41.0pt'>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%'>path</span></p>
  </td>
  <td width=433 style='width:325.0pt;border-top:none;border-left:none;
  border-bottom:solid #BF9000 1.0pt;border-right:solid #BF9000 1.0pt;
  background:#FFE599;padding:9.2pt 7.1pt 0in 6.4pt;height:41.0pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:.4pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%'>The url of this page. We add a slug with {id} to
  identify the id of the offer we want to publish.</span></p>
  </td>
 </tr>
 <tr style='height:28.0pt'>
  <td width=146 style='width:109.15pt;border:solid #BF9000 1.0pt;border-top:
  none;background:#FFE599;padding:9.2pt 7.1pt 0in 6.4pt;height:28.0pt'>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%'>_controller</span></p>
  </td>
  <td width=433 style='width:325.0pt;border-top:none;border-left:none;
  border-bottom:solid #BF9000 1.0pt;border-right:solid #BF9000 1.0pt;
  background:#FFE599;padding:9.2pt 7.1pt 0in 6.4pt;height:28.0pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:.4pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%'>The class that gets called when visiting the page.</span></p>
  </td>
 </tr>
 <tr style='height:41.0pt'>
  <td width=146 valign=top style='width:109.15pt;border:solid #BF9000 1.0pt;
  border-top:none;background:#FFE599;padding:9.2pt 7.1pt 0in 6.4pt;height:41.0pt'>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%'>_title callback</span></p>
  </td>
  <td width=433 style='width:325.0pt;border-top:none;border-left:none;
  border-bottom:solid #BF9000 1.0pt;border-right:solid #BF9000 1.0pt;
  background:#FFE599;padding:9.2pt 7.1pt 0in 6.4pt;height:41.0pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:.4pt;text-align:justify;text-justify:inter-ideograph;text-indent:
  0in;line-height:107%'><span style='font-size:11.0pt;line-height:107%'>The
  title of the page. We can add a string or a method inside the class.</span></p>
  </td>
 </tr>
 <tr style='height:41.0pt'>
  <td width=146 valign=top style='width:109.15pt;border:solid #BF9000 1.0pt;
  border-top:none;background:#FFE599;padding:9.2pt 7.1pt 0in 6.4pt;height:41.0pt'>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%'>id</span></p>
  </td>
  <td width=433 style='width:325.0pt;border-top:none;border-left:none;
  border-bottom:solid #BF9000 1.0pt;border-right:solid #BF9000 1.0pt;
  background:#FFE599;padding:9.2pt 7.1pt 0in 6.4pt;height:41.0pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:.4pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%'>We add a validator to the id slug. By saying ‘ \d+’,
  we mean that id has to be numeric.</span></p>
  </td>
 </tr>
 <tr style='height:82.0pt'>
  <td width=146 valign=top style='width:109.15pt;border:solid #BF9000 1.0pt;
  border-top:none;background:#FFE599;padding:9.2pt 7.1pt 0in 6.4pt;height:82.0pt'>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%'>_custom_access</span></p>
  </td>
  <td width=433 style='width:325.0pt;border-top:none;border-left:none;
  border-bottom:solid #BF9000 1.0pt;border-right:solid #BF9000 1.0pt;
  background:#FFE599;padding:9.2pt 7.1pt 0in 6.4pt;height:82.0pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.75pt;
  margin-left:.4pt;text-indent:0in;line-height:100%'><span style='font-size:
  11.0pt;line-height:100%'>That method can then check access and return an
  access result object.</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:.4pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%'>The advantage of this is that menu links that point
  to the controller can automatically check access and decide to hide the link
  when necessary.</span></p>
  </td>
 </tr>
 <tr style='height:108.9pt'>
  <td width=146 valign=top style='width:109.15pt;border:solid #BF9000 1.0pt;
  border-top:none;background:#FFE599;padding:9.2pt 7.1pt 0in 6.4pt;height:108.9pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:11.1pt;margin-bottom:
  0in;margin-left:5.45pt;text-indent:-5.45pt;line-height:100%'><span
  style='font-size:11.0pt;line-height:100%'>parameters: offer:</span></p>
  <p class=MsoNormal align=center style='margin-top:0in;margin-right:0in;
  margin-bottom:0in;margin-left:5.2pt;text-align:center;text-indent:0in;
  line-height:107%'><span style='font-size:11.0pt;line-height:107%'>type:
  entity:offer</span></p>
  </td>
  <td width=433 style='width:325.0pt;border-top:none;border-left:none;
  border-bottom:solid #BF9000 1.0pt;border-right:solid #BF9000 1.0pt;
  background:#FFE599;padding:9.2pt 7.1pt 0in 6.4pt;height:108.9pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:8.65pt;margin-bottom:
  0in;margin-left:.4pt;text-indent:0in;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%'>A route can have route parameters.
  In this case our slug is {offer}. We tell the system these are of type
  entity:offer. This is called route parameter upcasting.This way our routing
  is automatically secured against wrong, non-numerical calls etc. A bonus is
  that we can use the entity directly in our Render() and Access() functions
  like this: Render(Offer $offer) {}</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:22.15pt;
margin-left:-.25pt;line-height:110%'>Add a controller to <b>custom/offer/src/Controller/OfferPublishController</b></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:13.9pt;
margin-left:5.0pt;line-height:107%;background:#F8F8F8'><b><span
style='font-family:Consolas;color:#999999'>&lt;?php</span></b></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.55pt;margin-bottom:0in;
margin-left:-1.0in;text-indent:0in;line-height:107%'>&nbsp;</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:687.0pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
  height:687.0pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:18.6pt;
  margin-left:0in;text-indent:0in;line-height:107%'><b><span style='font-family:
  Consolas;color:#333333'>namespace </span></b><b><span style='font-family:
  Consolas;color:#990000'>Drupal</span></b><span style='font-family:Consolas;
  color:#333333'>\</span><b><span style='font-family:Consolas;color:#990000'>offer</span></b><span
  style='font-family:Consolas;color:#333333'>\</span><b><span style='font-family:
  Consolas;color:#990000'>Controller</span></b><span style='font-family:Consolas;
  color:#333333'>;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:83.45pt;margin-bottom:
  15.6pt;margin-left:0in;text-indent:0in;line-height:122%'><b><span
  style='font-family:Consolas;color:#333333'>use </span></b><b><span
  style='font-family:Consolas;color:#990000'>Drupal</span></b><span
  style='font-family:Consolas;color:#333333'>\</span><b><span style='font-family:
  Consolas;color:#990000'>Core</span></b><span style='font-family:Consolas;
  color:#333333'>\</span><b><span style='font-family:Consolas;color:#990000'>Access</span></b><span
  style='font-family:Consolas;color:#333333'>\</span><b><span style='font-family:
  Consolas;color:#990000'>AccessResult</span></b><span style='font-family:Consolas;
  color:#333333'>; <b>use </b></span><b><span style='font-family:Consolas;
  color:#990000'>Drupal</span></b><span style='font-family:Consolas;color:#333333'>\</span><b><span
  style='font-family:Consolas;color:#990000'>Core</span></b><span
  style='font-family:Consolas;color:#333333'>\</span><b><span style='font-family:
  Consolas;color:#990000'>Controller</span></b><span style='font-family:Consolas;
  color:#333333'>\</span><b><span style='font-family:Consolas;color:#990000'>ControllerBase</span></b><span
  style='font-family:Consolas;color:#333333'>; <b>use </b></span><b><span
  style='font-family:Consolas;color:#990000'>Drupal</span></b><span
  style='font-family:Consolas;color:#333333'>\</span><b><span style='font-family:
  Consolas;color:#990000'>Core</span></b><span style='font-family:Consolas;
  color:#333333'>\</span><b><span style='font-family:Consolas;color:#990000'>Entity</span></b><span
  style='font-family:Consolas;color:#333333'>\</span><b><span style='font-family:
  Consolas;color:#990000'>RevisionLogInterface</span></b><span
  style='font-family:Consolas;color:#333333'>; <b>use </b></span><b><span
  style='font-family:Consolas;color:#990000'>Drupal</span></b><span
  style='font-family:Consolas;color:#333333'>\</span><b><span style='font-family:
  Consolas;color:#990000'>Core</span></b><span style='font-family:Consolas;
  color:#333333'>\</span><b><span style='font-family:Consolas;color:#990000'>Url</span></b><span
  style='font-family:Consolas;color:#333333'>; <b>use </b></span><b><span
  style='font-family:Consolas;color:#990000'>Drupal</span></b><span
  style='font-family:Consolas;color:#333333'>\</span><b><span style='font-family:
  Consolas;color:#990000'>offer</span></b><span style='font-family:Consolas;
  color:#333333'>\</span><b><span style='font-family:Consolas;color:#990000'>Entity</span></b><span
  style='font-family:Consolas;color:#333333'>\</span><b><span style='font-family:
  Consolas;color:#990000'>Offer</span></b><span style='font-family:Consolas;
  color:#333333'>; <b>use </b></span><b><span style='font-family:Consolas;
  color:#990000'>Symfony</span></b><span style='font-family:Consolas;
  color:#333333'>\</span><b><span style='font-family:Consolas;color:#990000'>Component</span></b><span
  style='font-family:Consolas;color:#333333'>\</span><b><span style='font-family:
  Consolas;color:#990000'>HttpFoundation</span></b><span style='font-family:
  Consolas;color:#333333'>\</span><b><span style='font-family:Consolas;
  color:#990000'>RedirectResponse</span></b><span style='font-family:Consolas;
  color:#333333'>;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:0in;text-indent:0in;line-height:107%'><i><span style='font-family:
  Consolas;color:#999988'>/**</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:90.05pt;margin-bottom:
  10.4pt;margin-left:0in;text-indent:0in;line-height:159%'><i><span
  style='font-family:Consolas;color:#999988'>* Class OfferPublishController */ </span></i><b><span
  style='font-family:Consolas;color:#333333'>class </span></b><b><span
  style='font-family:Consolas;color:#445588'>OfferPublishController </span></b><b><span
  style='font-family:Consolas;color:#333333'>extends </span></b><b><span
  style='font-family:Consolas;color:#445588'>ControllerBase </span></b><span
  style='font-family:Consolas;color:#333333'>{ <b>public function </b></span><b><span
  style='font-family:Consolas;color:#990000'>Render</span></b><span
  style='font-family:Consolas;color:#333333'>(Offer $offer) {</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.1pt;
  margin-left:19.8pt;text-indent:0in;line-height:107%'><i><span
  style='font-family:Consolas;color:#999988'>// We set the moderation to
  published</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:19.8pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>$new_state = </span><span style='font-family:Consolas;
  color:#DD1144'>'published'</span><span style='font-family:Consolas;
  color:#333333'>;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:116.45pt;margin-bottom:
  0in;margin-left:19.8pt;text-indent:0in;line-height:122%'><span
  style='font-family:Consolas;color:#333333'>$offer-&gt;set(</span><span
  style='font-family:Consolas;color:#DD1144'>'moderation_state'</span><span
  style='font-family:Consolas;color:#333333'>, $new_state); <b>if </b>($offer <b>instanceof
  </b>RevisionLogInterface) {</span></p>
  <p class=MsoNormal align=center style='margin-top:0in;margin-right:0in;
  margin-bottom:1.2pt;margin-left:8.9pt;text-align:center;text-indent:0in;
  line-height:107%'><span style='font-family:Consolas;color:#333333'>$offer-&gt;setRevisionLogMessage(</span><span
  style='font-family:Consolas;color:#DD1144'>'Changed moderation state to</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#DD1144'>Published.'</span><span style='font-family:Consolas;
  color:#333333'>);</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:33.0pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>$offer-&gt;setRevisionUserId(<b>$this</b>-&gt;currentUser()-&gt;id());</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:19.8pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:17.7pt;
  margin-left:19.8pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>$offer-&gt;save();</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.1pt;
  margin-left:19.8pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>$publishedOffer = Url::fromRoute(</span><span
  style='font-family:Consolas;color:#DD1144'>'entity.offer.canonical'</span><span
  style='font-family:Consolas;color:#333333'>,</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:18.6pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>[</span><span style='font-family:Consolas;color:#DD1144'>'offer'
  </span><span style='font-family:Consolas;color:#333333'>=&gt;
  $offer-&gt;id()]);</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:43.9pt;margin-bottom:
  7.8pt;margin-left:0in;text-indent:19.8pt;line-height:177%'><span
  style='font-family:Consolas;color:#333333'>\Drupal::messenger()-&gt;addMessage($offer-&gt;label()
  . </span><span style='font-family:Consolas;color:#DD1144'>' is published.'</span><span
  style='font-family:Consolas;color:#333333'>); <b>return new </b>RedirectResponse($publishedOffer-&gt;toString());</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:182.45pt;margin-bottom:
  0in;margin-left:6.6pt;text-indent:0in;line-height:239%'><span
  style='font-family:Consolas;color:#333333'>} <b>public function </b></span><b><span
  style='font-family:Consolas;color:#990000'>Access</span></b><span
  style='font-family:Consolas;color:#333333'>(Offer $offer) {</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:19.8pt;text-indent:0in;line-height:107%'><i><span
  style='font-family:Consolas;color:#999988'>// Securing no one is trying to
  publish other people's offers.</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:19.8pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>$access = AccessResult::allowedIf($offer-&gt;access(</span><span
  style='font-family:Consolas;color:#DD1144'>'view'</span><span
  style='font-family:Consolas;color:#333333'>));</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:19.8pt;text-indent:0in;line-height:107%'><i><span
  style='font-family:Consolas;color:#999988'>// Make sure state is draft</span></i></p>
  </td>
 </tr>
 <tr style='height:1.75in'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
  height:1.75in'>
  <p class=MsoNormal align=center style='margin-top:0in;margin-right:0in;
  margin-bottom:1.2pt;margin-left:2.3pt;text-align:center;text-indent:0in;
  line-height:107%'><b><span style='font-family:Consolas;color:#333333'>if</span></b><span
  style='font-family:Consolas;color:#333333'>($offer-&gt;get(</span><span
  style='font-family:Consolas;color:#DD1144'>'moderation_state'</span><span
  style='font-family:Consolas;color:#333333'>)-&gt;getString() != </span><span
  style='font-family:Consolas;color:#DD1144'>'draft'</span><span
  style='font-family:Consolas;color:#333333'>) {</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:162.65pt;margin-bottom:
  17.4pt;margin-left:19.8pt;text-indent:13.2pt;line-height:116%'><span
  style='font-family:Consolas;color:#333333'>$access =
  AccessResult::forbidden(); }</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:19.8pt;text-indent:0in;line-height:107%'><b><span
  style='font-family:Consolas;color:#333333'>return </span></b><span
  style='font-family:Consolas;color:#333333'>$access;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:6.6pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-family:Consolas;color:#333333'>}</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:2.1pt;
margin-left:-.25pt'>In the <b><i>Render() </i></b>method, we programmatically
set the moderation state to published and redirect to the collection overview.
Thanks to the <b>Access() </b>method, we secure the page for abuse: we do an <b>$offer-&gt;access()
</b>check that verifies the visitor (it goes over the <b>OfferAccessControlHandler.php)
</b>is the owner and we check if the moderation state is draft.</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=600
 style='width:6.25in;border-collapse:collapse'>
 <tr style='height:319.5pt'>
  <td width=600 valign=top style='width:6.25in;background:#E2E3E5;padding:16.7pt 5.75pt 0in 14.25pt;
  height:319.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:7.8pt;margin-bottom:
  0in;margin-left:30.0pt;text-indent:-30.0pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%'>&#128187; </span>In the previous
  chapter we added a publish button in the view that was linked to the edit
  page. Link it to the publish page at <b>custom/offer/src/Plugin/views/field/OfferDynamicOperationLinks.php
  </b>on line <b>71</b>:</p>
  <table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=521
   style='width:390.75pt;margin-left:30.0pt;border-collapse:collapse'>
   <tr style='height:159.0pt'>
    <td width=521 style='width:390.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
    height:159.0pt'>
    <p class=MsoNormal style='margin-top:0in;margin-right:3.35in;margin-bottom:
    0in;margin-left:13.2pt;text-indent:-13.2pt;line-height:122%'><b><span
    style='font-family:Consolas;color:#333333'>switch </span></b><span
    style='font-family:Consolas;color:#333333'>($state) { <b>case </b></span><span
    style='font-family:Consolas;color:#DD1144'>'draft'</span><span
    style='font-family:Consolas;color:#333333'>:</span></p>
    <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:
    2.1pt;margin-left:26.4pt;text-indent:0in;line-height:107%'><span
    style='font-family:Consolas;color:#333333'>$operations[</span><span
    style='font-family:Consolas;color:#DD1144'>'publish'</span><span
    style='font-family:Consolas;color:#333333'>] = [</span></p>
    <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:
    2.1pt;margin-left:.55in;text-indent:0in;line-height:107%'><span
    style='font-family:Consolas;color:#DD1144'>'title' </span><span
    style='font-family:Consolas;color:#333333'>=&gt; <b>$this</b>-&gt;t(</span><span
    style='font-family:Consolas;color:#DD1144'>'Publish'</span><span
    style='font-family:Consolas;color:#333333'>),</span></p>
    <p class=MsoNormal style='margin-top:0in;margin-right:16.85pt;margin-bottom:
    0in;margin-left:0in;text-indent:.55in;line-height:116%'><span
    style='font-family:Consolas;color:#DD1144'>'url' </span><span
    style='font-family:Consolas;color:#333333'>=&gt; Url::fromRoute(</span><span
    style='font-family:Consolas;color:#DD1144'>'offer.publish'</span><span
    style='font-family:Consolas;color:#333333'>, [</span><span
    style='font-family:Consolas;color:#DD1144'>'offer' </span><span
    style='font-family:Consolas;color:#333333'>=&gt; $entity-&gt;id()]) ]; <b>break</b>;</span></p>
    <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
    style='font-family:Consolas;color:#333333'>}</span></p>
    </td>
   </tr>
  </table>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:30.0pt;text-indent:0in;line-height:107%'>Clear caches and publish
  a draft offer.</p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:70.85pt;
margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:11.0pt;
line-height:107%'><img border=0 width=600 height=286 id="Group 213272"
src="Learning%20drupal%209%20as%20a%20framework_files/image060.gif"></span></p>

<h2 style='margin-left:-.25pt'><a name="_Toc247052">Building an overview page</a></h2>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=600
 style='width:6.25in;border-collapse:collapse'>
 <tr style='height:55.5pt'>
  <td width=59 valign=top style='width:44.25pt;background:#6D9EEB;padding:14.6pt 5.75pt 0in 0in;
  height:55.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:14.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%'>&#128073;</span></p>
  </td>
  <td width=541 style='width:405.75pt;background:#6D9EEB;padding:14.6pt 5.75pt 0in 0in;
  height:55.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:3.05pt;margin-bottom:
  0in;margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%'>In this section you will be taught how to make <b>entity
  listings </b>with views using <b>view modes</b>.</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>We need an overview page where all the offers are viewable
for users that want to bid. The core views module comes back into play.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:.9pt;
margin-left:-.25pt'>But first, we want a <i>teaser </i><a
href="https://www.drupal.org/node/1577752"><span style='color:#1155CC'>view
mode</span></a><u><span style='color:#1155CC'> </span></u>for the offer
entities. At</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.7pt;margin-bottom:1.05pt;
margin-left:-.25pt;line-height:111%'><u>/admin/structure/display-modes/view/add/offer</u>.
we add a new one named <i>teaser.</i></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:38.25pt;
margin-left:1.5pt;text-indent:0in;line-height:107%'><img border=0 width=540
height=378 id="Picture 8444"
src="Learning%20drupal%209%20as%20a%20framework_files/image061.jpg"></p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=600
 style='width:6.25in;border-collapse:collapse'>
 <tr style='height:43.5pt'>
  <td width=59 style='width:44.25pt;background:#E2E3E5;padding:0in 5.75pt 0in 0in;
  height:43.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:14.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%'>&#128187;</span></p>
  </td>
  <td width=541 style='width:405.75pt;background:#E2E3E5;padding:0in 5.75pt 0in 0in;
  height:43.5pt'>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%'>Also, add a display mode called
  ‘full’, for later in the course.</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:.05in;
margin-left:-.25pt'>Make sure you activate the view modes via <u>/admin/structure/offer/display</u>:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:1.5pt;text-indent:0in;line-height:107%'><img border=0 width=537
height=360 id="Picture 8446"
src="Learning%20drupal%209%20as%20a%20framework_files/image062.jpg"></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:3.4pt;
margin-left:-.25pt'>At <u>/admin/structure/offer/display/teaser </u>we add the
fields we want to use in our twig files for the teasers of offer entities. For
the teaser, we need title, offer type, price, and image.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:24.25pt;
margin-left:1.5pt;text-indent:0in;line-height:107%'><img border=0 width=598
height=415 id="Picture 241844"
src="Learning%20drupal%209%20as%20a%20framework_files/image063.gif"></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>Time to build our view. Go to <u>admin/structure/views/<i>add
</i></u>to add a view named “Offer overview”</p>

<p class=MsoNormal style='margin-top:0in;margin-right:-1.7pt;margin-bottom:
24.25pt;margin-left:1.5pt;text-indent:0in;line-height:107%'><img border=0
width=602 height=775 id="Picture 8478"
src="Learning%20drupal%209%20as%20a%20framework_files/image064.jpg"></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>At the <b>fields </b>section, add “rendered entity”, choos
display mode <b>teaser</b>.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:-1.7pt;margin-bottom:
24.25pt;margin-left:1.5pt;text-indent:0in;line-height:107%'><img border=0
width=602 height=440 id="Picture 8485"
src="Learning%20drupal%209%20as%20a%20framework_files/image065.jpg"></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:0in;
margin-left:-.25pt'>We’ll take a look at what we have now: (</p>

<p class=MsoNormal style='margin-top:0in;margin-right:-1.7pt;margin-bottom:
24.25pt;margin-left:1.5pt;text-indent:0in;line-height:107%'><img border=0
width=602 height=548 id="Picture 8510"
src="Learning%20drupal%209%20as%20a%20framework_files/image066.jpg"></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>There is a bit of a problem here. We only want the ones
with moderation state ‘published’ in the overview. Not the ones with ‘expired’
status. For a solution for this, head on to the next chapter.</p>

<h3 style='margin-left:-.25pt'><a name="_Toc247053">Adding a custom views
filter based on moderation state</a></h3>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=600
 style='width:6.25in;border-collapse:collapse'>
 <tr style='height:82.5pt'>
  <td width=59 valign=top style='width:44.25pt;background:#6D9EEB;padding:14.6pt 5.75pt 0in 0in;
  height:82.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:14.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%'>&#128073;</span></p>
  </td>
  <td width=541 style='width:405.75pt;background:#6D9EEB;padding:14.6pt 5.75pt 0in 0in;
  height:82.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:7.55pt;margin-bottom:
  0in;margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%'>This section spotlights <b>custom views filters</b>.
  At the end you will be able to use a self-defined filter in the user
  interface of views. More specifically an example with a filter on certain
  moderation state (filter only on offers with moderation state “Published”) is
  elaborated.</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>Moderation state is not an available filter in drupal core
(<i>yet?)</i>. But this is a good opportunity to learn how to add a custom
filter in views, based on a state of the entity.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:2.1pt;
margin-left:-.25pt'>We extend our <i>viewsData() </i>function inside <b>custom/offer/src/OfferViewsData.php
</b>with a new field, this time a filter:</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:159.0pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
  height:159.0pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.1pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>$data[</span><span style='font-family:Consolas;
  color:#DD1144'>'offer'</span><span style='font-family:Consolas;color:#333333'>][</span><span
  style='font-family:Consolas;color:#DD1144'>'offer_moderation_state_filter'</span><span
  style='font-family:Consolas;color:#333333'>] = [</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.1pt;
  margin-left:6.6pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#DD1144'>'title' </span><span style='font-family:Consolas;
  color:#333333'>=&gt; t(</span><span style='font-family:Consolas;color:#DD1144'>'Moderation
  state'</span><span style='font-family:Consolas;color:#333333'>),</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.1pt;
  margin-left:6.6pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#DD1144'>'filter' </span><span style='font-family:Consolas;
  color:#333333'>=&gt; [</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.1pt;
  margin-left:19.8pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#DD1144'>'title' </span><span style='font-family:Consolas;
  color:#333333'>=&gt; t(</span><span style='font-family:Consolas;color:#DD1144'>'Moderation
  state'</span><span style='font-family:Consolas;color:#333333'>),</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:109.85pt;margin-bottom:
  0in;margin-left:19.8pt;text-indent:0in;line-height:122%'><span
  style='font-family:Consolas;color:#DD1144'>'help' </span><span
  style='font-family:Consolas;color:#333333'>=&gt; </span><span
  style='font-family:Consolas;color:#DD1144'>'Filters on moderation state'</span><span
  style='font-family:Consolas;color:#333333'>, </span><span style='font-family:
  Consolas;color:#DD1144'>'field' </span><span style='font-family:Consolas;
  color:#333333'>=&gt; </span><span style='font-family:Consolas;color:#DD1144'>'id'</span><span
  style='font-family:Consolas;color:#333333'>,</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:149.45pt;margin-bottom:
  0in;margin-left:6.6pt;text-indent:13.2pt;line-height:116%'><span
  style='font-family:Consolas;color:#DD1144'>'id' </span><span
  style='font-family:Consolas;color:#333333'>=&gt; </span><span
  style='font-family:Consolas;color:#DD1144'>'offer_moderation_state_filter'</span><span
  style='font-family:Consolas;color:#333333'>, ]</span></p>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-family:Consolas;color:#333333'>];</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.35pt;
margin-left:-.25pt;line-height:110%'>We add a file to <b>custom/offer/src/Plugin/views/filter
</b>named <b>ModerationStateFilter.php</b>:</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:355.5pt'>
  <td width=601 valign=top style='width:450.75pt;background:#F8F8F8;padding:
  7.65pt 5.75pt 0in 5.25pt;height:355.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:179.85pt;margin-bottom:
  0in;margin-left:0in;text-indent:0in;line-height:237%'><b><span
  style='font-size:11.0pt;line-height:237%;font-family:Consolas;color:#999999'>&lt;?php
  </span></b><b><span style='font-size:11.0pt;line-height:237%;font-family:
  Consolas;color:#333333'>namespace </span></b><b><span style='font-size:11.0pt;
  line-height:237%;font-family:Consolas;color:#990000'>Drupal</span></b><span
  style='font-size:11.0pt;line-height:237%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:237%;font-family:Consolas;color:#990000'>offer</span></b><span
  style='font-size:11.0pt;line-height:237%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:237%;font-family:Consolas;color:#990000'>Plugin</span></b><span
  style='font-size:11.0pt;line-height:237%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:237%;font-family:Consolas;color:#990000'>views</span></b><span
  style='font-size:11.0pt;line-height:237%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:237%;font-family:Consolas;color:#990000'>filter</span></b><span
  style='font-size:11.0pt;line-height:237%;font-family:Consolas;color:#333333'>;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:71.1pt;margin-bottom:
  14.2pt;margin-left:0in;text-indent:0in;line-height:121%'><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>use
  </span></b><b><span style='font-size:11.0pt;line-height:121%;font-family:
  Consolas;color:#990000'>Drupal</span></b><span style='font-size:11.0pt;
  line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>Core</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>Database</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>Connection</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>;
  <b>use </b></span><b><span style='font-size:11.0pt;line-height:121%;
  font-family:Consolas;color:#990000'>Drupal</span></b><span style='font-size:
  11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>views</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>Plugin</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>views</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>filter</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>InOperator</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>;
  <b>use </b></span><b><span style='font-size:11.0pt;line-height:121%;
  font-family:Consolas;color:#990000'>Drupal</span></b><span style='font-size:
  11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>views</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>ViewExecutable</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>;
  <b>use </b></span><b><span style='font-size:11.0pt;line-height:121%;
  font-family:Consolas;color:#990000'>Drupal</span></b><span style='font-size:
  11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>views</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>Plugin</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>views</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>display</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>DisplayPluginBase</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>;
  <b>use </b></span><b><span style='font-size:11.0pt;line-height:121%;
  font-family:Consolas;color:#990000'>Symfony</span></b><span style='font-size:
  11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>Component</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>DependencyInjection</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>ContainerInterface</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><i><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>/**</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:12.1pt;text-indent:-12.1pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>Filter
  class which filters by the available ModerationStates.</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:0in;text-indent:0in;line-height:107%'><i><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:12.1pt;text-indent:-12.1pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>@ViewsFilter</span></i><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>(&quot;offer_moderation_state_filter&quot;)</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:149.65pt;margin-bottom:
  29.2pt;margin-left:0in;text-indent:0in;line-height:121%'><i><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#999988'>*/
  </span></i><b><span style='font-size:11.0pt;line-height:121%;font-family:
  Consolas;color:#333333'>class </span></b><b><span style='font-size:11.0pt;
  line-height:121%;font-family:Consolas;color:#445588'>ModerationStateFilter </span></b><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>extends
  </span></b><b><span style='font-size:11.0pt;line-height:121%;font-family:
  Consolas;color:#445588'>InOperator </span></b><span style='font-size:11.0pt;
  line-height:121%;font-family:Consolas;color:#333333'>{</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>/**</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:12.1pt;text-indent:-12.1pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>@var
  </span></i><i><span style='font-size:11.0pt;line-height:107%;font-family:
  Consolas;color:#999988'>\Drupal\Core\Database\Connection</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:312.8pt;margin-bottom:
  0in;margin-left:6.05pt;text-indent:6.05pt;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*/
  </span></i><b><span style='font-size:11.0pt;line-height:107%;font-family:
  Consolas;color:#333333'>protected </span></b><span style='font-size:11.0pt;
  line-height:107%;font-family:Consolas;color:#333333'>$database;</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.55pt;margin-bottom:0in;
margin-left:-1.0in;text-indent:0in;line-height:107%'>&nbsp;</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:685.5pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 16.4pt 0in 5.25pt;
  height:685.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>/**</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.8pt;
  margin-left:12.1pt;text-indent:6.05pt;line-height:115%'><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#999988'>Constructs
  a Bundle object.*</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:12.1pt;text-indent:6.05pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>@param
  </span></i><i><span style='font-size:11.0pt;line-height:107%;font-family:
  Consolas;color:#999988'>array $configuration</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.8pt;
  margin-left:12.1pt;text-indent:6.05pt;line-height:115%'><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#999988'>A
  configuration array containing information about the plugin instance.</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:12.1pt;text-indent:6.05pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>@param
  </span></i><i><span style='font-size:11.0pt;line-height:107%;font-family:
  Consolas;color:#999988'>string $plugin_id</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:12.1pt;text-indent:6.05pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>The
  plugin_id for the plugin instance.</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:12.1pt;text-indent:6.05pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>@param
  </span></i><i><span style='font-size:11.0pt;line-height:107%;font-family:
  Consolas;color:#999988'>mixed $plugin_definition</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:12.1pt;text-indent:6.05pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>The
  plugin implementation definition.</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:54.4pt;margin-bottom:
  0in;margin-left:6.05pt;text-indent:6.05pt;line-height:121%'><i><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#999988'>*/
  </span></i><b><span style='font-size:11.0pt;line-height:121%;font-family:
  Consolas;color:#333333'>public function </span></b><b><span style='font-size:
  11.0pt;line-height:121%;font-family:Consolas;color:#990000'>__construct</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>(array
  $configuration, $plugin_id,</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:18.15pt;text-indent:-18.15pt;line-height:121%'><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>$plugin_definition,
  Connection $database) { <b>parent</b>::__construct($configuration,
  $plugin_id, $plugin_definition);</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$this</span></b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>-&gt;database
  = $database;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:15.95pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>/**</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:12.1pt;text-indent:6.05pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>{</span></i><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>@inheritdoc</span></i><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>}</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:24.15pt;margin-bottom:
  0in;margin-left:6.05pt;text-indent:6.05pt;line-height:121%'><i><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#999988'>*/
  </span></i><b><span style='font-size:11.0pt;line-height:121%;font-family:
  Consolas;color:#333333'>public static function </span></b><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>create</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>(ContainerInterface
  $container, array</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:96.7pt;margin-bottom:
  0in;margin-left:18.15pt;text-indent:-18.15pt;line-height:121%'><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>$configuration,
  $plugin_id, $plugin_definition) { <b>return new static</b>(</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:30.2pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$configuration,</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:30.2pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$plugin_id,</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:30.2pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$plugin_definition,</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:30.2pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$container-&gt;get(</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'database'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>)</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>);</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:15.95pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>/**</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:6.05pt;text-indent:12.1pt;line-height:115%'><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#999988'>Override
  the query so that no filtering takes place if the user doesn't</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:6.05pt;text-indent:12.1pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>select
  any options.</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:271.95pt;margin-bottom:
  14.2pt;margin-left:6.05pt;text-indent:6.05pt;line-height:121%'><i><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#999988'>*/
  </span></i><b><span style='font-size:11.0pt;line-height:121%;font-family:
  Consolas;color:#333333'>public function </span></b><b><span style='font-size:
  11.0pt;line-height:121%;font-family:Consolas;color:#990000'>query</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>()
  {</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>//
  Get the selected value first</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:16.8pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$selected = <b>$this</b>-&gt;value;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:15.0pt;
  margin-left:18.15pt;text-indent:0in;line-height:115%'><i><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#999988'>//
  If 'all' is selected, do not filter. This would mean all offers </span></i><b><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>if</span></b><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>(!in_array(</span><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#DD1144'>'all'</span><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>,
  $selected)) {</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:30.2pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$configuration =
  [</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:42.3pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'table' </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>=&gt;
  </span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#DD1144'>'content_moderation_state_field_data'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>,</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.55pt;margin-bottom:0in;
margin-left:-1.0in;text-indent:0in;line-height:107%'>&nbsp;</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:670.5pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 10.35pt 0in 5.25pt;
  height:670.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:42.3pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'field' </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>=&gt;
  </span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#DD1144'>'content_entity_id'</span><span style='font-size:11.0pt;
  line-height:107%;font-family:Consolas;color:#333333'>,</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:42.3pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'left_table' </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>=&gt;
  </span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#DD1144'>'offer'</span><span style='font-size:11.0pt;line-height:107%;
  font-family:Consolas;color:#333333'>,</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:42.3pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'left_field' </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>=&gt;
  </span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#DD1144'>'id'</span><span style='font-size:11.0pt;line-height:107%;
  font-family:Consolas;color:#333333'>,</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:42.3pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'operator' </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>=&gt;
  </span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#DD1144'>'='</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:30.2pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>];</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:30.2pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$join =</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>\Drupal::service(</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'plugin.manager.views.join'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>)-&gt;createInstance(</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'standard'</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:30.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>,
  $configuration);</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:0in;text-indent:0in;line-height:107%'><b><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$this</span></b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>-&gt;query-&gt;addRelationship(</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'content_moderation_state_field_data'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>,</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:15.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$join, </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'offer'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>);</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:30.2pt;text-indent:0in;line-height:107%'><b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$this</span></b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>-&gt;query-&gt;addWhere(</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'AND'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>,</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'content_moderation_state_field_data.moderation_state'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>,
  $selected,</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:15.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'IN'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>);</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:15.95pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>/**</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:6.05pt;text-indent:12.1pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>{</span></i><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>@inheritdoc</span></i><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>}</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:6.05pt;margin-bottom:
  0in;margin-left:6.05pt;text-indent:6.05pt;line-height:121%'><i><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#999988'>*/
  </span></i><b><span style='font-size:11.0pt;line-height:121%;font-family:
  Consolas;color:#333333'>public function </span></b><b><span style='font-size:
  11.0pt;line-height:121%;font-family:Consolas;color:#990000'>init</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>(ViewExecutable
  $view, DisplayPluginBase $display,</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:163.2pt;margin-bottom:
  0in;margin-left:18.15pt;text-indent:-18.15pt;line-height:115%'><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>array
  &amp;$options = NULL) { <b>parent</b>::init($view, $display, $options); <b>$this</b>-&gt;valueTitle
  = t(</span><span style='font-size:11.0pt;line-height:115%;font-family:Consolas;
  color:#DD1144'>'Moderation state'</span><span style='font-size:11.0pt;
  line-height:115%;font-family:Consolas;color:#333333'>);</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$this</span></b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>-&gt;definition[</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'options
  callback'</span><span style='font-size:11.0pt;line-height:107%;font-family:
  Consolas;color:#333333'>] = [<b>$this</b>,</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'getModerationStates'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>];</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:15.95pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>/**</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:6.05pt;text-indent:12.1pt;line-height:115%'><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#999988'>Generates
  the list of ModerationStates that can be used in the filter.</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:193.4pt;margin-bottom:
  0in;margin-left:6.05pt;text-indent:6.05pt;line-height:121%'><i><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#999988'>*/
  </span></i><b><span style='font-size:11.0pt;line-height:121%;font-family:
  Consolas;color:#333333'>public function </span></b><b><span style='font-size:
  11.0pt;line-height:121%;font-family:Consolas;color:#990000'>getModerationStates</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>()
  {</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$result = [</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:30.2pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'draft' </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>=&gt;
  </span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#DD1144'>'Draft'</span><span style='font-size:11.0pt;line-height:107%;
  font-family:Consolas;color:#333333'>,</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:30.2pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'published' </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>=&gt;
  </span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#DD1144'>'Published'</span><span style='font-size:11.0pt;line-height:
  107%;font-family:Consolas;color:#333333'>,</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:30.2pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'expired' </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>=&gt;
  </span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#DD1144'>'Expired'</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:326.35pt;margin-bottom:
  0in;margin-left:18.15pt;text-indent:0in;line-height:121%'><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>];
  <b>return </b>$result;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>Inside <i>getModerationStates()</i>, we define the search
options. We could dynamically get the available moderation states on an offer
entity, but this would take us too far. For the sake of example, we offer the
options in an hard-coded array.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:18.5pt;
margin-left:-.25pt'>Inside <i>query()</i>, we add a relationship to the
moderation table and left join it on the offer id.</p>

<p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
style='font-size:11.0pt;line-height:107%'><img border=0 width=600 height=452
src="Learning%20drupal%209%20as%20a%20framework_files/image067.gif"></span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:35.5pt;
margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:11.0pt;
line-height:107%'><img border=0 width=600 height=669 id="Group 188249"
src="Learning%20drupal%209%20as%20a%20framework_files/image068.gif"></span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:2.1pt;
margin-left:-.25pt'>One last thing we need to to before saving the view is add
a file to <b>custom/modules/offer/config/schema </b>named <b>offer.schema.yml</b>:</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:60.0pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
  height:60.0pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.1pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#DD1144'>views.filter.offer_moderation_state_filter:</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:195.65pt;margin-bottom:
  0in;margin-left:6.6pt;text-indent:0in;line-height:107%'><span
  style='font-family:Consolas;color:#333333'>type: </span><span
  style='font-family:Consolas;color:#DD1144'>views.filter.in_operator </span><span
  style='font-family:Consolas;color:#333333'>label: </span><span
  style='font-family:Consolas;color:#DD1144'>'Filter for moderation state'</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>Views plugins all need to have their own configuration
schema in order for them to work.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:21.35pt;
margin-left:-.25pt'>Clear caches, save the view and you’ll see it works! If you
check ‘Show SQL query’ at <u>admin/structure/views/settings </u>you can see the
actual query views does:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:155.2pt;margin-bottom:
.95pt;margin-left:5.0pt;line-height:110%;background:#F8F8F8'><b><span
style='font-size:11.0pt;line-height:110%;font-family:Consolas;color:#333333'>SELECT
</span></b><span style='font-size:11.0pt;line-height:110%;font-family:Consolas;
color:#333333'>offer.id <b>AS id</b></span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:155.2pt;margin-bottom:
.95pt;margin-left:5.0pt;line-height:110%;background:#F8F8F8'><b><span
style='font-size:11.0pt;line-height:110%;font-family:Consolas;color:#333333'>FROM</span></b></p>

<p class=MsoNormal style='margin-top:0in;margin-right:155.2pt;margin-bottom:
.8pt;margin-left:5.0pt;line-height:111%;background:#F8F8F8'><span
style='font-size:11.0pt;line-height:111%;font-family:Consolas;color:#333333'>{offer}
offer</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:155.2pt;margin-bottom:
.8pt;margin-left:5.0pt;line-height:111%;background:#F8F8F8'><b><span
style='font-size:11.0pt;line-height:111%;font-family:Consolas;color:#333333'>LEFT
JOIN </span></b><span style='font-size:11.0pt;line-height:111%;font-family:
Consolas;color:#333333'>{content_moderation_state_field_data}
content_moderation_state_field_data <b>ON </b>offer.id =
content_moderation_state_field_data.content_entity_id <b>WHERE </b>content_moderation_state_field_data.moderation_state
<b>IN</b></span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:155.2pt;margin-bottom:
1.25pt;margin-left:5.0pt;line-height:111%;background:#F8F8F8'><span
style='font-size:11.0pt;line-height:111%;font-family:Consolas;color:#333333'>(</span><span
style='font-size:11.0pt;line-height:111%;font-family:Consolas;color:#DD1144'>'published'</span><span
style='font-size:11.0pt;line-height:111%;font-family:Consolas;color:#333333'>)</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:155.2pt;margin-bottom:
37.45pt;margin-left:5.0pt;line-height:110%;background:#F8F8F8'><b><span
style='font-size:11.0pt;line-height:110%;font-family:Consolas;color:#333333'>LIMIT
</span></b><span style='font-size:11.0pt;line-height:110%;font-family:Consolas;
color:teal'>11 </span><b><span style='font-size:11.0pt;line-height:110%;
font-family:Consolas;color:#333333'>OFFSET </span></b><span style='font-size:
11.0pt;line-height:110%;font-family:Consolas;color:teal'>0</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:15.1pt;margin-bottom:
32.35pt;margin-left:14.0pt;line-height:110%;background:#FFD966'><span
style='font-size:11.0pt;line-height:110%'>Before drupal 8, we always used the
‘Published’ status which is a built-in boolean for being published or not. Here
we use states.</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:2.5pt;
margin-left:-.25pt'>An overview of the moderation states vs published status of
our offers:</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=602
 style='width:451.15pt;margin-left:.4pt;border-collapse:collapse'>
 <tr style='height:26.15pt'>
  <td width=299 style='width:224.15pt;border:solid #BF9000 1.0pt;background:
  #BF9000;padding:0in 5.75pt 0in 6.4pt;height:26.15pt'>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-size:10.0pt;line-height:107%'>Moderation state</span></p>
  </td>
  <td width=303 style='width:227.0pt;border:solid #BF9000 1.0pt;border-left:
  none;background:#BF9000;padding:0in 5.75pt 0in 6.4pt;height:26.15pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  10.0pt;line-height:107%'>Offer is published?</span></p>
  </td>
 </tr>
 <tr style='height:26.0pt'>
  <td width=299 style='width:224.15pt;border:solid #BF9000 1.0pt;border-top:
  none;background:#FFE599;padding:0in 5.75pt 0in 6.4pt;height:26.0pt'>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-size:10.0pt;line-height:107%'>Draft</span></p>
  </td>
  <td width=303 style='width:227.0pt;border-top:none;border-left:none;
  border-bottom:solid #BF9000 1.0pt;border-right:solid #BF9000 1.0pt;
  background:#FFE599;padding:0in 5.75pt 0in 6.4pt;height:26.0pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  10.0pt;line-height:107%'>No</span></p>
  </td>
 </tr>
 <tr style='height:26.0pt'>
  <td width=299 style='width:224.15pt;border:solid #BF9000 1.0pt;border-top:
  none;background:#FFE599;padding:0in 5.75pt 0in 6.4pt;height:26.0pt'>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-size:10.0pt;line-height:107%'>Published</span></p>
  </td>
  <td width=303 style='width:227.0pt;border-top:none;border-left:none;
  border-bottom:solid #BF9000 1.0pt;border-right:solid #BF9000 1.0pt;
  background:#FFE599;padding:0in 5.75pt 0in 6.4pt;height:26.0pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  10.0pt;line-height:107%'>Yes</span></p>
  </td>
 </tr>
 <tr style='height:26.9pt'>
  <td width=299 style='width:224.15pt;border:solid #BF9000 1.0pt;border-top:
  none;background:#FFE599;padding:0in 5.75pt 0in 6.4pt;height:26.9pt'>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-size:10.0pt;line-height:107%'>Expired</span></p>
  </td>
  <td width=303 style='width:227.0pt;border-top:none;border-left:none;
  border-bottom:solid #BF9000 1.0pt;border-right:solid #BF9000 1.0pt;
  background:#FFE599;padding:0in 5.75pt 0in 6.4pt;height:26.9pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  10.0pt;line-height:107%'>Yes</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:22.75pt;
margin-left:-.25pt'>So while the expired offers <i>are </i>published, we do not
show them in our view. On a software level we want to keep our expired offers
online, for SEO and archiving. Users will not be able to place a bid on expired
offers anymore.</p>

<h2 style='margin-left:-.25pt'><a name="_Toc247054">Optimize the entity teaser
with custom variables for twig</a></h2>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=600
 style='width:6.25in;border-collapse:collapse'>
 <tr style='height:88.5pt'>
  <td width=59 valign=top style='width:44.25pt;background:#6D9EEB;padding:14.6pt 5.75pt 0in 0in;
  height:88.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:14.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%'>&#128073;</span></p>
  </td>
  <td width=541 style='width:405.75pt;background:#6D9EEB;padding:14.6pt 5.75pt 0in 0in;
  height:88.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:8.1pt;margin-bottom:
  0in;margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%'>In this chapter we will learn how to optimize <b>rendered
  output </b>of an entity. You will see how we <b>prepare variables </b>for
  output with <b>twig</b>. For example, if an offer has no bids yet, show a
  message. Or show the amount of bids the offer has so far.</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>First, we prepare some extra variables we want to show in
our teasers:</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=564
 style='width:423.0pt;margin-left:.4pt;border-collapse:collapse'>
 <tr style='height:26.5pt'>
  <td width=248 style='width:186.15pt;border:solid #BF9000 1.0pt;border-top:
  none;background:#BF9000;padding:9.55pt 5.75pt 0in 6.4pt;height:26.5pt'>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-size:10.0pt;line-height:107%'>Variable name</span></p>
  </td>
  <td width=316 style='width:236.9pt;border-top:none;border-left:none;
  border-bottom:solid #BF9000 1.0pt;border-right:solid #BF9000 1.0pt;
  background:#BF9000;padding:9.55pt 5.75pt 0in 6.4pt;height:26.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:.65pt;text-indent:0in;line-height:107%'><span style='font-size:
  10.0pt;line-height:107%'>Description</span></p>
  </td>
 </tr>
 <tr style='height:44.0pt'>
  <td width=248 valign=top style='width:186.15pt;border:solid #BF9000 1.0pt;
  border-top:none;background:#FFE599;padding:9.55pt 5.75pt 0in 6.4pt;
  height:44.0pt'>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%'>promo</span></p>
  </td>
  <td width=316 style='width:236.9pt;border-top:none;border-left:none;
  border-bottom:solid #BF9000 1.0pt;border-right:solid #BF9000 1.0pt;
  background:#FFE599;padding:9.55pt 5.75pt 0in 6.4pt;height:44.0pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:.65pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%'>Adds a teasing message ‘Be the first!’ if the offer
  has no bids yet.</span></p>
  </td>
 </tr>
 <tr style='height:44.0pt'>
  <td width=248 valign=top style='width:186.15pt;border:solid #BF9000 1.0pt;
  border-top:none;background:#FFE599;padding:9.55pt 5.75pt 0in 6.4pt;
  height:44.0pt'>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%'>price</span></p>
  </td>
  <td width=316 style='width:236.9pt;border-top:none;border-left:none;
  border-bottom:solid #BF9000 1.0pt;border-right:solid #BF9000 1.0pt;
  background:#FFE599;padding:9.55pt 5.75pt 0in 6.4pt;height:44.0pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:3.0pt;margin-bottom:
  0in;margin-left:.65pt;text-indent:0in;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%'>Based on the type of offer, show
  the minimum price</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:2.1pt;
margin-left:-.25pt'>We can make the variables available by using the <i>template_preprocess_offer()
</i>hook in <b>modules/custom/offer/offer.module</b>:</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:460.5pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
  height:460.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:15.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><b><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>use </span></b><b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#990000'>Drupal</span></b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#990000'>Core</span></b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#990000'>Render</span></b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#990000'>Element</span></b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>;
  </span><i><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#999988'>// on top of file</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><i><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>/**</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:18.15pt;text-indent:-12.1pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>Prepares
  variables for templates.</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:18.15pt;text-indent:-12.1pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>implements
  hook_preprocess_HOOK()</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:59.0pt;margin-bottom:
  0in;margin-left:0in;text-indent:6.05pt;line-height:121%'><i><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#999988'>*/
  </span></i><b><span style='font-size:11.0pt;line-height:121%;font-family:
  Consolas;color:#333333'>function </span></b><b><span style='font-size:11.0pt;
  line-height:121%;font-family:Consolas;color:#990000'>template_preprocess_offer</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>(array
  &amp;$variables) { <b>foreach </b>(Element::children($variables[</span><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#DD1144'>'elements'</span><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>])
  <b>as </b>$key) {</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:24.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$variables[</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'content'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>][$key]
  = $variables[</span><span style='font-size:11.0pt;line-height:107%;
  font-family:Consolas;color:#DD1144'>'elements'</span><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>][$key];</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:15.95pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$offer =
  $variables[</span><span style='font-size:11.0pt;line-height:107%;font-family:
  Consolas;color:#DD1144'>'elements'</span><span style='font-size:11.0pt;
  line-height:107%;font-family:Consolas;color:#333333'>][</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'#offer'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>];</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>//
  The full offer object</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:16.8pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$variables[</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'offer'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>]
  = $offer;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:77.1pt;margin-bottom:
  0in;margin-left:12.1pt;text-indent:0in;line-height:121%'><i><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#999988'>//
  The current price: minimum or highest bid if available </span></i><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>switch</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>($offer-&gt;get(</span><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#DD1144'>'field_offer_type'</span><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>)-&gt;getString())
  { <b>case </b></span><span style='font-size:11.0pt;line-height:121%;
  font-family:Consolas;color:#DD1144'>'with_minimum'</span><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>:</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:36.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$variables[</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'price'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>]
  = </span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#DD1144'>'Start bidding at '</span><span style='font-size:11.0pt;
  line-height:107%;font-family:Consolas;color:#333333'>.</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:125.45pt;margin-bottom:
  .8pt;margin-left:36.25pt;text-indent:-36.25pt;line-height:115%'><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>$offer-&gt;get(</span><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#DD1144'>'field_price'</span><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>)-&gt;getString()
  . </span><span style='font-size:11.0pt;line-height:115%;font-family:Consolas;
  color:#DD1144'>'$'</span><span style='font-size:11.0pt;line-height:115%;
  font-family:Consolas;color:#333333'>; <b>break</b>;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:24.15pt;text-indent:0in;line-height:107%'><b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>case
  </span></b><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#DD1144'>'no_minimum'</span><span style='font-size:11.0pt;line-height:
  107%;font-family:Consolas;color:#333333'>;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:101.3pt;margin-bottom:
  0in;margin-left:36.25pt;text-indent:0in;line-height:115%'><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>$variables[</span><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#DD1144'>'price'</span><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>]
  = </span><span style='font-size:11.0pt;line-height:115%;font-family:Consolas;
  color:#DD1144'>'Start bidding at 0$'</span><span style='font-size:11.0pt;
  line-height:115%;font-family:Consolas;color:#333333'>; <b>break</b>;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:15.95pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>//
  a promo badge (we'll change this later)</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:15.95pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$variables[</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'promo'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>]
  = </span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#DD1144'>'Be the first!'</span><span style='font-size:11.0pt;
  line-height:107%;font-family:Consolas;color:#333333'>;</span></p>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.35pt;
margin-left:-.25pt;line-height:110%'>We add a teaser template file <b>custom/offer/templates/offer--teaser.html.twig:</b></p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:241.5pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
  height:241.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.1pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>&lt;a href=</span><span style='font-family:Consolas;
  color:#DD1144'>&quot;{{ path('entity.offer.canonical', {'offer': offer.id()})</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.1pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#DD1144'>}}&quot; </span><span style='font-family:Consolas;
  color:#333333'>{{ attributes.addClass(</span><span style='font-family:Consolas;
  color:#DD1144'>'offer-teaser'</span><span style='font-family:Consolas;
  color:#333333'>) }}&gt;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.1pt;
  margin-left:6.6pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>{% <b>if </b>promo %}&lt;div <b>class</b>=&quot;</span><b><span
  style='font-family:Consolas;color:#445588'>badge</span></b><span
  style='font-family:Consolas;color:#333333'>&quot;&gt;{{promo }}&lt;/div&gt;{%
  <b>endif </b>%}</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:6.6pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>&lt;div <b>class</b>=&quot;</span><b><span
  style='font-family:Consolas;color:#445588'>product</span></b><span
  style='font-family:Consolas;color:#333333'>-</span><b><span style='font-family:
  Consolas;color:#445588'>tumb</span></b><span style='font-family:Consolas;
  color:#333333'>&quot;&gt;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:19.8pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>{{ content.field_image }}</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.1pt;
  margin-left:6.6pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>&lt;/div&gt;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:6.6pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>&lt;div <b>class</b>=&quot;</span><b><span
  style='font-family:Consolas;color:#445588'>product</span></b><span
  style='font-family:Consolas;color:#333333'>-</span><b><span style='font-family:
  Consolas;color:#445588'>details</span></b><span style='font-family:Consolas;
  color:#333333'>&quot;&gt;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:19.8pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>&lt;</span><b><span style='font-family:Consolas;
  color:#445588'>h4</span></b><span style='font-family:Consolas;color:#333333'>&gt;{{
  offer.label() }}&lt;/h4&gt;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.1pt;
  margin-left:19.8pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>&lt;p&gt;{{ bid_amount }} bids&lt;/p&gt;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.1pt;
  margin-left:19.8pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>&lt;div <b>class</b>=&quot;</span><b><span
  style='font-family:Consolas;color:#445588'>product</span></b><span
  style='font-family:Consolas;color:#333333'>-</span><b><span style='font-family:
  Consolas;color:#445588'>bottom</span></b><span style='font-family:Consolas;
  color:#333333'>-</span><b><span style='font-family:Consolas;color:#445588'>details</span></b><span
  style='font-family:Consolas;color:#333333'>&quot;&gt;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:76.85pt;margin-bottom:
  0in;margin-left:19.8pt;text-indent:13.2pt;line-height:116%'><span
  style='font-family:Consolas;color:#333333'>&lt;</span><b><span
  style='font-family:Consolas;color:#445588'>div class</span></b><span
  style='font-family:Consolas;color:#333333'>=&quot;</span><b><span
  style='font-family:Consolas;color:#445588'>product</span></b><span
  style='font-family:Consolas;color:#333333'>-</span><b><span style='font-family:
  Consolas;color:#445588'>price</span></b><span style='font-family:Consolas;
  color:#333333'>&quot;&gt;{{ price }}&lt;/div&gt; &lt;/div&gt;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:6.6pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>&lt;/div&gt;</span></p>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-family:Consolas;color:#333333'>&lt;/a&gt;</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:2.1pt;
margin-left:-.25pt'>For drupal to be able to recognize this template, extend
the <i>offer_theme() </i>hook inside <b>custom/offer/offer.module</b>, we add
the offer__teaser key. We also add the default offer key, and a offer__full for
the offer page which we will use later:</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:291.0pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
  height:291.0pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.1pt;
  margin-left:0in;text-indent:0in;line-height:107%'><i><span style='font-family:
  Consolas;color:#999988'>/**</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:38.45pt;margin-bottom:
  1.2pt;margin-left:0in;text-indent:0in;line-height:107%'><span
  style='font-family:Consolas;color:#999988'>*<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  </span></span><i><span style='font-family:Consolas;color:#999988'>Provides a
  theme definition for custom content entity offer</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:38.45pt;margin-bottom:
  .45pt;margin-left:0in;text-indent:0in;line-height:119%'><span
  style='font-family:Consolas;color:#999988'>*<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  </span></span><i><span style='font-family:Consolas;color:#999988'>{</span></i><i><span
  style='font-family:Consolas;color:#DD1144'>@inheritdoc</span></i><i><span
  style='font-family:Consolas;color:#999988'>} */ </span></i><b><span
  style='font-family:Consolas;color:#333333'>function </span></b><b><span
  style='font-family:Consolas;color:#990000'>offer_theme</span></b><span
  style='font-family:Consolas;color:#333333'>($existing, $type, $theme, $path)
  {</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.1pt;
  margin-left:6.6pt;text-indent:0in;line-height:107%'><b><span
  style='font-family:Consolas;color:#333333'>return </span></b><span
  style='font-family:Consolas;color:#333333'>[</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.1pt;
  margin-left:19.8pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#DD1144'>'offer' </span><span style='font-family:Consolas;
  color:#333333'>=&gt; [</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:33.0pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#DD1144'>'render element' </span><span style='font-family:
  Consolas;color:#333333'>=&gt; </span><span style='font-family:Consolas;
  color:#DD1144'>'elements'</span><span style='font-family:Consolas;color:#333333'>,</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.1pt;
  margin-left:19.8pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>],</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.1pt;
  margin-left:19.8pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#DD1144'>'offer__full' </span><span style='font-family:Consolas;
  color:#333333'>=&gt; [</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:33.0pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#DD1144'>'base hook' </span><span style='font-family:Consolas;
  color:#333333'>=&gt; </span><span style='font-family:Consolas;color:#DD1144'>'offer'</span><span
  style='font-family:Consolas;color:#333333'>,</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.1pt;
  margin-left:19.8pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>],</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.1pt;
  margin-left:19.8pt;text-indent:0in;line-height:107%'><b><span
  style='font-family:Consolas;color:#DD1144'>'offer__teaser' </span></b><b><span
  style='font-family:Consolas;color:#333333'>=&gt; [</span></b></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:33.0pt;text-indent:0in;line-height:107%'><b><span
  style='font-family:Consolas;color:#DD1144'>'base hook' </span></b><b><span
  style='font-family:Consolas;color:#333333'>=&gt; </span></b><b><span
  style='font-family:Consolas;color:#DD1144'>'offer'</span></b></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:19.8pt;text-indent:0in;line-height:107%'><b><span
  style='font-family:Consolas;color:#333333'>]</span></b></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:6.6pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>];</span></p>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-family:Consolas;color:#333333'>}</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:0in;
margin-left:-.25pt'>Clear caches and take a view. Drupal now recognizes the
teaser file and shows the correct values in the teasers.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:-1.7pt;margin-bottom:
24.25pt;margin-left:1.5pt;text-indent:0in;line-height:107%'><img border=0
width=602 height=381 id="Picture 9577"
src="Learning%20drupal%209%20as%20a%20framework_files/image069.jpg"></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:21.95pt;
margin-left:-.25pt'>Head to the next chapter to add some styling to them.</p>

<h2 style='margin-left:-.25pt'><a name="_Toc247055">Adding css to views</a></h2>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=600
 style='width:6.25in;border-collapse:collapse'>
 <tr style='height:73.5pt'>
  <td width=59 valign=top style='width:44.25pt;background:#6D9EEB;padding:14.6pt 5.75pt 0in 0in;
  height:73.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:14.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%'>&#128073;</span></p>
  </td>
  <td width=541 style='width:405.75pt;background:#6D9EEB;padding:14.6pt 5.75pt 0in 0in;
  height:73.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:9.0pt;margin-bottom:
  0in;margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%'>In this chapter we will learn how to add <b>a
  libraries.yml </b>file with css to be included when rendering a specific
  view. At the end you will be able to include styles where a certain view is
  loaded.</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>I would recommend including the theming in a custom theme,
but sometimes it is needed to have custom javascript or css in a module to
target only specific components.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:2.1pt;
margin-left:-.25pt'>Add a file <b>custom/offer/offer.libraries.yml </b>file to
include a library for the overview page:</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:76.5pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
  height:76.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>offer_overview_page:</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:6.6pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>css:</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.1pt;
  margin-left:19.8pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>theme:</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:33.0pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#DD1144'>css/overview.css: {}</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:2.1pt;
margin-left:-.25pt'>To add the css <u>only </u>when the view is showed, we can
use the following hook that we add to our <b>custom/offer/offer.module </b>file:</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:175.5pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
  height:175.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:15.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><b><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>use </span></b><b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#990000'>Drupal</span></b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#990000'>views</span></b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#990000'>ViewExecutable</span></b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>;
  </span><i><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#999988'>// on top of file</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><i><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>/**</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><i><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>* Implements
  hook_views_pre_render().</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:107.35pt;margin-bottom:
  0in;margin-left:0in;text-indent:0in;line-height:121%'><i><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#999988'>*/
  </span></i><b><span style='font-size:11.0pt;line-height:121%;font-family:
  Consolas;color:#333333'>function </span></b><b><span style='font-size:11.0pt;
  line-height:121%;font-family:Consolas;color:#990000'>offer_views_pre_render</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>(ViewExecutable
  $view) {</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>if
  </span></b><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#333333'>(<b>isset</b>($view) &amp;&amp; ($view-&gt;storage-&gt;id() ==
  </span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#DD1144'>'offer_overview'</span><span style='font-size:11.0pt;
  line-height:107%;font-family:Consolas;color:#333333'>)) {</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$view-&gt;element[</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'#attached'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>][</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'library'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>][]
  =</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:264.45pt;margin-bottom:
  0in;margin-left:6.05pt;text-indent:-6.05pt;line-height:115%'><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#DD1144'>'offer/offer_overview_page'</span><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>;
  }</span></p>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:15.1pt;margin-bottom:
32.35pt;margin-left:14.0pt;line-height:110%;background:#FFD966'><span
style='font-size:11.0pt;line-height:110%'>We use <i>hook_views_pre_render() </i>to
tell the system to always attach the extra library whenever this view is
rendered.</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:2.1pt;
margin-left:-.25pt'>We add some css to <b>offer/css/overview.css </b>and our
teasers are ready!</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:340.5pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
  height:340.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:228.6pt;margin-bottom:
  0in;margin-left:13.2pt;text-indent:-13.2pt;line-height:120%'><span
  style='font-family:Consolas;color:#333333'>.offer-teaser { </span><span
  style='font-family:Consolas;color:navy'>width</span><span style='font-family:
  Consolas;color:#333333'>: </span><span style='font-family:Consolas;
  color:teal'>90%</span><span style='font-family:Consolas;color:#333333'>; </span><span
  style='font-family:Consolas;color:navy'>position</span><span
  style='font-family:Consolas;color:#333333'>: relative; </span><span
  style='font-family:Consolas;color:navy'>box-shadow</span><span
  style='font-family:Consolas;color:#333333'>: </span><span style='font-family:
  Consolas;color:teal'>0 2px 7px #dfdfdf</span><span style='font-family:Consolas;
  color:#333333'>; </span><span style='font-family:Consolas;color:navy'>margin</span><span
  style='font-family:Consolas;color:#333333'>: </span><span style='font-family:
  Consolas;color:teal'>50px 0</span><span style='font-family:Consolas;
  color:#333333'>; </span><span style='font-family:Consolas;color:navy'>background</span><span
  style='font-family:Consolas;color:#333333'>: </span><span style='font-family:
  Consolas;color:teal'>#fafafa</span><span style='font-family:Consolas;
  color:#333333'>; </span><span style='font-family:Consolas;color:navy'>display</span><span
  style='font-family:Consolas;color:#333333'>:block;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:17.7pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:195.65pt;margin-bottom:
  0in;margin-left:13.2pt;text-indent:-13.2pt;line-height:116%'><span
  style='font-family:Consolas;color:#333333'>.offer-teaser * { </span><span
  style='font-family:Consolas;color:navy'>text-underline</span><span
  style='font-family:Consolas;color:#333333'>:none;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:17.7pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:255.0pt;margin-bottom:
  0in;margin-left:13.2pt;text-indent:-13.2pt;line-height:107%'><span
  style='font-family:Consolas;color:#333333'>.badge { </span><span
  style='font-family:Consolas;color:navy'>position</span><span
  style='font-family:Consolas;color:#333333'>: absolute; </span><span
  style='font-family:Consolas;color:navy'>left</span><span style='font-family:
  Consolas;color:#333333'>: </span><span style='font-family:Consolas;
  color:teal'>0</span><span style='font-family:Consolas;color:#333333'>; </span><span
  style='font-family:Consolas;color:navy'>top</span><span style='font-family:
  Consolas;color:#333333'>: </span><span style='font-family:Consolas;
  color:teal'>20px</span><span style='font-family:Consolas;color:#333333'>; </span><span
  style='font-family:Consolas;color:navy'>text-transform</span><span
  style='font-family:Consolas;color:#333333'>: uppercase; </span><span
  style='font-family:Consolas;color:navy'>font-size</span><span
  style='font-family:Consolas;color:#333333'>: </span><span style='font-family:
  Consolas;color:teal'>13px</span><span style='font-family:Consolas;color:#333333'>;
  </span><span style='font-family:Consolas;color:navy'>font-weight</span><span
  style='font-family:Consolas;color:#333333'>: </span><span style='font-family:
  Consolas;color:teal'>700</span><span style='font-family:Consolas;color:#333333'>;</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.55pt;margin-bottom:0in;
margin-left:-1.0in;text-indent:0in;line-height:107%'>&nbsp;</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:687.0pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
  height:687.0pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:294.6pt;margin-bottom:
  0in;margin-left:13.2pt;text-indent:0in;line-height:122%'><span
  style='font-family:Consolas;color:navy'>background</span><span
  style='font-family:Consolas;color:#333333'>: </span><span style='font-family:
  Consolas;color:teal'>#C48904</span><span style='font-family:Consolas;
  color:#333333'>; </span><span style='font-family:Consolas;color:navy'>color</span><span
  style='font-family:Consolas;color:#333333'>: </span><span style='font-family:
  Consolas;color:teal'>#fff</span><span style='font-family:Consolas;color:#333333'>;
  </span><span style='font-family:Consolas;color:navy'>padding</span><span
  style='font-family:Consolas;color:#333333'>: </span><span style='font-family:
  Consolas;color:teal'>3px 10px</span><span style='font-family:Consolas;
  color:#333333'>;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:17.7pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:268.2pt;margin-bottom:
  0in;margin-left:13.2pt;text-indent:-13.2pt;line-height:117%'><span
  style='font-family:Consolas;color:#333333'>.product-tumb { </span><span
  style='font-family:Consolas;color:navy'>display</span><span style='font-family:
  Consolas;color:#333333'>: flex; </span><span style='font-family:Consolas;
  color:navy'>align-items</span><span style='font-family:Consolas;color:#333333'>:
  center; </span><span style='font-family:Consolas;color:navy'>justify-content</span><span
  style='font-family:Consolas;color:#333333'>: center; </span><span
  style='font-family:Consolas;color:navy'>height</span><span style='font-family:
  Consolas;color:#333333'>: auto; </span><span style='font-family:Consolas;
  color:navy'>width</span><span style='font-family:Consolas;color:#333333'>: </span><span
  style='font-family:Consolas;color:teal'>100%</span><span style='font-family:
  Consolas;color:#333333'>;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:18.6pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:3.45in;margin-bottom:
  0in;margin-left:13.2pt;text-indent:-13.2pt;line-height:122%'><span
  style='font-family:Consolas;color:#333333'>.product-tumb <b>img </b>{ </span><span
  style='font-family:Consolas;color:navy'>max-width</span><span
  style='font-family:Consolas;color:#333333'>: </span><span style='font-family:
  Consolas;color:teal'>100%</span><span style='font-family:Consolas;color:#333333'>;
  </span><span style='font-family:Consolas;color:navy'>max-height</span><span
  style='font-family:Consolas;color:#333333'>: </span><span style='font-family:
  Consolas;color:teal'>100%</span><span style='font-family:Consolas;color:#333333'>;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:17.7pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:268.2pt;margin-bottom:
  0in;margin-left:13.2pt;text-indent:-13.2pt;line-height:122%'><span
  style='font-family:Consolas;color:#333333'>.product-details { </span><span
  style='font-family:Consolas;color:navy'>padding</span><span style='font-family:
  Consolas;color:#333333'>: </span><span style='font-family:Consolas;
  color:teal'>30px</span><span style='font-family:Consolas;color:#333333'>;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:18.6pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:255.0pt;margin-bottom:
  0in;margin-left:13.2pt;text-indent:-13.2pt;line-height:120%'><span
  style='font-family:Consolas;color:#333333'>.product-details <b>h4 </b>{ </span><span
  style='font-family:Consolas;color:navy'>font-weight</span><span
  style='font-family:Consolas;color:#333333'>: </span><span style='font-family:
  Consolas;color:teal'>500</span><span style='font-family:Consolas;color:#333333'>;
  </span><span style='font-family:Consolas;color:navy'>display</span><span
  style='font-family:Consolas;color:#333333'>: block; </span><span
  style='font-family:Consolas;color:navy'>margin-bottom</span><span
  style='font-family:Consolas;color:#333333'>: </span><span style='font-family:
  Consolas;color:teal'>18px</span><span style='font-family:Consolas;color:#333333'>;
  </span><span style='font-family:Consolas;color:navy'>text-transform</span><span
  style='font-family:Consolas;color:#333333'>: uppercase; </span><span
  style='font-family:Consolas;color:navy'>color</span><span style='font-family:
  Consolas;color:#333333'>: </span><span style='font-family:Consolas;
  color:teal'>#363636</span><span style='font-family:Consolas;color:#333333'>; </span><span
  style='font-family:Consolas;color:navy'>text-decoration</span><span
  style='font-family:Consolas;color:#333333'>: none; </span><span
  style='font-family:Consolas;color:navy'>transition</span><span
  style='font-family:Consolas;color:#333333'>: </span><span style='font-family:
  Consolas;color:teal'>0.3s</span><span style='font-family:Consolas;color:#333333'>;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:18.6pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:255.0pt;margin-bottom:
  0in;margin-left:13.2pt;text-indent:-13.2pt;line-height:122%'><span
  style='font-family:Consolas;color:#333333'>.product-details <b>p </b>{ </span><span
  style='font-family:Consolas;color:navy'>font-size</span><span
  style='font-family:Consolas;color:#333333'>: </span><span style='font-family:
  Consolas;color:teal'>15px</span><span style='font-family:Consolas;color:#333333'>;
  </span><span style='font-family:Consolas;color:navy'>line-height</span><span
  style='font-family:Consolas;color:#333333'>: </span><span style='font-family:
  Consolas;color:teal'>22px</span><span style='font-family:Consolas;color:#333333'>;
  </span><span style='font-family:Consolas;color:navy'>margin-bottom</span><span
  style='font-family:Consolas;color:#333333'>: </span><span style='font-family:
  Consolas;color:teal'>18px</span><span style='font-family:Consolas;color:#333333'>;
  </span><span style='font-family:Consolas;color:navy'>color</span><span
  style='font-family:Consolas;color:#333333'>: </span><span style='font-family:
  Consolas;color:teal'>#999</span><span style='font-family:Consolas;color:#333333'>;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:17.7pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:215.4pt;margin-bottom:
  0in;margin-left:13.2pt;text-indent:-13.2pt;line-height:107%'><span
  style='font-family:Consolas;color:#333333'>.product-bottom-details { </span><span
  style='font-family:Consolas;color:navy'>overflow</span><span
  style='font-family:Consolas;color:#333333'>: hidden;</span></p>
  </td>
 </tr>
 <tr style='height:159.0pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
  height:159.0pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:169.25pt;margin-bottom:
  0in;margin-left:13.2pt;text-indent:0in;line-height:122%'><span
  style='font-family:Consolas;color:navy'>border-top</span><span
  style='font-family:Consolas;color:#333333'>: </span><span style='font-family:
  Consolas;color:teal'>1px </span><span style='font-family:Consolas;color:#333333'>solid
  </span><span style='font-family:Consolas;color:teal'>#eee</span><span
  style='font-family:Consolas;color:#333333'>; </span><span style='font-family:
  Consolas;color:navy'>padding-top</span><span style='font-family:Consolas;
  color:#333333'>: </span><span style='font-family:Consolas;color:teal'>20px</span><span
  style='font-family:Consolas;color:#333333'>;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:17.7pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:281.4pt;margin-bottom:
  0in;margin-left:13.2pt;text-indent:-13.2pt;line-height:122%'><span
  style='font-family:Consolas;color:#333333'>.product-price { </span><span
  style='font-family:Consolas;color:navy'>font-size</span><span
  style='font-family:Consolas;color:#333333'>: </span><span style='font-family:
  Consolas;color:teal'>12px</span><span style='font-family:Consolas;color:#333333'>;
  </span><span style='font-family:Consolas;color:navy'>color</span><span
  style='font-family:Consolas;color:#333333'>: </span><span style='font-family:
  Consolas;color:teal'>#C43218</span><span style='font-family:Consolas;
  color:#333333'>; </span><span style='font-family:Consolas;color:navy'>font-weight</span><span
  style='font-family:Consolas;color:#333333'>: </span><span style='font-family:
  Consolas;color:teal'>600</span><span style='font-family:Consolas;color:#333333'>;</span></p>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-family:Consolas;color:#333333'>}</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:.05in;
margin-left:-.25pt'>Clear all caches and let’s have a look:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:-1.7pt;margin-bottom:
24.25pt;margin-left:1.5pt;text-indent:0in;line-height:107%'><img border=0
width=602 height=392 id="Picture 9963"
src="Learning%20drupal%209%20as%20a%20framework_files/image070.jpg"></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:47.0pt;
margin-left:-.25pt'>This looks nice and appealing. Later in this course we will
make the variables more dynamic. Let’s move forward!</p>

<p class=MsoNormal style='margin-top:0in;margin-right:15.1pt;margin-bottom:
32.35pt;margin-left:14.0pt;line-height:110%;background:#FFD966'><b><span
style='font-size:11.0pt;line-height:110%'>Sidenote here</span></b><span
style='font-size:11.0pt;line-height:110%'>: if the use case is to show the
teasers on other pages also, it would be better to attach the css to the
teasers and not the overview. In general, you should style your view modes in a
way that they look the same everywhere on the platform.</span></p>

<h2 style='margin-left:-.25pt'><a name="_Toc247056">Adding a user-friendly
multistep form for entity creation</a></h2>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=600
 style='width:6.25in;border-collapse:collapse'>
 <tr style='height:69.0pt'>
  <td width=59 valign=top style='width:44.25pt;background:#6D9EEB;padding:14.6pt 5.75pt 0in 0in;
  height:69.0pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:14.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%'>&#128073;</span></p>
  </td>
  <td width=541 style='width:405.75pt;background:#6D9EEB;padding:14.6pt 5.75pt 0in 0in;
  height:69.0pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:8.45pt;margin-bottom:
  0in;margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%'>In this chapter you will learn how to create <b>form
  modes </b>for your data entry forms. More specifically we will show how to
  add a <b>multistep form </b>for creating offers in a user-friendly way.</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>If we head over to <i>offers/create </i>we see the default
form that can be configured under <u>admin/structure/offer/form-display</u><i>.</i></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>But we want a more user-friendly creation form. This is the
flow we want:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:.95pt;
margin-left:.5in;text-indent:-.25in'><span style='font-family:"Arial",sans-serif'>&#9679;<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span><b>Step
1: </b>Add the title of the offer</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:.95pt;
margin-left:.5in;text-indent:-.25in'><span style='font-family:"Arial",sans-serif'>&#9679;<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span><b>Step
2</b>: Add a description and an image</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:.5in;text-indent:-.25in'><span style='font-family:"Arial",sans-serif'>&#9679;<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span><b>Step
3: </b>Add the type of offer</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:.9pt;
margin-left:-.25pt'>That’s where <a
href="https://www.drupal.org/docs/8/api/entity-api/display-modes-view-modes-and-form-modes#s-form-modes-and-form-operations"><span
style='color:#1155CC'>Form Modes</span></a><u><span style='color:#1155CC'> </span></u>come
into play. Go to</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.7pt;margin-bottom:3.7pt;
margin-left:-.25pt;line-height:111%'><u>/admin/structure/display-modes/form </u>and
add a new one for Offer:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:24.25pt;
margin-left:1.5pt;text-indent:0in;line-height:107%'><img border=0 width=475
height=361 id="Picture 10019"
src="Learning%20drupal%209%20as%20a%20framework_files/image071.jpg"></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.35pt;
margin-left:-.25pt;line-height:110%'>Add <b>step_1 (Step 1), step_2 (Step 2),
step_3 (Step 3)</b>:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:24.25pt;
margin-left:1.5pt;text-indent:0in;line-height:107%'><img border=0 width=557
height=417 id="Picture 10039"
src="Learning%20drupal%209%20as%20a%20framework_files/image072.jpg"></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:3.5pt;
margin-left:-.25pt'>At <u>/admin/structure/offer/form-display </u>go to “Custom
display settings” and enable all three:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:24.25pt;
margin-left:1.5pt;text-indent:0in;line-height:107%'><img border=0 width=522
height=337 id="Picture 10041"
src="Learning%20drupal%209%20as%20a%20framework_files/image073.jpg"></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>Next, we drag the desired fields to each of the steps. In
the case of “Step 1”, this is only the title field.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:-1.7pt;margin-bottom:
40.75pt;margin-left:1.5pt;text-indent:0in;line-height:107%'><img border=0
width=602 height=367 id="Picture 10110"
src="Learning%20drupal%209%20as%20a%20framework_files/image074.jpg"></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:.9pt;
margin-left:-.25pt'>Do the same for step 2 and step 3.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:21.7pt;
margin-left:-.25pt'>We have our new form modes, but this will initially do
nothing. First, we have to “inform” our custom entity that there are three new
form modes available. Let’s add them to the offer entity right after our
default form:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:4.0pt;margin-bottom:1.4pt;
margin-left:57.3pt;text-indent:-52.8pt;line-height:112%;background:#F8F8F8'><span
style='font-family:Consolas;color:#333333'>*<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span style='font-family:Consolas;color:#333333'>handlers = {</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:4.0pt;margin-bottom:1.45pt;
margin-left:57.3pt;text-indent:-52.8pt;line-height:112%;background:#F8F8F8'><span
style='font-family:Consolas;color:#333333'>*<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span style='font-family:Consolas;color:#DD1144'>&quot;access&quot;
</span><span style='font-family:Consolas;color:#333333'>= </span><span
style='font-family:Consolas;color:#DD1144'>&quot;...&quot;</span><span
style='font-family:Consolas;color:#333333'>,</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:4.0pt;margin-bottom:1.45pt;
margin-left:57.3pt;text-indent:-52.8pt;line-height:112%;background:#F8F8F8'><span
style='font-family:Consolas;color:#333333'>*<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span style='font-family:Consolas;color:#DD1144'>&quot;views_data&quot;
</span><span style='font-family:Consolas;color:#333333'>= </span><span
style='font-family:Consolas;color:#DD1144'>&quot;...&quot;</span><span
style='font-family:Consolas;color:#333333'>,</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:4.0pt;margin-bottom:1.45pt;
margin-left:57.3pt;text-indent:-52.8pt;line-height:112%;background:#F8F8F8'><span
style='font-family:Consolas;color:#333333'>*<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span style='font-family:Consolas;color:#DD1144'>&quot;form&quot;
</span><span style='font-family:Consolas;color:#333333'>= {</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:4.0pt;margin-bottom:1.45pt;
margin-left:57.3pt;text-indent:-52.8pt;line-height:112%;background:#F8F8F8'><span
style='font-family:Consolas;color:#333333'>*<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span style='font-family:Consolas;color:#DD1144'>&quot;default&quot;
</span><span style='font-family:Consolas;color:#333333'>= </span><span
style='font-family:Consolas;color:#DD1144'>&quot;Drupal\offer\Form\OfferForm&quot;</span><span
style='font-family:Consolas;color:#333333'>,</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:4.0pt;margin-bottom:2.05pt;
margin-left:57.3pt;text-indent:-52.8pt;line-height:107%;background:#F8F8F8'><span
style='font-family:Consolas;color:#333333'>*<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><b><span style='font-family:Consolas;color:#DD1144'>&quot;step_1&quot;
</span></b><b><span style='font-family:Consolas;color:#333333'>= </span></b><b><span
style='font-family:Consolas;color:#DD1144'>&quot;Drupal\offer\Form\OfferAddFormStep1&quot;</span></b><b><span
style='font-family:Consolas;color:#333333'>,</span></b></p>

<p class=MsoNormal style='margin-top:0in;margin-right:4.0pt;margin-bottom:2.05pt;
margin-left:57.3pt;text-indent:-52.8pt;line-height:107%;background:#F8F8F8'><span
style='font-family:Consolas;color:#333333'>*<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><b><span style='font-family:Consolas;color:#DD1144'>&quot;step_2&quot;
</span></b><b><span style='font-family:Consolas;color:#333333'>= </span></b><b><span
style='font-family:Consolas;color:#DD1144'>&quot;Drupal\offer\Form\OfferAddFormStep2&quot;</span></b><b><span
style='font-family:Consolas;color:#333333'>,</span></b></p>

<p class=MsoNormal style='margin-top:0in;margin-right:4.0pt;margin-bottom:2.05pt;
margin-left:57.3pt;text-indent:-52.8pt;line-height:107%;background:#F8F8F8'><span
style='font-family:Consolas;color:#333333'>*<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><b><span style='font-family:Consolas;color:#DD1144'>&quot;step_3&quot;
</span></b><b><span style='font-family:Consolas;color:#333333'>= </span></b><b><span
style='font-family:Consolas;color:#DD1144'>&quot;Drupal\offer\Form\OfferAddFormStep3&quot;</span></b><b><span
style='font-family:Consolas;color:#333333'>,</span></b></p>

<p class=MsoNormal style='margin-top:0in;margin-right:4.0pt;margin-bottom:22.45pt;
margin-left:57.3pt;text-indent:-52.8pt;line-height:112%;background:#F8F8F8'><span
style='font-family:Consolas;color:#333333'>*<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span style='font-family:Consolas;color:#DD1144'>&quot;edit&quot;
</span><span style='font-family:Consolas;color:#333333'>= </span><span
style='font-family:Consolas;color:#DD1144'>&quot;Drupal\offer\Form\OfferForm&quot;</span><span
style='font-family:Consolas;color:#333333'>,</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:30.65pt;
margin-left:-.25pt'>Clear caches to see the result.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:13.65pt;margin-bottom:
30.8pt;margin-left:14.0pt;line-height:114%;background:#FFD966'><span
style='font-size:11.0pt;line-height:114%'>We’ve informed drupal that there are
now new forms for our entity. <b>Make sure your keys in the annotations
(“step_1”, “step_2”, …) are the same as the machine name of your custom form
modes.</b></span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:.9pt;
margin-left:-.25pt'>Now <b>copy </b>the content entity form under <b>Form\Offerform.php
to</b></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.35pt;
margin-left:-.25pt;line-height:110%'><b>Form\OfferAddFormStep1,
Form\OfferAddFormStep2.php, and</b></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:2.1pt;
margin-left:-.25pt'><b>Form\OfferAddFormStep3.php</b>. This way you copied the
default entity form to the steps. This way we can customize them later.</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=600
 style='width:6.25in;border-collapse:collapse'>
 <tr style='height:58.5pt'>
  <td width=59 valign=top style='width:44.25pt;background:#E2E3E5;padding:14.6pt 5.75pt 0in 0in;
  height:58.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:14.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%'>&#128187;</span></p>
  </td>
  <td width=541 style='width:405.75pt;background:#E2E3E5;padding:14.6pt 5.75pt 0in 0in;
  height:58.5pt'>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%'>When copying the <b>Offerform.php </b>to
  <b>OfferAddFormStep1</b>, make sure you also change the Class name in the
  file itself!</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:2.1pt;
margin-left:-.25pt'>Time to make new routes for our multi-step pages. To <b>custom/offer/offer.routing.yml</b>:</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:460.5pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
  height:460.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:300.75pt;margin-bottom:
  0in;margin-left:6.05pt;text-indent:-6.05pt;line-height:118%'><span
  style='font-size:11.0pt;line-height:118%;font-family:Consolas;color:#333333'>offer.add:
  path: </span><span style='font-size:11.0pt;line-height:118%;font-family:Consolas;
  color:#DD1144'>'/offers/create' </span><span style='font-size:11.0pt;
  line-height:118%;font-family:Consolas;color:#333333'>defaults:</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>_entity_form:
  offer.step_1</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:149.65pt;margin-bottom:
  .8pt;margin-left:6.05pt;text-indent:12.1pt;line-height:115%'><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>_title:
  </span><span style='font-size:11.0pt;line-height:115%;font-family:Consolas;
  color:#DD1144'>'Step 1: set your title' </span><span style='font-size:11.0pt;
  line-height:115%;font-family:Consolas;color:#333333'>requirements:</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:15.95pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>_entity_create_access:
  </span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#DD1144'>'offer'</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:252.4pt;margin-bottom:
  0in;margin-left:6.05pt;text-indent:-6.05pt;line-height:118%'><span
  style='font-size:11.0pt;line-height:118%;font-family:Consolas;color:#333333'>offer.step1:
  path: </span><span style='font-size:11.0pt;line-height:118%;font-family:Consolas;
  color:#DD1144'>'/offers/create/{offer}' </span><span style='font-size:11.0pt;
  line-height:118%;font-family:Consolas;color:#333333'>defaults:</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>_entity_form:
  offer.step_1</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:149.65pt;margin-bottom:
  .8pt;margin-left:6.05pt;text-indent:12.1pt;line-height:115%'><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>_title:
  </span><span style='font-size:11.0pt;line-height:115%;font-family:Consolas;
  color:#DD1144'>'Step 1: set your title' </span><span style='font-size:11.0pt;
  line-height:115%;font-family:Consolas;color:#333333'>requirements:</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:15.95pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>_entity_create_access:
  </span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#DD1144'>'offer'</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:216.1pt;margin-bottom:
  0in;margin-left:6.05pt;text-indent:-6.05pt;line-height:118%'><span
  style='font-size:11.0pt;line-height:118%;font-family:Consolas;color:#333333'>offer.step2:
  path: </span><span style='font-size:11.0pt;line-height:118%;font-family:Consolas;
  color:#DD1144'>'/offers/create/step2/{offer}' </span><span style='font-size:
  11.0pt;line-height:118%;font-family:Consolas;color:#333333'>defaults:</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>_entity_form:
  offer.step_2</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:71.05pt;margin-bottom:
  .8pt;margin-left:6.05pt;text-indent:12.1pt;line-height:115%'><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>_title:
  </span><span style='font-size:11.0pt;line-height:115%;font-family:Consolas;
  color:#DD1144'>'Step 2: add a description and image' </span><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>requirements:</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:15.95pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>_entity_access: </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'offer.edit'</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:216.1pt;margin-bottom:
  0in;margin-left:6.05pt;text-indent:-6.05pt;line-height:118%'><span
  style='font-size:11.0pt;line-height:118%;font-family:Consolas;color:#333333'>offer.step3:
  path: </span><span style='font-size:11.0pt;line-height:118%;font-family:Consolas;
  color:#DD1144'>'/offers/create/step3/{offer}' </span><span style='font-size:
  11.0pt;line-height:118%;font-family:Consolas;color:#333333'>defaults:</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>_entity_form:
  offer.step_3</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:89.2pt;margin-bottom:
  0in;margin-left:6.05pt;text-indent:12.1pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>_title:
  </span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#DD1144'>'Step 3: choose the type of offer' </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>requirements:</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:76.6pt;margin-bottom:
24.05pt;margin-left:23.9pt;line-height:111%;background:#F8F8F8'><span
style='font-size:11.0pt;line-height:111%;font-family:Consolas;color:#333333'>_entity_access:
</span><span style='font-size:11.0pt;line-height:111%;font-family:Consolas;
color:#DD1144'>'offer.edit'</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:2.1pt;
margin-left:-.25pt'>The entity forms remain basically the same (although they
have different form modes), but the difference is in the <i>Save() </i>function.
We change it in <b>src\Form\OfferAddFormStep1.php </b>like this:</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:115.5pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 40.6pt 0in 5.25pt;
  height:115.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.8pt;
  margin-left:24.15pt;text-indent:-24.15pt;line-height:115%'><b><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>public
  function </span></b><b><span style='font-size:11.0pt;line-height:115%;
  font-family:Consolas;color:#990000'>save</span></b><span style='font-size:
  11.0pt;line-height:115%;font-family:Consolas;color:#333333'>(array $form,
  FormStateInterface $form_state) { </span><i><span style='font-size:11.0pt;
  line-height:115%;font-family:Consolas;color:#999988'>// Redirect to step 2.</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:24.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$entity = <b>$this</b>-&gt;getEntity();</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:24.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$entity-&gt;save();</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:24.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$id =
  $entity-&gt;id();</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:24.15pt;margin-bottom:
  0in;margin-left:12.1pt;text-align:justify;text-justify:inter-ideograph;
  text-indent:12.1pt;line-height:107%'><span style='font-size:11.0pt;
  line-height:107%;font-family:Consolas;color:#333333'>$form_state-&gt;setRedirect(</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'offer.step2'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>,
  [</span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#DD1144'>'offer' </span><span style='font-size:11.0pt;line-height:107%;
  font-family:Consolas;color:#333333'>=&gt; $id]); }</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>Step 1 is where the entity gets saved on submission. We use
it to redirect to step 2 via entity parameter upcasting.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>We do the same in step 2, to redirect to step 3. Change it
in <b>src\Form\OfferAddFormStep2.php </b>to this:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.7pt;
margin-left:6.6pt;text-indent:-6.6pt;line-height:112%'><span style='font-family:
Consolas'>public </span><span style='font-family:Consolas;color:#000088'>function
</span><span style='font-family:Consolas'>save(array </span><span
style='font-family:Consolas;color:#666600'>$form</span><span style='font-family:
Consolas'>, FormStateInterface </span><span style='font-family:Consolas;
color:#666600'>$form_state</span><span style='font-family:Consolas'>) { //
Redirect step 3 after save.</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.7pt;
margin-left:6.35pt;line-height:112%'><span style='font-family:Consolas;
color:#666600'>$entity </span><span style='font-family:Consolas'>= </span><span
style='font-family:Consolas;color:#666600'>$this</span><span style='font-family:
Consolas'>-&gt;getEntity();</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.7pt;
margin-left:6.35pt;line-height:112%'><span style='font-family:Consolas;
color:#666600'>$entity</span><span style='font-family:Consolas'>-&gt;save();</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.1pt;
margin-left:6.6pt;text-indent:0in;line-height:107%'><span style='font-family:
Consolas;color:#666600'>$id </span><span style='font-family:Consolas'>= </span><span
style='font-family:Consolas;color:#666600'>$entity</span><span
style='font-family:Consolas'>-&gt;id();</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.7pt;
margin-left:6.35pt;line-height:112%'><span style='font-family:Consolas;
color:#666600'>$form_state</span><span style='font-family:Consolas'>-&gt;setRedirect(</span><span
style='font-family:Consolas;color:#008800'>'offer.step3'</span><span
style='font-family:Consolas'>, [</span><span style='font-family:Consolas;
color:#008800'>'offer' </span><span style='font-family:Consolas'>=&gt; </span><span
style='font-family:Consolas;color:#666600'>$id</span><span style='font-family:
Consolas'>]);</span></p>

<p class=MsoNormal style='margin-bottom:.25in;line-height:112%'><span
style='font-family:Consolas'>}</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:20.8pt;
margin-left:-.25pt'>In our final step, <b>src\Form\OfferAddFormStep3.php</b>, we
add redirect to the overview and add a message:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:41.1pt;margin-bottom:
1.0pt;margin-left:5.75pt;line-height:107%;background:#F8F8F8'><i><span
style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>/**</span></i></p>

<p class=MsoNormal style='margin-top:0in;margin-right:41.1pt;margin-bottom:
1.75pt;margin-left:5.75pt;line-height:107%;background:#F8F8F8'><i><span
style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*
{</span></i><i><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
color:#DD1144'>@inheritdoc</span></i><i><span style='font-size:11.0pt;
line-height:107%;font-family:Consolas;color:#999988'>}</span></i></p>

<p class=MsoNormal style='margin-top:0in;margin-right:41.1pt;margin-bottom:
.8pt;margin-left:5.75pt;line-height:111%;background:#F8F8F8'><i><span
style='font-size:11.0pt;line-height:111%;font-family:Consolas;color:#999988'>*/
</span></i><b><span style='font-size:11.0pt;line-height:111%;font-family:Consolas;
color:#333333'>public function </span></b><b><span style='font-size:11.0pt;
line-height:111%;font-family:Consolas;color:#990000'>save</span></b><span
style='font-size:11.0pt;line-height:111%;font-family:Consolas;color:#333333'>(array
$form, FormStateInterface $form_state) {</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:41.1pt;margin-bottom:
1.0pt;margin-left:5.75pt;line-height:107%;background:#F8F8F8'><i><span
style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>//
Redirect to offer overview after save.</span></i></p>

<p class=MsoNormal style='margin-top:0in;margin-right:41.1pt;margin-bottom:
.8pt;margin-left:5.75pt;line-height:111%;background:#F8F8F8'><span
style='font-size:11.0pt;line-height:111%;font-family:Consolas;color:#333333'>$form_state-&gt;setRedirect(</span><span
style='font-size:11.0pt;line-height:111%;font-family:Consolas;color:#DD1144'>'entity.offer.collection'</span><span
style='font-size:11.0pt;line-height:111%;font-family:Consolas;color:#333333'>);</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:41.1pt;margin-bottom:
1.25pt;margin-left:5.25pt;text-indent:6.05pt;line-height:111%;background:#F8F8F8'><span
style='font-size:11.0pt;line-height:111%;font-family:Consolas;color:#333333'>\Drupal::messenger()-&gt;addMessage(</span><span
style='font-size:11.0pt;line-height:111%;font-family:Consolas;color:#DD1144'>'Your
offer was created. Click the publish button to start earning.'</span><span
style='font-size:11.0pt;line-height:111%;font-family:Consolas;color:#333333'>);</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:41.1pt;margin-bottom:
.8pt;margin-left:5.75pt;line-height:111%;background:#F8F8F8'><span
style='font-size:11.0pt;line-height:111%;font-family:Consolas;color:#333333'>$entity
= <b>$this</b>-&gt;getEntity();</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:41.1pt;margin-bottom:
.8pt;margin-left:5.75pt;line-height:111%;background:#F8F8F8'><span
style='font-size:11.0pt;line-height:111%;font-family:Consolas;color:#333333'>$entity-&gt;save();</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:41.1pt;margin-bottom:
.8pt;margin-left:5.75pt;line-height:111%;background:#F8F8F8'><span
style='font-size:11.0pt;line-height:111%;font-family:Consolas;color:#333333'>}</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:22.6pt;
margin-left:-.25pt'>In the <i>buildForm() </i>function of each of the forms,
you can tweak some more. I changed the submit button text like this:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:10.6pt;margin-bottom:
1.25pt;margin-left:8.3pt;line-height:112%;background:#F8F8F8'><b><span
style='font-family:Consolas;color:#333333'>public function </span></b><b><span
style='font-family:Consolas;color:#990000'>buildForm</span></b><span
style='font-family:Consolas;color:#333333'>(array $form, FormStateInterface
$form_state) {</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:10.6pt;margin-bottom:
2.05pt;margin-left:8.3pt;line-height:107%;background:#F8F8F8'><i><span
style='font-family:Consolas;color:#999988'>/* </span></i><i><span
style='font-family:Consolas;color:#DD1144'>@var </span></i><i><span
style='font-family:Consolas;color:#999988'>$entity \Drupal\offer\Entity\Offer
*/</span></i></p>

<p class=MsoNormal style='margin-top:0in;margin-right:10.6pt;margin-bottom:
1.15pt;margin-left:8.3pt;line-height:112%;background:#F8F8F8'><span
style='font-family:Consolas;color:#333333'>$form = <b>parent</b>::buildForm($form,
$form_state); $form[</span><span style='font-family:Consolas;color:#DD1144'>'actions'</span><span
style='font-family:Consolas;color:#333333'>][</span><span style='font-family:
Consolas;color:#DD1144'>'submit'</span><span style='font-family:Consolas;
color:#333333'>][</span><span style='font-family:Consolas;color:#DD1144'>'#value'</span><span
style='font-family:Consolas;color:#333333'>] = t(</span><span style='font-family:
Consolas;color:#DD1144'>'Save and proceed'</span><span style='font-family:Consolas;
color:#333333'>); <b>return </b>$form;</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:10.6pt;margin-bottom:
23.05pt;margin-left:8.3pt;line-height:112%;background:#F8F8F8'><span
style='font-family:Consolas;color:#333333'>}</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:18.6pt;
margin-left:-.25pt'>We’re done! We’ve created an advanced multi-step form,
which saves our entity on each step. Let’s enhance the process a bit for
further user experience.</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=600
 style='width:6.25in;border-collapse:collapse'>
 <tr style='height:73.5pt'>
  <td width=59 valign=top style='width:44.25pt;background:#E2E3E5;padding:14.6pt 5.75pt 0in 0in;
  height:73.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:14.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%'>&#128187;</span></p>
  </td>
  <td width=541 style='width:405.75pt;background:#E2E3E5;padding:14.6pt 5.75pt 0in 0in;
  height:73.5pt'>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%'>Best way to test is to create a
  test user at <u>admin/people </u>who is just an authenticated user. This way
  you can check better if all permissions are set correctly.</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>Go to <u>offers/create </u>and have a look:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:-1.7pt;margin-bottom:
24.25pt;margin-left:1.5pt;text-indent:0in;line-height:107%'><img border=0
width=602 height=520 id="Picture 10435"
src="Learning%20drupal%209%20as%20a%20framework_files/image075.jpg"></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:.05in;
margin-left:-.25pt'>If we click <i>Save and proceed </i>we go to the next step:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:-1.7pt;margin-bottom:
0in;margin-left:1.5pt;text-indent:0in;line-height:107%'><img border=0
width=602 height=217 id="Picture 10437"
src="Learning%20drupal%209%20as%20a%20framework_files/image076.jpg"></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:35.45pt;
margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:11.0pt;
line-height:107%'><img border=0 width=602 height=438
src="Learning%20drupal%209%20as%20a%20framework_files/image077.gif"></span></p>

<h3 style='margin-left:-.25pt'><a name="_Toc247057">Add custom actions to the
form</a></h3>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=600
 style='width:6.25in;border-collapse:collapse'>
 <tr style='height:55.5pt'>
  <td width=59 valign=top style='width:44.25pt;background:#6D9EEB;padding:14.6pt 5.75pt 0in 0in;
  height:55.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:14.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%'>&#128073;</span></p>
  </td>
  <td width=541 style='width:405.75pt;background:#6D9EEB;padding:14.6pt 5.75pt 0in 0in;
  height:55.5pt'>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%'>In this chapter you will learn how
  to add additional form buttons (actions) like a cancel button or a “Go back
  to step 1” redirect on entity forms.</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>Actions are the typical buttons drupal groups below a form.
Because we use multiple steps we want to add functionality to be able to
navigate inside the form as well.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>In our first step, we’d like to provide a ‘<b>Cancel</b>’
button next to the ‘<b>Save and proceed</b>’ button. Also, remove the ‘delete’
button.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.35pt;
margin-left:-.25pt;line-height:110%'>To <b>src\Form\OfferAddFormStep1.php </b>we
add:</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=600
 style='width:6.25in;margin-left:.75pt;border-collapse:collapse'>
 <tr style='height:85.5pt'>
  <td width=600 style='width:6.25in;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
  height:85.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:3.85pt;margin-bottom:
  .8pt;margin-left:0in;text-indent:0in;line-height:115%'><b><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>protected
  function </span></b><b><span style='font-size:11.0pt;line-height:115%;
  font-family:Consolas;color:#990000'>actions</span></b><span style='font-size:
  11.0pt;line-height:115%;font-family:Consolas;color:#333333'>(array $form,
  FormStateInterface $form_state) {</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$actions = <b>parent</b>::actions($form,
  $form_state);</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$actions[</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'cancel'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>]
  = [</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'#type' </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>=&gt;
  </span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#DD1144'>'submit'</span><span style='font-size:11.0pt;line-height:107%;
  font-family:Consolas;color:#333333'>,</span></p>
  </td>
 </tr>
 <tr style='height:265.5pt'>
  <td width=600 style='width:6.25in;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
  height:265.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'#value' </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>=&gt;
  <b>$this</b>-&gt;t(</span><span style='font-size:11.0pt;line-height:107%;
  font-family:Consolas;color:#DD1144'>'Cancel'</span><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>),</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:173.05pt;margin-bottom:
  0in;margin-left:18.15pt;text-indent:0in;line-height:121%'><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#DD1144'>'#submit'
  </span><span style='font-size:11.0pt;line-height:121%;font-family:Consolas;
  color:#333333'>=&gt; [</span><span style='font-size:11.0pt;line-height:121%;
  font-family:Consolas;color:#DD1144'>'::cancelSubmit'</span><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>],
  </span><span style='font-size:11.0pt;line-height:121%;font-family:Consolas;
  color:#DD1144'>'#weight' </span><span style='font-size:11.0pt;line-height:
  121%;font-family:Consolas;color:#333333'>=&gt; </span><span style='font-size:
  11.0pt;line-height:121%;font-family:Consolas;color:teal'>90</span><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>,</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'#limit_validation_errors'
  </span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#333333'>=&gt; []</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:173.05pt;margin-bottom:
  0in;margin-left:6.05pt;text-indent:0in;line-height:118%'><span
  style='font-size:11.0pt;line-height:118%;font-family:Consolas;color:#333333'>];
  <b>if </b>(array_key_exists(</span><span style='font-size:11.0pt;line-height:
  118%;font-family:Consolas;color:#DD1144'>'delete'</span><span
  style='font-size:11.0pt;line-height:118%;font-family:Consolas;color:#333333'>,
  $actions)) { <b>unset</b>($actions[</span><span style='font-size:11.0pt;
  line-height:118%;font-family:Consolas;color:#DD1144'>'delete'</span><span
  style='font-size:11.0pt;line-height:118%;font-family:Consolas;color:#333333'>]);</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:16.8pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$actions[</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'#prefix'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>]
  = </span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#DD1144'>'&lt;i&gt;Step 1 of 3&lt;/i&gt;'</span><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>return
  </span></b><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#333333'>$actions;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:16.8pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><b><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>public function </span></b><b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#990000'>cancelSubmit</span></b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>(array
  $form, FormStateInterface</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$form_state) {</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$form_state-&gt;setRedirect(</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'entity.offer.collection'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>);</span></p>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:15.1pt;margin-bottom:
32.35pt;margin-left:14.0pt;line-height:110%;background:#FFD966'><span
style='font-size:11.0pt;line-height:110%'>This is Object Oriented code in
practice. The actions method allows us to extend and add an extra action. In
the callback we specify a redirect to cancel the operation.</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>This is what <b>step 1 </b>now looks like:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:-1.7pt;margin-bottom:
24.25pt;margin-left:1.5pt;text-indent:0in;line-height:107%'><img border=0
width=602 height=468 id="Picture 10742"
src="Learning%20drupal%209%20as%20a%20framework_files/image078.jpg"></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.35pt;
margin-left:-.25pt;line-height:110%'>To <b>src\Form\OfferAddFormStep2.php </b>we
add:</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:274.5pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
  height:274.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:0in;text-indent:0in;line-height:107%'><b><span style='font-family:
  Consolas;color:#333333'>protected function </span></b><b><span
  style='font-family:Consolas;color:#990000'>actions</span></b><span
  style='font-family:Consolas;color:#333333'>(array $form, FormStateInterface</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.1pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>$form_state) {</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:6.6pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>$actions = <b>parent</b>::actions($form,
  $form_state);</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.1pt;
  margin-left:6.6pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>$actions[</span><span style='font-family:Consolas;
  color:#DD1144'>'go_back'</span><span style='font-family:Consolas;color:#333333'>]
  = [</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.1pt;
  margin-left:19.8pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#DD1144'>'#type' </span><span style='font-family:Consolas;
  color:#333333'>=&gt; </span><span style='font-family:Consolas;color:#DD1144'>'submit'</span><span
  style='font-family:Consolas;color:#333333'>,</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.1pt;
  margin-left:19.8pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#DD1144'>'#value' </span><span style='font-family:Consolas;
  color:#333333'>=&gt; <b>$this</b>-&gt;t(</span><span style='font-family:Consolas;
  color:#DD1144'>'Back to step 1'</span><span style='font-family:Consolas;
  color:#333333'>),</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.1pt;
  margin-left:19.8pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#DD1144'>'#submit' </span><span style='font-family:Consolas;
  color:#333333'>=&gt; [</span><span style='font-family:Consolas;color:#DD1144'>'::goBack'</span><span
  style='font-family:Consolas;color:#333333'>],</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.1pt;
  margin-left:19.8pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#DD1144'>'#weight' </span><span style='font-family:Consolas;
  color:#333333'>=&gt; </span><span style='font-family:Consolas;color:teal'>90</span><span
  style='font-family:Consolas;color:#333333'>,</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:19.8pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#DD1144'>'#limit_validation_errors' </span><span
  style='font-family:Consolas;color:#333333'>=&gt; []</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:149.45pt;margin-bottom:
  0in;margin-left:6.6pt;text-indent:0in;line-height:119%'><span
  style='font-family:Consolas;color:#333333'>]; <b>if </b>(array_key_exists(</span><span
  style='font-family:Consolas;color:#DD1144'>'delete'</span><span
  style='font-family:Consolas;color:#333333'>, $actions)) { <b>unset</b>($actions[</span><span
  style='font-family:Consolas;color:#DD1144'>'delete'</span><span
  style='font-family:Consolas;color:#333333'>]);</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.1pt;
  margin-left:6.6pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:109.85pt;margin-bottom:
  0in;margin-left:6.6pt;text-indent:0in;line-height:122%'><span
  style='font-family:Consolas;color:#333333'>$actions[</span><span
  style='font-family:Consolas;color:#DD1144'>'#prefix'</span><span
  style='font-family:Consolas;color:#333333'>] = </span><span style='font-family:
  Consolas;color:#DD1144'>'&lt;i&gt;Step 2 of 3&lt;/i&gt;'</span><span
  style='font-family:Consolas;color:#333333'>; <b>return </b>$actions;</span></p>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-family:Consolas;color:#333333'>}</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:10.6pt;margin-bottom:
1.25pt;margin-left:12.35pt;line-height:112%;background:#F8F8F8'><b><span
style='font-family:Consolas;color:#333333'>public function </span></b><b><span
style='font-family:Consolas;color:#990000'>goBack</span></b><span
style='font-family:Consolas;color:#333333'>(array $form, FormStateInterface
$form_state) {</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:10.6pt;margin-bottom:
.6pt;margin-left:12.35pt;line-height:112%;background:#F8F8F8'><span
style='font-family:Consolas;color:#333333'>$entity = <b>$this</b>-&gt;getEntity();</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:10.6pt;margin-bottom:
1.45pt;margin-left:12.35pt;line-height:112%;background:#F8F8F8'><span
style='font-family:Consolas;color:#333333'>$id = $entity-&gt;id();</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:10.6pt;margin-bottom:
.6pt;margin-left:12.35pt;line-height:112%;background:#F8F8F8'><span
style='font-family:Consolas;color:#333333'>$form_state-&gt;setRedirect(</span><span
style='font-family:Consolas;color:#DD1144'>'offer.step1'</span><span
style='font-family:Consolas;color:#333333'>, [</span><span style='font-family:
Consolas;color:#DD1144'>'offer' </span><span style='font-family:Consolas;
color:#333333'>=&gt; $id]);</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:10.6pt;margin-bottom:
23.05pt;margin-left:12.35pt;line-height:112%;background:#F8F8F8'><span
style='font-family:Consolas;color:#333333'>}</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>You’ll understand what I did here. The <i>goBack() </i>function
will get called when clicking the button ‘<b>Back to step 1</b>’. We’ll get
redirected to <i>/offer/create/{offer}</i>.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:.05in;
margin-left:-.25pt'>This is what the actions in <b>step 2 </b>now look like:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:24.25pt;
margin-left:1.5pt;text-indent:0in;line-height:107%'><img border=0 width=379
height=130 id="Picture 10897"
src="Learning%20drupal%209%20as%20a%20framework_files/image079.jpg"></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:2.1pt;
margin-left:-.25pt'>Finally, we optimize our step three in the same way. To <b>src\Form\OfferAddFormStep3.php
</b>we add:</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:295.5pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
  height:295.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:4.6pt;margin-bottom:
  .8pt;margin-left:0in;text-indent:0in;line-height:115%'><b><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>protected
  function </span></b><b><span style='font-size:11.0pt;line-height:115%;
  font-family:Consolas;color:#990000'>actions</span></b><span style='font-size:
  11.0pt;line-height:115%;font-family:Consolas;color:#333333'>(array $form,
  FormStateInterface $form_state) {</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$actions = <b>parent</b>::actions($form,
  $form_state);</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$actions[</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'go_back'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>]
  = [</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'#type' </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>=&gt;
  </span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#DD1144'>'submit'</span><span style='font-size:11.0pt;line-height:107%;
  font-family:Consolas;color:#333333'>,</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'#value' </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>=&gt;
  <b>$this</b>-&gt;t(</span><span style='font-size:11.0pt;line-height:107%;
  font-family:Consolas;color:#DD1144'>'Back to step 2'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>),</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'#submit' </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>=&gt;
  [</span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#DD1144'>'::goBack'</span><span style='font-size:11.0pt;line-height:
  107%;font-family:Consolas;color:#333333'>],</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'#weight' </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>=&gt;
  </span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:teal'>90</span><span style='font-size:11.0pt;line-height:107%;
  font-family:Consolas;color:#333333'>,</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'#limit_validation_errors'
  </span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#333333'>=&gt; []</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:173.8pt;margin-bottom:
  0in;margin-left:6.05pt;text-indent:0in;line-height:118%'><span
  style='font-size:11.0pt;line-height:118%;font-family:Consolas;color:#333333'>];
  <b>if </b>(array_key_exists(</span><span style='font-size:11.0pt;line-height:
  118%;font-family:Consolas;color:#DD1144'>'delete'</span><span
  style='font-size:11.0pt;line-height:118%;font-family:Consolas;color:#333333'>,
  $actions)) { <b>unset</b>($actions[</span><span style='font-size:11.0pt;
  line-height:118%;font-family:Consolas;color:#DD1144'>'delete'</span><span
  style='font-size:11.0pt;line-height:118%;font-family:Consolas;color:#333333'>]);</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:137.55pt;margin-bottom:
  0in;margin-left:6.05pt;text-indent:0in;line-height:121%'><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>$actions[</span><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#DD1144'>'#prefix'</span><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>]
  = </span><span style='font-size:11.0pt;line-height:121%;font-family:Consolas;
  color:#DD1144'>'&lt;i&gt;Step 3 of 3&lt;/i&gt;'</span><span style='font-size:
  11.0pt;line-height:121%;font-family:Consolas;color:#333333'>; <b>return </b>$actions;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:16.8pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:0in;text-indent:0in;line-height:107%'><b><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>public function </span></b><b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#990000'>goBack</span></b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>(array
  $form, FormStateInterface $form_state) {</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$entity = <b>$this</b>-&gt;getEntity();</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:80.0pt;margin-bottom:
.8pt;margin-left:8.4pt;line-height:111%;background:#F8F8F8'><span
style='font-size:11.0pt;line-height:111%;font-family:Consolas;color:#333333'>$id
= $entity-&gt;id();</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:80.0pt;margin-bottom:
23.9pt;margin-left:7.9pt;text-indent:6.05pt;line-height:111%;background:#F8F8F8'><span
style='font-size:11.0pt;line-height:111%;font-family:Consolas;color:#333333'>$form_state-&gt;setRedirect(</span><span
style='font-size:11.0pt;line-height:111%;font-family:Consolas;color:#DD1144'>'offer.step2'</span><span
style='font-size:11.0pt;line-height:111%;font-family:Consolas;color:#333333'>,
[</span><span style='font-size:11.0pt;line-height:111%;font-family:Consolas;
color:#DD1144'>'offer' </span><span style='font-size:11.0pt;line-height:111%;
font-family:Consolas;color:#333333'>=&gt; $id]); }</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:22.45pt;
margin-left:-.25pt'>Because this is the last step in the form, we redirect to
our overview and add a message via the <a
href="https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Messenger%21Messenger.php/class/Messenger/8.5.x"><span
style='color:#1155CC'>Messenger API</span></a><u><span style='color:#1155CC'> </span></u>Drupal
provides us:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:10.6pt;margin-bottom:
.4pt;margin-left:8.65pt;line-height:112%;background:#F8F8F8'><b><span
style='font-family:Consolas;color:#333333'>public function </span></b><b><span
style='font-family:Consolas;color:#990000'>save</span></b><span
style='font-family:Consolas;color:#333333'>(array $form, FormStateInterface
$form_state) { </span><i><span style='font-family:Consolas;color:#999988'>//
Redirect to offer overview after save.</span></i></p>

<p class=MsoNormal style='margin-top:0in;margin-right:10.6pt;margin-bottom:
1.45pt;margin-left:8.65pt;line-height:112%;background:#F8F8F8'><span
style='font-family:Consolas;color:#333333'>$form_state-&gt;setRedirect(</span><span
style='font-family:Consolas;color:#DD1144'>'entity.offer.collection'</span><span
style='font-family:Consolas;color:#333333'>);</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:10.6pt;margin-bottom:
1.45pt;margin-left:8.15pt;text-indent:6.6pt;line-height:112%;background:#F8F8F8'><span
style='font-family:Consolas;color:#333333'>\Drupal::messenger()-&gt;addMessage(</span><span
style='font-family:Consolas;color:#DD1144'>'Your offer was created. Click the
publish button to start earning.'</span><span style='font-family:Consolas;
color:#333333'>);</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:10.6pt;margin-bottom:
.6pt;margin-left:8.65pt;line-height:112%;background:#F8F8F8'><span
style='font-family:Consolas;color:#333333'>$entity = <b>$this</b>-&gt;getEntity();</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:10.6pt;margin-bottom:
.6pt;margin-left:8.65pt;line-height:112%;background:#F8F8F8'><span
style='font-family:Consolas;color:#333333'>$entity-&gt;save();</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:10.6pt;margin-bottom:
23.05pt;margin-left:8.65pt;line-height:112%;background:#F8F8F8'><span
style='font-family:Consolas;color:#333333'>}</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>Step three looks like this now:<br clear=all
style='page-break-before:always'>
</p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:24.25pt;
margin-left:1.5pt;text-indent:0in;line-height:107%'><img border=0 width=535
height=620 id="Picture 11013"
src="Learning%20drupal%209%20as%20a%20framework_files/image080.jpg"></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:.05in;
margin-left:-.25pt'>After we finished our offer, we get redirected to the My
offers page:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:-1.7pt;margin-bottom:
0in;margin-left:1.5pt;text-indent:0in;line-height:107%'><img border=0
width=602 height=184 id="Picture 11015"
src="Learning%20drupal%209%20as%20a%20framework_files/image081.jpg"></p>

<p class=MsoNormal style='margin-top:0in;margin-right:15.1pt;margin-bottom:
49.65pt;margin-left:14.0pt;line-height:110%;background:#FFD966'><span
style='font-size:11.0pt;line-height:110%'>The last step (step 3) is not yet how
we want it. We want to show the Price field <u>only </u>if the Offer type is
set to ‘Set minimum price’ and hidden when the Offer type is set to ‘No minimum
price’. We’ll do this in the next chapter.</span></p>

<h3 style='margin-left:-.25pt'><a name="_Toc247058">Conditional fields in the
Form API</a></h3>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=600
 style='width:6.25in;border-collapse:collapse'>
 <tr style='height:69.0pt'>
  <td width=59 valign=top style='width:44.25pt;background:#6D9EEB;padding:14.6pt 5.75pt 0in 0in;
  height:69.0pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:14.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%'>&#128073;</span></p>
  </td>
  <td width=541 style='width:405.75pt;background:#6D9EEB;padding:14.6pt 5.75pt 0in 0in;
  height:69.0pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:7.0pt;margin-bottom:
  0in;margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%'>In this chapter we show how to use <b>conditional
  fields </b>with the core <b>form API</b>. By the end of this chapter you will
  know how to show/hide fields based on user input on another field.</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:.65pt;
margin-left:-.25pt'>While there were quite a lot of new things introduced last
year, one of the most stable things is the Form API. It grew out to be one of
the best API’s drupal has. In our step</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>3, we want to have our price field only visible when users
select ‘Set minimum price’.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:2.1pt;
margin-left:-.25pt'>In <b>src\Form\OfferAddFormStep3.php </b>tweak the
buildForm function so that it becomes this:</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:220.5pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
  height:220.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:0in;text-indent:0in;line-height:107%'><b><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>public function </span></b><b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#990000'>buildForm</span></b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>(array
  $form, FormStateInterface $form_state) {</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>/*
  </span></i><i><span style='font-size:11.0pt;line-height:107%;font-family:
  Consolas;color:#DD1144'>@var </span></i><i><span style='font-size:11.0pt;
  line-height:107%;font-family:Consolas;color:#999988'>$entity
  \Drupal\offer\Entity\Offer */</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$form = <b>parent</b>::buildForm($form,
  $form_state);</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:15.0pt;
  margin-left:6.05pt;text-indent:0in;line-height:115%'><span style='font-size:
  11.0pt;line-height:115%;font-family:Consolas;color:#333333'>$form[</span><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#DD1144'>'actions'</span><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>][</span><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#DD1144'>'submit'</span><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>][</span><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#DD1144'>'#value'</span><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>]
  = t(</span><span style='font-size:11.0pt;line-height:115%;font-family:Consolas;
  color:#DD1144'>'Save and proceed'</span><span style='font-size:11.0pt;
  line-height:115%;font-family:Consolas;color:#333333'>); <b>unset</b>($form[</span><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#DD1144'>'actions'</span><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>][</span><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#DD1144'>'delete'</span><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>]);</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$form[</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'field_price'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>][</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'#states'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>]
  = [</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'visible' </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>=&gt;
  [</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:30.2pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>[</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'select[name=&quot;field_offer_type&quot;]'
  </span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#333333'>=&gt; [</span><span style='font-size:11.0pt;line-height:107%;
  font-family:Consolas;color:#DD1144'>'value' </span><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>=&gt; </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'with_minimum'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>]],</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:403.45pt;margin-bottom:
  15.8pt;margin-left:6.05pt;text-indent:12.1pt;line-height:115%'><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>]
  ];</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>return
  </span></b><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#333333'>$form;</span></p>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:.9pt;
margin-left:-.25pt'>This is actually quite readable. <b>WHEN </b>the offer type
has the selection</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>‘with_minimum’ (this is the key of ‘Set minimum price’)
selected, <b>THEN </b>make the price field visible.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>In action:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:-1.7pt;margin-bottom:
24.25pt;margin-left:1.5pt;text-indent:0in;line-height:107%'><img border=0
width=602 height=363 id="Picture 11156"
src="Learning%20drupal%209%20as%20a%20framework_files/image082.jpg"></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:.05in;
margin-left:-.25pt'>When selecting ‘Set a minimum price’:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:-1.7pt;margin-bottom:
0in;margin-left:1.5pt;text-indent:0in;line-height:107%'><img border=0
width=602 height=456 id="Picture 11158"
src="Learning%20drupal%209%20as%20a%20framework_files/image083.jpg"></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:21.95pt;
margin-left:-.25pt'>This is it! Our multi step form is completely done.</p>

<h2 style='margin-top:0in;margin-right:0in;margin-bottom:3.35pt;margin-left:
-.25pt'><a name="_Toc247059">Updating our data seeds</a></h2>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>Remember from the first part of this course that we created
some seed data. This was meant for using real dummy data on our platform. Now
that our offer entity is ready, we can extend our import with offers.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:2.1pt;
margin-left:-.25pt'>To <b>offer/src/SeedData/SeedDataGenerator.php </b>we add a
function with an array of offers. We’ll add one below for example:</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:390.0pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 10.05pt 0in 5.25pt;
  height:390.0pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:0in;text-indent:0in;line-height:107%'><b><span style='font-family:
  Consolas;color:#333333'>public function </span></b><b><span style='font-family:
  Consolas;color:#990000'>getOfferList</span></b><span style='font-family:Consolas;
  color:#333333'>() {</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:26.4pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>$data = [</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.1pt;
  margin-left:.55in;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>[</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:52.8pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#DD1144'>'title' </span><span style='font-family:Consolas;
  color:#333333'>=&gt; </span><span style='font-family:Consolas;color:#DD1144'>'Gq2019
  Mens Mountain Trail Bike,11 Speed</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.1pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#DD1144'>Mountain Bike Aluminum'</span><span style='font-family:
  Consolas;color:#333333'>,</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:52.8pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#DD1144'>'field_description' </span><span style='font-family:
  Consolas;color:#333333'>=&gt; </span><span style='font-family:Consolas;
  color:#DD1144'>'</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.1pt;
  margin-left:79.15pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#DD1144'>&lt;ul&gt;</span></p>
  <p class=MsoNormal align=right style='margin-top:0in;margin-right:6.6pt;
  margin-bottom:2.1pt;margin-left:0in;text-align:right;text-indent:0in;
  line-height:107%'><span style='font-family:Consolas;color:#DD1144'>&lt;li&gt;Photochromic
  mountain bike, the use of aluminum</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#DD1144'>alloy frame, hydraulic disc brake system, wheel
  diameter size:</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#DD1144'>27.5 inches ...&lt;/li&gt;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:79.15pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#DD1144'>&lt;/ul&gt;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.1pt;
  margin-left:66.0pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#DD1144'>'</span><span style='font-family:Consolas;color:#333333'>,</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.1pt;
  margin-left:52.8pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#DD1144'>'field_price' </span><span style='font-family:Consolas;
  color:#333333'>=&gt; </span><span style='font-family:Consolas;color:teal'>1500</span><span
  style='font-family:Consolas;color:#333333'>,</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.1pt;
  margin-left:52.8pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#DD1144'>'field_offer_type' </span><span style='font-family:
  Consolas;color:#333333'>=&gt; </span><span style='font-family:Consolas;
  color:#DD1144'>'with_minimum'</span><span style='font-family:Consolas;
  color:#333333'>,</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:52.8pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#DD1144'>'field_image' </span><span style='font-family:Consolas;
  color:#333333'>=&gt;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#DD1144'>'https://images-na.ssl-images-amazon.com/images/I/61-HR1eqFuL._AC_</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.1pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#DD1144'>SL1001_.jpg'</span><span style='font-family:Consolas;
  color:#333333'>,</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.1pt;
  margin-left:52.8pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#DD1144'>'moderation_state' </span><span style='font-family:
  Consolas;color:#333333'>=&gt; </span><span style='font-family:Consolas;
  color:#DD1144'>'published'</span><span style='font-family:Consolas;
  color:#333333'>,</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:52.8pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#DD1144'>'user_id' </span><span style='font-family:Consolas;
  color:#333333'>=&gt; </span><span style='font-family:Consolas;color:teal'>1</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:369.45pt;margin-bottom:
  .9pt;margin-left:26.4pt;text-indent:13.2pt;line-height:116%'><span
  style='font-family:Consolas;color:#333333'>], ];</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:26.4pt;text-indent:0in;line-height:107%'><b><span
  style='font-family:Consolas;color:#333333'>return </span></b><span
  style='font-family:Consolas;color:#333333'>$data;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:13.2pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>}</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:22.45pt;
margin-left:-.25pt'>We’ll use this to loop over our offer entities to create.
We add this to the switch statement under ‘user’ in de <i>generate() </i>method:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:4.0pt;margin-bottom:1.45pt;
margin-left:5.0pt;line-height:112%;background:#F8F8F8'><b><span
style='font-family:Consolas;color:#333333'>case </span></b><span
style='font-family:Consolas;color:#DD1144'>'offer'</span><span
style='font-family:Consolas;color:#333333'>:</span></p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:555.0pt'>
  <td width=601 valign=top style='width:450.75pt;background:#F8F8F8;padding:
  7.85pt 5.75pt 0in 5.25pt;height:555.0pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:123.05pt;margin-bottom:
  0in;margin-left:6.6pt;text-indent:0in;line-height:122%'><span
  style='font-family:Consolas;color:#333333'>$offers = <b>$this</b>-&gt;getOfferList();
  <b>foreach</b>($offers <b>as </b>$offerListItem) {</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:19.8pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>$offer = Offer::create();</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.1pt;
  margin-left:19.8pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>$offer-&gt;set(</span><span style='font-family:Consolas;
  color:#DD1144'>'title'</span><span style='font-family:Consolas;color:#333333'>,
  $offerListItem[</span><span style='font-family:Consolas;color:#DD1144'>'title'</span><span
  style='font-family:Consolas;color:#333333'>]);</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.1pt;
  margin-left:19.8pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>$offer-&gt;set(</span><span style='font-family:Consolas;
  color:#DD1144'>'field_description'</span><span style='font-family:Consolas;
  color:#333333'>, [</span><span style='font-family:Consolas;color:#DD1144'>'value'
  </span><span style='font-family:Consolas;color:#333333'>=&gt;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:19.8pt;text-indent:-19.8pt;line-height:116%'><span
  style='font-family:Consolas;color:#333333'>$offerListItem[</span><span
  style='font-family:Consolas;color:#DD1144'>'field_description'</span><span
  style='font-family:Consolas;color:#333333'>], </span><span style='font-family:
  Consolas;color:#DD1144'>'format' </span><span style='font-family:Consolas;
  color:#333333'>=&gt; </span><span style='font-family:Consolas;color:#DD1144'>'html'</span><span
  style='font-family:Consolas;color:#333333'>]); $offer-&gt;set(</span><span
  style='font-family:Consolas;color:#DD1144'>'field_offer_type'</span><span
  style='font-family:Consolas;color:#333333'>,</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:30.7pt;margin-bottom:
  .9pt;margin-left:19.8pt;text-indent:-19.8pt;line-height:116%'><span
  style='font-family:Consolas;color:#333333'>$offerListItem[</span><span
  style='font-family:Consolas;color:#DD1144'>'field_offer_type'</span><span
  style='font-family:Consolas;color:#333333'>]); $offer-&gt;set(</span><span
  style='font-family:Consolas;color:#DD1144'>'field_price'</span><span
  style='font-family:Consolas;color:#333333'>, $offerListItem[</span><span
  style='font-family:Consolas;color:#DD1144'>'field_price'</span><span
  style='font-family:Consolas;color:#333333'>]);</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:19.8pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>$directory = </span><span style='font-family:Consolas;
  color:#DD1144'>'public://'</span><span style='font-family:Consolas;
  color:#333333'>;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.1pt;
  margin-left:19.8pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>$url = $offerListItem[</span><span style='font-family:
  Consolas;color:#DD1144'>'field_image'</span><span style='font-family:Consolas;
  color:#333333'>];</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:19.8pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>$file = system_retrieve_file($url, $directory, <b>true</b>);</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.1pt;
  margin-left:19.8pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>$drupalMedia = Media::create([</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.1pt;
  margin-left:33.0pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#DD1144'>'bundle' </span><span style='font-family:Consolas;
  color:#333333'>=&gt; </span><span style='font-family:Consolas;color:#DD1144'>'image'</span><span
  style='font-family:Consolas;color:#333333'>,</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.1pt;
  margin-left:33.0pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#DD1144'>'uid' </span><span style='font-family:Consolas;
  color:#333333'>=&gt; </span><span style='font-family:Consolas;color:#DD1144'>'0'</span><span
  style='font-family:Consolas;color:#333333'>,</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.1pt;
  margin-left:33.0pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#DD1144'>'field_media_image' </span><span style='font-family:
  Consolas;color:#333333'>=&gt; [</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:46.2pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#DD1144'>'target_id' </span><span style='font-family:Consolas;
  color:#333333'>=&gt; $file-&gt;id(),</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:33.0pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>],</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:19.8pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>]);</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:19.8pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>$drupalMedia-&gt;setPublished(<b>TRUE</b>)</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.1pt;
  margin-left:33.0pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>-&gt;save();</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:19.8pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>$offer-&gt;set(</span><span style='font-family:Consolas;
  color:#DD1144'>'field_image'</span><span style='font-family:Consolas;
  color:#333333'>, [</span><span style='font-family:Consolas;color:#DD1144'>'target_id'
  </span><span style='font-family:Consolas;color:#333333'>=&gt;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.1pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>$drupalMedia-&gt;id()]);</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:19.8pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>$offer-&gt;set(</span><span style='font-family:Consolas;
  color:#DD1144'>'user_id'</span><span style='font-family:Consolas;color:#333333'>,
  </span><span style='font-family:Consolas;color:teal'>1</span><span
  style='font-family:Consolas;color:#333333'>);</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:19.8pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>$offer-&gt;set(</span><span style='font-family:Consolas;
  color:#DD1144'>'moderation_state'</span><span style='font-family:Consolas;
  color:#333333'>,</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:202.2pt;margin-bottom:
  0in;margin-left:19.8pt;text-indent:-19.8pt;line-height:119%'><span
  style='font-family:Consolas;color:#333333'>$offerListItem[</span><span
  style='font-family:Consolas;color:#DD1144'>'moderation_state'</span><span
  style='font-family:Consolas;color:#333333'>]); <b>if</b>($offer-&gt;save()) {
  $count += </span><span style='font-family:Consolas;color:teal'>1</span><span
  style='font-family:Consolas;color:#333333'>;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:340.8pt;margin-bottom:
  0in;margin-left:6.6pt;text-indent:13.2pt;line-height:107%'><span
  style='font-family:Consolas;color:#333333'>} } <b>return </b>$count; <b>break</b>;</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:22.0pt;
margin-left:-.25pt;line-height:110%'>Then, we add the following lines to our <i>OfferCreateSeeds()
</i>method in <b>custom/offer/src/Commands/SeedGeneratorCommand.php:</b></p>

<p class=MsoNormal style='margin-top:0in;margin-right:10.6pt;margin-bottom:
1.45pt;margin-left:5.0pt;line-height:112%;background:#F8F8F8'><span
style='font-family:Consolas;color:#333333'>$count = $seed-&gt;Generate(</span><span
style='font-family:Consolas;color:#DD1144'>'offer'</span><span
style='font-family:Consolas;color:#333333'>);</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:10.6pt;margin-bottom:
0in;margin-left:5.0pt;line-height:112%;background:#F8F8F8'><span
style='font-family:Consolas;color:#333333'>Drush::output()-&gt;writeln($count .
</span><span style='font-family:Consolas;color:#DD1144'>' offer(s) created'</span><span
style='font-family:Consolas;color:#333333'>);</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.55pt;margin-bottom:0in;
margin-left:-1.0in;text-indent:0in;line-height:107%'>&nbsp;</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:78.0pt'>
  <td width=601 style='width:450.75pt;background:#FFD966;padding:0in 5.75pt 0in 14.25pt;
  height:78.0pt'>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'>In the
  final project code, you’ll see I’ve ended up with multiple offers that get
  created this way. Now developers who install the platform locally can work
  with real-life offers instead of an empty installation.</p>
  </td>
 </tr>
</table>

<span style='font-size:12.0pt;line-height:112%;font-family:"Calibri",sans-serif;
color:black'><br clear=all style='page-break-before:always'>
</span>

<p class=MsoNormal>&nbsp;</p>

<h1 style='margin-top:0in;margin-right:0in;margin-bottom:16.35pt;margin-left:
-.25pt'><a name="_Toc247060">Part 4: building the application. Storing,
validating and rendering data</a></h1>

<h2 style='margin-top:0in;margin-right:0in;margin-bottom:3.55pt;margin-left:
-.25pt'><a name="_Toc247061">Add dynamic menu links with Menu plugins</a></h2>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=600
 style='width:6.25in;border-collapse:collapse'>
 <tr style='height:55.5pt'>
  <td width=59 valign=top style='width:44.25pt;background:#6D9EEB;padding:14.6pt 5.75pt 0in 0in;
  height:55.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:14.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%'>&#128073;</span></p>
  </td>
  <td width=541 style='width:405.75pt;background:#6D9EEB;padding:14.6pt 5.75pt 0in 0in;
  height:55.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:9.55pt;margin-bottom:
  0in;margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%'>In this chapter we go over <b>custom menu links </b>defined
  in <b>code</b>. At the end you will be able to create dynamic menu links with
  counters such as “My offers (2)”.</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>If we log in with a user who is not the administrator we
lack navigation. Drupal has a built-in menu system which content managers can
use to add content to menus. But because this is more a framework course than a
CMS course we want to add these in code. A nice advantage is that you can cache
these items individually and cleverly. More about this in the chapter about
caching. A second advantage is you can add <i>variable </i>data such as
counters.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:21.15pt;
margin-left:-.25pt;line-height:110%'>To <b>modules/custom/offer/offer.links.menu.yml</b>,
we add:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:99.1pt;margin-bottom:
1.25pt;margin-left:8.4pt;line-height:111%;background:#F8F8F8'><span
style='font-size:11.0pt;line-height:111%;font-family:Consolas;color:#DD1144'>offer.account.my_offers:</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:99.1pt;margin-bottom:
23.8pt;margin-left:8.4pt;line-height:111%;background:#F8F8F8'><span
style='font-size:11.0pt;line-height:111%;font-family:Consolas;color:#333333'>route_name:
</span><span style='font-size:11.0pt;line-height:111%;font-family:Consolas;
color:#DD1144'>entity.offer.collection </span><span style='font-size:11.0pt;
line-height:111%;font-family:Consolas;color:#333333'>menu_name: </span><span
style='font-size:11.0pt;line-height:111%;font-family:Consolas;color:#DD1144'>main
</span><span style='font-size:11.0pt;line-height:111%;font-family:Consolas;
color:#333333'>class: </span><span style='font-size:11.0pt;line-height:111%;
font-family:Consolas;color:#DD1144'>Drupal\offer\Plugin\Menu\MyOffers </span><span
style='font-size:11.0pt;line-height:111%;font-family:Consolas;color:#333333'>weight:
</span><span style='font-size:11.0pt;line-height:111%;font-family:Consolas;
color:#990073'>-50</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:2.1pt;
margin-left:-.25pt'>We need to add a Menu Plugin to our module so the Menu
module can detect our menu link. Add <b>modules/custom/offer/Plugin/Menu/MyOffers.php:</b></p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:190.5pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
  height:190.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:216.1pt;margin-bottom:
  6.7pt;margin-left:0in;text-indent:0in;line-height:179%'><b><span
  style='font-size:11.0pt;line-height:179%;font-family:Consolas;color:#999999'>&lt;?php
  </span></b><b><span style='font-size:11.0pt;line-height:179%;font-family:
  Consolas;color:#333333'>namespace </span></b><b><span style='font-size:11.0pt;
  line-height:179%;font-family:Consolas;color:#990000'>Drupal</span></b><span
  style='font-size:11.0pt;line-height:179%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:179%;font-family:Consolas;color:#990000'>offer</span></b><span
  style='font-size:11.0pt;line-height:179%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:179%;font-family:Consolas;color:#990000'>Plugin</span></b><span
  style='font-size:11.0pt;line-height:179%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:179%;font-family:Consolas;color:#990000'>Menu</span></b><span
  style='font-size:11.0pt;line-height:179%;font-family:Consolas;color:#333333'>;
  <b>use </b></span><b><span style='font-size:11.0pt;line-height:179%;
  font-family:Consolas;color:#990000'>Drupal</span></b><span style='font-size:
  11.0pt;line-height:179%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:179%;font-family:Consolas;color:#990000'>Core</span></b><span
  style='font-size:11.0pt;line-height:179%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:179%;font-family:Consolas;color:#990000'>Menu</span></b><span
  style='font-size:11.0pt;line-height:179%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:179%;font-family:Consolas;color:#990000'>MenuLinkDefault</span></b><span
  style='font-size:11.0pt;line-height:179%;font-family:Consolas;color:#333333'>;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><i><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>/**</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:18.15pt;text-indent:-12.1pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>displays
  number of offers.</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:2.75in;margin-bottom:
  14.2pt;margin-left:0in;text-indent:0in;line-height:121%'><i><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#999988'>*/
  </span></i><b><span style='font-size:11.0pt;line-height:121%;font-family:
  Consolas;color:#333333'>class </span></b><b><span style='font-size:11.0pt;
  line-height:121%;font-family:Consolas;color:#445588'>MyOffers </span></b><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>extends
  </span></b><b><span style='font-size:11.0pt;line-height:121%;font-family:
  Consolas;color:#445588'>MenuLinkDefault </span></b><span style='font-size:
  11.0pt;line-height:121%;font-family:Consolas;color:#333333'>{</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>/**</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:18.15pt;text-indent:-12.1pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>{</span></i><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>@inheritdoc</span></i><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>}</span></i></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.55pt;margin-bottom:0in;
margin-left:-1.0in;text-indent:0in;line-height:107%'>&nbsp;</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:355.5pt'>
  <td width=601 colspan=2 style='width:450.75pt;background:#F8F8F8;padding:
  0in 5.75pt 0in 0in;height:355.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:264.45pt;margin-bottom:
  0in;margin-left:6.05pt;text-indent:6.05pt;line-height:121%'><i><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#999988'>*/
  </span></i><b><span style='font-size:11.0pt;line-height:121%;font-family:
  Consolas;color:#333333'>public function </span></b><b><span style='font-size:
  11.0pt;line-height:121%;font-family:Consolas;color:#990000'>getTitle</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>()
  {</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:83.15pt;margin-bottom:
  0in;margin-left:18.15pt;text-indent:0in;line-height:115%'><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>$count
  = </span><span style='font-size:11.0pt;line-height:115%;font-family:Consolas;
  color:teal'>0</span><span style='font-size:11.0pt;line-height:115%;
  font-family:Consolas;color:#333333'>; <b>if</b>(\Drupal::currentUser()-&gt;isAuthenticated())
  {</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:30.2pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$offers =
  \Drupal::entityTypeManager()</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:42.3pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>-&gt;getStorage(</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'offer'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>)</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:42.3pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>-&gt;loadByProperties([</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'user_id'
  </span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#333333'>=&gt; \Drupal::currentUser()-&gt;id()]);</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:210.1pt;margin-bottom:
  0in;margin-left:30.2pt;text-indent:0in;line-height:121%'><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>$count
  = count($offers); <b>return $this</b>-&gt;t(</span><span style='font-size:
  11.0pt;line-height:121%;font-family:Consolas;color:#DD1144'>'My offers
  (&lt;span</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>class=&quot;count-badge&quot;&gt;(@count)&lt;/span&gt;)'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>,
  [</span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#DD1144'>'@count' </span><span style='font-size:11.0pt;line-height:
  107%;font-family:Consolas;color:#333333'>=&gt; $count]);</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>} <b>else </b>{</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:30.2pt;text-indent:0in;line-height:107%'><b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>return
  null</span></b><span style='font-size:11.0pt;line-height:107%;font-family:
  Consolas;color:#333333'>;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:15.95pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>/**</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*
  {</span></i><i><span style='font-size:11.0pt;line-height:107%;font-family:
  Consolas;color:#DD1144'>@inheritdoc</span></i><i><span style='font-size:11.0pt;
  line-height:107%;font-family:Consolas;color:#999988'>}</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:228.2pt;margin-bottom:
  0in;margin-left:6.05pt;text-indent:6.05pt;line-height:121%'><i><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#999988'>*/
  </span></i><b><span style='font-size:11.0pt;line-height:121%;font-family:
  Consolas;color:#333333'>public function </span></b><b><span style='font-size:
  11.0pt;line-height:121%;font-family:Consolas;color:#990000'>getCacheMaxAge</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>()
  { <b>return </b></span><span style='font-size:11.0pt;line-height:121%;
  font-family:Consolas;color:teal'>0</span><span style='font-size:11.0pt;
  line-height:121%;font-family:Consolas;color:#333333'>;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:15.95pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  </td>
 </tr>
 <tr style='height:111.75pt'>
  <td width=59 valign=top style='width:44.25pt;background:#E2E3E5;padding:0in 5.75pt 0in 0in;
  height:111.75pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:14.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%'>&#128187;</span></p>
  </td>
  <td width=542 valign=top style='width:406.5pt;background:#E2E3E5;padding:
  0in 5.75pt 0in 0in;height:111.75pt'>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%'>Add the <b>main navigation </b>block
  to the ‘breadcrumb’ region at</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:14.25pt;
  margin-left:0in;text-indent:0in;line-height:105%'><i><u><span
  style='font-size:11.0pt;line-height:105%'>/admin/structure/blocks</span></u></i><span
  style='font-size:11.0pt;line-height:105%'>, we see our dynamic link to the
  offers page, with a number counter to show the amount of offers we’ve created
  so far.</span></p>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%'>If we clear the caches, we see the
  ‘My offers’ menu link appearing on top.</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:19.0pt;
margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:11.0pt;
line-height:107%'><img border=0 width=600 height=385 id="Group 192118"
src="Learning%20drupal%209%20as%20a%20framework_files/image084.gif"></span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>The link is not cached as it needs to show an updated value
after adding a new offer. See the <u><span style='color:#1155CC'>chapter about
caching </span></u>for details on how to provide custom caching mechanisms for
this. We will style this main menu in a further chapter.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>Next, we add a link to the overview page (to the main menu)
and the notifications (to the account menu):</p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:19.9pt;
margin-left:-.25pt;line-height:110%'>To <b>custom/offer/offer.links.menu.yml</b></p>

<p class=MsoNormal style='margin-top:0in;margin-right:188.7pt;margin-bottom:
22.15pt;margin-left:11.1pt;text-indent:-6.6pt;line-height:112%;background:#F8F8F8'><span
style='font-family:Consolas;color:#DD1144'>offer.overview: </span><span
style='font-family:Consolas;color:#333333'>title: </span><span
style='font-family:Consolas;color:#DD1144'>'Offers' </span><span
style='font-family:Consolas;color:#333333'>route_name: </span><span
style='font-family:Consolas;color:#DD1144'>view.offer_overview.page_1 </span><span
style='font-family:Consolas;color:#333333'>menu_name: </span><span
style='font-family:Consolas;color:#DD1144'>main </span><span style='font-family:
Consolas;color:#333333'>weight: </span><span style='font-family:Consolas;
color:teal'>5</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:.05in;
margin-left:-.25pt'>The second link is visible after a cache clear:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:1.5pt;text-indent:0in;line-height:107%'><img border=0 width=191
height=127 id="Picture 11713"
src="Learning%20drupal%209%20as%20a%20framework_files/image085.jpg"></p>

<h2 style='margin-top:0in;margin-right:0in;margin-bottom:3.2pt;margin-left:
-.25pt'><a name="_Toc247062">Building the offer page with twig: theming a
custom content entity</a></h2>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>Now it's time for us to start building the offer page.
We’ll use twig files, because this is the standard in drupal 9. I would
recommend not to install contributed modules for styling as they may cause
troubles in the long run (upgrading?).</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:2.1pt;
margin-left:-.25pt'>If you followed this course, thanks to the instruction in
the <u><span style='color:#1155CC'>rendering a teaser </span></u>the full
template should already be registered in our <b>custom/offer/offer.module:</b></p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:291.0pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
  height:291.0pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.1pt;
  margin-left:0in;text-indent:0in;line-height:107%'><i><span style='font-family:
  Consolas;color:#999988'>/**</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:38.45pt;margin-bottom:
  1.2pt;margin-left:0in;text-indent:0in;line-height:107%'><span
  style='font-family:Consolas;color:#999988'>*<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  </span></span><i><span style='font-family:Consolas;color:#999988'>Provides a
  theme definition for custom content entity offer</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:38.45pt;margin-bottom:
  .45pt;margin-left:0in;text-indent:0in;line-height:119%'><span
  style='font-family:Consolas;color:#999988'>*<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  </span></span><i><span style='font-family:Consolas;color:#999988'>{</span></i><i><span
  style='font-family:Consolas;color:#DD1144'>@inheritdoc</span></i><i><span
  style='font-family:Consolas;color:#999988'>} */ </span></i><b><span
  style='font-family:Consolas;color:#333333'>function </span></b><b><span
  style='font-family:Consolas;color:#990000'>offer_theme</span></b><span
  style='font-family:Consolas;color:#333333'>($existing, $type, $theme, $path)
  {</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.1pt;
  margin-left:6.6pt;text-indent:0in;line-height:107%'><b><span
  style='font-family:Consolas;color:#333333'>return </span></b><span
  style='font-family:Consolas;color:#333333'>[</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.1pt;
  margin-left:19.8pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#DD1144'>'offer' </span><span style='font-family:Consolas;
  color:#333333'>=&gt; [</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:33.0pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#DD1144'>'render element' </span><span style='font-family:
  Consolas;color:#333333'>=&gt; </span><span style='font-family:Consolas;
  color:#DD1144'>'elements'</span><span style='font-family:Consolas;color:#333333'>,</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.1pt;
  margin-left:19.8pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>],</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.1pt;
  margin-left:19.8pt;text-indent:0in;line-height:107%'><b><span
  style='font-family:Consolas;color:#DD1144'>'offer__full' </span></b><b><span
  style='font-family:Consolas;color:#333333'>=&gt; [</span></b></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:33.0pt;text-indent:0in;line-height:107%'><b><span
  style='font-family:Consolas;color:#DD1144'>'base hook' </span></b><b><span
  style='font-family:Consolas;color:#333333'>=&gt; </span></b><b><span
  style='font-family:Consolas;color:#DD1144'>'offer'</span></b><b><span
  style='font-family:Consolas;color:#333333'>,</span></b></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.1pt;
  margin-left:19.8pt;text-indent:0in;line-height:107%'><b><span
  style='font-family:Consolas;color:#333333'>],</span></b></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.1pt;
  margin-left:19.8pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#DD1144'>'offer__teaser' </span><span style='font-family:Consolas;
  color:#333333'>=&gt; [</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:33.0pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#DD1144'>'base hook' </span><span style='font-family:Consolas;
  color:#333333'>=&gt; </span><span style='font-family:Consolas;color:#DD1144'>'offer'</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:19.8pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>]</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:6.6pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>];</span></p>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-family:Consolas;color:#333333'>}</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:20.65pt;
margin-left:-.25pt'>First, we want to theme the full view, for that we clear
caches and add a file to <b>custom/offer/templates </b>named <b>offer--full.html.twig</b>.
To the file, add:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:25.65pt;
margin-left:5.0pt;line-height:110%;background:#F8F8F8'><span style='font-size:
11.0pt;line-height:110%;font-family:Consolas;color:teal'>{{ content }}</span></p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=600
 style='width:6.25in;border-collapse:collapse'>
 <tr style='height:82.5pt'>
  <td width=59 valign=top style='width:44.25pt;background:#E2E3E5;padding:14.6pt 5.75pt 0in 0in;
  height:82.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:14.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%'>&#128187;</span></p>
  </td>
  <td width=541 valign=top style='width:405.75pt;background:#E2E3E5;padding:
  14.6pt 5.75pt 0in 0in;height:82.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:4.8pt;margin-bottom:
  0in;margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%'>In the ‘fields’-section of your offers view, at <u>/admin/structure/views/view/offers</u>,
  make sure you’ve clicked the “Link to Offer” checkbox. This way you will be
  able to visit your entity detail page from the <u>/offers </u>page.</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:19.0pt;
margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:11.0pt;
line-height:107%'><img border=0 width=600 height=560 id="Group 193703"
src="Learning%20drupal%209%20as%20a%20framework_files/image086.gif"></span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>Clear caches to make sure this template is rendered. Add
some dummy sentence before the content statement to test it.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:-1.7pt;margin-bottom:
24.25pt;margin-left:1.5pt;text-indent:0in;line-height:107%'><img border=0
width=602 height=420 id="Picture 11918"
src="Learning%20drupal%209%20as%20a%20framework_files/image087.jpg"></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:20.65pt;
margin-left:-.25pt'>We can play along with the fields at <u>admin/structure/offer/display/full
</u>to change the order of the fields and hiding or showing the label. But I
prefer to be more specific when using twig, so I edit my <b>offer--full.html.twig
</b>like this:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.7pt;
margin-left:5.0pt;line-height:110%;background:#F8F8F8'><span style='font-size:
11.0pt;line-height:110%;font-family:Consolas;color:teal'>{{ content.field_image
}}</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:23.4pt;
margin-left:5.0pt;line-height:110%;background:#F8F8F8'><span style='font-size:
11.0pt;line-height:110%;font-family:Consolas;color:teal'>{{
content.field_description }}</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:23.05pt;
margin-left:-.25pt'>This will only show the image and the description.</p>

<h2 style='margin-top:0in;margin-right:0in;margin-bottom:3.2pt;margin-left:
-.25pt'><a name="_Toc247063">Adding a dynamic bidding form to our page with an
advanced block plugin</a></h2>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:2.1pt;
margin-left:-.25pt'>We want a nice and dynamic bidding form on our offer pages.
We’ll start by adding a form to <b>custom/modules/offer/src/Form </b>named <b>OfferBiddingForm.php</b>:</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:100.5pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
  height:100.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:270.5pt;margin-bottom:
  15.0pt;margin-left:0in;text-indent:0in;line-height:121%'><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#999999'>&lt;?php
  </span></b><b><span style='font-size:11.0pt;line-height:121%;font-family:
  Consolas;color:#333333'>namespace </span></b><b><span style='font-size:11.0pt;
  line-height:121%;font-family:Consolas;color:#990000'>Drupal</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>offer</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>Form</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:2.75in;margin-bottom:
  0in;margin-left:0in;text-indent:0in;line-height:107%'><b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>use
  </span></b><b><span style='font-size:11.0pt;line-height:107%;font-family:
  Consolas;color:#990000'>Drupal</span></b><span style='font-size:11.0pt;
  line-height:107%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#990000'>Core</span></b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#990000'>Form</span></b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#990000'>FormBase</span></b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>;
  <b>use </b></span><b><span style='font-size:11.0pt;line-height:107%;
  font-family:Consolas;color:#990000'>Drupal</span></b><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#990000'>Core</span></b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#990000'>Form</span></b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#990000'>FormStateInterface</span></b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>;
  <b>use </b></span><b><span style='font-size:11.0pt;line-height:107%;
  font-family:Consolas;color:#990000'>Drupal</span></b><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#990000'>offer</span></b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#990000'>Entity</span></b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#990000'>Offer</span></b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>;</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.55pt;margin-bottom:0in;
margin-left:-1.0in;text-indent:0in;line-height:107%'>&nbsp;</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:685.5pt'>
  <td width=601 valign=bottom style='width:450.75pt;background:#F8F8F8;
  padding:0in 5.75pt 0in 5.25pt;height:685.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:15.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><b><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>class </span></b><b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#445588'>OfferBiddingForm
  </span></b><b><span style='font-size:11.0pt;line-height:107%;font-family:
  Consolas;color:#333333'>extends </span></b><b><span style='font-size:11.0pt;
  line-height:107%;font-family:Consolas;color:#445588'>FormBase </span></b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>{</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>/**</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>@return
  </span></i><i><span style='font-size:11.0pt;line-height:107%;font-family:
  Consolas;color:#999988'>string</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>The
  unique string identifying the form.</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:247.8pt;margin-bottom:
  0in;margin-left:12.1pt;text-indent:6.05pt;line-height:121%'><i><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#999988'>*/
  </span></i><b><span style='font-size:11.0pt;line-height:121%;font-family:
  Consolas;color:#333333'>public function </span></b><b><span style='font-size:
  11.0pt;line-height:121%;font-family:Consolas;color:#990000'>getFormId</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>()
  { <b>return </b></span><span style='font-size:11.0pt;line-height:121%;
  font-family:Consolas;color:#DD1144'>'offer_bid_form'</span><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:15.95pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>/**</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>Form
  constructor.</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>@param
  </span></i><i><span style='font-size:11.0pt;line-height:107%;font-family:
  Consolas;color:#999988'>array $form</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.4pt;
  margin-left:18.15pt;text-indent:0in;line-height:118%'><span style='font-size:
  11.0pt;line-height:118%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:118%;font-family:Consolas;color:#999988'>An
  associative array containing the structure of the form. * </span></i><i><span
  style='font-size:11.0pt;line-height:118%;font-family:Consolas;color:#DD1144'>@param
  </span></i><i><span style='font-size:11.0pt;line-height:118%;font-family:
  Consolas;color:#999988'>\Drupal\Core\Form\FormStateInterface $form_state *  
  The current state of the form.</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>@param
  </span></i><i><span style='font-size:11.0pt;line-height:107%;font-family:
  Consolas;color:#999988'>\Drupal\offer\Entity\Offer $offer</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>The
  offer entity we're viewing</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>@return
  </span></i><i><span style='font-size:11.0pt;line-height:107%;font-family:
  Consolas;color:#999988'>array</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>The
  form structure.</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:12.1pt;text-indent:6.05pt;line-height:121%'><i><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#999988'>*/
  </span></i><b><span style='font-size:11.0pt;line-height:121%;font-family:
  Consolas;color:#333333'>public function </span></b><b><span style='font-size:
  11.0pt;line-height:121%;font-family:Consolas;color:#990000'>buildForm</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>(array
  $form, FormStateInterface $form_state,</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:15.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$offer = NULL) {</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:24.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$form[</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'bid'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>]
  = [</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:36.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'#type' </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>=&gt;
  </span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#DD1144'>'textfield'</span><span style='font-size:11.0pt;line-height:
  107%;font-family:Consolas;color:#333333'>,</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:36.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'#attributes' </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>=&gt;
  <b>array</b>(</span></p>
  <p class=MsoNormal align=center style='margin-top:0in;margin-right:0in;
  margin-bottom:.95pt;margin-left:0in;text-align:center;text-indent:0in;
  line-height:107%'><span style='font-size:11.0pt;line-height:107%;font-family:
  Consolas;color:#DD1144'>' type' </span><span style='font-size:11.0pt;
  line-height:107%;font-family:Consolas;color:#333333'>=&gt; </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'number'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>,
  </span><i><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#999988'>// this validates it as a number in</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><i><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>front-end</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:36.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>),</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:36.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'#title' </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>=&gt;
  <b>$this</b>-&gt;t(</span><span style='font-size:11.0pt;line-height:107%;
  font-family:Consolas;color:#DD1144'>'Your bid'</span><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>),</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:36.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'#description' </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>=&gt;
  <b>$this</b>-&gt;t(</span><span style='font-size:11.0pt;line-height:107%;
  font-family:Consolas;color:#DD1144'>'Prices in $.'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>),</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:36.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'#required' </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>=&gt;
  <b>TRUE</b>,</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:16.8pt;
  margin-left:24.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>];</span></p>
  <p class=MsoNormal style='margin:0in;text-align:justify;text-justify:inter-ideograph;
  text-indent:24.15pt;line-height:115%'><i><span style='font-size:11.0pt;
  line-height:115%;font-family:Consolas;color:#999988'>// Group submit handlers
  in an actions element with a key of &quot;actions&quot;.</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:24.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$form[</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'actions'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>]
  = [</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:36.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'#type' </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>=&gt;
  </span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#DD1144'>'actions'</span><span style='font-size:11.0pt;line-height:
  107%;font-family:Consolas;color:#333333'>,</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:16.8pt;
  margin-left:24.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>];</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:24.15pt;text-indent:0in;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>//
  Add a submit button that handles the submission of the form.</span></i></p>
  </td>
 </tr>
 <tr style='height:145.5pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
  height:145.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:24.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$form[</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'actions'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>][</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'submit'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>]
  = [</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:36.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'#type' </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>=&gt;
  </span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#DD1144'>'submit'</span><span style='font-size:11.0pt;line-height:107%;
  font-family:Consolas;color:#333333'>,</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:36.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'#value' </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>=&gt;
  <b>$this</b>-&gt;t(</span><span style='font-size:11.0pt;line-height:107%;
  font-family:Consolas;color:#DD1144'>'Submit'</span><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>),</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:337.0pt;margin-bottom:
  0in;margin-left:24.15pt;text-indent:0in;line-height:237%'><span
  style='font-size:11.0pt;line-height:237%;font-family:Consolas;color:#333333'>];
  <b>return </b>$form;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:2.1pt;
margin-left:-.25pt'>We add the <i>validateForm() </i>and <i>submitForm() </i>functions
but keep them empty for now:</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:70.5pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
  height:70.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><b><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>public function </span></b><b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#990000'>validateForm</span></b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>(array
  &amp;$form, FormStateInterface</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:179.85pt;margin-bottom:
  0in;margin-left:12.1pt;text-indent:-12.1pt;line-height:115%'><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>$form_state)
  { <b>parent</b>::validateForm($form, $form_state);</span></p>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:76.6pt;margin-bottom:
.8pt;margin-left:5.0pt;line-height:111%;background:#F8F8F8'><b><span
style='font-size:11.0pt;line-height:111%;font-family:Consolas;color:#333333'>public
function </span></b><b><span style='font-size:11.0pt;line-height:111%;
font-family:Consolas;color:#990000'>submitForm</span></b><span
style='font-size:11.0pt;line-height:111%;font-family:Consolas;color:#333333'>(array
&amp;$form, FormStateInterface $form_state)</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:76.6pt;margin-bottom:
.8pt;margin-left:5.0pt;line-height:111%;background:#F8F8F8'><span
style='font-size:11.0pt;line-height:111%;font-family:Consolas;color:#333333'>{</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:76.6pt;margin-bottom:
37.3pt;margin-left:5.0pt;line-height:111%;background:#F8F8F8'><span
style='font-size:11.0pt;line-height:111%;font-family:Consolas;color:#333333'>}</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:15.1pt;margin-bottom:
32.35pt;margin-left:14.0pt;line-height:110%;background:#FFD966'><span
style='font-size:11.0pt;line-height:110%'>How do we show the form on the entity
page? This is an important architectural decision. Our <b>entities are cached
as a whole</b>, so we need to keep this out of our entity. A <b>block plugin </b>is
the wisest decision here.</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>We’ll use an advanced technique here. Because the form in
the block needs to be dependent on the current offer, we will use the <a
href="https://api.drupal.org/api/drupal/core!lib!Drupal.php/function/Drupal%3A%3ArequestStack/8.2.x"><span
style='color:#1155CC'>RequestStack</span></a><u><span style='color:#1155CC'> </span></u><a
href="https://api.drupal.org/api/drupal/core!lib!Drupal.php/function/Drupal%3A%3ArequestStack/8.2.x"><span
style='color:#1155CC'>service</span></a>.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.35pt;
margin-left:-.25pt;line-height:110%'>Add a file called <b>OfferBiddingFormBlock.php
</b>to <b>custom/offer/src/Plugin/Block</b>:</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:160.5pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
  height:160.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:222.15pt;margin-bottom:
  0in;margin-left:0in;text-indent:0in;line-height:237%'><b><span
  style='font-size:11.0pt;line-height:237%;font-family:Consolas;color:#999999'>&lt;?php
  </span></b><b><span style='font-size:11.0pt;line-height:237%;font-family:
  Consolas;color:#333333'>namespace </span></b><b><span style='font-size:11.0pt;
  line-height:237%;font-family:Consolas;color:#990000'>Drupal</span></b><span
  style='font-size:11.0pt;line-height:237%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:237%;font-family:Consolas;color:#990000'>offer</span></b><span
  style='font-size:11.0pt;line-height:237%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:237%;font-family:Consolas;color:#990000'>Plugin</span></b><span
  style='font-size:11.0pt;line-height:237%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:237%;font-family:Consolas;color:#990000'>Block</span></b><span
  style='font-size:11.0pt;line-height:237%;font-family:Consolas;color:#333333'>;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:71.1pt;margin-bottom:
  0in;margin-left:0in;text-indent:0in;line-height:107%'><b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>use
  </span></b><b><span style='font-size:11.0pt;line-height:107%;font-family:
  Consolas;color:#990000'>Drupal</span></b><span style='font-size:11.0pt;
  line-height:107%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#990000'>Core</span></b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#990000'>Block</span></b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#990000'>BlockBase</span></b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>;
  <b>use </b></span><b><span style='font-size:11.0pt;line-height:107%;
  font-family:Consolas;color:#990000'>Symfony</span></b><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#990000'>Component</span></b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#990000'>DependencyInjection</span></b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#990000'>ContainerInterface</span></b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>;
  <b>use </b></span><b><span style='font-size:11.0pt;line-height:107%;
  font-family:Consolas;color:#990000'>Drupal</span></b><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#990000'>Core</span></b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#990000'>Plugin</span></b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#990000'>ContainerFactoryPluginInterface</span></b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>;
  <b>use </b></span><b><span style='font-size:11.0pt;line-height:107%;
  font-family:Consolas;color:#990000'>Symfony</span></b><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#990000'>Component</span></b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#990000'>HttpFoundation</span></b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#990000'>RequestStack</span></b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>;
  <b>use </b></span><b><span style='font-size:11.0pt;line-height:107%;
  font-family:Consolas;color:#990000'>Drupal</span></b><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#990000'>Core</span></b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#990000'>Entity</span></b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#990000'>EntityStorageInterface</span></b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>;
  <b>use </b></span><b><span style='font-size:11.0pt;line-height:107%;
  font-family:Consolas;color:#990000'>Drupal</span></b><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#990000'>Core</span></b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#990000'>Session</span></b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#990000'>AccountProxyInterface</span></b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>;</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.55pt;margin-bottom:0in;
margin-left:-1.0in;text-indent:0in;line-height:107%'>&nbsp;</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:685.5pt'>
  <td width=601 valign=bottom style='width:450.75pt;background:#F8F8F8;
  padding:0in 5.75pt 6.95pt 5.25pt;height:685.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:0in;text-indent:0in;line-height:107%'><i><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>/**</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>@Block</span></i><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>(</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>id
  = &quot;offer_bidding_block&quot;,</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>admin_label
  = </span></i><i><span style='font-size:11.0pt;line-height:107%;font-family:
  Consolas;color:#DD1144'>@Translation</span></i><i><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>(&quot;Offer bid
  block&quot;),</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>category
  = </span></i><i><span style='font-size:11.0pt;line-height:107%;font-family:
  Consolas;color:#DD1144'>@Translation</span></i><i><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>(&quot;Shows the
  bidding block to an offer&quot;),</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:15.8pt;
  margin-left:12.1pt;text-indent:0in;line-height:115%'><span style='font-size:
  11.0pt;line-height:115%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#999988'>)*/</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:0in;text-indent:0in;line-height:107%'><b><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>class </span></b><b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#445588'>OfferBiddingFormBlock
  </span></b><b><span style='font-size:11.0pt;line-height:107%;font-family:
  Consolas;color:#333333'>extends </span></b><b><span style='font-size:11.0pt;
  line-height:107%;font-family:Consolas;color:#445588'>BlockBase </span></b><b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>implements</span></b></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:15.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><b><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#445588'>ContainerFactoryPluginInterface
  </span></b><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#333333'>{</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>/**</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>@var
  </span></i><i><span style='font-size:11.0pt;line-height:107%;font-family:
  Consolas;color:#999988'>$account \Drupal\Core\Session\AccountProxyInterface</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:318.85pt;margin-bottom:
  14.2pt;margin-left:6.05pt;text-indent:6.05pt;line-height:121%'><i><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#999988'>*/
  </span></i><b><span style='font-size:11.0pt;line-height:121%;font-family:
  Consolas;color:#333333'>protected </span></b><span style='font-size:11.0pt;
  line-height:121%;font-family:Consolas;color:#333333'>$account;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>/**</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>The
  request object.</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>@var
  </span></i><i><span style='font-size:11.0pt;line-height:107%;font-family:
  Consolas;color:#999988'>\Symfony\Component\HttpFoundation\RequestStack</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:288.65pt;margin-bottom:
  14.2pt;margin-left:6.05pt;text-indent:6.05pt;line-height:121%'><i><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#999988'>*/
  </span></i><b><span style='font-size:11.0pt;line-height:121%;font-family:
  Consolas;color:#333333'>protected </span></b><span style='font-size:11.0pt;
  line-height:121%;font-family:Consolas;color:#333333'>$requestStack;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>/**</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>The
  entity storage.</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>@var
  </span></i><i><span style='font-size:11.0pt;line-height:107%;font-family:
  Consolas;color:#999988'>\Drupal\Core\Entity\EntityStorageInterface</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:282.6pt;margin-bottom:
  14.2pt;margin-left:6.05pt;text-indent:6.05pt;line-height:121%'><i><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#999988'>*/
  </span></i><b><span style='font-size:11.0pt;line-height:121%;font-family:
  Consolas;color:#333333'>protected </span></b><span style='font-size:11.0pt;
  line-height:121%;font-family:Consolas;color:#333333'>$entityStorage;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>/**</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>Constructs
  a new OfferBiddingBlock instance.</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>@param
  </span></i><i><span style='font-size:11.0pt;line-height:107%;font-family:
  Consolas;color:#999988'>string $plugin_id</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>The
  plugin_id for the plugin instance.</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>@param
  </span></i><i><span style='font-size:11.0pt;line-height:107%;font-family:
  Consolas;color:#999988'>mixed $plugin_definition</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>The
  plugin implementation definition.</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.8pt;
  margin-left:12.1pt;text-indent:0in;line-height:115%'><span style='font-size:
  11.0pt;line-height:115%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#DD1144'>@param
  </span></i><i><span style='font-size:11.0pt;line-height:115%;font-family:
  Consolas;color:#999988'>\Symfony\Component\HttpFoundation\RequestStack
  $request_stack *   The request stack object.</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:12.1pt;text-indent:0in;line-height:115%'><span style='font-size:
  11.0pt;line-height:115%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#DD1144'>@param
  </span></i><i><span style='font-size:11.0pt;line-height:115%;font-family:
  Consolas;color:#999988'>\Drupal\Core\Entity\EntityStorageInterface
  $entity_storage *   The entity storage.</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:65.05pt;margin-bottom:
  0in;margin-left:6.05pt;text-indent:6.05pt;line-height:121%'><i><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#999988'>*/
  </span></i><b><span style='font-size:11.0pt;line-height:121%;font-family:
  Consolas;color:#333333'>public function </span></b><b><span style='font-size:
  11.0pt;line-height:121%;font-family:Consolas;color:#990000'>__construct</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>(array
  $configuration, $plugin_id,</span></p>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$plugin_definition,
  RequestStack $request_stack, EntityStorageInterface</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.55pt;margin-bottom:0in;
margin-left:-1.0in;text-indent:0in;line-height:107%'>&nbsp;</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:685.5pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
  height:685.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:14.2pt;
  margin-left:18.15pt;text-indent:-18.15pt;line-height:121%'><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>$entity_storage,
  AccountProxyInterface $account) { <b>parent</b>::__construct($configuration,
  $plugin_id, $plugin_definition);</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$this</span></b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>-&gt;requestStack
  = $request_stack;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$this</span></b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>-&gt;entityStorage
  = $entity_storage;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$this</span></b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>-&gt;account
  = $account;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:15.95pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>/**</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*
  {</span></i><i><span style='font-size:11.0pt;line-height:107%;font-family:
  Consolas;color:#DD1144'>@inheritdoc</span></i><i><span style='font-size:11.0pt;
  line-height:107%;font-family:Consolas;color:#999988'>}</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:34.8pt;margin-bottom:
  0in;margin-left:6.05pt;text-indent:6.05pt;line-height:121%'><i><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#999988'>*/
  </span></i><b><span style='font-size:11.0pt;line-height:121%;font-family:
  Consolas;color:#333333'>public static function </span></b><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>create</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>(ContainerInterface
  $container, array</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:107.35pt;margin-bottom:
  0in;margin-left:18.15pt;text-indent:-18.15pt;line-height:121%'><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>$configuration,
  $plugin_id, $plugin_definition) { <b>return new static</b>(</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:30.2pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$configuration,</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:30.2pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$plugin_id,</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:30.2pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$plugin_definition,</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:30.2pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$container-&gt;get(</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'request_stack'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>),</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:30.2pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$container-&gt;get(</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'entity_type.manager'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>)-&gt;getStorage(</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'offer'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>),</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:210.1pt;margin-bottom:
  0in;margin-left:18.15pt;text-indent:12.1pt;line-height:115%'><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>$container-&gt;get(</span><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#DD1144'>'current_user'</span><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>)
  );</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:15.95pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>/**</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*
  {</span></i><i><span style='font-size:11.0pt;line-height:107%;font-family:
  Consolas;color:#DD1144'>@inheritdoc</span></i><i><span style='font-size:11.0pt;
  line-height:107%;font-family:Consolas;color:#999988'>}</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:282.6pt;margin-bottom:
  0in;margin-left:6.05pt;text-indent:6.05pt;line-height:121%'><i><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#999988'>*/
  </span></i><b><span style='font-size:11.0pt;line-height:121%;font-family:
  Consolas;color:#333333'>public function </span></b><b><span style='font-size:
  11.0pt;line-height:121%;font-family:Consolas;color:#990000'>build</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>()
  {</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>//
  Make sure this is an offer page</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:34.8pt;margin-bottom:
  0in;margin-left:18.15pt;text-indent:0in;line-height:118%'><span
  style='font-size:11.0pt;line-height:118%;font-family:Consolas;color:#333333'>$offer
  = <b>$this</b>-&gt;requestStack-&gt;getCurrentRequest()-&gt;get(</span><span
  style='font-size:11.0pt;line-height:118%;font-family:Consolas;color:#DD1144'>'offer'</span><span
  style='font-size:11.0pt;line-height:118%;font-family:Consolas;color:#333333'>);
  <b>if</b>(!$offer) { <b>return null</b>;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:83.15pt;margin-bottom:
  0in;margin-left:18.15pt;text-indent:0in;line-height:121%'><i><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#999988'>//
  Make sure the current user is not owner of the offer </span></i><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>if</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>(<b>$this</b>-&gt;account-&gt;id()
  == $offer-&gt;getOwnerId()) { <b>return null</b>;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:15.95pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$form =</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>\Drupal::formBuilder()-&gt;getForm(</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'\Drupal\offer\Form\OfferBiddingForm'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>,</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:343.05pt;margin-bottom:
  0in;margin-left:18.15pt;text-indent:-18.15pt;line-height:121%'><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>$offer);
  <b>return </b>$form;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:15.95pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>/**</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*
  A form for authenticated users never gets cached.</span></i></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:155.2pt;margin-bottom:
.95pt;margin-left:11.3pt;text-indent:6.05pt;line-height:110%;background:#F8F8F8'><i><span
style='font-size:11.0pt;line-height:110%;font-family:Consolas;color:#999988'>*/
</span></i><b><span style='font-size:11.0pt;line-height:110%;font-family:Consolas;
color:#333333'>public function </span></b><b><span style='font-size:11.0pt;
line-height:110%;font-family:Consolas;color:#990000'>getCacheMaxAge</span></b><span
style='font-size:11.0pt;line-height:110%;font-family:Consolas;color:#333333'>()
{</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:155.2pt;margin-bottom:
.95pt;margin-left:11.8pt;line-height:110%;background:#F8F8F8'><b><span
style='font-size:11.0pt;line-height:110%;font-family:Consolas;color:#333333'>return
</span></b><span style='font-size:11.0pt;line-height:110%;font-family:Consolas;
color:teal'>0</span><span style='font-size:11.0pt;line-height:110%;font-family:
Consolas;color:#333333'>;</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:155.2pt;margin-bottom:
15.55pt;margin-left:11.8pt;line-height:111%;background:#F8F8F8'><span
style='font-size:11.0pt;line-height:111%;font-family:Consolas;color:#333333'>}</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:155.2pt;margin-bottom:
25.5pt;margin-left:11.8pt;line-height:111%;background:#F8F8F8'><span
style='font-size:11.0pt;line-height:111%;font-family:Consolas;color:#333333'>}</span></p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:304.5pt'>
  <td width=601 style='width:450.75pt;background:#FFD966;padding:0in 5.75pt 0in 14.25pt;
  height:304.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:8.7pt;margin-bottom:
  0in;margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%'>A lot happens here. This is actually the best
  practice way to get the current entity loaded in your block. A fine piece of
  Object oriented programming. The more you dive in it, the more comfortable
  you will be with it. One advantage of it is that via the <i>create(),
  construct() </i>and <i>build() </i>methods you will receive objects from
  memory and not need to load again objects with some direct functions like:</span></p>
  <table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=563
   style='width:422.25pt;border-collapse:collapse'>
   <tr style='height:40.5pt'>
    <td width=563 style='width:422.25pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
    height:40.5pt'>
    <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:
    .95pt;margin-left:0in;text-indent:0in;line-height:107%'><span
    style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$offerId
    = \Drupal::routeMatch()-&gt;getParameter(</span><span style='font-size:
    11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'offer'</span><span
    style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>);</span></p>
    <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
    style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$offer
    = Offer::load($offerId);</span></p>
    </td>
   </tr>
  </table>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%'>We pass the full offer entity
  object as a parameter to the form, it gets picked up by our <i>buildForm </i>method
  inside this piece:</span></p>
  <table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=563
   style='width:422.25pt;border-collapse:collapse'>
   <tr style='height:40.5pt'>
    <td width=563 style='width:422.25pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
    height:40.5pt'>
    <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:
    1.8pt;margin-left:0in;text-indent:0in;line-height:107%'><b><span
    style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>public
    function </span></b><b><span style='font-size:11.0pt;line-height:107%;
    font-family:Consolas;color:#990000'>buildForm</span></b><span
    style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>(array
    $form, FormStateInterface</span></p>
    <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
    style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$form_state,
    <b><u>$offer = NULL</u></b>)</span></p>
    </td>
   </tr>
  </table>
  <p class=MsoNormal style='margin-top:0in;margin-right:8.65pt;margin-bottom:
  0in;margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%'>Also check out the <i>getCacheMaxAge() </i>which is
  set to 0. This means the block will never be cached. More about this in the </span><u><span
  style='font-size:11.0pt;line-height:107%;color:#1155CC'>chapter about caching</span></u><span
  style='font-size:11.0pt;line-height:107%'>.</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
style='font-size:11.0pt;line-height:107%'><img border=0 width=602 height=244
src="Learning%20drupal%209%20as%20a%20framework_files/image088.gif"></span></p>

<p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
style='font-size:11.0pt;line-height:107%'><img border=0 width=602 height=634
src="Learning%20drupal%209%20as%20a%20framework_files/image089.gif"></span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:-1.7pt;margin-bottom:
24.25pt;margin-left:0in;text-indent:0in;line-height:107%'><span
style='font-size:11.0pt;line-height:107%'><img border=0 width=604 height=806
src="Learning%20drupal%209%20as%20a%20framework_files/image090.gif"></span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>Looks good!</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=600
 style='width:6.25in;border-collapse:collapse'>
 <tr style='height:55.5pt'>
  <td width=59 valign=top style='width:44.25pt;background:#E2E3E5;padding:14.6pt 5.75pt 0in 0in;
  height:55.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:14.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%'>&#128187;</span></p>
  </td>
  <td width=541 style='width:405.75pt;background:#E2E3E5;padding:14.6pt 5.75pt 0in 0in;
  height:55.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:6.1pt;margin-bottom:
  0in;margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%'>Of course you are not able to place a bid on your
  own offers. Make sure you test it on an offer of a different user.</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:.95pt;
margin-left:-.25pt'>Remember from the <u><span style='color:#1155CC'>adding
fields chapter </span></u>there were two options in <i>field_offer_type</i>:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:.95pt;
margin-left:.5in;text-indent:-.25in'><span style='font-family:"Arial",sans-serif'>&#9679;<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span>with_minimum|Set
minimum price</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:.5in;text-indent:-.25in'><span style='font-family:"Arial",sans-serif'>&#9679;<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span>no_minimum|No
minimum price</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:.95pt;
margin-left:-.25pt'>We integrate it in our form in two ways:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:.95pt;
margin-left:.5in;text-indent:-.25in'><span style='font-family:"Arial",sans-serif'>&#9679;<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span>1)
If the form has a minimum price, display it.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:.5in;text-indent:-.25in'><span style='font-family:"Arial",sans-serif'>&#9679;<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span>2)
if the form has a minimum price, validate the form and check for the inputted
price</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:2.1pt;
margin-left:-.25pt'>To our <i>buildForm() </i>function we add this before
$form[‘description’]:</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:205.5pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
  height:205.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:0in;text-indent:0in;line-height:107%'><b><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>switch</span></b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>($offer-&gt;get(</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'field_offer_type'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>)-&gt;getString())
  {</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>case
  </span></b><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#DD1144'>'with_minimum'</span><span style='font-size:11.0pt;line-height:
  107%;font-family:Consolas;color:#333333'>:</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:89.2pt;margin-bottom:
  .8pt;margin-left:18.15pt;text-indent:0in;line-height:115%'><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>$price
  = $offer-&gt;get(</span><span style='font-size:11.0pt;line-height:115%;
  font-family:Consolas;color:#DD1144'>'field_price'</span><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>)-&gt;getString();
  <b>break</b>;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:306.75pt;margin-bottom:
  0in;margin-left:18.15pt;text-indent:-12.1pt;line-height:118%'><b><span
  style='font-size:11.0pt;line-height:118%;font-family:Consolas;color:#333333'>case
  </span></b><span style='font-size:11.0pt;line-height:118%;font-family:Consolas;
  color:#DD1144'>'no_minimum'</span><span style='font-size:11.0pt;line-height:
  118%;font-family:Consolas;color:#333333'>; $price = </span><span
  style='font-size:11.0pt;line-height:118%;font-family:Consolas;color:#DD1144'>'0'</span><span
  style='font-size:11.0pt;line-height:118%;font-family:Consolas;color:#333333'>;
  <b>break</b>;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:15.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$form[</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'price'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>]
  = [</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'#markup' </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>=&gt;
  </span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#DD1144'>'&lt;h2&gt;' </span><span style='font-size:11.0pt;line-height:
  107%;font-family:Consolas;color:#333333'>. <b>$this</b>-&gt;t(</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'Start
  bidding at @price$'</span><span style='font-size:11.0pt;line-height:107%;
  font-family:Consolas;color:#333333'>, [</span><span style='font-size:11.0pt;
  line-height:107%;font-family:Consolas;color:#DD1144'>'@price' </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>=&gt;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$price]) . </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'&lt;/h2&gt;'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>,</span></p>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>];</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:-1.7pt;margin-bottom:
24.25pt;margin-left:1.5pt;text-indent:0in;line-height:107%'><img border=0
width=602 height=320 id="Picture 12890"
src="Learning%20drupal%209%20as%20a%20framework_files/image091.jpg"></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:2.1pt;
margin-left:-.25pt'>Now we extend the bid textfield with two HTML5 attributes,
for a minimum price and for a numeric field. This will offer front-end
validation in the browser.</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:370.5pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
  height:370.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:89.2pt;margin-bottom:
  0in;margin-left:12.1pt;text-indent:-12.1pt;line-height:121%'><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>switch</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>($offer-&gt;get(</span><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#DD1144'>'field_offer_type'</span><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>)-&gt;getString())
  { <b>case </b></span><span style='font-size:11.0pt;line-height:121%;
  font-family:Consolas;color:#DD1144'>'with_minimum'</span><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>:</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:83.15pt;margin-bottom:
  .8pt;margin-left:24.15pt;text-indent:0in;line-height:115%'><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>$price
  = $offer-&gt;get(</span><span style='font-size:11.0pt;line-height:115%;
  font-family:Consolas;color:#DD1144'>'field_price'</span><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>)-&gt;getString();
  <b>break</b>;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:300.75pt;margin-bottom:
  0in;margin-left:24.2pt;text-indent:-12.1pt;line-height:118%'><b><span
  style='font-size:11.0pt;line-height:118%;font-family:Consolas;color:#333333'>case
  </span></b><span style='font-size:11.0pt;line-height:118%;font-family:Consolas;
  color:#DD1144'>'no_minimum'</span><span style='font-size:11.0pt;line-height:
  118%;font-family:Consolas;color:#333333'>; $price = </span><span
  style='font-size:11.0pt;line-height:118%;font-family:Consolas;color:#DD1144'>'0'</span><span
  style='font-size:11.0pt;line-height:118%;font-family:Consolas;color:#333333'>;
  <b>break</b>;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:15.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$form[</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'price'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>]
  = [</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'#children' </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>=&gt;
  </span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#DD1144'>'&lt;h2&gt;' </span><span style='font-size:11.0pt;line-height:
  107%;font-family:Consolas;color:#333333'>. <b>$this</b>-&gt;t(</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'Start
  bidding at @price$'</span><span style='font-size:11.0pt;line-height:107%;
  font-family:Consolas;color:#333333'>, [</span><span style='font-size:11.0pt;
  line-height:107%;font-family:Consolas;color:#DD1144'>'@price'</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>=&gt; $price]) . </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'&lt;/h2&gt;'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>,</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:15.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>];</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$form[</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'bid'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>]
  = [</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'#type' </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>=&gt;
  </span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#DD1144'>'textfield'</span><span style='font-size:11.0pt;line-height:
  107%;font-family:Consolas;color:#333333'>,</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'#attributes' </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>=&gt;
  [</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:24.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>' type' </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>=&gt;
  </span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#DD1144'>'number'</span><span style='font-size:11.0pt;line-height:107%;
  font-family:Consolas;color:#333333'>, </span><i><span style='font-size:11.0pt;
  line-height:107%;font-family:Consolas;color:#999988'>// note the space before
  attribute key</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:24.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>' min' </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>=&gt;
  $price</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>],</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'#title' </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>=&gt;
  <b>$this</b>-&gt;t(</span><span style='font-size:11.0pt;line-height:107%;
  font-family:Consolas;color:#DD1144'>'Your bid'</span><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>),</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'#description' </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>=&gt;
  <b>$this</b>-&gt;t(</span><span style='font-size:11.0pt;line-height:107%;
  font-family:Consolas;color:#DD1144'>'Prices in $.'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>),</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'#required' </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>=&gt;
  <b>TRUE</b>,</span></p>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>];</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:2.1pt;
margin-left:-.25pt'>Be careful. Front-end validation is not enough. We validate
the input on server-side as well with the ValidateForm() method. For now we’ll
validate for integers. Further along we’ll check to make sure the bid exceeds
the highest bid so far.:</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:175.5pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
  height:175.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><b><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>public function </span></b><b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#990000'>validateForm</span></b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>(array
  &amp;$form, FormStateInterface</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:185.9pt;margin-bottom:
  15.0pt;margin-left:6.05pt;text-indent:-6.05pt;line-height:115%'><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>$form_state)
  { <b>parent</b>::validateForm($form, $form_state);</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:143.6pt;margin-bottom:
  0in;margin-left:6.05pt;text-indent:0in;line-height:121%'><i><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#999988'>//
  Server side validation for numeric </span></i><b><span style='font-size:11.0pt;
  line-height:121%;font-family:Consolas;color:#333333'>if </span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>(!is_numeric($form_state-&gt;getValue(</span><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#DD1144'>'bid'</span><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>)))
  {</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:65.05pt;margin-bottom:
  15.0pt;margin-left:0in;text-indent:18.15pt;line-height:115%'><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>$form_state-&gt;setErrorByName(</span><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#DD1144'>'bid'</span><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>,
  t(</span><span style='font-size:11.0pt;line-height:115%;font-family:Consolas;
  color:#DD1144'>'Bid input needs to be numeric.'</span><span style='font-size:
  11.0pt;line-height:115%;font-family:Consolas;color:#333333'>)); }</span></p>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:21.7pt;
margin-left:-.25pt'>We need to submit the form in the <i>submitForm() </i>method.
For now, we just submit without saving anything. In a further chapter,  we’ll
save the bid.</p>

<h2 style='margin-top:0in;margin-right:0in;margin-bottom:3.55pt;margin-left:
-.25pt'><a name="_Toc247064">Adding site-wide css and javascript</a></h2>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=600
 style='width:6.25in;border-collapse:collapse'>
 <tr style='height:69.0pt'>
  <td width=59 valign=top style='width:44.25pt;background:#6D9EEB;padding:14.6pt 5.75pt 0in 0in;
  height:69.0pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:14.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%'>&#128073;</span></p>
  </td>
  <td width=541 style='width:405.75pt;background:#6D9EEB;padding:14.6pt 5.75pt 0in 0in;
  height:69.0pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:10.45pt;margin-bottom:
  0in;margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%'>In this chapter you will learn how to add <b>libraries
  </b>containing css and load it on all pages At the end you will have
  discovered how to apply <b>global styling </b>to your project.</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:2.1pt;
margin-left:-.25pt'>While in this course we will not focus (at all) on drupal
theming we need to define a css file that gets used site-wide in order to do
some small tweaks to make the bidding page look good. In order to add css or
javascript to pages we need to define libraries. We will define this inside <b>custom/offer/offer.libraries.yml</b>:</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:70.5pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
  height:70.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:361.15pt;margin-bottom:
  0in;margin-left:6.05pt;text-indent:-6.05pt;line-height:115%'><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>platform:
  css:</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>theme:</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:30.2pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>css/platform.css:
  {}</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:.1pt;
margin-left:-.25pt'>Now we need to tell the system <i>when </i>to include the
library. There are ways to add them specifically to:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:.5in;text-indent:-.25in'><span style='font-size:11.0pt;line-height:
112%;font-family:"Arial",sans-serif'>&#9679;<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;
</span></span>Controllers</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:.4pt;
margin-left:.5in;text-indent:-.25in'><span style='font-size:11.0pt;line-height:
112%;font-family:"Arial",sans-serif'>&#9679;<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;
</span></span>Forms</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:.4pt;
margin-left:.5in;text-indent:-.25in'><span style='font-size:11.0pt;line-height:
112%;font-family:"Arial",sans-serif'>&#9679;<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;
</span></span>Blocks</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:.5in;text-indent:-.25in'><span style='font-size:11.0pt;line-height:
112%;font-family:"Arial",sans-serif'>&#9679;<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;
</span></span>Views</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:2.1pt;
margin-left:-.25pt'>But in this case, we always want it. For this we can use <i>hook_page_attachments()
</i>in <b>custom/offer/offer.module</b>:</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:100.5pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 76.85pt 0in 5.25pt;
  height:100.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><i><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>/**</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><i><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>* Implements
  hook_page_attachments().</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:42.3pt;margin-bottom:
  0in;margin-left:0in;text-indent:0in;line-height:121%'><i><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#999988'>*/
  </span></i><b><span style='font-size:11.0pt;line-height:121%;font-family:
  Consolas;color:#333333'>function </span></b><b><span style='font-size:11.0pt;
  line-height:121%;font-family:Consolas;color:#990000'>offer_page_attachments</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>(array
  &amp;$attachments) {</span></p>
  <p class=MsoNormal style='margin:0in;text-align:justify;text-justify:inter-ideograph;
  text-indent:18.15pt;line-height:107%'><span style='font-size:11.0pt;
  line-height:107%;font-family:Consolas;color:#333333'>$attachments[</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'#attached'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>][</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'library'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>][]
  = </span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#DD1144'>'offer/platform'</span><span style='font-size:11.0pt;
  line-height:107%;font-family:Consolas;color:#333333'>; }</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:2.1pt;
margin-left:-.25pt'>Below this, we add an extra body class to the offer detail
page using <i>hook_preprocess_html</i>:</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:145.5pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
  height:145.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:0in;text-indent:0in;line-height:107%'><i><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>/**</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*
  Add a &quot;offer-detail-page&quot; class to the body on a offer detail page</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:167.8pt;margin-bottom:
  0in;margin-left:0in;text-indent:6.05pt;line-height:121%'><i><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#999988'>*/
  </span></i><b><span style='font-size:11.0pt;line-height:121%;font-family:
  Consolas;color:#333333'>function </span></b><b><span style='font-size:11.0pt;
  line-height:121%;font-family:Consolas;color:#990000'>offer_preprocess_html</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>(&amp;$variables)
  {</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:40.85pt;margin-bottom:
  .8pt;margin-left:12.1pt;text-indent:0in;line-height:115%'><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>$offer
  = \Drupal::routeMatch()-&gt;getParameter(</span><span style='font-size:11.0pt;
  line-height:115%;font-family:Consolas;color:#DD1144'>'offer'</span><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>);
  <b>if</b>($offer) {</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:24.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$variables[</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'attributes'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>][</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'class'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>][]
  = </span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#DD1144'>'offer-detail-page'</span><span style='font-size:11.0pt;
  line-height:107%;font-family:Consolas;color:#333333'>;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.35pt;
margin-left:-.25pt;line-height:110%'>We add <b>custom/offer/css/platform.css</b>:</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:130.5pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
  height:130.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:167.8pt;margin-bottom:
  0in;margin-left:6.05pt;text-indent:-6.05pt;line-height:118%'><b><span
  style='font-size:11.0pt;line-height:118%;font-family:Consolas;color:#333333'>.offer-detail-page
  </span></b><span style='font-size:11.0pt;line-height:118%;font-family:Consolas;
  color:#333333'>.block-system-main-block { </span><span style='font-size:11.0pt;
  line-height:118%;font-family:Consolas;color:navy'>width</span><span
  style='font-size:11.0pt;line-height:118%;font-family:Consolas;color:#333333'>:
  </span><span style='font-size:11.0pt;line-height:118%;font-family:Consolas;
  color:teal'>55%</span><span style='font-size:11.0pt;line-height:118%;
  font-family:Consolas;color:#333333'>; </span><span style='font-size:11.0pt;
  line-height:118%;font-family:Consolas;color:navy'>float</span><span
  style='font-size:11.0pt;line-height:118%;font-family:Consolas;color:#333333'>:left;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:216.1pt;margin-bottom:
  0in;margin-left:6.05pt;text-indent:-6.05pt;line-height:118%'><b><span
  style='font-size:11.0pt;line-height:118%;font-family:Consolas;color:#333333'>.offer-detail-page
  </span></b><b><span style='font-size:11.0pt;line-height:118%;font-family:
  Consolas;color:#990000'>#block-bid-block </span></b><span style='font-size:
  11.0pt;line-height:118%;font-family:Consolas;color:#333333'>{ </span><span
  style='font-size:11.0pt;line-height:118%;font-family:Consolas;color:navy'>width</span><span
  style='font-size:11.0pt;line-height:118%;font-family:Consolas;color:#333333'>:
  </span><span style='font-size:11.0pt;line-height:118%;font-family:Consolas;
  color:teal'>30%</span><span style='font-size:11.0pt;line-height:118%;
  font-family:Consolas;color:#333333'>; </span><span style='font-size:11.0pt;
  line-height:118%;font-family:Consolas;color:navy'>float</span><span
  style='font-size:11.0pt;line-height:118%;font-family:Consolas;color:#333333'>:right;</span></p>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>Clear caches, and you’ll see the blocks showing more nicely
next to each other.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:19.0pt;
margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:11.0pt;
line-height:107%'><img border=0 width=600 height=358
src="Learning%20drupal%209%20as%20a%20framework_files/image092.gif"></span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:.05in;
margin-left:-.25pt'>This puts the bidding block next to the offer:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:-1.7pt;margin-bottom:
24.25pt;margin-left:1.5pt;text-indent:0in;line-height:107%'><img border=0
width=602 height=317 id="Picture 13184"
src="Learning%20drupal%209%20as%20a%20framework_files/image093.jpg"></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:21.9pt;
margin-left:-.25pt'>Add some extra css in <b>platform.css </b>for the menus:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:35.0pt;margin-bottom:
2.05pt;margin-left:8.3pt;line-height:107%;background:#F8F8F8'><i><span
style='font-family:Consolas;color:#999988'>/** Main menu + user menu **/</span></i></p>

<p class=MsoNormal style='margin-top:0in;margin-right:35.0pt;margin-bottom:
23.05pt;margin-left:.2in;text-indent:-6.6pt;line-height:112%;background:#F8F8F8'><span
style='font-family:Consolas;color:#333333'>.navigation.menu--main <b>ul</b>,
.navigation.menu--account <b>ul </b>{ </span><span style='font-family:Consolas;
color:navy'>list-style</span><span style='font-family:Consolas;color:#333333'>:none;
</span><span style='font-family:Consolas;color:navy'>height</span><span
style='font-family:Consolas;color:#333333'>: </span><span style='font-family:
Consolas;color:teal'>50px</span><span style='font-family:Consolas;color:#333333'>;</span></p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:621.0pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
  height:621.0pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:182.45pt;margin-bottom:
  0in;margin-left:6.6pt;text-indent:-6.6pt;line-height:116%'><span
  style='font-family:Consolas;color:#333333'>.navigation.menu--account { </span><span
  style='font-family:Consolas;color:navy'>float</span><span style='font-family:
  Consolas;color:#333333'>:right;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:2.9in;margin-bottom:
  0in;margin-left:6.6pt;text-indent:-6.6pt;line-height:116%'><span
  style='font-family:Consolas;color:#333333'>.navigation.menu--main { </span><span
  style='font-family:Consolas;color:navy'>float</span><span style='font-family:
  Consolas;color:#333333'>:left;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.1pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:24.1pt;margin-bottom:
  0in;margin-left:6.6pt;text-indent:-6.6pt;line-height:116%'><span
  style='font-family:Consolas;color:#333333'>.navigation.menu--main <b>ul li</b>,
  .navigation.menu--account <b>ul li </b>{ </span><span style='font-family:
  Consolas;color:navy'>float</span><span style='font-family:Consolas;
  color:#333333'>:left; </span><span style='font-family:Consolas;color:navy'>list-style</span><span
  style='font-family:Consolas;color:#333333'>:none;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.1pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:6.6pt;text-indent:-6.6pt;line-height:122%'><span
  style='font-family:Consolas;color:#333333'>.navigation.menu--main .menu,
  .navigation.menu--account .menu { </span><span style='font-family:Consolas;
  color:navy'>margin</span><span style='font-family:Consolas;color:#333333'>: </span><span
  style='font-family:Consolas;color:teal'>0</span><span style='font-family:
  Consolas;color:#333333'>;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.1pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>.navigation.menu--main <b>ul li a</b>,
  .navigation.menu--account <b>ul li a</b></span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:294.6pt;margin-bottom:
  0in;margin-left:6.6pt;text-indent:-6.6pt;line-height:121%'><span
  style='font-family:Consolas;color:#333333'>{ </span><span style='font-family:
  Consolas;color:navy'>color</span><span style='font-family:Consolas;
  color:#333333'>: </span><span style='font-family:Consolas;color:teal'>#0444C4</span><span
  style='font-family:Consolas;color:#333333'>; </span><span style='font-family:
  Consolas;color:navy'>padding</span><span style='font-family:Consolas;
  color:#333333'>: </span><span style='font-family:Consolas;color:teal'>20px</span><span
  style='font-family:Consolas;color:#333333'>; </span><span style='font-family:
  Consolas;color:navy'>text-decoration</span><span style='font-family:Consolas;
  color:#333333'>:none; </span><span style='font-family:Consolas;color:navy'>font-size</span><span
  style='font-family:Consolas;color:#333333'>: </span><span style='font-family:
  Consolas;color:teal'>0.8125rem</span><span style='font-family:Consolas;
  color:#333333'>;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.1pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:4.3pt;margin-bottom:
  0in;margin-left:0in;text-indent:0in;line-height:122%'><span style='font-family:
  Consolas;color:#333333'>.navigation.menu--main <b>ul li a</b>.is-active,
  .navigation.menu--main <b>ul li a</b>:hover, .navigation.menu--account <b>ul
  li a</b>.is-active,</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:169.25pt;margin-bottom:
  0in;margin-left:6.6pt;text-indent:-6.6pt;line-height:119%'><span
  style='font-family:Consolas;color:#333333'>.navigation.menu--account <b>ul li
  a</b>:hover { </span><span style='font-family:Consolas;color:navy'>background</span><span
  style='font-family:Consolas;color:#333333'>: </span><span style='font-family:
  Consolas;color:teal'>#E5EDFD</span><span style='font-family:Consolas;
  color:#333333'>; </span><span style='font-family:Consolas;color:navy'>color</span><span
  style='font-family:Consolas;color:#333333'>:black;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:0in;text-indent:0in;line-height:107%'><i><span style='font-family:
  Consolas;color:#999988'>/** breadcrumbs **/</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:228.6pt;margin-bottom:
  0in;margin-left:6.6pt;text-indent:-6.6pt;line-height:116%'><span
  style='font-family:Consolas;color:#333333'>.block-system-breadcrumb-block { </span><span
  style='font-family:Consolas;color:navy'>clear</span><span style='font-family:
  Consolas;color:#333333'>:both; margin-left: min(5vw,48px); margin-right:
  min(5vw,48px);</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:307.8pt;margin-bottom:
  0in;margin-left:6.6pt;text-indent:-6.6pt;line-height:119%'><span
  style='font-family:Consolas;color:#333333'>.count-badge { </span><span
  style='font-family:Consolas;color:navy'>color</span><span style='font-family:
  Consolas;color:#333333'>: red; </span><span style='font-family:Consolas;
  color:navy'>font-weight</span><span style='font-family:Consolas;color:#333333'>:
  </span><span style='font-family:Consolas;color:teal'>600</span><span
  style='font-family:Consolas;color:#333333'>;</span></p>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-family:Consolas;color:#333333'>}</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:0in;
margin-left:-.25pt'>We now have a more attractive menu system.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:-1.7pt;margin-bottom:
38.3pt;margin-left:1.5pt;text-indent:0in;line-height:107%'><img border=0
width=602 height=241 id="Picture 13408"
src="Learning%20drupal%209%20as%20a%20framework_files/image094.jpg"></p>

<p class=MsoNormal style='margin-top:0in;margin-right:15.1pt;margin-bottom:
15.75pt;margin-left:14.0pt;line-height:110%;background:#FFD966'><span
style='font-size:11.0pt;line-height:110%'>Note again that for professional
platforms we would do a more advanced theming (tailwind, bootstrap, …), with a
primary focus on mobile experience. But this is not the purpose of this course.</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:15.1pt;margin-bottom:
53.75pt;margin-left:14.0pt;line-height:110%;background:#FFD966'><span
style='font-size:11.0pt;line-height:110%'>For more about libraries, visit </span><a
href="https://www.drupal.org/docs/creating-custom-modules/adding-stylesheets-css-and-javascript-js-to-a-drupal-module"><span
style='font-size:11.0pt;line-height:110%;color:#1155CC'>this page on drupal.org</span></a><span
style='font-size:11.0pt;line-height:110%'>.</span></p>

<h2 style='margin-left:-.25pt'><a name="_Toc247065">Adding a code-only bid
entity</a></h2>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=600
 style='width:6.25in;border-collapse:collapse'>
 <tr style='height:69.0pt'>
  <td width=59 valign=top style='width:44.25pt;background:#6D9EEB;padding:14.6pt 5.75pt 0in 0in;
  height:69.0pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:14.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%'>&#128073;</span></p>
  </td>
  <td width=541 style='width:405.75pt;background:#6D9EEB;padding:14.6pt 5.75pt 0in 0in;
  height:69.0pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:4.15pt;margin-bottom:
  0in;margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%'>This chapter teaches you how to <b>define an entity </b>that
  will only live in our database and is <b>not visible in our UI</b>. After
  this chapter you will be able to create custom entities with fields like
  entity reference.</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:.85pt;
margin-left:-.25pt'>For storing our bids, we need a second entity which will
have a minimum of code. We start a new module adding the following files:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:2.35pt;
margin-left:.5in;text-indent:-.25in;line-height:110%'><span style='font-family:
"Arial",sans-serif'>&#9679;<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><b>bid.info.yml</b></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.7pt;
margin-left:.5in;text-indent:-.25in;line-height:110%'><span style='font-family:
"Arial",sans-serif'>&#9679;<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><b>src/Entity/Bid.php</b></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:21.9pt;
margin-left:-.25pt;line-height:110%'>We start with <b>custom/bid/bid.info.yml:</b></p>

<p class=MsoNormal style='margin-top:0in;margin-right:191.8pt;margin-bottom:
.8pt;margin-left:5.0pt;line-height:111%;background:#F8F8F8'><span
style='font-size:11.0pt;line-height:111%;font-family:Consolas;color:#333333'>name:
</span><span style='font-size:11.0pt;line-height:111%;font-family:Consolas;
color:#DD1144'>bid </span><span style='font-size:11.0pt;line-height:111%;
font-family:Consolas;color:#333333'>type: </span><span style='font-size:11.0pt;
line-height:111%;font-family:Consolas;color:#DD1144'>module </span><span
style='font-size:11.0pt;line-height:111%;font-family:Consolas;color:#333333'>description:
</span><span style='font-size:11.0pt;line-height:111%;font-family:Consolas;
color:#DD1144'>bid entity </span><span style='font-size:11.0pt;line-height:
111%;font-family:Consolas;color:#333333'>core: </span><span style='font-size:
11.0pt;line-height:111%;font-family:Consolas;color:teal'>8.</span><span
style='font-size:11.0pt;line-height:111%;font-family:Consolas;color:#DD1144'>x</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:191.8pt;margin-bottom:
24.05pt;margin-left:5.0pt;line-height:111%;background:#F8F8F8'><span
style='font-size:11.0pt;line-height:111%;font-family:Consolas;color:#333333'>core_version_requirement:
</span><span style='font-size:11.0pt;line-height:111%;font-family:Consolas;
color:#DD1144'>^8 || ^9</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>Next, our bid entity. We’ll add the following database
fields:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:.95pt;
margin-left:.5in;text-indent:-.25in'><span style='font-family:"Arial",sans-serif'>&#9679;<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span>user_id
(entity_reference): the owner of the bid</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:.95pt;
margin-left:.5in;text-indent:-.25in'><span style='font-family:"Arial",sans-serif'>&#9679;<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span>offer_id
(entity_reference): the offer the bid is for</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:.95pt;
margin-left:.5in;text-indent:-.25in'><span style='font-family:"Arial",sans-serif'>&#9679;<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span>bid
(decimal): the amount of the bid</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:.95pt;
margin-left:.5in;text-indent:-.25in'><span style='font-family:"Arial",sans-serif'>&#9679;<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span>created
(created): the time the bid was done</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:30.65pt;
margin-left:.5in;text-indent:-.25in'><span style='font-family:"Arial",sans-serif'>&#9679;<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span>changed
(changed): the updated time of the bid</p>

<p class=MsoNormal align=right style='margin-top:0in;margin-right:18.5pt;
margin-bottom:.2pt;margin-left:7.25pt;text-align:right;line-height:110%;
background:#FFD966'><span style='font-size:11.0pt;line-height:110%'>Once again,
we include the revisioning system which allows us to show a history (e.g.</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:18.5pt;margin-bottom:
32.35pt;margin-left:7.25pt;line-height:110%;background:#FFD966'><span
style='font-size:11.0pt;line-height:110%'>“Person x has raised his bid with
4$”).</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.35pt;
margin-left:-.25pt;line-height:110%'>To <b>custom/bid/src/Entity/Bid.php</b>:</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:490.5pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
  height:490.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><b><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999999'>&lt;?php</span></b></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:0in;text-indent:0in;line-height:107%'><i><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>/**</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:6.05pt;text-indent:6.05pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>@file</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:7.9pt;
  margin-left:6.05pt;text-indent:6.05pt;line-height:176%'><span
  style='font-size:11.0pt;line-height:176%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:176%;font-family:Consolas;color:#999988'>Contains
  \Drupal\bid\Entity\bid.*/ </span></i><b><span style='font-size:11.0pt;
  line-height:176%;font-family:Consolas;color:#333333'>namespace </span></b><b><span
  style='font-size:11.0pt;line-height:176%;font-family:Consolas;color:#990000'>Drupal</span></b><span
  style='font-size:11.0pt;line-height:176%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:176%;font-family:Consolas;color:#990000'>bid</span></b><span
  style='font-size:11.0pt;line-height:176%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:176%;font-family:Consolas;color:#990000'>Entity</span></b><span
  style='font-size:11.0pt;line-height:176%;font-family:Consolas;color:#333333'>;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:137.55pt;margin-bottom:
  14.2pt;margin-left:0in;text-indent:0in;line-height:121%'><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>use
  </span></b><b><span style='font-size:11.0pt;line-height:121%;font-family:
  Consolas;color:#990000'>Drupal</span></b><span style='font-size:11.0pt;
  line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>Core</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>Entity</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>EditorialContentEntityBase</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>;
  <b>use </b></span><b><span style='font-size:11.0pt;line-height:121%;
  font-family:Consolas;color:#990000'>Drupal</span></b><span style='font-size:
  11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>Core</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>Field</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>BaseFieldDefinition</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>;
  <b>use </b></span><b><span style='font-size:11.0pt;line-height:121%;
  font-family:Consolas;color:#990000'>Drupal</span></b><span style='font-size:
  11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>Core</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>Entity</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>EntityTypeInterface</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><i><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>/**</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:6.05pt;text-indent:6.05pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>Defines
  the bid entity.</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:6.05pt;text-indent:6.05pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>@ingroup
  </span></i><i><span style='font-size:11.0pt;line-height:107%;font-family:
  Consolas;color:#999988'>bid</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:6.05pt;text-indent:6.05pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>@ContentEntityType</span></i><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>(</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:6.05pt;text-indent:6.05pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>id
  = &quot;bid&quot;,</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:6.05pt;text-indent:6.05pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>label
  = </span></i><i><span style='font-size:11.0pt;line-height:107%;font-family:
  Consolas;color:#DD1144'>@Translation</span></i><i><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>(&quot;bid&quot;),</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:6.05pt;text-indent:6.05pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>base_table
  = &quot;bid&quot;,</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:6.05pt;text-indent:6.05pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>data_table
  = &quot;bid_field_data&quot;,</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:6.05pt;text-indent:6.05pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>fieldable
  = TRUE,</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:6.05pt;text-indent:6.05pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>revision_table
  = &quot;bid_revision&quot;,</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:6.05pt;text-indent:6.05pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>revision_data_table
  = &quot;bid_field_revision&quot;,</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:6.05pt;text-indent:6.05pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>entity_keys
  = {</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:6.05pt;text-indent:6.05pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>&quot;id&quot;
  = &quot;id&quot;,</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:6.05pt;text-indent:6.05pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>&quot;uuid&quot;
  = &quot;uuid&quot;,</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:6.05pt;text-indent:6.05pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>&quot;label&quot;
  = &quot;title&quot;,</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:6.05pt;text-indent:6.05pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>&quot;owner&quot;
  = &quot;uid&quot;,</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:6.05pt;text-indent:6.05pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>&quot;revision&quot;
  = &quot;vid&quot;,</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:6.05pt;text-indent:6.05pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>&quot;published&quot;
  = &quot;status&quot;,</span></i></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.55pt;margin-bottom:0in;
margin-left:-1.0in;text-indent:0in;line-height:107%'>&nbsp;</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:685.5pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
  height:685.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:6.05pt;text-indent:3.0pt;line-height:115%'><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#999988'>&quot;uid&quot;
  = &quot;uid&quot;,*     &quot;owner&quot; = &quot;uid&quot;,</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:6.05pt;text-indent:3.0pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>},</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:6.05pt;text-indent:3.0pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>handlers
  = {</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:6.05pt;text-indent:3.0pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>&quot;access&quot;
  = &quot;Drupal\bid\BidAccessControlHandler&quot;,</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:6.05pt;text-indent:3.0pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>},</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:6.05pt;text-indent:3.0pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>revision_metadata_keys
  = {</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:6.05pt;text-indent:3.0pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>&quot;revision_user&quot;
  = &quot;revision_uid&quot;,</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:6.05pt;text-indent:3.0pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>&quot;revision_created&quot;
  = &quot;revision_timestamp&quot;,</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:6.05pt;text-indent:3.0pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>&quot;revision_log_message&quot;
  = &quot;revision_log&quot;</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:6.05pt;text-indent:3.0pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>}</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:7.9pt;
  margin-left:6.05pt;text-indent:3.0pt;line-height:176%'><span
  style='font-size:11.0pt;line-height:176%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:176%;font-family:Consolas;color:#999988'>)*/
  </span></i><b><span style='font-size:11.0pt;line-height:176%;font-family:
  Consolas;color:#333333'>class </span></b><b><span style='font-size:11.0pt;
  line-height:176%;font-family:Consolas;color:#445588'>Bid </span></b><b><span
  style='font-size:11.0pt;line-height:176%;font-family:Consolas;color:#333333'>extends
  </span></b><b><span style='font-size:11.0pt;line-height:176%;font-family:
  Consolas;color:#445588'>EditorialContentEntityBase </span></b><span
  style='font-size:11.0pt;line-height:176%;font-family:Consolas;color:#333333'>{</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>public
  static function </span></b><b><span style='font-size:11.0pt;line-height:107%;
  font-family:Consolas;color:#990000'>baseFieldDefinitions</span></b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>(EntityTypeInterface</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$entity_type) {</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:15.0pt;
  margin-left:0in;text-align:justify;text-justify:inter-ideograph;text-indent:
  24.15pt;line-height:115%'><span style='font-size:11.0pt;line-height:115%;
  font-family:Consolas;color:#333333'>$fields = <b>parent</b>::baseFieldDefinitions($entity_type);
  </span><i><span style='font-size:11.0pt;line-height:115%;font-family:Consolas;
  color:#999988'>// provides id and uuid fields</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:24.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$fields[</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'user_id'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>]
  = BaseFieldDefinition::create(</span><span style='font-size:11.0pt;
  line-height:107%;font-family:Consolas;color:#DD1144'>'entity_reference'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>)</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:36.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>-&gt;setLabel(t(</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'User'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>))</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:36.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>-&gt;setDescription(t(</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'The
  user that created the bid.'</span><span style='font-size:11.0pt;line-height:
  107%;font-family:Consolas;color:#333333'>))</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:36.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>-&gt;setSetting(</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'target_type'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>,
  </span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#DD1144'>'user'</span><span style='font-size:11.0pt;line-height:107%;
  font-family:Consolas;color:#333333'>)</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:15.95pt;
  margin-left:36.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>-&gt;setSetting(</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'handler'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>,
  </span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#DD1144'>'default'</span><span style='font-size:11.0pt;line-height:
  107%;font-family:Consolas;color:#333333'>);</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:24.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$fields[</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'offer_id'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>]
  =</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>BaseFieldDefinition::create(</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'entity_reference'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>)</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:36.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>-&gt;setLabel(t(</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'Offer'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>))</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:36.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>-&gt;setDescription(t(</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'The
  offer the bid is for.'</span><span style='font-size:11.0pt;line-height:107%;
  font-family:Consolas;color:#333333'>))</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:36.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>-&gt;setSetting(</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'target_type'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>,
  </span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#DD1144'>'offer'</span><span style='font-size:11.0pt;line-height:107%;
  font-family:Consolas;color:#333333'>)</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:15.95pt;
  margin-left:36.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>-&gt;setSetting(</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'handler'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>,
  </span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#DD1144'>'default'</span><span style='font-size:11.0pt;line-height:
  107%;font-family:Consolas;color:#333333'>);</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:24.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$fields[</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'bid'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>]
  = BaseFieldDefinition::create(</span><span style='font-size:11.0pt;
  line-height:107%;font-family:Consolas;color:#DD1144'>'float'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>)</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:36.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>-&gt;setLabel(t(</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'Bid
  amount'</span><span style='font-size:11.0pt;line-height:107%;font-family:
  Consolas;color:#333333'>))</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:36.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>-&gt;setRevisionable(<b>TRUE</b>)</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:15.95pt;
  margin-left:36.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>-&gt;setDescription(t(</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'The
  bid amount in $.'</span><span style='font-size:11.0pt;line-height:107%;
  font-family:Consolas;color:#333333'>));</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:24.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$fields[</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'created'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>]
  = BaseFieldDefinition::create(</span><span style='font-size:11.0pt;
  line-height:107%;font-family:Consolas;color:#DD1144'>'created'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>)</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:36.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>-&gt;setLabel(t(</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'Created'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>))</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:15.95pt;
  margin-left:36.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>-&gt;setDescription(t(</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'The
  time that the entity was created.'</span><span style='font-size:11.0pt;
  line-height:107%;font-family:Consolas;color:#333333'>));</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:24.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$fields[</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'changed'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>]
  = BaseFieldDefinition::create(</span><span style='font-size:11.0pt;
  line-height:107%;font-family:Consolas;color:#DD1144'>'changed'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>)</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:36.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>-&gt;setLabel(t(</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'Changed'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>))</span></p>
  </td>
 </tr>
 <tr style='height:310.5pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
  height:310.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:16.8pt;
  margin-left:36.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>-&gt;setDescription(t(</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'The
  time that the entity was last edited.'</span><span style='font-size:11.0pt;
  line-height:107%;font-family:Consolas;color:#333333'>));</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:24.15pt;text-indent:0in;line-height:107%'><b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>return
  </span></b><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#333333'>$fields;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:15.95pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>/**</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:30.25pt;text-indent:-12.1pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>{</span></i><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>@inheritdoc</span></i><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>}</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:191.95pt;margin-bottom:
  0in;margin-left:12.1pt;text-indent:6.05pt;line-height:121%'><i><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#999988'>*/
  </span></i><b><span style='font-size:11.0pt;line-height:121%;font-family:
  Consolas;color:#333333'>public function </span></b><b><span style='font-size:
  11.0pt;line-height:121%;font-family:Consolas;color:#990000'>getOwner</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>()
  { <b>return $this</b>-&gt;get(</span><span style='font-size:11.0pt;
  line-height:121%;font-family:Consolas;color:#DD1144'>'user_id'</span><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>)-&gt;entity;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:15.95pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>/**</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:30.25pt;text-indent:-12.1pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>{</span></i><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>@inheritdoc</span></i><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>}</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:173.8pt;margin-bottom:
  14.45pt;margin-left:12.1pt;text-indent:6.05pt;line-height:119%'><i><span
  style='font-size:11.0pt;line-height:119%;font-family:Consolas;color:#999988'>*/
  </span></i><b><span style='font-size:11.0pt;line-height:119%;font-family:
  Consolas;color:#333333'>public function </span></b><b><span style='font-size:
  11.0pt;line-height:119%;font-family:Consolas;color:#990000'>getOwnerId</span></b><span
  style='font-size:11.0pt;line-height:119%;font-family:Consolas;color:#333333'>()
  { <b>return $this</b>-&gt;get(</span><span style='font-size:11.0pt;
  line-height:119%;font-family:Consolas;color:#DD1144'>'user_id'</span><span
  style='font-size:11.0pt;line-height:119%;font-family:Consolas;color:#333333'>)-&gt;target_id;
  }</span></p>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:21.9pt;
margin-left:-.25pt'>Time to enable the module.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:10.6pt;margin-bottom:
1.45pt;margin-left:8.65pt;line-height:112%;background:#F8F8F8'><span
style='font-family:Consolas;color:#333333'>bash$ drush en bid</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:10.6pt;margin-bottom:
23.05pt;margin-left:8.65pt;line-height:112%;background:#F8F8F8'><span
style='font-family:Consolas;color:#008800'>[success] </span><span
style='font-family:Consolas;color:#333333'>Successfully enabled: bid</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>When double checking our database, we see our columns
correctly created:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:24.25pt;
margin-left:1.5pt;text-indent:0in;line-height:107%'><img border=0 width=300
height=526 id="Picture 13879"
src="Learning%20drupal%209%20as%20a%20framework_files/image095.jpg"></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:21.7pt;
margin-left:-.25pt'>We’ve created our bid entity. This entity will only live in
our database. It is fully powered by the drupal entity API. But because we
don’t make it “fieldable”.</p>

<h2 style='margin-left:-.25pt'><a name="_Toc247066">Saving the bid entities on
form submission</a></h2>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=600
 style='width:6.25in;border-collapse:collapse'>
 <tr style='height:82.5pt'>
  <td width=59 valign=top style='width:44.25pt;background:#6D9EEB;padding:14.6pt 5.75pt 0in 0in;
  height:82.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:14.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%'>&#128073;</span></p>
  </td>
  <td width=541 style='width:405.75pt;background:#6D9EEB;padding:14.6pt 5.75pt 0in 0in;
  height:82.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:5.1pt;margin-bottom:
  0in;margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%'>This chapter will teach you <b>how to save custom
  entity values </b>on a <b>form submission</b>. This is a very common use case
  for saving data from a custom form. At the end you will be able to save
  values such as an entity reference and integer values to an entity that only
  lives in our database.</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>We now have everything in place to start saving the bids of
the users.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.25pt;
margin-left:-.25pt;line-height:110%'>Let’s change the <i>submitForm() </i>function
of <b>custom/offer/src/Form/OfferBidForm.php.</b></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>On top we now add:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:76.6pt;margin-bottom:
23.0pt;margin-left:5.0pt;line-height:121%;background:#F8F8F8'><b><span
style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>use
</span></b><b><span style='font-size:11.0pt;line-height:121%;font-family:Consolas;
color:#990000'>Drupal</span></b><span style='font-size:11.0pt;line-height:121%;
font-family:Consolas;color:#333333'>\</span><b><span style='font-size:11.0pt;
line-height:121%;font-family:Consolas;color:#990000'>bid</span></b><span
style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>Entity</span></b><span
style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>Bid</span></b><span
style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>;</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:20.65pt;
margin-left:-.25pt'>One thing we’ll need for saving the bid is the current
offer id. We’ll send it along in the <i>buildForm() </i>function as a hidden
and inaccessible field:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:76.6pt;margin-bottom:
.8pt;margin-left:11.05pt;line-height:111%;background:#F8F8F8'><span
style='font-size:11.0pt;line-height:111%;font-family:Consolas;color:#333333'>$form[</span><span
style='font-size:11.0pt;line-height:111%;font-family:Consolas;color:#DD1144'>'offer_id'</span><span
style='font-size:11.0pt;line-height:111%;font-family:Consolas;color:#333333'>]
= [</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:76.6pt;margin-bottom:
1.25pt;margin-left:11.05pt;line-height:111%;background:#F8F8F8'><span
style='font-size:11.0pt;line-height:111%;font-family:Consolas;color:#DD1144'>'#type'
</span><span style='font-size:11.0pt;line-height:111%;font-family:Consolas;
color:#333333'>=&gt; </span><span style='font-size:11.0pt;line-height:111%;
font-family:Consolas;color:#DD1144'>'hidden'</span><span style='font-size:11.0pt;
line-height:111%;font-family:Consolas;color:#333333'>,</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:76.6pt;margin-bottom:
.8pt;margin-left:11.05pt;line-height:111%;background:#F8F8F8'><span
style='font-size:11.0pt;line-height:111%;font-family:Consolas;color:#DD1144'>'#value'
</span><span style='font-size:11.0pt;line-height:111%;font-family:Consolas;
color:#333333'>=&gt; $offer-&gt;id(),</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:76.6pt;margin-bottom:
1.25pt;margin-left:11.05pt;line-height:111%;background:#F8F8F8'><span
style='font-size:11.0pt;line-height:111%;font-family:Consolas;color:#DD1144'>'#access'
</span><span style='font-size:11.0pt;line-height:111%;font-family:Consolas;
color:#333333'>=&gt; <b>FALSE</b></span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:76.6pt;margin-bottom:
24.05pt;margin-left:11.05pt;line-height:111%;background:#F8F8F8'><span
style='font-size:11.0pt;line-height:111%;font-family:Consolas;color:#333333'>];</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:0in;
margin-left:-.25pt'>In the <i>submitForm() </i>function we save the offer:</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:175.5pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 10.35pt 0in 5.25pt;
  height:175.5pt'>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:115%'><b><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>public
  function </span></b><b><span style='font-size:11.0pt;line-height:115%;
  font-family:Consolas;color:#990000'>submitForm</span></b><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>(array
  &amp;$form, FormStateInterface $form_state) {</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$bid =
  Bid::create([</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:24.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'bid' </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>=&gt;
  $form_state-&gt;getValue(</span><span style='font-size:11.0pt;line-height:
  107%;font-family:Consolas;color:#DD1144'>'bid'</span><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>),</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:24.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'user_id' </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>=&gt;
  [</span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#DD1144'>'target_id' </span><span style='font-size:11.0pt;line-height:
  107%;font-family:Consolas;color:#333333'>=&gt;
  \Drupal::currentUser()-&gt;id()],</span></p>
  <p class=MsoNormal align=center style='margin-top:0in;margin-right:0in;
  margin-bottom:.95pt;margin-left:0in;text-align:center;text-indent:0in;
  line-height:107%'><span style='font-size:11.0pt;line-height:107%;font-family:
  Consolas;color:#DD1144'>'offer_id' </span><span style='font-size:11.0pt;
  line-height:107%;font-family:Consolas;color:#333333'>=&gt; [</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'target_id'
  </span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#333333'>=&gt; $form_state-&gt;getValue(</span><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'offer_id'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>)]</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>]);</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$bid-&gt;save();</span></p>
  <p class=MsoNormal style='margin:0in;text-align:justify;text-justify:inter-ideograph;
  text-indent:12.1pt;line-height:115%'><span style='font-size:11.0pt;
  line-height:115%;font-family:Consolas;color:#333333'>\Drupal::messenger()-&gt;addMessage(<b>$this</b>-&gt;t(</span><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#DD1144'>'Your
  bid was successfully submitted.'</span><span style='font-size:11.0pt;
  line-height:115%;font-family:Consolas;color:#333333'>));</span></p>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>Time to test the bidding form.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:24.25pt;
margin-left:1.5pt;text-indent:0in;line-height:107%'><img border=0 width=549
height=432 id="Picture 14019"
src="Learning%20drupal%209%20as%20a%20framework_files/image096.jpg"></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:.05in;
margin-left:-.25pt'>After submission, we get a success message.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:-1.7pt;margin-bottom:
24.25pt;margin-left:1.5pt;text-indent:0in;line-height:107%'><img border=0
width=602 height=108 id="Picture 14021"
src="Learning%20drupal%209%20as%20a%20framework_files/image097.jpg"></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:21.85pt;
margin-left:-.25pt'>We now have successfully saved our bid to the custom
entity. But let us build in some security so our database stays clean.</p>

<h2 style='margin-top:0in;margin-right:0in;margin-bottom:3.55pt;margin-left:
-.25pt'><a name="_Toc247067">Form validation based on highest bids</a></h2>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=600
 style='width:6.25in;border-collapse:collapse'>
 <tr style='height:57.0pt'>
  <td width=59 valign=top style='width:44.25pt;background:#6D9EEB;padding:14.6pt 16.3pt 0in 0in;
  height:57.0pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:14.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%'>&#128073;</span></p>
  </td>
  <td width=541 style='width:405.75pt;background:#6D9EEB;padding:14.6pt 16.3pt 0in 0in;
  height:57.0pt'>
  <p class=MsoNormal style='margin:0in;text-align:justify;text-justify:inter-ideograph;
  text-indent:0in;line-height:107%'><span style='font-size:11.0pt;line-height:
  107%'>In this chapter we will add <b>custom methods </b></span>to our entity.
  More specifically these are functions to <b>validate input </b>on our bidding
  form server-side.</p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>There are still things left undone. The form needs to
anticipate the latest bid so now offer lower or equal than the highest bid gets
accepted.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>To <b>custom/offer/src/Entity/Offer.php </b>we add a method
for receiving the highest bids of a given offer.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:38.2pt;
margin-left:-.25pt'>On top of the file, add:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:76.6pt;margin-bottom:
23.0pt;margin-left:5.0pt;line-height:121%;background:#F8F8F8'><b><span
style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>use
</span></b><b><span style='font-size:11.0pt;line-height:121%;font-family:Consolas;
color:#990000'>Drupal</span></b><span style='font-size:11.0pt;line-height:121%;
font-family:Consolas;color:#333333'>\</span><b><span style='font-size:11.0pt;
line-height:121%;font-family:Consolas;color:#990000'>bid</span></b><span
style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>Entity</span></b><span
style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>Bid</span></b><span
style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>;</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:2.1pt;
margin-left:-.25pt'>To the Offer() class:</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:310.5pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
  height:310.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><i><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>/**</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:18.15pt;text-indent:-18.15pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>Returns
  the highest bid on an offer</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:18.15pt;text-indent:-18.15pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>@return
  </span></i><i><span style='font-size:11.0pt;line-height:107%;font-family:
  Consolas;color:#999988'>integer $price</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:18.15pt;text-indent:-18.15pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>The
  price</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:210.1pt;margin-bottom:
  0in;margin-left:0in;text-indent:0in;line-height:121%'><i><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#999988'>*/
  </span></i><b><span style='font-size:11.0pt;line-height:121%;font-family:
  Consolas;color:#333333'>public function </span></b><b><span style='font-size:
  11.0pt;line-height:121%;font-family:Consolas;color:#990000'>getOfferHighestBid</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>()
  {</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$bids = [];</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$id = <b>$this</b>-&gt;id();</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$query =
  \Drupal::entityQuery(</span><span style='font-size:11.0pt;line-height:107%;
  font-family:Consolas;color:#DD1144'>'bid'</span><span style='font-size:11.0pt;
  line-height:107%;font-family:Consolas;color:#333333'>)</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>-&gt;condition(</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'offer_id'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>,
  $id)</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>-&gt;sort(</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'bid'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>,
  </span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#DD1144'>'ASC'</span><span style='font-size:11.0pt;line-height:107%;
  font-family:Consolas;color:#333333'>)</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>-&gt;range(<b>NULL</b>,
  </span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:teal'>1</span><span style='font-size:11.0pt;line-height:107%;
  font-family:Consolas;color:#333333'>);</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$bidIds =
  $query-&gt;execute();</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:258.4pt;margin-bottom:
  0in;margin-left:6.05pt;text-indent:0in;line-height:121%'><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>$price
  = <b>null</b>; <b>foreach</b>($bidIds <b>as </b>$id) {</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$bid =
  Bid::load($id);</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$price =
  $bid-&gt;get(</span><span style='font-size:11.0pt;line-height:107%;
  font-family:Consolas;color:#DD1144'>'bid'</span><span style='font-size:11.0pt;
  line-height:107%;font-family:Consolas;color:#333333'>)-&gt;getString();</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:349.1pt;margin-bottom:
  0in;margin-left:6.05pt;text-indent:0in;line-height:121%'><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>}
  <b>return </b>$price;</span></p>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:20.9pt;
margin-left:-.25pt'>Also, add a second function loading all the bids of a given
offer:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.0pt;
margin-left:5.0pt;line-height:107%;background:#F8F8F8'><i><span
style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>/**</span></i></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.0pt;
margin-left:22.65pt;text-indent:-18.15pt;line-height:107%;background:#F8F8F8'><span
style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span><i><span
style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>Returns
all bids of an offer</span></i></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.0pt;
margin-left:22.65pt;text-indent:-18.15pt;line-height:107%;background:#F8F8F8'><span
style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span><i><span
style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>@return
</span></i><i><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
color:#999988'>array $bids</span></i></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.0pt;
margin-left:22.65pt;text-indent:-18.15pt;line-height:107%;background:#F8F8F8'><span
style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span><i><span
style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>Array
of bid entities</span></i></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
margin-left:5.0pt;line-height:110%;background:#F8F8F8'><i><span
style='font-size:11.0pt;line-height:110%;font-family:Consolas;color:#999988'>*/
</span></i><b><span style='font-size:11.0pt;line-height:110%;font-family:Consolas;
color:#333333'>public function </span></b><b><span style='font-size:11.0pt;
line-height:110%;font-family:Consolas;color:#990000'>getOfferBids</span></b><span
style='font-size:11.0pt;line-height:110%;font-family:Consolas;color:#333333'>()
{</span></p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:190.5pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
  height:190.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$bids = [];</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$id = <b>$this</b>-&gt;id();</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$query =
  \Drupal::entityQuery(</span><span style='font-size:11.0pt;line-height:107%;
  font-family:Consolas;color:#DD1144'>'bid'</span><span style='font-size:11.0pt;
  line-height:107%;font-family:Consolas;color:#333333'>)</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>-&gt;condition(</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'offer_id'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>,
  $id)</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:246.35pt;margin-bottom:
  0in;margin-left:6.05pt;text-indent:12.1pt;line-height:118%'><span
  style='font-size:11.0pt;line-height:118%;font-family:Consolas;color:#333333'>-&gt;sort(</span><span
  style='font-size:11.0pt;line-height:118%;font-family:Consolas;color:#DD1144'>'bid'</span><span
  style='font-size:11.0pt;line-height:118%;font-family:Consolas;color:#333333'>,
  </span><span style='font-size:11.0pt;line-height:118%;font-family:Consolas;
  color:#DD1144'>'DESC'</span><span style='font-size:11.0pt;line-height:118%;
  font-family:Consolas;color:#333333'>); $bidIds = $query-&gt;execute(); <b>foreach</b>($bidIds
  <b>as </b>$id) {</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$bid =
  Bid::load($id);</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$bids[] = $bid;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:355.15pt;margin-bottom:
  0in;margin-left:6.05pt;text-indent:0in;line-height:121%'><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>}
  <b>return </b>$bids;</span></p>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:2.1pt;
margin-left:-.25pt'>Inside <b>custom/offer/src/Form/OfferBiddingForm.php </b>we
change our <i>buildForm() </i>function to the following:</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:220.5pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
  height:220.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:306.75pt;margin-bottom:
  0in;margin-left:18.15pt;text-indent:-18.15pt;line-height:118%'><span
  style='font-size:11.0pt;line-height:118%;font-family:Consolas;color:#333333'>...</span><i><span
  style='font-size:11.0pt;line-height:118%;font-family:Consolas;color:#999988'>//
  switch statement </span></i><span style='font-size:11.0pt;line-height:118%;
  font-family:Consolas;color:#333333'>$price = </span><span style='font-size:
  11.0pt;line-height:118%;font-family:Consolas;color:#DD1144'>'0'</span><span
  style='font-size:11.0pt;line-height:118%;font-family:Consolas;color:#333333'>;
  <b>break</b>;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:15.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:77.1pt;margin-bottom:
  .8pt;margin-left:0in;text-indent:0in;line-height:115%'><b><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>$OfferHasBid
  = $offer-&gt;getOfferHighestBid(); if($OfferHasBid) {</span></b></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$price
  = $OfferHasBid + </span></b><b><span style='font-size:11.0pt;line-height:
  107%;font-family:Consolas;color:teal'>1</span></b><b><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>;</span></b></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:15.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><b><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></b></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$form[</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'price'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>]
  = [</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'#children' </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>=&gt;
  </span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#DD1144'>'&lt;h2&gt;' </span><span style='font-size:11.0pt;line-height:
  107%;font-family:Consolas;color:#333333'>. <b>$this</b>-&gt;t(</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'Start
  bidding at @price$'</span><span style='font-size:11.0pt;line-height:107%;
  font-family:Consolas;color:#333333'>, [</span><span style='font-size:11.0pt;
  line-height:107%;font-family:Consolas;color:#DD1144'>'@price'</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>=&gt; $price]) . </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'&lt;/h2&gt;'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>,</span></p>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>];</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>This will change the minimum price for both our title and
our front-end validation. To definitely make sure we’re not accepting lower
bids than our highest bid, we validate server-side too in our <i>validateForm()
</i>function. Always remember to do this, because front-end validation can be
skipped easily.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:21.95pt;
margin-left:-.25pt;line-height:110%'>To the top of <b>OfferBiddingForm.php:</b></p>

<p class=MsoNormal style='margin-top:0in;margin-right:76.6pt;margin-bottom:
23.0pt;margin-left:5.0pt;line-height:121%;background:#F8F8F8'><b><span
style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>use
</span></b><b><span style='font-size:11.0pt;line-height:121%;font-family:Consolas;
color:#990000'>Drupal</span></b><span style='font-size:11.0pt;line-height:121%;
font-family:Consolas;color:#333333'>\</span><b><span style='font-size:11.0pt;
line-height:121%;font-family:Consolas;color:#990000'>offer</span></b><span
style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>Entity</span></b><span
style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>Offer</span></b><span
style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>;</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.65pt;
margin-left:-.25pt;line-height:107%'>Inside our <i>validateForm():</i></p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:280.5pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
  height:280.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><i><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>// Load the offer
  and make sure no higher bid was done in the meantime</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$offer_id =
  $form_state-&gt;getValue(</span><span style='font-size:11.0pt;line-height:
  107%;font-family:Consolas;color:#DD1144'>'offer_id'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>);</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$offer =
  Offer::load($offer_id);</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:16.8pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$OfferHasBid =
  $offer-&gt;getOfferHighestBid();</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:89.2pt;margin-bottom:
  0in;margin-left:6.05pt;text-indent:-6.05pt;line-height:121%'><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>switch</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>($offer-&gt;get(</span><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#DD1144'>'field_offer_type'</span><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>)-&gt;getString())
  { <b>case </b></span><span style='font-size:11.0pt;line-height:121%;
  font-family:Consolas;color:#DD1144'>'with_minimum'</span><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>:</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$minium_price = <b>isset</b>($OfferHasBid)
  ? $OfferHasBid :</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:161.75pt;margin-bottom:
  .8pt;margin-left:18.15pt;text-indent:-18.15pt;line-height:115%'><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>$offer-&gt;get(</span><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#DD1144'>'field_price'</span><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>)-&gt;getString();
  <b>break</b>;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>case
  </span></b><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#DD1144'>'no_minimum'</span><span style='font-size:11.0pt;line-height:
  107%;font-family:Consolas;color:#333333'>;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:52.95pt;margin-bottom:
  0in;margin-left:18.15pt;text-indent:0in;line-height:115%'><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>$minium_price
  = <b>isset</b>($OfferHasBid) ? $OfferHasBid : </span><span style='font-size:
  11.0pt;line-height:115%;font-family:Consolas;color:teal'>0</span><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>;
  <b>break</b>;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:131.5pt;margin-bottom:
  0in;margin-left:0in;text-indent:0in;line-height:121%'><span style='font-size:
  11.0pt;line-height:121%;font-family:Consolas;color:#333333'>} <b>if</b>($minium_price
  &gt;= $form_state-&gt;getValue(</span><span style='font-size:11.0pt;
  line-height:121%;font-family:Consolas;color:#DD1144'>'bid'</span><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>))
  {</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$form_state-&gt;setErrorByName(</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'bid'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>,
  t(</span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#DD1144'>'Minimum bid needs to be @price'</span><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>,</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>[</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'@price'
  </span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#333333'>=&gt; (@$minium_price + </span><span style='font-size:11.0pt;
  line-height:107%;font-family:Consolas;color:teal'>1</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>)
  . </span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#DD1144'>'$' </span><span style='font-size:11.0pt;line-height:107%;
  font-family:Consolas;color:#333333'>]));;</span></p>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:21.85pt;
margin-left:-.25pt'>We now validate server-side that no bid can pass that is
lower than the current highest bid.</p>

<h2 style='margin-left:-.25pt'><a name="_Toc247068">Add dynamic variables to
our entity teaser</a></h2>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=600
 style='width:6.25in;border-collapse:collapse'>
 <tr style='height:69.75pt'>
  <td width=59 valign=top style='width:44.25pt;background:#6D9EEB;padding:14.6pt 5.75pt 0in 0in;
  height:69.75pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:14.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%'>&#128073;</span></p>
  </td>
  <td width=541 style='width:405.75pt;background:#6D9EEB;padding:14.6pt 5.75pt 0in 0in;
  height:69.75pt'>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%'>In this chapter we will add <b>dynamic
  variables </b>such as the current amount of bids to our teaser overview. At
  the end you will be able to <b>call custom entity methods </b>and process
  them into variable output of your teasers in twig</span>.</p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:2.1pt;
margin-left:-.25pt'>We can now update our <b>offer--teaser.html </b><i>template_preprocess_offer()
</i>function inside <b>custom/offer/offer.module </b>with the following
variables:</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=564
 style='width:423.0pt;margin-left:.4pt;border-collapse:collapse'>
 <tr style='height:26.0pt'>
  <td width=248 style='width:186.15pt;border:solid #BF9000 1.0pt;background:
  #BF9000;padding:9.3pt 5.75pt 0in 6.4pt;height:26.0pt'>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-size:10.0pt;line-height:107%'>Variable name</span></p>
  </td>
  <td width=316 style='width:236.9pt;border:solid #BF9000 1.0pt;border-left:
  none;background:#BF9000;padding:9.3pt 5.75pt 0in 6.4pt;height:26.0pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:.65pt;text-indent:0in;line-height:107%'><span style='font-size:
  10.0pt;line-height:107%'>Description</span></p>
  </td>
 </tr>
 <tr style='height:30.0pt'>
  <td width=248 style='width:186.15pt;border:solid #BF9000 1.0pt;border-top:
  none;background:#FFE599;padding:9.3pt 5.75pt 0in 6.4pt;height:30.0pt'>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%'>bid_amount</span></p>
  </td>
  <td width=316 style='width:236.9pt;border-top:none;border-left:none;
  border-bottom:solid #BF9000 1.0pt;border-right:solid #BF9000 1.0pt;
  background:#FFE599;padding:9.3pt 5.75pt 0in 6.4pt;height:30.0pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:.65pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%'>Shows the amount of bids so far</span></p>
  </td>
 </tr>
 <tr style='height:44.0pt'>
  <td width=248 valign=top style='width:186.15pt;border:solid #BF9000 1.0pt;
  border-top:none;background:#FFE599;padding:9.3pt 5.75pt 0in 6.4pt;height:
  44.0pt'>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%'>promo</span></p>
  </td>
  <td width=316 style='width:236.9pt;border-top:none;border-left:none;
  border-bottom:solid #BF9000 1.0pt;border-right:solid #BF9000 1.0pt;
  background:#FFE599;padding:9.3pt 5.75pt 0in 6.4pt;height:44.0pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:.65pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%'>Shows a “Be the first”-badge if there is no bid on
  the offer yet.</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:20.9pt;
margin-left:-.25pt'>The function now integrates the <i>getOfferBids() </i>and <i>getOfferHighestBids()
</i>methods:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.0pt;
margin-left:11.8pt;line-height:107%;background:#F8F8F8'><i><span
style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>/**</span></i></p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:610.5pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
  height:610.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:18.15pt;text-indent:-12.1pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>Prepares
  variables for templates.</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:18.15pt;text-indent:-12.1pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>implements
  hook_preprocess_HOOK()</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:59.0pt;margin-bottom:
  0in;margin-left:0in;text-indent:6.05pt;line-height:121%'><i><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#999988'>*/
  </span></i><b><span style='font-size:11.0pt;line-height:121%;font-family:
  Consolas;color:#333333'>function </span></b><b><span style='font-size:11.0pt;
  line-height:121%;font-family:Consolas;color:#990000'>template_preprocess_offer</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>(array
  &amp;$variables) { <b>foreach </b>(Element::children($variables[</span><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#DD1144'>'elements'</span><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>])
  <b>as </b>$key) {</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:24.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$variables[</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'content'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>][$key]
  = $variables[</span><span style='font-size:11.0pt;line-height:107%;
  font-family:Consolas;color:#DD1144'>'elements'</span><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>][$key];</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:15.95pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$offer =
  $variables[</span><span style='font-size:11.0pt;line-height:107%;font-family:
  Consolas;color:#DD1144'>'elements'</span><span style='font-size:11.0pt;
  line-height:107%;font-family:Consolas;color:#333333'>][</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'#offer'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>];</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>//
  The full offer object</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:16.8pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$variables[</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'offer'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>]
  = $offer;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:77.1pt;margin-bottom:
  0in;margin-left:12.1pt;text-indent:0in;line-height:121%'><i><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#999988'>//
  The current price: minimum or highest bid if available </span></i><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>switch</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>($offer-&gt;get(</span><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#DD1144'>'field_offer_type'</span><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>)-&gt;getString())
  { <b>case </b></span><span style='font-size:11.0pt;line-height:121%;
  font-family:Consolas;color:#DD1144'>'with_minimum'</span><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>:</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:36.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$price = </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'Start
  bidding at '</span><span style='font-size:11.0pt;line-height:107%;font-family:
  Consolas;color:#333333'>.</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:125.45pt;margin-bottom:
  .8pt;margin-left:36.25pt;text-indent:-36.25pt;line-height:115%'><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>$offer-&gt;get(</span><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#DD1144'>'field_price'</span><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>)-&gt;getString()
  . </span><span style='font-size:11.0pt;line-height:115%;font-family:Consolas;
  color:#DD1144'>'$'</span><span style='font-size:11.0pt;line-height:115%;
  font-family:Consolas;color:#333333'>; <b>break</b>;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:24.15pt;text-indent:0in;line-height:107%'><b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>case
  </span></b><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#DD1144'>'no_minimum'</span><span style='font-size:11.0pt;line-height:
  107%;font-family:Consolas;color:#333333'>;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:179.85pt;margin-bottom:
  0in;margin-left:36.25pt;text-indent:0in;line-height:115%'><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>$price
  = </span><span style='font-size:11.0pt;line-height:115%;font-family:Consolas;
  color:#DD1144'>'Start bidding at 0$'</span><span style='font-size:11.0pt;
  line-height:115%;font-family:Consolas;color:#333333'>; <b>break</b>;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:65.05pt;margin-bottom:
  .8pt;margin-left:12.1pt;text-indent:0in;line-height:115%'><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>$OfferHasBid
  = $offer-&gt;getOfferHighestBid(); <b>if</b>($OfferHasBid) {</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:24.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$price = </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'Highest
  bid currently ' </span><span style='font-size:11.0pt;line-height:107%;
  font-family:Consolas;color:#333333'>. $OfferHasBid . </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'$'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:24.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$variables[</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'price'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>]
  = $price;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>} <b>else </b>{</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:24.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$variables[</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'price'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>]
  = </span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#DD1144'>'No bids yet. Grab your chance!'</span><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:15.95pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>//
  The amount of bids</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:16.7pt;margin-bottom:
  15.0pt;margin-left:12.1pt;text-indent:0in;line-height:115%'><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>$bid_amount
  = count($offer-&gt;getOfferBids()); $variables[</span><span style='font-size:
  11.0pt;line-height:115%;font-family:Consolas;color:#DD1144'>'bid_amount'</span><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>]
  = $bid_amount;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:83.15pt;margin-bottom:
  0in;margin-left:12.1pt;text-indent:0in;line-height:121%'><i><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#999988'>//
  a promo badge </span></i><b><span style='font-size:11.0pt;line-height:121%;
  font-family:Consolas;color:#333333'>if</span></b><span style='font-size:11.0pt;
  line-height:121%;font-family:Consolas;color:#333333'>(($bid_amount == </span><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:teal'>0</span><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>)
  &amp;&amp; (\Drupal::currentUser()-&gt;id() !=</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$offer-&gt;getOwnerId()))
  {</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:179.85pt;margin-bottom:
  0in;margin-left:12.1pt;text-indent:12.1pt;line-height:115%'><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>$variables[</span><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#DD1144'>'promo'</span><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>]
  = </span><span style='font-size:11.0pt;line-height:115%;font-family:Consolas;
  color:#DD1144'>'Be the first!'</span><span style='font-size:11.0pt;
  line-height:115%;font-family:Consolas;color:#333333'>; }</span></p>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:21.95pt;
margin-left:-.25pt;line-height:110%'>The final <b>offer--teaser.html </b>file:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.7pt;
margin-left:5.0pt;line-height:110%;background:#F8F8F8'><span style='font-size:
11.0pt;line-height:110%;font-family:Consolas;color:navy'>&lt;a </span><span
style='font-size:11.0pt;line-height:110%;font-family:Consolas;color:teal'>href</span><span
style='font-size:11.0pt;line-height:110%;font-family:Consolas;color:navy'>=</span><span
style='font-size:11.0pt;line-height:110%;font-family:Consolas;color:#DD1144'>&quot;</span><span
style='font-size:11.0pt;line-height:110%;font-family:Consolas;color:teal'>{{
path('entity.offer.canonical', {'offer': offer.id()}) }}</span><span
style='font-size:11.0pt;line-height:110%;font-family:Consolas;color:#DD1144'>&quot;
</span><span style='font-size:11.0pt;line-height:110%;font-family:Consolas;
color:teal'>{{</span></p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:220.5pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
  height:220.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:teal'>attributes.addClass('offer-teaser')
  }}</span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:navy'>&gt;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>{% <b>if </b>promo
  %}</span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:navy'>&lt;div </span><span style='font-size:11.0pt;line-height:107%;
  font-family:Consolas;color:teal'>class</span><span style='font-size:11.0pt;
  line-height:107%;font-family:Consolas;color:navy'>=</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>&quot;badge&quot;</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:navy'>&gt;</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:teal'>{{promo
  }}</span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:navy'>&lt;/div&gt;</span><span style='font-size:11.0pt;line-height:
  107%;font-family:Consolas;color:#333333'>{% <b>endif </b>%}</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:navy'>&lt;div </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:teal'>class</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:navy'>=</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>&quot;product-tumb&quot;</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:navy'>&gt;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:24.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:teal'>{{
  content.field_image }}</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:navy'>&lt;/div&gt;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:navy'>&lt;div </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:teal'>class</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:navy'>=</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>&quot;product-details&quot;</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:navy'>&gt;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:216.1pt;margin-bottom:
  0in;margin-left:24.15pt;text-indent:0in;line-height:121%'><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:navy'>&lt;h4&gt;</span><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:teal'>{{
  offer.label() }}</span><span style='font-size:11.0pt;line-height:121%;
  font-family:Consolas;color:navy'>&lt;/h4&gt; &lt;p&gt;</span><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:teal'>{{
  bid_amount }} </span><span style='font-size:11.0pt;line-height:121%;
  font-family:Consolas;color:#333333'>bids</span><span style='font-size:11.0pt;
  line-height:121%;font-family:Consolas;color:navy'>&lt;/p&gt;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:24.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:navy'>&lt;div </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:teal'>class</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:navy'>=</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>&quot;product-bottom-details&quot;</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:navy'>&gt;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:36.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:navy'>&lt;div </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:teal'>class</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:navy'>=</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>&quot;product-price&quot;</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:navy'>&gt;</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:teal'>{{
  price }}</span><span style='font-size:11.0pt;line-height:107%;font-family:
  Consolas;color:navy'>&lt;/div&gt;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:36.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:navy'>&lt;div </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:teal'>class</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:navy'>=</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>&quot;product-user-profile&quot;</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:navy'>&gt;</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:teal'>{{
  user_profile }}</span><span style='font-size:11.0pt;line-height:107%;
  font-family:Consolas;color:navy'>&lt;/div&gt;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:24.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:navy'>&lt;/div&gt;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:navy'>&lt;/div&gt;</span></p>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:navy'>&lt;/a&gt;</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:.05in;
margin-left:-.25pt'>Clear caches and take a look at <i>/offer</i>:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:-1.7pt;margin-bottom:
24.25pt;margin-left:1.5pt;text-indent:0in;line-height:107%'><img border=0
width=602 height=424 id="Picture 14731"
src="Learning%20drupal%209%20as%20a%20framework_files/image098.jpg"></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>We now have more dynamic teasers, showing the current
amount of bids, the highest bid so far, and a promo badge if there are no bids
yet.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:15.1pt;margin-bottom:
69.55pt;margin-left:14.0pt;line-height:110%;background:#FFD966'><span
style='font-size:11.0pt;line-height:110%'>You might stumble upon the fact that
this overview not always get updated when bidding, we’ll fix this in the </span><u><span
style='font-size:11.0pt;line-height:110%;color:#1155CC'>chapter about caching</span></u><span
style='font-size:11.0pt;line-height:110%'>.</span></p>

<h2 style='margin-left:-.25pt'><a name="_Toc247069">Validating the entity with
constraints</a></h2>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=600
 style='width:6.25in;border-collapse:collapse'>
 <tr style='height:55.5pt'>
  <td width=59 valign=top style='width:44.25pt;background:#6D9EEB;padding:14.6pt 5.75pt 0in 0in;
  height:55.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:14.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%'>&#128073;</span></p>
  </td>
  <td width=541 style='width:405.75pt;background:#6D9EEB;padding:14.6pt 5.75pt 0in 0in;
  height:55.5pt'>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%'>In this chapter we explore the <b>Entity
  Validation API</b>. With this API we set constraints on saving entities to
  keep our database clean at all times.</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>What if something goes wrong and a bid gets saved with
incorrect values?</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:.75pt;
margin-left:-.25pt'>The <a
href="https://www.drupal.org/docs/drupal-apis/entity-api/entity-validation-api"><span
style='color:#1155CC'>Entity Validation API</span></a><u><span
style='color:#1155CC'> </span></u>ensures that all entities pass the validation
criteria. We can add validation on an entity level, or on a field level. For
our bids we will first validate to make sure all values are set and are not
empty.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>We could choose to do these checks in our <i>submitForm() </i>function,
but using constraints is more a good practice way because this way other
classes or modules can use the same validators.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.35pt;
margin-left:-.25pt;line-height:110%'>We make a new map structure: <b>custom/bid/src/Plugin/Validation/Constraint</b>.
First file we add is <b>AllFieldsRequiredConstraint.php</b>:</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:280.5pt'>
  <td width=601 valign=top style='width:450.75pt;background:#F8F8F8;padding:
  7.65pt 5.75pt 0in 5.25pt;height:280.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:16.8pt;
  margin-left:0in;text-indent:0in;line-height:107%'><b><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>namespace </span></b><b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#990000'>Drupal</span></b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#990000'>bid</span></b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#990000'>Plugin</span></b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#990000'>Validation</span></b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#990000'>Constraint</span></b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:40.85pt;margin-bottom:
  14.2pt;margin-left:0in;text-indent:0in;line-height:121%'><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>use
  </span></b><b><span style='font-size:11.0pt;line-height:121%;font-family:
  Consolas;color:#990000'>Symfony</span></b><span style='font-size:11.0pt;
  line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>Component</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>Validator</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>Constraint</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>;
  <b>use </b></span><b><span style='font-size:11.0pt;line-height:121%;
  font-family:Consolas;color:#990000'>Symfony</span></b><span style='font-size:
  11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>Component</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>Validator</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>Exception</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>MissingOptionsException</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:0in;text-indent:0in;line-height:107%'><i><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>/**</span></i></p>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:115%'><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  </span></span><i><span style='font-size:11.0pt;line-height:115%;font-family:
  Consolas;color:#999988'>Requires an offer entity to have all fields required
  to save as an object.</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:0in;text-indent:0in;line-height:107%'><i><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  </span></span><i><span style='font-size:11.0pt;line-height:107%;font-family:
  Consolas;color:#DD1144'>@Constraint</span></i><i><span style='font-size:11.0pt;
  line-height:107%;font-family:Consolas;color:#999988'>(</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  </span></span><i><span style='font-size:11.0pt;line-height:107%;font-family:
  Consolas;color:#999988'>id = &quot;AllFieldsRequired&quot;,</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  </span></span><i><span style='font-size:11.0pt;line-height:107%;font-family:
  Consolas;color:#999988'>label = </span></i><i><span style='font-size:11.0pt;
  line-height:107%;font-family:Consolas;color:#DD1144'>@Translation</span></i><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>(&quot;All
  fields required.&quot;, context =</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><i><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>&quot;Validation&quot;),</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  </span></span><i><span style='font-size:11.0pt;line-height:107%;font-family:
  Consolas;color:#999988'>type = &quot;entity:bid&quot;</span></i></p>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  </span></span><i><span style='font-size:11.0pt;line-height:107%;font-family:
  Consolas;color:#999988'>)*/ </span></i><b><span style='font-size:11.0pt;
  line-height:107%;font-family:Consolas;color:#333333'>class </span></b><b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#445588'>AllFieldsRequiredConstraint
  </span></b><b><span style='font-size:11.0pt;line-height:107%;font-family:
  Consolas;color:#333333'>extends </span></b><b><span style='font-size:11.0pt;
  line-height:107%;font-family:Consolas;color:#445588'>Constraint </span></b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>{</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.25pt;
margin-left:5.75pt;line-height:111%;background:#F8F8F8'><b><span
style='font-size:11.0pt;line-height:111%;font-family:Consolas;color:#333333'>public
</span></b><span style='font-size:11.0pt;line-height:111%;font-family:Consolas;
color:#333333'>$message = </span><span style='font-size:11.0pt;line-height:
111%;font-family:Consolas;color:#DD1144'>'At least one field was empty and
prevented saving</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:15.55pt;
margin-left:5.75pt;line-height:111%;background:#F8F8F8'><span style='font-size:
11.0pt;line-height:111%;font-family:Consolas;color:#DD1144'>the bid.'</span><span
style='font-size:11.0pt;line-height:111%;font-family:Consolas;color:#333333'>;</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:24.05pt;
margin-left:5.75pt;line-height:111%;background:#F8F8F8'><span style='font-size:
11.0pt;line-height:111%;font-family:Consolas;color:#333333'>}</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>This file registers the constraint on the bid entity. It
would be used to give feedback in an entity form. This means it will go over
this constraint if we ask to validate input for an entire entity. This is also
possible for one field only.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:.3in;
margin-left:-.25pt'>But when validating on custom forms, we have to make sure
the constraint is also set in <b>custom/bid/src/Entity/Bid.php</b>. To the
annotations, add the following:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:10.6pt;margin-bottom:
1.45pt;margin-left:51.45pt;text-indent:-.55in;line-height:112%;background:#F8F8F8'><span
style='font-family:Consolas;color:#333333'>*<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span style='font-family:Consolas;color:#333333'>constraints = {</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:10.6pt;margin-bottom:
1.45pt;margin-left:51.45pt;text-indent:-.55in;line-height:112%;background:#F8F8F8'><span
style='font-family:Consolas;color:#333333'>*<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span style='font-family:Consolas;color:#DD1144'>&quot;AllFieldsRequired&quot;
</span><span style='font-family:Consolas;color:#333333'>= {}</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:10.6pt;margin-bottom:
23.05pt;margin-left:51.45pt;text-indent:-.55in;line-height:112%;background:
#F8F8F8'><span style='font-family:Consolas;color:#333333'>*<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span style='font-family:Consolas;color:#333333'>}</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>Next file will do the actual validation:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.35pt;
margin-left:-.25pt;line-height:110%'><b>AllFieldsRequiredConstraintValidator.php:</b></p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:340.5pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
  height:340.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:137.55pt;margin-bottom:
  0in;margin-left:0in;text-indent:0in;line-height:237%'><b><span
  style='font-size:11.0pt;line-height:237%;font-family:Consolas;color:#999999'>&lt;?php
  </span></b><b><span style='font-size:11.0pt;line-height:237%;font-family:
  Consolas;color:#333333'>namespace </span></b><b><span style='font-size:11.0pt;
  line-height:237%;font-family:Consolas;color:#990000'>Drupal</span></b><span
  style='font-size:11.0pt;line-height:237%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:237%;font-family:Consolas;color:#990000'>bid</span></b><span
  style='font-size:11.0pt;line-height:237%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:237%;font-family:Consolas;color:#990000'>Plugin</span></b><span
  style='font-size:11.0pt;line-height:237%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:237%;font-family:Consolas;color:#990000'>Validation</span></b><span
  style='font-size:11.0pt;line-height:237%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:237%;font-family:Consolas;color:#990000'>Constraint</span></b><span
  style='font-size:11.0pt;line-height:237%;font-family:Consolas;color:#333333'>;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:125.45pt;margin-bottom:
  14.2pt;margin-left:0in;text-indent:0in;line-height:121%'><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>use
  </span></b><b><span style='font-size:11.0pt;line-height:121%;font-family:
  Consolas;color:#990000'>Symfony</span></b><span style='font-size:11.0pt;
  line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>Component</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>Validator</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>Constraint</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>;
  <b>use </b></span><b><span style='font-size:11.0pt;line-height:121%;
  font-family:Consolas;color:#990000'>Symfony</span></b><span style='font-size:
  11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>Component</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>Validator</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>ConstraintValidator</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><i><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>/**</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:18.15pt;text-indent:-12.1pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>Validates
  the AllFieldsRequired constraint.</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:4.6pt;margin-bottom:
  0in;margin-left:0in;text-indent:0in;line-height:121%'><i><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#999988'>*/
  </span></i><b><span style='font-size:11.0pt;line-height:121%;font-family:
  Consolas;color:#333333'>class </span></b><b><span style='font-size:11.0pt;
  line-height:121%;font-family:Consolas;color:#445588'>AllFieldsRequiredConstraintValidator
  </span></b><b><span style='font-size:11.0pt;line-height:121%;font-family:
  Consolas;color:#333333'>extends </span></b><b><span style='font-size:11.0pt;
  line-height:121%;font-family:Consolas;color:#445588'>ConstraintValidator </span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>{</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>/**</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:18.15pt;text-indent:-12.1pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>{</span></i><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>@inheritdoc</span></i><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>}</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:77.1pt;margin-bottom:
  0in;margin-left:6.05pt;text-indent:6.05pt;line-height:121%'><i><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#999988'>*/
  </span></i><b><span style='font-size:11.0pt;line-height:121%;font-family:
  Consolas;color:#333333'>public function </span></b><b><span style='font-size:
  11.0pt;line-height:121%;font-family:Consolas;color:#990000'>validate</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>($entity,
  Constraint $constraint) { <b>if </b>($entity-&gt;get(</span><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#DD1144'>'user_id'</span><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>)-&gt;isEmpty())
  {</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:30.2pt;text-indent:0in;line-height:107%'><b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$this</span></b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>-&gt;context-&gt;addViolation($constraint-&gt;message);</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:2.75in;margin-bottom:
  0in;margin-left:18.15pt;text-indent:0in;line-height:121%'><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>}
  <b>if </b>($entity-&gt;get(</span><span style='font-size:11.0pt;line-height:
  121%;font-family:Consolas;color:#DD1144'>'bid'</span><span style='font-size:
  11.0pt;line-height:121%;font-family:Consolas;color:#333333'>)-&gt;isEmpty())
  {</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:30.2pt;text-indent:0in;line-height:107%'><b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$this</span></b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>-&gt;context-&gt;addViolation($constraint-&gt;message);</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:167.8pt;margin-bottom:
  0in;margin-left:18.15pt;text-indent:0in;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}
  <b>if </b>($entity-&gt;get(</span><span style='font-size:11.0pt;line-height:
  107%;font-family:Consolas;color:#DD1144'>'offer_id'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>)-&gt;isEmpty())
  {</span></p>
  </td>
 </tr>
 <tr style='height:85.5pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
  height:85.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:30.2pt;text-indent:0in;line-height:107%'><b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$this</span></b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>-&gt;context-&gt;addViolation($constraint-&gt;message);</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:15.95pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>The code itself is quite readable. If one of the fields
‘bid’, ‘offer_id’, ‘user_id’ is empty, it will not validate.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>A final step is to clear the caches so the constraint gets
picked up.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:2.1pt;
margin-left:-.25pt'>We change the creation of bids in the <i>submitForm() </i>function
of the <b>custom/offer/src/Form/OfferBiddingForm.php </b>to integrate the
constraint:</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:340.5pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
  height:340.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:0in;text-indent:0in;line-height:107%'><b><span style='font-family:
  Consolas;color:#333333'>public function </span></b><b><span style='font-family:
  Consolas;color:#990000'>submitForm</span></b><span style='font-family:Consolas;
  color:#333333'>(array &amp;$form, FormStateInterface</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>$form_state) {</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.1pt;
  margin-left:13.2pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>$bid = Bid::create([</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.1pt;
  margin-left:26.4pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#DD1144'>'bid' </span><span style='font-family:Consolas;
  color:#333333'>=&gt; $form_state-&gt;getValue(</span><span style='font-family:
  Consolas;color:#DD1144'>'bid'</span><span style='font-family:Consolas;
  color:#333333'>),</span></p>
  <p class=MsoNormal align=center style='margin-top:0in;margin-right:0in;
  margin-bottom:2.1pt;margin-left:2.3pt;text-align:center;text-indent:0in;
  line-height:107%'><span style='font-family:Consolas;color:#DD1144'>'user_id' </span><span
  style='font-family:Consolas;color:#333333'>=&gt; [</span><span
  style='font-family:Consolas;color:#DD1144'>'target_id' </span><span
  style='font-family:Consolas;color:#333333'>=&gt;
  \Drupal::currentUser()-&gt;id()],</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:26.4pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#DD1144'>'offer_id' </span><span style='font-family:Consolas;
  color:#333333'>=&gt; [</span><span style='font-family:Consolas;color:#DD1144'>'target_id'
  </span><span style='font-family:Consolas;color:#333333'>=&gt;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>$form_state-&gt;getValue(</span><span
  style='font-family:Consolas;color:#DD1144'>'offer_id'</span><span
  style='font-family:Consolas;color:#333333'>)]</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:13.2pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>]);</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:149.45pt;margin-bottom:
  17.4pt;margin-left:13.2pt;text-indent:0in;line-height:116%'><span
  style='font-family:Consolas;color:#333333'>$violations = $bid-&gt;validate();
  $validation = $violations-&gt;count();</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:13.2pt;text-indent:0in;line-height:107%'><b><span
  style='font-family:Consolas;color:#333333'>if</span></b><span
  style='font-family:Consolas;color:#333333'>($validation === </span><span
  style='font-family:Consolas;color:teal'>0</span><span style='font-family:
  Consolas;color:#333333'>) {</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.1pt;
  margin-left:26.4pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>$bid-&gt;save();</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.9pt;
  margin-left:0in;text-indent:26.4pt;line-height:116%'><span style='font-family:
  Consolas;color:#333333'>\Drupal::messenger()-&gt;addMessage(<b>$this</b>-&gt;t(</span><span
  style='font-family:Consolas;color:#DD1144'>'Your bid was successfully
  submitted.'</span><span style='font-family:Consolas;color:#333333'>));</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:17.7pt;
  margin-left:13.2pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>} <b>else </b>{</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>\Drupal::messenger()-&gt;addWarning($violations[</span><span
  style='font-family:Consolas;color:teal'>0</span><span style='font-family:
  Consolas;color:#333333'>]-&gt;getMessage());</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:13.2pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-family:Consolas;color:#333333'>}</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:.15pt;
margin-left:-.25pt'>This is pretty neat. We made sure our entities will be
complete on save with custom</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:2.1pt;
margin-left:-.25pt'>constraint validators.</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=600
 style='width:6.25in;border-collapse:collapse'>
 <tr style='height:55.5pt'>
  <td width=59 valign=top style='width:44.25pt;background:#E2E3E5;padding:14.6pt 5.75pt 0in 0in;
  height:55.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:14.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%'>&#128187;</span></p>
  </td>
  <td width=541 style='width:405.75pt;background:#E2E3E5;padding:14.6pt 5.75pt 0in 0in;
  height:55.5pt'>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%'>You can check if the constraints
  works like expected if you comment out the <i>validateForm() </i>and the
  ‘#attributes’ and ‘#required’ key in $form[‘bid’] inside the</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:15.1pt;margin-bottom:
17.65pt;margin-left:44.75pt;line-height:110%;background:#E2E3E5'><span
style='font-size:11.0pt;line-height:110%'>OfferBiddingForm.php</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:-1.7pt;margin-bottom:
38.3pt;margin-left:1.5pt;text-indent:0in;line-height:107%'><img border=0
width=602 height=419 id="Picture 15238"
src="Learning%20drupal%209%20as%20a%20framework_files/image099.jpg"></p>

<p class=MsoNormal style='margin-top:0in;margin-right:15.1pt;margin-bottom:
30.45pt;margin-left:14.0pt;line-height:110%;background:#FFD966'><span
style='font-size:11.0pt;line-height:110%'>In a way, this is adding extra
security towards malicious input on your database. In addition to server-side
validation in our form, we added constraints to saving our entity. The <b>Entity
validation API </b>can also be used to do all kinds of other checks. For
example to check if the offer is still published when the form gets submitted.</span></p>

<p class=MsoNormal style='margin-bottom:22.1pt;line-height:110%'>For more,
check out the Entity validation API on drupal.org: <a
href="https://www.drupal.org/docs/drupal-apis/entity-api/entity-validation-api"><span
style='color:#1155CC'>https://www.drupal.org/docs/drupal-apis/entity-api/entity-validation-api</span></a></p>

<h2 style='margin-top:0in;margin-right:0in;margin-bottom:3.55pt;margin-left:
-.25pt'><a name="_Toc247070">Displaying all bids in a dynamically rendered
table</a></h2>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=600
 style='width:6.25in;border-collapse:collapse'>
 <tr style='height:82.5pt'>
  <td width=59 valign=top style='width:44.25pt;background:#6D9EEB;padding:14.6pt 5.75pt 0in 0in;
  height:82.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:14.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%'>&#128073;</span></p>
  </td>
  <td width=541 style='width:405.75pt;background:#6D9EEB;padding:14.6pt 5.75pt 0in 0in;
  height:82.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:7.3pt;margin-bottom:
  0in;margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%'>This chapter will teach you how to use <b>render
  arrays </b>for displaying <b>processed data</b>. At the end you will know how
  to add tables or other ways to display items to a block. By using the <b>RequestStack
  </b>service, you will be able to receive data of the current entity in your
  block.</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>We need an overview of previously done bids to the offer.
In this section we’ll be rendering a drupal table render array. The advantage
of using these <a
href="https://www.drupal.org/docs/drupal-apis/render-api/render-arrays"><span
style='color:#1155CC'>render arrays</span></a><u><span style='color:#1155CC'> </span></u>is
that their layout will be consistent over all themes. Therefore, I like using
them.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>Because we’ll be doing quite some preprocessing on the
bids, I add an extra class for properly returning my data. This way we keep
things a bit more readable.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.35pt;
margin-left:-.25pt;line-height:110%'>Add this file <b>custom/offer/src/OfferPreprocess/OfferPreprocess.php</b>.
To the file, add:</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:520.5pt'>
  <td width=601 valign=top style='width:450.75pt;background:#F8F8F8;padding:
  0in 5.75pt 0in 5.25pt;height:520.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:199.45pt;margin-bottom:
  0in;margin-left:0in;text-indent:0in;line-height:237%'><b><span
  style='font-size:11.0pt;line-height:237%;font-family:Consolas;color:#999999'>&lt;?php
  </span></b><b><span style='font-size:11.0pt;line-height:237%;font-family:
  Consolas;color:#333333'>namespace </span></b><b><span style='font-size:11.0pt;
  line-height:237%;font-family:Consolas;color:#990000'>Drupal</span></b><span
  style='font-size:11.0pt;line-height:237%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:237%;font-family:Consolas;color:#990000'>offer</span></b><span
  style='font-size:11.0pt;line-height:237%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:237%;font-family:Consolas;color:#990000'>OfferPreprocess</span></b><span
  style='font-size:11.0pt;line-height:237%;font-family:Consolas;color:#333333'>;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:253.85pt;margin-bottom:
  6.7pt;margin-left:0in;text-indent:0in;line-height:179%'><b><span
  style='font-size:11.0pt;line-height:179%;font-family:Consolas;color:#333333'>use
  </span></b><b><span style='font-size:11.0pt;line-height:179%;font-family:
  Consolas;color:#990000'>Drupal</span></b><span style='font-size:11.0pt;
  line-height:179%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:179%;font-family:Consolas;color:#990000'>bid</span></b><span
  style='font-size:11.0pt;line-height:179%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:179%;font-family:Consolas;color:#990000'>Entity</span></b><span
  style='font-size:11.0pt;line-height:179%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:179%;font-family:Consolas;color:#990000'>Bid</span></b><span
  style='font-size:11.0pt;line-height:179%;font-family:Consolas;color:#333333'>;
  <b>use </b></span><b><span style='font-size:11.0pt;line-height:179%;
  font-family:Consolas;color:#990000'>Drupal</span></b><span style='font-size:
  11.0pt;line-height:179%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:179%;font-family:Consolas;color:#990000'>offer</span></b><span
  style='font-size:11.0pt;line-height:179%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:179%;font-family:Consolas;color:#990000'>Entity</span></b><span
  style='font-size:11.0pt;line-height:179%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:179%;font-family:Consolas;color:#990000'>Offer</span></b><span
  style='font-size:11.0pt;line-height:179%;font-family:Consolas;color:#333333'>;
  <b>class </b></span><b><span style='font-size:11.0pt;line-height:179%;
  font-family:Consolas;color:#445588'>OfferPreprocess </span></b><span
  style='font-size:11.0pt;line-height:179%;font-family:Consolas;color:#333333'>{</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>/**</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>Returns
  rendered table below an offer</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.8pt;
  margin-left:12.1pt;text-indent:0in;line-height:115%'><span style='font-size:
  11.0pt;line-height:115%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#DD1144'>@param
  </span></i><i><span style='font-size:11.0pt;line-height:115%;font-family:
  Consolas;color:#999988'>entity $offer *  The offer entity</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>@return
  </span></i><i><span style='font-size:11.0pt;line-height:107%;font-family:
  Consolas;color:#999988'>array $table</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>Drupal
  table render array</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:132.95pt;margin-bottom:
  0in;margin-left:6.05pt;text-indent:6.05pt;line-height:121%'><i><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#999988'>*/
  </span></i><b><span style='font-size:11.0pt;line-height:121%;font-family:
  Consolas;color:#333333'>public static function </span></b><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>offerTable</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>(Offer
  $offer) {</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:15.95pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$bids =
  $offer-&gt;getOfferBids();</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:271.95pt;margin-bottom:
  0in;margin-left:18.15pt;text-indent:0in;line-height:121%'><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>$rows
  = []; <b>foreach</b>($bids <b>as </b>$bid) {</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:30.2pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$price =
  $bid-&gt;get(</span><span style='font-size:11.0pt;line-height:107%;
  font-family:Consolas;color:#DD1144'>'bid'</span><span style='font-size:11.0pt;
  line-height:107%;font-family:Consolas;color:#333333'>)-&gt;getString();</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:30.2pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$owner =
  $bid-&gt;getOwner();</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:145.05pt;margin-bottom:
  0in;margin-left:30.2pt;text-indent:0in;line-height:115%'><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>$ownerName
  = $owner-&gt;getDisplayName(); $time =</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:15.0pt;
  margin-left:0in;text-align:justify;text-justify:inter-ideograph;text-indent:
  0in;line-height:115%'><span style='font-size:11.0pt;line-height:115%;
  font-family:Consolas;color:#333333'>\Drupal::service(</span><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#DD1144'>'date.formatter'</span><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>)-&gt;formatTimeDiffSince($bid-&gt;created-&gt;v
  alue);</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:30.2pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$row = [</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:42.3pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$ownerName . </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'
  - ' </span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#333333'>. $time . </span><span style='font-size:11.0pt;line-height:
  107%;font-family:Consolas;color:#DD1144'>' ago'</span><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>, $price . </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'$'</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:30.2pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>];</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:30.2pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$rows[] = $row;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  </td>
 </tr>
 <tr style='height:190.5pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
  height:190.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$build[</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'table'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>]
  = [</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:30.2pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'#type' </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>=&gt;
  </span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#DD1144'>'table'</span><span style='font-size:11.0pt;line-height:107%;
  font-family:Consolas;color:#333333'>,</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:30.2pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'#rows' </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>=&gt;
  $rows,</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:30.2pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'#empty' </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>=&gt;
  t(</span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#DD1144'>'This offer has no bids yet. Grab your chance!'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>),</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:373.25pt;margin-bottom:
  0in;margin-left:18.15pt;text-indent:0in;line-height:121%'><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>];
  <b>return </b>[</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:30.2pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'#type' </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>=&gt;
  </span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#DD1144'>'#markup'</span><span style='font-size:11.0pt;line-height:
  107%;font-family:Consolas;color:#333333'>,</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:30.2pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'#markup' </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>=&gt;
  render($build)</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>];</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:15.95pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:2.1pt;
margin-left:-.25pt'>Next, in order to show our table with the latest offers we
add it to a new block inside <b>custom/offer/src/Plugin/Block/OfferBiddingTableBlock.php:</b></p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:430.5pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
  height:430.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:222.15pt;margin-bottom:
  0in;margin-left:0in;text-indent:0in;line-height:237%'><b><span
  style='font-size:11.0pt;line-height:237%;font-family:Consolas;color:#999999'>&lt;?php
  </span></b><b><span style='font-size:11.0pt;line-height:237%;font-family:
  Consolas;color:#333333'>namespace </span></b><b><span style='font-size:11.0pt;
  line-height:237%;font-family:Consolas;color:#990000'>Drupal</span></b><span
  style='font-size:11.0pt;line-height:237%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:237%;font-family:Consolas;color:#990000'>offer</span></b><span
  style='font-size:11.0pt;line-height:237%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:237%;font-family:Consolas;color:#990000'>Plugin</span></b><span
  style='font-size:11.0pt;line-height:237%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:237%;font-family:Consolas;color:#990000'>Block</span></b><span
  style='font-size:11.0pt;line-height:237%;font-family:Consolas;color:#333333'>;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:71.1pt;margin-bottom:
  14.2pt;margin-left:0in;text-indent:0in;line-height:121%'><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>use
  </span></b><b><span style='font-size:11.0pt;line-height:121%;font-family:
  Consolas;color:#990000'>Drupal</span></b><span style='font-size:11.0pt;
  line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>Core</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>Block</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>BlockBase</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>;
  <b>use </b></span><b><span style='font-size:11.0pt;line-height:121%;
  font-family:Consolas;color:#990000'>Symfony</span></b><span style='font-size:
  11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>Component</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>DependencyInjection</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>ContainerInterface</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>;
  <b>use </b></span><b><span style='font-size:11.0pt;line-height:121%;
  font-family:Consolas;color:#990000'>Drupal</span></b><span style='font-size:
  11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>Core</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>Plugin</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>ContainerFactoryPluginInterface</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>;
  <b>use </b></span><b><span style='font-size:11.0pt;line-height:121%;
  font-family:Consolas;color:#990000'>Symfony</span></b><span style='font-size:
  11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>Component</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>HttpFoundation</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>RequestStack</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>;
  <b>use </b></span><b><span style='font-size:11.0pt;line-height:121%;
  font-family:Consolas;color:#990000'>Drupal</span></b><span style='font-size:
  11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>Core</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>Entity</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>EntityStorageInterface</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>;
  <b>use </b></span><b><span style='font-size:11.0pt;line-height:121%;
  font-family:Consolas;color:#990000'>Drupal</span></b><span style='font-size:
  11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>offer</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>OfferPreprocess</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>OfferPreprocess</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:0in;text-indent:0in;line-height:107%'><i><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>/**</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  </span></span><i><span style='font-size:11.0pt;line-height:107%;font-family:
  Consolas;color:#DD1144'>@Block</span></i><i><span style='font-size:11.0pt;
  line-height:107%;font-family:Consolas;color:#999988'>(</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  </span></span><i><span style='font-size:11.0pt;line-height:107%;font-family:
  Consolas;color:#999988'>id = &quot;offer_bidding_table_block&quot;,</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  </span></span><i><span style='font-size:11.0pt;line-height:107%;font-family:
  Consolas;color:#999988'>admin_label = </span></i><i><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>@Translation</span></i><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>(&quot;Bidding
  table block&quot;),</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  </span></span><i><span style='font-size:11.0pt;line-height:107%;font-family:
  Consolas;color:#999988'>category = </span></i><i><span style='font-size:11.0pt;
  line-height:107%;font-family:Consolas;color:#DD1144'>@Translation</span></i><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>(&quot;Shows
  the bidding table to an offer&quot;),</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:15.8pt;
  margin-left:0in;text-indent:0in;line-height:115%'><span style='font-size:
  11.0pt;line-height:115%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  </span></span><i><span style='font-size:11.0pt;line-height:115%;font-family:
  Consolas;color:#999988'>)*/</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:0in;text-indent:0in;line-height:107%'><b><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>class </span></b><b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#445588'>OfferBiddingTableBlock
  </span></b><b><span style='font-size:11.0pt;line-height:107%;font-family:
  Consolas;color:#333333'>extends </span></b><b><span style='font-size:11.0pt;
  line-height:107%;font-family:Consolas;color:#445588'>BlockBase </span></b><b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>implements</span></b></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:15.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><b><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#445588'>ContainerFactoryPluginInterface
  </span></b><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#333333'>{</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>/**</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  </span></span><i><span style='font-size:11.0pt;line-height:107%;font-family:
  Consolas;color:#999988'>The request object.</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  </span></span><i><span style='font-size:11.0pt;line-height:107%;font-family:
  Consolas;color:#DD1144'>@var </span></i><i><span style='font-size:11.0pt;
  line-height:107%;font-family:Consolas;color:#999988'>\Symfony\Component\HttpFoundation\RequestStack</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:288.65pt;margin-bottom:
  0in;margin-left:6.05pt;text-indent:6.05pt;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*/
  </span></i><b><span style='font-size:11.0pt;line-height:107%;font-family:
  Consolas;color:#333333'>protected </span></b><span style='font-size:11.0pt;
  line-height:107%;font-family:Consolas;color:#333333'>$requestStack;</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.55pt;margin-bottom:0in;
margin-left:-1.0in;text-indent:0in;line-height:107%'>&nbsp;</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:685.5pt'>
  <td width=601 valign=bottom style='width:450.75pt;background:#F8F8F8;
  padding:0in 5.75pt 0in 5.25pt;height:685.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>/**</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>The
  entity storage.</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>@var
  </span></i><i><span style='font-size:11.0pt;line-height:107%;font-family:
  Consolas;color:#999988'>\Drupal\Core\Entity\EntityStorageInterface</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:282.6pt;margin-bottom:
  14.2pt;margin-left:6.05pt;text-indent:6.05pt;line-height:121%'><i><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#999988'>*/
  </span></i><b><span style='font-size:11.0pt;line-height:121%;font-family:
  Consolas;color:#333333'>protected </span></b><span style='font-size:11.0pt;
  line-height:121%;font-family:Consolas;color:#333333'>$entityStorage;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>/**</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>Constructs
  a new OfferBiddingTableBlock instance.</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>@param
  </span></i><i><span style='font-size:11.0pt;line-height:107%;font-family:
  Consolas;color:#999988'>string $plugin_id</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>The
  plugin_id for the plugin instance.</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>@param
  </span></i><i><span style='font-size:11.0pt;line-height:107%;font-family:
  Consolas;color:#999988'>mixed $plugin_definition</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>The
  plugin implementation definition.</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.8pt;
  margin-left:12.1pt;text-indent:0in;line-height:115%'><span style='font-size:
  11.0pt;line-height:115%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#DD1144'>@param
  </span></i><i><span style='font-size:11.0pt;line-height:115%;font-family:
  Consolas;color:#999988'>\Symfony\Component\HttpFoundation\RequestStack
  $request_stack *   The request stack object.</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:12.1pt;text-indent:0in;line-height:115%'><span style='font-size:
  11.0pt;line-height:115%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#DD1144'>@param
  </span></i><i><span style='font-size:11.0pt;line-height:115%;font-family:
  Consolas;color:#999988'>\Drupal\Core\Entity\EntityStorageInterface
  $entity_storage *   The entity storage.</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:65.05pt;margin-bottom:
  0in;margin-left:6.05pt;text-indent:6.05pt;line-height:121%'><i><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#999988'>*/
  </span></i><b><span style='font-size:11.0pt;line-height:121%;font-family:
  Consolas;color:#333333'>public function </span></b><b><span style='font-size:
  11.0pt;line-height:121%;font-family:Consolas;color:#990000'>__construct</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>(array
  $configuration, $plugin_id,</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$plugin_definition,
  RequestStack $request_stack, EntityStorageInterface</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:10.65pt;margin-bottom:
  14.2pt;margin-left:18.15pt;text-indent:-18.15pt;line-height:121%'><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>$entity_storage)
  { <b>parent</b>::__construct($configuration, $plugin_id, $plugin_definition);</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$this</span></b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>-&gt;requestStack
  = $request_stack;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$this</span></b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>-&gt;entityStorage
  = $entity_storage;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:15.95pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>/**</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>{</span></i><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>@inheritdoc</span></i><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>}</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:34.8pt;margin-bottom:
  0in;margin-left:6.05pt;text-indent:6.05pt;line-height:121%'><i><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#999988'>*/
  </span></i><b><span style='font-size:11.0pt;line-height:121%;font-family:
  Consolas;color:#333333'>public static function </span></b><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>create</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>(ContainerInterface
  $container, array</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:107.35pt;margin-bottom:
  0in;margin-left:18.15pt;text-indent:-18.15pt;line-height:121%'><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>$configuration,
  $plugin_id, $plugin_definition) { <b>return new static</b>(</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:30.2pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$configuration,</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:30.2pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$plugin_id,</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:30.2pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$plugin_definition,</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:30.2pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$container-&gt;get(</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'request_stack'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>),</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:30.2pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$container-&gt;get(</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'entity_type.manager'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>)-&gt;getStorage(</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'offer'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>)</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>);</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:15.95pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>/**</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*
  {</span></i><i><span style='font-size:11.0pt;line-height:107%;font-family:
  Consolas;color:#DD1144'>@inheritdoc</span></i><i><span style='font-size:11.0pt;
  line-height:107%;font-family:Consolas;color:#999988'>}</span></i></p>
  </td>
 </tr>
 <tr style='height:280.5pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
  height:280.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:282.6pt;margin-bottom:
  0in;margin-left:6.05pt;text-indent:6.05pt;line-height:121%'><i><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#999988'>*/
  </span></i><b><span style='font-size:11.0pt;line-height:121%;font-family:
  Consolas;color:#333333'>public function </span></b><b><span style='font-size:
  11.0pt;line-height:121%;font-family:Consolas;color:#990000'>build</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>()
  {</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:34.8pt;margin-bottom:
  0in;margin-left:18.15pt;text-indent:0in;line-height:118%'><span
  style='font-size:11.0pt;line-height:118%;font-family:Consolas;color:#333333'>$offer
  = <b>$this</b>-&gt;requestStack-&gt;getCurrentRequest()-&gt;get(</span><span
  style='font-size:11.0pt;line-height:118%;font-family:Consolas;color:#DD1144'>'offer'</span><span
  style='font-size:11.0pt;line-height:118%;font-family:Consolas;color:#333333'>);
  <b>if</b>(!$offer) { <b>return null</b>;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:89.2pt;margin-bottom:
  0in;margin-left:18.15pt;text-indent:0in;line-height:121%'><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>$bid_table
  = OfferPreprocess::offerTable($offer); <b>return </b>$bid_table;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:15.95pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>/**</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*
  Never cache this block (for now)</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:228.2pt;margin-bottom:
  0in;margin-left:6.05pt;text-indent:6.05pt;line-height:121%'><i><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#999988'>*/
  </span></i><b><span style='font-size:11.0pt;line-height:121%;font-family:
  Consolas;color:#333333'>public function </span></b><b><span style='font-size:
  11.0pt;line-height:121%;font-family:Consolas;color:#990000'>getCacheMaxAge</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>()
  { <b>return </b></span><span style='font-size:11.0pt;line-height:121%;
  font-family:Consolas;color:teal'>0</span><span style='font-size:11.0pt;
  line-height:121%;font-family:Consolas;color:#333333'>;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:15.95pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:2.1pt;
margin-left:-.25pt'>We get the table from our OfferPreprocess class and render
it in the same way we did with our form: by making use of the request stack
services to get the current offer.</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=600
 style='width:6.25in;border-collapse:collapse'>
 <tr style='height:94.5pt'>
  <td width=59 valign=top style='width:44.25pt;background:#E2E3E5;padding:14.6pt 5.75pt 0in 0in;
  height:94.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:14.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%'>&#128187;</span></p>
  </td>
  <td width=541 valign=top style='width:405.75pt;background:#E2E3E5;padding:
  14.6pt 5.75pt 0in 0in;height:94.5pt'>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'>Clear
  caches and add the block to the bottom of the content region at <u>/admin/structure/blocks</u>.
  Restrict for authenticated users and set page visibility only at <i>/offer/* </i>like
  we did for the bidding form<i>.</i></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
style='font-size:11.0pt;line-height:107%'><img border=0 width=602 height=857
src="Learning%20drupal%209%20as%20a%20framework_files/image100.gif"></span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:3.5pt;
margin-left:-.25pt'>You’ll now see a nicely rendered table with the bids. We
will add a nice looking profile picture and some layout later on.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:-1.7pt;margin-bottom:
43.1pt;margin-left:1.5pt;text-indent:0in;line-height:107%'><img border=0
width=602 height=213 id="Picture 15894"
src="Learning%20drupal%209%20as%20a%20framework_files/image101.jpg"></p>

<h2 style='margin-top:0in;margin-right:0in;margin-bottom:3.55pt;margin-left:
-.25pt'><a name="_Toc247071">Integrating the core revision system into the
bidding process to raise a bid</a></h2>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=600
 style='width:6.25in;border-collapse:collapse'>
 <tr style='height:69.0pt'>
  <td width=59 valign=top style='width:44.25pt;background:#6D9EEB;padding:14.6pt 5.75pt 0in 0in;
  height:69.0pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:14.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%'>&#128073;</span></p>
  </td>
  <td width=541 style='width:405.75pt;background:#6D9EEB;padding:14.6pt 5.75pt 0in 0in;
  height:69.0pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:4.3pt;margin-bottom:
  0in;margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%'>In this important chapter we integrate the <b>core
  revisioning </b>system into our platform. This allows us to modify our
  entities while keeping a <b>history of changes</b>.</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:.8pt;
margin-left:-.25pt'>When a user raises his bid we will not save this as a new
entity but as a revision of his current bid.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>This allows us to nicely show a “user x raised his bid with
4$” message to the table. It also adds a variety of options when our software
platforms grows larger. Because ultimately, a raising of a bid <i>is </i>a
revision of a current bid and not a new bid.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:2.1pt;
margin-left:-.25pt'>First, we need a new method to check if the offer the user
is looking at already has bids from him/her. To <b>custom/modules/offer/src/Entity/Offer.php
</b>we add a method for it:</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:130.5pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
  height:130.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:0in;text-indent:0in;line-height:107%'><i><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>/**</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:18.15pt;text-indent:-18.15pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>Checks
  if the current user has bids on the current offer</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:18.15pt;text-indent:-18.15pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>@return
  </span></i><i><span style='font-size:11.0pt;line-height:107%;font-family:
  Consolas;color:#999988'>bool</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:18.15pt;text-indent:-18.15pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>True
  if it has, false if it doesn't</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:210.1pt;margin-bottom:
  0in;margin-left:0in;text-indent:0in;line-height:121%'><i><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#999988'>*/
  </span></i><b><span style='font-size:11.0pt;line-height:121%;font-family:
  Consolas;color:#333333'>public function </span></b><b><span style='font-size:
  11.0pt;line-height:121%;font-family:Consolas;color:#990000'>CurrentUserHasBids</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>()
  {</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$user_id =
  \Drupal::currentUser()-&gt;id();</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$id = <b>$this</b>-&gt;id();</span></p>
  </td>
 </tr>
 <tr style='height:160.5pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
  height:160.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$query =
  \Drupal::entityQuery(</span><span style='font-size:11.0pt;line-height:107%;
  font-family:Consolas;color:#DD1144'>'bid'</span><span style='font-size:11.0pt;
  line-height:107%;font-family:Consolas;color:#333333'>)</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>-&gt;condition(</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'offer_id'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>,
  $id)</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:216.1pt;margin-bottom:
  .25pt;margin-left:6.05pt;text-indent:12.1pt;line-height:119%'><span
  style='font-size:11.0pt;line-height:119%;font-family:Consolas;color:#333333'>-&gt;condition(</span><span
  style='font-size:11.0pt;line-height:119%;font-family:Consolas;color:#DD1144'>'user_id'</span><span
  style='font-size:11.0pt;line-height:119%;font-family:Consolas;color:#333333'>,
  $user_id); $count = $query-&gt;count()-&gt;execute(); <b>if</b>($count &gt; </span><span
  style='font-size:11.0pt;line-height:119%;font-family:Consolas;color:teal'>0</span><span
  style='font-size:11.0pt;line-height:119%;font-family:Consolas;color:#333333'>)
  { <b>return true</b>;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>} <b>else </b>{</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>return
  false</span></b><span style='font-size:11.0pt;line-height:107%;font-family:
  Consolas;color:#333333'>;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>Now, in our form we change the label of the submit button
dependent on the previous function to from “Submit” to “Raise my bid”</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:2.1pt;
margin-left:-.25pt'>Inside <b>custom/offer/src/Form/OfferBiddingForm</b>, to
the <i>buildForm() </i>method we add above $form[‘actions’]:</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:175.5pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
  height:175.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:0in;text-indent:0in;line-height:107%'><i><span style='font-family:
  Consolas;color:#999988'>// Group submit handlers in an actions element with a
  key of</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:0in;text-indent:0in;line-height:107%'><i><span style='font-family:
  Consolas;color:#999988'>&quot;actions&quot;</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.1pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>$currentUserHasBid = $offer-&gt;CurrentUserHasBids();</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.9pt;
  margin-left:0in;text-indent:0in;line-height:116%'><span style='font-family:
  Consolas;color:#333333'>$callToAction = $currentUserHasBid ? <b>$this</b>-&gt;t(</span><span
  style='font-family:Consolas;color:#DD1144'>'Raise my bid'</span><span
  style='font-family:Consolas;color:#333333'>) : <b>$this</b>-&gt;t(</span><span
  style='font-family:Consolas;color:#DD1144'>'Submit'</span><span
  style='font-family:Consolas;color:#333333'>);</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:0in;text-indent:0in;line-height:107%'><i><span style='font-family:
  Consolas;color:#999988'>// Add a submit button that handles the submission of
  the form.</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.1pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>$form[</span><span style='font-family:Consolas;
  color:#DD1144'>'actions'</span><span style='font-family:Consolas;color:#333333'>][</span><span
  style='font-family:Consolas;color:#DD1144'>'submit'</span><span
  style='font-family:Consolas;color:#333333'>] = [</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.1pt;
  margin-left:13.2pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#DD1144'>'#type' </span><span style='font-family:Consolas;
  color:#333333'>=&gt; </span><span style='font-family:Consolas;color:#DD1144'>'submit'</span><span
  style='font-family:Consolas;color:#333333'>,</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:13.2pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#DD1144'>'#value' </span><span style='font-family:Consolas;
  color:#333333'>=&gt; $callToAction,</span></p>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-family:Consolas;color:#333333'>];</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>Now in our <i>submitForm</i>() function, dependent on the <i>currentUserHasBids()
</i>result we save the offer as a revision instead of a new entity.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:2.1pt;
margin-left:-.25pt'>Once again we need a helper method on the offer entity to
get the bid entity from the current user. To <b>custom/modules/offer/src/Entity/Offer.php
</b>we add:</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:130.5pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
  height:130.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><i><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>/**</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:18.15pt;text-indent:-18.15pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>Returns
  the current users bid on the offer</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:18.15pt;text-indent:-18.15pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>@return
  </span></i><i><span style='font-size:11.0pt;line-height:107%;font-family:
  Consolas;color:#999988'>Drupal\bid\Entity\Bid Bid</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:18.15pt;text-indent:-18.15pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>The
  offer entity</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:276.55pt;margin-bottom:
  0in;margin-left:0in;text-indent:0in;line-height:121%'><i><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#999988'>*/
  </span></i><b><span style='font-size:11.0pt;line-height:121%;font-family:
  Consolas;color:#333333'>function </span></b><b><span style='font-size:11.0pt;
  line-height:121%;font-family:Consolas;color:#990000'>currentUserBid</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>()
  {</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$user_id =
  \Drupal::currentUser()-&gt;id();</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$id = <b>$this</b>-&gt;id();</span></p>
  </td>
 </tr>
 <tr style='height:130.5pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
  height:130.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$query =
  \Drupal::entityQuery(</span><span style='font-size:11.0pt;line-height:107%;
  font-family:Consolas;color:#DD1144'>'bid'</span><span style='font-size:11.0pt;
  line-height:107%;font-family:Consolas;color:#333333'>)</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>-&gt;condition(</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'offer_id'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>,
  $id)</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>-&gt;condition(</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'user_id'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>,
  $user_id);</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$result =
  $query-&gt;execute();</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:264.45pt;margin-bottom:
  0in;margin-left:6.05pt;text-indent:0in;line-height:118%'><span
  style='font-size:11.0pt;line-height:118%;font-family:Consolas;color:#333333'>$bidId
  = reset($result); $bid = Bid::load($bidId); <b>return </b>$bid;</span></p>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:2.1pt;
margin-left:-.25pt'>In our <i>submitForm() </i>function, before our validation
we integrate our revisions. We save as a new revision if the user raises his
bid, we save it as a new bid if he hasn’t done any bids yet:</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:475.5pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
  height:475.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><i><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>// Save as new
  revision of existing bid if user already has bids</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><i><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>// Save as new
  bid if not</span></i></p>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:115%'><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>$offer
  = Offer::load($form_state-&gt;getValue(</span><span style='font-size:11.0pt;
  line-height:115%;font-family:Consolas;color:#DD1144'>'offer_id'</span><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>));
  <b>if</b>($offer-&gt;currentUserHasBids()) {</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$bid =
  $offer-&gt;currentUserBid();</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$bid-&gt;set(</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'bid'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>,
  $form_state-&gt;getValue(</span><span style='font-size:11.0pt;line-height:
  107%;font-family:Consolas;color:#DD1144'>'bid'</span><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>));</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:6.05pt;text-indent:0in;line-height:121%'><span style='font-size:
  11.0pt;line-height:121%;font-family:Consolas;color:#333333'>$bid-&gt;set(</span><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#DD1144'>'user_id'</span><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>,
  [</span><span style='font-size:11.0pt;line-height:121%;font-family:Consolas;
  color:#DD1144'>'target_id' </span><span style='font-size:11.0pt;line-height:
  121%;font-family:Consolas;color:#333333'>=&gt;
  \Drupal::currentUser()-&gt;id()]); $bid-&gt;set(</span><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#DD1144'>'offer_id'</span><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>,
  [</span><span style='font-size:11.0pt;line-height:121%;font-family:Consolas;
  color:#DD1144'>'target_id' </span><span style='font-size:11.0pt;line-height:
  121%;font-family:Consolas;color:#333333'>=&gt;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$form_state-&gt;getValue(</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'offer_id'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>)]);</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$bid-&gt;setNewRevision();</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$bid-&gt;setRe</span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>/**</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:18.15pt;text-indent:-18.15pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>Checks
  if the bid has revisions</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:18.15pt;text-indent:-18.15pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>@return
  </span></i><i><span style='font-size:11.0pt;line-height:107%;font-family:
  Consolas;color:#999988'>bool</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:18.15pt;text-indent:-18.15pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>True
  if it has, false if it does not</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:246.35pt;margin-bottom:
  0in;margin-left:0in;text-indent:0in;line-height:121%'><i><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#999988'>*/
  </span></i><b><span style='font-size:11.0pt;line-height:121%;font-family:
  Consolas;color:#333333'>public function </span></b><b><span style='font-size:
  11.0pt;line-height:121%;font-family:Consolas;color:#990000'>hasRevisions</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>()
  {</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$id = <b>$this</b>-&gt;id();</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:113.4pt;margin-bottom:
  0in;margin-left:18.15pt;text-indent:-12.1pt;line-height:115%'><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>$query
  = \Drupal::entityQuery(</span><span style='font-size:11.0pt;line-height:115%;
  font-family:Consolas;color:#DD1144'>'bid'</span><span style='font-size:11.0pt;
  line-height:115%;font-family:Consolas;color:#333333'>) -&gt;condition(</span><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#DD1144'>'id'</span><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>,
  $id);</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:119.45pt;margin-bottom:
  0in;margin-left:6.05pt;text-indent:0in;line-height:121%'><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>$count
  = $query-&gt;allRevisions()-&gt;count()-&gt;execute(); <b>if</b>($count &gt; </span><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:teal'>1</span><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>)
  { <b>return true</b>;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>} <b>else </b>{</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>return
  false</span></b><span style='font-size:11.0pt;line-height:107%;font-family:
  Consolas;color:#333333'>;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:15.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:0in;text-indent:0in;line-height:107%'><i><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>/**</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:2.3pt;margin-bottom:
  .8pt;margin-left:0in;text-indent:0in;line-height:115%'><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  </span></span><i><span style='font-size:11.0pt;line-height:115%;font-family:
  Consolas;color:#999988'>Returns list of revision entity ids of the bid. Key
  is the revision ID.</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:2.3pt;margin-bottom:
  0in;margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  </span></span><i><span style='font-size:11.0pt;line-height:107%;font-family:
  Consolas;color:#DD1144'>@return </span></i><i><span style='font-size:11.0pt;
  line-height:107%;font-family:Consolas;color:#999988'>array</span></i></p>
  </td>
 </tr>
 <tr style='height:130.5pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
  height:130.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:222.15pt;margin-bottom:
  0in;margin-left:0in;text-indent:0in;line-height:121%'><i><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#999988'>*/
  </span></i><b><span style='font-size:11.0pt;line-height:121%;font-family:
  Consolas;color:#333333'>public function </span></b><b><span style='font-size:
  11.0pt;line-height:121%;font-family:Consolas;color:#990000'>getRevisionsList</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>()
  {</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$id = <b>$this</b>-&gt;id();</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:113.4pt;margin-bottom:
  0in;margin-left:18.15pt;text-indent:-12.1pt;line-height:115%'><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>$query
  = \Drupal::entityQuery(</span><span style='font-size:11.0pt;line-height:115%;
  font-family:Consolas;color:#DD1144'>'bid'</span><span style='font-size:11.0pt;
  line-height:115%;font-family:Consolas;color:#333333'>) -&gt;condition(</span><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#DD1144'>'id'</span><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>,
  $id);</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:113.4pt;margin-bottom:
  0in;margin-left:6.05pt;text-indent:0in;line-height:121%'><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>$revisions
  = $query-&gt;allRevisions()-&gt;execute(); <b>return </b>$revisions;</span></p>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>Drupal cores revision system does a great deal of the heavy
lifting. We will now add a ‘raise’ icon to our bid table when a bid has been
raised. Another possible feature, for example, is to add actions like sending
emails to all other bidders based on this.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:2.1pt;
margin-left:-.25pt'>To include revision information to our bid table, we’ll add
some helper methods to our entities first. To our <b>custom/bid/src/Entity/Bid.php</b>,
we add two methods. The first is to track if a bid has revisions, the second is
a list of all the revision ids:</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:415.5pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
  height:415.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><i><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>/**</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:18.15pt;text-indent:-18.15pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>Checks
  if the bid has revisions</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:18.15pt;text-indent:-18.15pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>@return
  </span></i><i><span style='font-size:11.0pt;line-height:107%;font-family:
  Consolas;color:#999988'>bool</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:18.15pt;text-indent:-18.15pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>True
  if it has, false if it does not</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:246.35pt;margin-bottom:
  0in;margin-left:0in;text-indent:0in;line-height:121%'><i><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#999988'>*/
  </span></i><b><span style='font-size:11.0pt;line-height:121%;font-family:
  Consolas;color:#333333'>public function </span></b><b><span style='font-size:
  11.0pt;line-height:121%;font-family:Consolas;color:#990000'>hasRevisions</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>()
  {</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$id = <b>$this</b>-&gt;id();</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:113.4pt;margin-bottom:
  0in;margin-left:18.15pt;text-indent:-12.1pt;line-height:115%'><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>$query
  = \Drupal::entityQuery(</span><span style='font-size:11.0pt;line-height:115%;
  font-family:Consolas;color:#DD1144'>'bid'</span><span style='font-size:11.0pt;
  line-height:115%;font-family:Consolas;color:#333333'>) -&gt;condition(</span><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#DD1144'>'id'</span><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>,
  $id);</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:119.45pt;margin-bottom:
  0in;margin-left:6.05pt;text-indent:0in;line-height:121%'><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>$count
  = $query-&gt;allRevisions()-&gt;count()-&gt;execute(); <b>if</b>($count &gt; </span><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:teal'>1</span><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>)
  { <b>return true</b>;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>} <b>else </b>{</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>return
  false</span></b><span style='font-size:11.0pt;line-height:107%;font-family:
  Consolas;color:#333333'>;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:15.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:0in;text-indent:0in;line-height:107%'><i><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>/**</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:2.3pt;margin-bottom:
  .8pt;margin-left:0in;text-indent:0in;line-height:115%'><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  </span></span><i><span style='font-size:11.0pt;line-height:115%;font-family:
  Consolas;color:#999988'>Returns list of revision entity ids of the bid. Key
  is the revision ID.</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:2.3pt;margin-bottom:
  .95pt;margin-left:0in;text-indent:0in;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  </span></span><i><span style='font-size:11.0pt;line-height:107%;font-family:
  Consolas;color:#DD1144'>@return </span></i><i><span style='font-size:11.0pt;
  line-height:107%;font-family:Consolas;color:#999988'>array</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:222.15pt;margin-bottom:
  0in;margin-left:0in;text-indent:0in;line-height:121%'><i><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#999988'>*/
  </span></i><b><span style='font-size:11.0pt;line-height:121%;font-family:
  Consolas;color:#333333'>public function </span></b><b><span style='font-size:
  11.0pt;line-height:121%;font-family:Consolas;color:#990000'>getRevisionsList</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>()
  {</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$id = <b>$this</b>-&gt;id();</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:113.4pt;margin-bottom:
  0in;margin-left:18.15pt;text-indent:-12.1pt;line-height:115%'><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>$query
  = \Drupal::entityQuery(</span><span style='font-size:11.0pt;line-height:115%;
  font-family:Consolas;color:#DD1144'>'bid'</span><span style='font-size:11.0pt;
  line-height:115%;font-family:Consolas;color:#333333'>) -&gt;condition(</span><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#DD1144'>'id'</span><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>,
  $id);</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$revisions =
  $query-&gt;allRevisions()-&gt;execute();</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:76.6pt;margin-bottom:
.8pt;margin-left:8.4pt;line-height:111%;background:#F8F8F8'><b><span
style='font-size:11.0pt;line-height:111%;font-family:Consolas;color:#333333'>return
</span></b><span style='font-size:11.0pt;line-height:111%;font-family:Consolas;
color:#333333'>$revisions;</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:76.6pt;margin-bottom:
23.25pt;margin-left:8.4pt;line-height:111%;background:#F8F8F8'><span
style='font-size:11.0pt;line-height:111%;font-family:Consolas;color:#333333'>}</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:18.85pt;
margin-left:-.25pt;line-height:110%'>We’ll include these two methods in the <b>custom/offer/src/OfferPreprocess/OfferPreprocess.php
</b><i>offerTable() </i>method.</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=600
 style='width:6.25in;border-collapse:collapse'>
 <tr style='height:42.75pt'>
  <td width=59 style='width:44.25pt;background:#E2E3E5;padding:0in 5.75pt 0in 0in;
  height:42.75pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:14.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%'>&#128187;</span></p>
  </td>
  <td width=541 style='width:405.75pt;background:#E2E3E5;padding:0in 5.75pt 0in 0in;
  height:42.75pt'>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><b><span
  style='font-family:Consolas;color:#333333;background:#F8F8F8'>use </span></b><b><span
  style='font-family:Consolas;color:#990000;background:#F8F8F8'>Drupal</span></b><span
  style='font-family:Consolas;color:#333333;background:#F8F8F8'>\</span><b><span
  style='font-family:Consolas;color:#990000;background:#F8F8F8'>Core</span></b><span
  style='font-family:Consolas;color:#333333;background:#F8F8F8'>\</span><b><span
  style='font-family:Consolas;color:#990000;background:#F8F8F8'>Render</span></b><span
  style='font-family:Consolas;color:#333333;background:#F8F8F8'>\</span><b><span
  style='font-family:Consolas;color:#990000;background:#F8F8F8'>Markup</span></b><span
  style='font-family:Consolas;color:#333333;background:#F8F8F8'>; </span><i><span
  style='font-family:Consolas;color:#999988;background:#F8F8F8'>// on top of
  file</span></i></p>
  </td>
 </tr>
 <tr style='height:505.5pt'>
  <td width=600 colspan=2 style='width:6.25in;background:#F8F8F8;padding:0in 5.75pt 0in 0in;
  height:505.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><i><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>/**</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>Returns
  rendered table below an offer</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.8pt;
  margin-left:6.05pt;text-indent:0in;line-height:115%'><span style='font-size:
  11.0pt;line-height:115%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#DD1144'>@param
  </span></i><i><span style='font-size:11.0pt;line-height:115%;font-family:
  Consolas;color:#999988'>entity $offer *  The offer entity</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>@return
  </span></i><i><span style='font-size:11.0pt;line-height:107%;font-family:
  Consolas;color:#999988'>array $table</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>Drupal
  table render array</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:139.0pt;margin-bottom:
  0in;margin-left:0in;text-indent:6.05pt;line-height:121%'><i><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#999988'>*/
  </span></i><b><span style='font-size:11.0pt;line-height:121%;font-family:
  Consolas;color:#333333'>public static function </span></b><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>offerTable</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>(Offer
  $offer) {</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:15.95pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$bids =
  $offer-&gt;getOfferBids();</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:278.0pt;margin-bottom:
  0in;margin-left:12.1pt;text-indent:0in;line-height:121%'><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>$rows
  = []; <b>foreach</b>($bids <b>as </b>$bid) {</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:24.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$price =
  $bid-&gt;get(</span><span style='font-size:11.0pt;line-height:107%;
  font-family:Consolas;color:#DD1144'>'bid'</span><span style='font-size:11.0pt;
  line-height:107%;font-family:Consolas;color:#333333'>)-&gt;getString();</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:24.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$owner =
  $bid-&gt;getOwner();</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:151.1pt;margin-bottom:
  0in;margin-left:24.15pt;text-indent:0in;line-height:115%'><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>$ownerName
  = $owner-&gt;getDisplayName(); $time =</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:15.8pt;
  margin-left:0in;text-align:justify;text-justify:inter-ideograph;text-indent:
  0in;line-height:115%'><span style='font-size:11.0pt;line-height:115%;
  font-family:Consolas;color:#333333'>\Drupal::service(</span><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#DD1144'>'date.formatter'</span><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>)-&gt;formatTimeDiffSince($bid-&gt;created-&gt;v
  alue);</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:253.85pt;margin-bottom:
  0in;margin-left:24.15pt;text-indent:0in;line-height:118%'><span
  style='font-size:11.0pt;line-height:118%;font-family:Consolas;color:#333333'>$updates
  = </span><span style='font-size:11.0pt;line-height:118%;font-family:Consolas;
  color:#DD1144'>''</span><span style='font-size:11.0pt;line-height:118%;
  font-family:Consolas;color:#333333'>; $link = </span><span style='font-size:
  11.0pt;line-height:118%;font-family:Consolas;color:#DD1144'>''</span><span
  style='font-size:11.0pt;line-height:118%;font-family:Consolas;color:#333333'>;
  <b>if</b>($bid-&gt;hasRevisions()) {</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:157.15pt;margin-bottom:
  .8pt;margin-left:36.25pt;text-indent:0in;line-height:115%'><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>$revisions
  = $bid-&gt;getRevisionsList(); </span><i><span style='font-size:11.0pt;
  line-height:115%;font-family:Consolas;color:#999988'>// We now have the list
  of revisions.</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:36.25pt;text-indent:0in;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>//
  Let's compare the latest bid with the last revision</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:36.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$current_revision_id
  = $bid-&gt;getLoadedRevisionId();</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:36.25pt;text-indent:0in;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>//
  We now know the current, we want the one before the current</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.8pt;
  margin-left:36.25pt;text-indent:0in;line-height:115%'><i><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#999988'>//
  We remove the current from the revisions list </span></i><b><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>unset</span></b><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>($revisions[$current_revision_id]);</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:36.25pt;margin-bottom:
  0in;margin-left:36.25pt;text-indent:0in;line-height:115%'><i><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#999988'>//
  And take the last one from the revisions list </span></i><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>$last_revision_id
  = max(array_keys($revisions)); $revisionBid = \Drupal::entityTypeManager()</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:48.35pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>-&gt;getStorage(</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'bid'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>)</span></p>
  </td>
 </tr>
 <tr style='height:460.5pt'>
  <td width=600 colspan=2 style='width:6.25in;background:#F8F8F8;padding:0in 5.75pt 0in 0in;
  height:460.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:48.35pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>-&gt;loadRevision($last_revision_id);</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:36.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$revisionAmount =
  $revisionBid-&gt;get(</span><span style='font-size:11.0pt;line-height:107%;
  font-family:Consolas;color:#DD1144'>'bid'</span><span style='font-size:11.0pt;
  line-height:107%;font-family:Consolas;color:#333333'>)-&gt;getString();</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:36.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$priceDifference
  = $price - $revisionAmount;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.8pt;
  margin-left:0in;text-indent:36.25pt;line-height:115%'><span style='font-size:
  11.0pt;line-height:115%;font-family:Consolas;color:#333333'>$updates = </span><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#DD1144'>'&lt;svg
  width=&quot;24px&quot; height=&quot;18px&quot; viewBox=&quot;0 0 24 24&quot;
  fill=&quot;#61f70a&quot; xmlns=&quot;http://www.w3.org/2000/svg&quot;&gt;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:36.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>&lt;path
  d=&quot;M6.1018 16.9814C5.02785 16.9814 4.45387 15.7165 5.16108</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>14.9083L10.6829
  8.59762C11.3801 7.80079 12.6197 7.80079 13.3169</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>8.59762L18.8388
  14.9083C19.5459 15.7165 18.972 16.9814 17.898</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>16.9814H6.1018Z&quot;
  fill=&quot;#61f70a&quot;/&gt;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:36.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>&lt;/svg&gt;&lt;small
  style=&quot;color:#0444C4&quot;&gt;Last raise was ' </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>.</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$priceDifference
  .</span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#DD1144'>'$&lt;/small&gt;'</span><span style='font-size:11.0pt;
  line-height:107%;font-family:Consolas;color:#333333'>;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:15.95pt;
  margin-left:24.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:24.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$row = [</span></p>
  <p class=MsoNormal style='margin:0in;text-indent:36.25pt;line-height:121%'><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>Markup::create($ownerName
  . </span><span style='font-size:11.0pt;line-height:121%;font-family:Consolas;
  color:#DD1144'>' - ' </span><span style='font-size:11.0pt;line-height:121%;
  font-family:Consolas;color:#333333'>. $time . </span><span style='font-size:
  11.0pt;line-height:121%;font-family:Consolas;color:#DD1144'>' ago'</span><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>),
  Markup::create($price . </span><span style='font-size:11.0pt;line-height:
  121%;font-family:Consolas;color:#DD1144'>'$' </span><span style='font-size:
  11.0pt;line-height:121%;font-family:Consolas;color:#333333'>. $updates)</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:24.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>];</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:24.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$rows[] = $row;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:15.95pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$build[</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'table'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>]
  = [</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:24.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'#type' </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>=&gt;
  </span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#DD1144'>'table'</span><span style='font-size:11.0pt;line-height:107%;
  font-family:Consolas;color:#333333'>,</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:24.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'#rows' </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>=&gt;
  $rows,</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:24.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'#empty' </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>=&gt;
  t(</span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#DD1144'>'This offer has no bids yet. Grab your chance!'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>),</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:379.3pt;margin-bottom:
  0in;margin-left:12.1pt;text-indent:0in;line-height:121%'><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>];
  <b>return </b>[</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:24.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'#type' </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>=&gt;
  </span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#DD1144'>'#markup'</span><span style='font-size:11.0pt;line-height:
  107%;font-family:Consolas;color:#333333'>,</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:24.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'#markup' </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>=&gt;
  render($build)</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>];</span></p>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:3.5pt;
margin-left:-.25pt'>The result of all this is that in the bid table a notice
appears that indicates that the bid was raised.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:1.5pt;text-indent:0in;line-height:107%'><img border=0 width=256
height=190 id="Picture 16621"
src="Learning%20drupal%209%20as%20a%20framework_files/image102.jpg"></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:30.4pt;
margin-left:-.25pt'>Revisions are complete entities stored aside from our bid
entities. We now took advantage of this quite complex system to store
differences, like a raise of a bid.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:15.1pt;margin-bottom:
31.15pt;margin-left:14.0pt;line-height:110%;background:#FFD966'><span
style='font-size:11.0pt;line-height:110%'>Think about the possibilities of
this. You could show a detailed table overview or graphic of the bidding
history.</span></p>

<h2 style='margin-top:0in;margin-right:0in;margin-bottom:3.55pt;margin-left:
-.25pt'><a name="_Toc247072">Deleting a bid with a core dialog pop-up</a></h2>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=600
 style='width:6.25in;border-collapse:collapse'>
 <tr style='height:69.0pt'>
  <td width=59 valign=top style='width:44.25pt;background:#6D9EEB;padding:14.6pt 5.75pt 0in 0in;
  height:69.0pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:14.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%'>&#128073;</span></p>
  </td>
  <td width=541 style='width:405.75pt;background:#6D9EEB;padding:14.6pt 5.75pt 0in 0in;
  height:69.0pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:9.55pt;margin-bottom:
  0in;margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%'>In this chapter we explore the drupal API system
  further. First, we will create a <b>delete form </b>to make it possible to
  delete your own bids. Second, we will open the form with a <b>core dialog
  pop-up</b>, to make sure you stay on the page.</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:20.75pt;
margin-left:-.25pt'>Users need to have the possibility to delete a bid when
they want to. Again, we use the standard entity behaviours for the deletion. To
<b>custom/bid/src/Entity/bid.php</b>, we add a delete link:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.45pt;
margin-left:52.85pt;text-indent:-48.35pt;line-height:110%;background:#F8F8F8'><span
style='font-size:11.0pt;line-height:110%;font-family:Consolas;color:#333333'>*<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><i><span style='font-size:11.0pt;line-height:110%;font-family:
Consolas;color:#333333'>handlers = {</span></i></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.75pt;
margin-left:52.85pt;text-indent:-48.35pt;line-height:107%;background:#F8F8F8'><span
style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>*<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><i><span style='font-size:11.0pt;line-height:107%;font-family:
Consolas;color:#DD1144'>&quot;access&quot; </span></i><i><span
style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>= </span></i><i><span
style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>&quot;Drupal\bid\BidAccessControlHandler&quot;</span></i><i><span
style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>,</span></i></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.75pt;
margin-left:52.85pt;text-indent:-48.35pt;line-height:107%;background:#F8F8F8'><span
style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>*<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><i><span style='font-size:11.0pt;line-height:107%;font-family:
Consolas;color:#DD1144'>&quot;form&quot; </span></i><i><span style='font-size:
11.0pt;line-height:107%;font-family:Consolas;color:#333333'>= {</span></i></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.75pt;
margin-left:52.85pt;text-indent:-48.35pt;line-height:107%;background:#F8F8F8'><span
style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>*<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><i><span style='font-size:11.0pt;line-height:107%;font-family:
Consolas;color:#DD1144'>&quot;delete&quot; </span></i><i><span
style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>= </span></i><i><span
style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>&quot;Drupal\bid\Form\BidDeleteForm&quot;</span></i><i><span
style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>,</span></i></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.45pt;
margin-left:52.85pt;text-indent:-48.35pt;line-height:110%;background:#F8F8F8'><span
style='font-size:11.0pt;line-height:110%;font-family:Consolas;color:#333333'>*<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><i><span style='font-size:11.0pt;line-height:110%;font-family:
Consolas;color:#333333'>},</span></i></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.45pt;
margin-left:52.85pt;text-indent:-48.35pt;line-height:110%;background:#F8F8F8'><span
style='font-size:11.0pt;line-height:110%;font-family:Consolas;color:#333333'>*<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><i><span style='font-size:11.0pt;line-height:110%;font-family:
Consolas;color:#333333'>},</span></i></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.45pt;
margin-left:52.85pt;text-indent:-48.35pt;line-height:110%;background:#F8F8F8'><span
style='font-size:11.0pt;line-height:110%;font-family:Consolas;color:#333333'>*<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><i><span style='font-size:11.0pt;line-height:110%;font-family:
Consolas;color:#333333'>links = {</span></i></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.75pt;
margin-left:52.85pt;text-indent:-48.35pt;line-height:107%;background:#F8F8F8'><span
style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>*<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><i><span style='font-size:11.0pt;line-height:107%;font-family:
Consolas;color:#DD1144'>&quot;delete-form&quot; </span></i><i><span
style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>= </span></i><i><span
style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>&quot;/bid/{bid}/delete&quot;</span></i><i><span
style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>,</span></i></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:24.2pt;
margin-left:52.85pt;text-indent:-48.35pt;line-height:110%;background:#F8F8F8'><span
style='font-size:11.0pt;line-height:110%;font-family:Consolas;color:#333333'>*<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><i><span style='font-size:11.0pt;line-height:110%;font-family:
Consolas;color:#333333'>},</span></i></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.35pt;
margin-left:-.25pt;line-height:110%'>We add a route inside <b>custom/bid/bid.routing.yml</b>:</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:115.5pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
  height:115.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:270.5pt;margin-bottom:
  .4pt;margin-left:6.05pt;text-indent:-6.05pt;line-height:118%'><span
  style='font-size:11.0pt;line-height:118%;font-family:Consolas;color:#DD1144'>entity.bid.delete_form:
  </span><span style='font-size:11.0pt;line-height:118%;font-family:Consolas;
  color:#333333'>path: </span><span style='font-size:11.0pt;line-height:118%;
  font-family:Consolas;color:#DD1144'>'/bid/{bid}/delete' </span><span
  style='font-size:11.0pt;line-height:118%;font-family:Consolas;color:#333333'>defaults:</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>_entity_form: </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>bid.delete</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:222.15pt;margin-bottom:
  .8pt;margin-left:6.05pt;text-indent:12.1pt;line-height:115%'><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>_title:
  </span><span style='font-size:11.0pt;line-height:115%;font-family:Consolas;
  color:#DD1144'>'Delete bid' </span><span style='font-size:11.0pt;line-height:
  115%;font-family:Consolas;color:#333333'>requirements:</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>_entity_access: </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'bid.delete'</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.35pt;
margin-left:-.25pt;line-height:110%'>We add the delete form itself to <b>custom/bid/src/Form/BidDeleteForm.php</b>:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.55pt;margin-bottom:0in;
margin-left:-1.0in;text-indent:0in;line-height:107%'>&nbsp;</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:685.5pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
  height:685.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:15.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><b><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999999'>&lt;?php</span></b></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:0in;text-indent:0in;line-height:107%'><i><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>/**</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:18.15pt;text-indent:-12.1pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>@file</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:18.15pt;text-indent:-12.1pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>Contains
  \Drupal\bid\Form\BidDeleteForm.</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:282.6pt;margin-bottom:
  0in;margin-left:0in;text-indent:0in;line-height:237%'><i><span
  style='font-size:11.0pt;line-height:237%;font-family:Consolas;color:#999988'>*/
  </span></i><b><span style='font-size:11.0pt;line-height:237%;font-family:
  Consolas;color:#333333'>namespace </span></b><b><span style='font-size:11.0pt;
  line-height:237%;font-family:Consolas;color:#990000'>Drupal</span></b><span
  style='font-size:11.0pt;line-height:237%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:237%;font-family:Consolas;color:#990000'>bid</span></b><span
  style='font-size:11.0pt;line-height:237%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:237%;font-family:Consolas;color:#990000'>Form</span></b><span
  style='font-size:11.0pt;line-height:237%;font-family:Consolas;color:#333333'>;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:125.45pt;margin-bottom:
  14.2pt;margin-left:0in;text-indent:0in;line-height:121%'><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>use
  </span></b><b><span style='font-size:11.0pt;line-height:121%;font-family:
  Consolas;color:#990000'>Drupal</span></b><span style='font-size:11.0pt;
  line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>Core</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>Entity</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>ContentEntityConfirmFormBase</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>;
  <b>use </b></span><b><span style='font-size:11.0pt;line-height:121%;
  font-family:Consolas;color:#990000'>Drupal</span></b><span style='font-size:
  11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>Core</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>Form</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>FormStateInterface</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>;
  <b>use </b></span><b><span style='font-size:11.0pt;line-height:121%;
  font-family:Consolas;color:#990000'>Drupal</span></b><span style='font-size:
  11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>Core</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>Url</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>;
  <b>use </b></span><b><span style='font-size:11.0pt;line-height:121%;
  font-family:Consolas;color:#990000'>Drupal</span></b><span style='font-size:
  11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>offer</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>Entity</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>Offer</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:0in;text-indent:0in;line-height:107%'><i><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>/**</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:18.15pt;text-indent:-12.1pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>Provides
  a form for deleting a content_entity_example entity.</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:0in;text-indent:0in;line-height:107%'><i><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:18.15pt;text-indent:-12.1pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>@ingroup
  </span></i><i><span style='font-size:11.0pt;line-height:107%;font-family:
  Consolas;color:#999988'>bid</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:89.2pt;margin-bottom:
  14.2pt;margin-left:0in;text-indent:0in;line-height:121%'><i><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#999988'>*/
  </span></i><b><span style='font-size:11.0pt;line-height:121%;font-family:
  Consolas;color:#333333'>class </span></b><b><span style='font-size:11.0pt;
  line-height:121%;font-family:Consolas;color:#445588'>BidDeleteForm </span></b><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>extends
  </span></b><b><span style='font-size:11.0pt;line-height:121%;font-family:
  Consolas;color:#445588'>ContentEntityConfirmFormBase </span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>{</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>/**</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:18.15pt;text-indent:-12.1pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>{</span></i><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>@inheritdoc</span></i><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>}</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:59.0pt;margin-bottom:
  0in;margin-left:6.05pt;text-indent:6.05pt;line-height:121%'><i><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#999988'>*/
  </span></i><b><span style='font-size:11.0pt;line-height:121%;font-family:
  Consolas;color:#333333'>public function </span></b><b><span style='font-size:
  11.0pt;line-height:121%;font-family:Consolas;color:#990000'>getQuestion</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>()
  { <b>return $this</b>-&gt;t(</span><span style='font-size:11.0pt;line-height:
  121%;font-family:Consolas;color:#DD1144'>'Are you sure you want to delete
  your bid of</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>%price$?'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>,
  <b>array</b>(</span><span style='font-size:11.0pt;line-height:107%;
  font-family:Consolas;color:#DD1144'>'%price' </span><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>=&gt; <b>$this</b>-&gt;entity-&gt;get(</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'bid'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>)-&gt;getString()));</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:15.95pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>/**</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:18.15pt;text-indent:-12.1pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>{</span></i><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>@inheritdoc</span></i><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>}</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:18.15pt;text-indent:-12.1pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>If
  the delete command is canceled, return to the bid list.</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:240.3pt;margin-bottom:
  0in;margin-left:6.05pt;text-indent:6.05pt;line-height:121%'><i><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#999988'>*/
  </span></i><b><span style='font-size:11.0pt;line-height:121%;font-family:
  Consolas;color:#333333'>public function </span></b><b><span style='font-size:
  11.0pt;line-height:121%;font-family:Consolas;color:#990000'>getCancelUrl</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>()
  {</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$offer_id = <b>$this</b>-&gt;entity-&gt;get(</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'offer_id'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>)-&gt;getString();</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:18.15pt;text-indent:0in;line-height:121%'><span style='font-size:
  11.0pt;line-height:121%;font-family:Consolas;color:#333333'>$url = <b>new </b>Url(</span><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#DD1144'>'entity.offer.canonical'</span><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>,
  [</span><span style='font-size:11.0pt;line-height:121%;font-family:Consolas;
  color:#DD1144'>'offer' </span><span style='font-size:11.0pt;line-height:121%;
  font-family:Consolas;color:#333333'>=&gt; $offer_id]); <b>return </b>$url;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:15.95pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>/**</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:18.15pt;text-indent:-12.1pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>{</span></i><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>@inheritdoc</span></i><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>}</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:228.2pt;margin-bottom:
  0in;margin-left:6.05pt;text-indent:6.05pt;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*/
  </span></i><b><span style='font-size:11.0pt;line-height:107%;font-family:
  Consolas;color:#333333'>public function </span></b><b><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#990000'>getConfirmText</span></b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>()
  { <b>return $this</b>-&gt;t(</span><span style='font-size:11.0pt;line-height:
  107%;font-family:Consolas;color:#DD1144'>'Delete'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>);</span></p>
  </td>
 </tr>
 <tr style='height:370.5pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
  height:370.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:15.95pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>/**</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:165.45pt;margin-bottom:
  .8pt;margin-left:9.8pt;text-indent:0in;line-height:115%'><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#999988'>{</span></i><i><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#DD1144'>@inheritdoc</span></i><i><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#999988'>}
  *</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:165.45pt;margin-bottom:
  .95pt;margin-left:9.8pt;text-indent:0in;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>Delete
  the entity and log the event. logger() replaces the watchdog.</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:77.1pt;margin-bottom:
  0in;margin-left:6.05pt;text-indent:6.05pt;line-height:121%'><i><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#999988'>*/
  </span></i><b><span style='font-size:11.0pt;line-height:121%;font-family:
  Consolas;color:#333333'>public function </span></b><b><span style='font-size:
  11.0pt;line-height:121%;font-family:Consolas;color:#990000'>submitForm</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>(array
  &amp;$form, FormStateInterface</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$form_state) {</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>//
  Redirect to offer after delete.</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:16.8pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$offer_id = <b>$this</b>-&gt;entity-&gt;get(</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'offer_id'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>)-&gt;getString();</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$entity = <b>$this</b>-&gt;getEntity();</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:15.95pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$entity-&gt;delete();</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:95.25pt;margin-bottom:
  .8pt;margin-left:30.25pt;text-indent:-12.1pt;line-height:115%'><b><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>$this</span></b><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>-&gt;logger(</span><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#DD1144'>'bid'</span><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>)-&gt;notice(</span><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#DD1144'>'deleted
  bid %id.'</span><span style='font-size:11.0pt;line-height:115%;font-family:
  Consolas;color:#333333'>, <b>array</b>(</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:185.9pt;margin-bottom:
  .8pt;margin-left:30.2pt;text-indent:12.1pt;line-height:115%'><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#DD1144'>'%title'
  </span><span style='font-size:11.0pt;line-height:115%;font-family:Consolas;
  color:#333333'>=&gt; <b>$this</b>-&gt;entity-&gt;id(), ));</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$form_state-&gt;setRedirect(</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'entity.offer.canonical'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>,
  [</span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#DD1144'>'offer' </span><span style='font-size:11.0pt;line-height:107%;
  font-family:Consolas;color:#333333'>=&gt;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:361.15pt;margin-bottom:
  15.0pt;margin-left:6.05pt;text-indent:-6.05pt;line-height:115%'><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>$offer_id]);
  }</span></p>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>This is a standard entity delete form with the exception of
the getCancelUrl() and SubmitForm() methods. There we needed to get the offer
ID from the bid to generate a url to redirect to after deletion or cancel
action.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:2.1pt;
margin-left:-.25pt'>To do this properly, we need again to add an
AccessControlHandler. To <b>custom/bid/src/BidAccessControlHandler.php</b>, add</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:190.5pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
  height:190.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:312.8pt;margin-bottom:
  0in;margin-left:0in;text-indent:0in;line-height:237%'><b><span
  style='font-size:11.0pt;line-height:237%;font-family:Consolas;color:#999999'>&lt;?php
  </span></b><b><span style='font-size:11.0pt;line-height:237%;font-family:
  Consolas;color:#333333'>namespace </span></b><b><span style='font-size:11.0pt;
  line-height:237%;font-family:Consolas;color:#990000'>Drupal</span></b><span
  style='font-size:11.0pt;line-height:237%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:237%;font-family:Consolas;color:#990000'>bid</span></b><span
  style='font-size:11.0pt;line-height:237%;font-family:Consolas;color:#333333'>;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:137.55pt;margin-bottom:
  14.2pt;margin-left:0in;text-indent:0in;line-height:121%'><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>use
  </span></b><b><span style='font-size:11.0pt;line-height:121%;font-family:
  Consolas;color:#990000'>Drupal</span></b><span style='font-size:11.0pt;
  line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>Core</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>Access</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>AccessResult</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>;
  <b>use </b></span><b><span style='font-size:11.0pt;line-height:121%;
  font-family:Consolas;color:#990000'>Drupal</span></b><span style='font-size:
  11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>Core</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>Entity</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>EntityAccessControlHandler</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>;
  <b>use </b></span><b><span style='font-size:11.0pt;line-height:121%;
  font-family:Consolas;color:#990000'>Drupal</span></b><span style='font-size:
  11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>Core</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>Entity</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>EntityInterface</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>;
  <b>use </b></span><b><span style='font-size:11.0pt;line-height:121%;
  font-family:Consolas;color:#990000'>Drupal</span></b><span style='font-size:
  11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>Core</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>Session</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>AccountInterface</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:0in;text-indent:0in;line-height:107%'><i><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>/**</span></i></p>
  <p class=MsoNormal style='margin:0in;text-indent:6.05pt;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*
  Access controller for the bid entity. Controls create/edit/delete access for
  entity and fields.</span></i></p>
  </td>
 </tr>
 <tr style='height:475.5pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
  height:475.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*
  </span></i><i><span style='font-size:11.0pt;line-height:107%;font-family:
  Consolas;color:#DD1144'>@see </span></i><i><span style='font-size:11.0pt;
  line-height:107%;font-family:Consolas;color:#999988'>\Drupal\bid\Entity\Bid.</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:40.85pt;margin-bottom:
  15.0pt;margin-left:0in;text-indent:6.05pt;line-height:121%'><i><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#999988'>*/
  </span></i><b><span style='font-size:11.0pt;line-height:121%;font-family:
  Consolas;color:#333333'>class </span></b><b><span style='font-size:11.0pt;
  line-height:121%;font-family:Consolas;color:#445588'>BidAccessControlHandler </span></b><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>extends
  </span></b><b><span style='font-size:11.0pt;line-height:121%;font-family:
  Consolas;color:#445588'>EntityAccessControlHandler </span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>{</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>protected
  function </span></b><b><span style='font-size:11.0pt;line-height:107%;
  font-family:Consolas;color:#990000'>checkAccess</span></b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>(EntityInterface
  $entity, $operation,</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>AccountInterface
  $account) {</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:2.75in;margin-bottom:
  0in;margin-left:24.15pt;text-indent:0in;line-height:121%'><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>$access
  = AccessResult::forbidden(); <b>switch </b>($operation) { <b>case </b></span><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#DD1144'>'view'</span><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>:</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:161.75pt;margin-bottom:
  .8pt;margin-left:48.35pt;text-indent:0in;line-height:115%'><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>$access
  = AccessResult::allowed; <b>break</b>;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:36.25pt;text-indent:0in;line-height:107%'><b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>case
  </span></b><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#DD1144'>'update'</span><span style='font-size:11.0pt;line-height:107%;
  font-family:Consolas;color:#333333'>:</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:48.35pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$access =
  AccessResult::allowedIf($account-&gt;id() ==</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.8pt;
  margin-left:48.35pt;text-indent:-48.35pt;line-height:115%'><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>$entity-&gt;getOwnerId())-&gt;cachePerUser()-&gt;addCacheableDependency($entity);
  <b>break</b>;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:36.25pt;text-indent:0in;line-height:107%'><b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>case
  </span></b><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#DD1144'>'edit'</span><span style='font-size:11.0pt;line-height:107%;
  font-family:Consolas;color:#333333'>:</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:48.35pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$access =
  AccessResult::allowedIf($account-&gt;id() ==</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.8pt;
  margin-left:48.35pt;text-indent:-48.35pt;line-height:115%'><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>$entity-&gt;getOwnerId())-&gt;cachePerUser()-&gt;addCacheableDependency($entity);
  <b>break</b>;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:36.25pt;text-indent:0in;line-height:107%'><b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>case
  </span></b><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#DD1144'>'delete'</span><span style='font-size:11.0pt;line-height:107%;
  font-family:Consolas;color:#333333'>:</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:48.35pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$access =
  AccessResult::allowedIf($account-&gt;id() ==</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:48.35pt;text-indent:-48.35pt;line-height:115%'><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>$entity-&gt;getOwnerId())-&gt;cachePerUser()-&gt;addCacheableDependency($entity);
  <b>break</b>;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:16.8pt;
  margin-left:24.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:24.15pt;text-indent:0in;line-height:107%'><b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>return
  </span></b><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#333333'>$access;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:15.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999999'>?&gt;</span></b></p>
  </td>
 </tr>
</table>

<p class=MsoNormal align=center style='margin-top:0in;margin-right:5.5pt;
margin-bottom:26.85pt;margin-left:.5pt;text-align:center;line-height:163%;
background:#FFD966'><span style='font-size:11.0pt;line-height:163%'>This code
determines if I am the owner of the bid. This is an important security check!</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>The final part of this section is to provide a delete link
to the bid when a user is the owner of the bid.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:21.85pt;
margin-left:-.25pt;line-height:110%'>To the <b>custom/offer/src/OfferPreprocess/OfferPreprocess.php
</b><i>OfferTable() </i>we can now add a delete link:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:76.6pt;margin-bottom:
.8pt;margin-left:5.0pt;line-height:111%;background:#F8F8F8'><b><span
style='font-size:11.0pt;line-height:111%;font-family:Consolas;color:#333333'>use
</span></b><b><span style='font-size:11.0pt;line-height:111%;font-family:Consolas;
color:#990000'>Drupal</span></b><span style='font-size:11.0pt;line-height:111%;
font-family:Consolas;color:#333333'>\</span><b><span style='font-size:11.0pt;
line-height:111%;font-family:Consolas;color:#990000'>Core</span></b><span
style='font-size:11.0pt;line-height:111%;font-family:Consolas;color:#333333'>\</span><b><span
style='font-size:11.0pt;line-height:111%;font-family:Consolas;color:#990000'>Link</span></b><span
style='font-size:11.0pt;line-height:111%;font-family:Consolas;color:#333333'>;
// on top of file</span></p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:175.5pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
  height:175.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:0in;text-indent:0in;line-height:107%'><b><span style='font-family:
  Consolas;color:#333333'>if</span></b><span style='font-family:Consolas;
  color:#333333'>($bid-&gt;access(</span><span style='font-family:Consolas;
  color:#DD1144'>'delete'</span><span style='font-family:Consolas;color:#333333'>))
  {</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:13.2pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>$url = $bid-&gt;toUrl(</span><span style='font-family:
  Consolas;color:#DD1144'>'delete-form'</span><span style='font-family:Consolas;
  color:#333333'>);</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:13.2pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>$link = Link::fromTextAndUrl(</span><span
  style='font-family:Consolas;color:#DD1144'>'Remove bid'</span><span
  style='font-family:Consolas;color:#333333'>, $url)-&gt;toString();</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:17.7pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.1pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>$row = [</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.1pt;
  margin-left:13.2pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>Markup::create($ownerName), Markup::create($time.</span><span
  style='font-family:Consolas;color:#DD1144'>' ago'</span><span
  style='font-family:Consolas;color:#333333'>),</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:10.9pt;margin-bottom:
  0in;margin-left:0in;text-indent:0in;line-height:116%'><span style='font-family:
  Consolas;color:#333333'>Markup::create($price . </span><span
  style='font-family:Consolas;color:#DD1144'>'$' </span><span style='font-family:
  Consolas;color:#333333'>. $updates), Markup::create($link) ];</span></p>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-family:Consolas;color:#333333'>$rows[] = $row;</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:.05in;
margin-left:-.25pt'>We clear caches and now we have a delete link on our own
bids:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:-1.7pt;margin-bottom:
24.25pt;margin-left:1.5pt;text-indent:0in;line-height:107%'><img border=0
width=602 height=135 id="Picture 17260"
src="Learning%20drupal%209%20as%20a%20framework_files/image103.jpg"></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:3.35pt;
margin-left:-.25pt'>When we click the link, we get redirected to a delete form
with cancel and delete link. We took advantage of the core entity delete form
to do this. No need to to access checks on the form, Drupal core provides us
these by default thanks to the Entity API!</p>

<p class=MsoNormal style='margin-top:0in;margin-right:-1.7pt;margin-bottom:
0in;margin-left:1.5pt;text-indent:0in;line-height:107%'><img border=0
width=602 height=268 id="Picture 17262"
src="Learning%20drupal%209%20as%20a%20framework_files/image104.jpg"></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>The confirm page is quite nice. But I prefer to stay on the
same page when deleting a bid. Drupal core offers a nice option to do this: an
ajax dialog to render the very same form in. Let’s see how this works.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:2.1pt;
margin-left:-.25pt'>We only need to add extra attributes to the delete link.
Therefore we’ll use a link render array. We’ve already used drupal core’s
render arrays for tables and drop buttons. The link render array offers
possibilities to add attributes we’ll need to ajaxify dialogs. We change the <i>offerTable()
</i>part where we define the delete link:</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:265.5pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
  height:265.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><b><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>if</span></b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>($bid-&gt;access(</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'delete'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>))
  {</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$url =
  $bid-&gt;toUrl(</span><span style='font-size:11.0pt;line-height:107%;
  font-family:Consolas;color:#DD1144'>'delete-form'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>);</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$deleteLink = [</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'#type' </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>=&gt;
  </span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#DD1144'>'link'</span><span style='font-size:11.0pt;line-height:107%;
  font-family:Consolas;color:#333333'>,</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'#title' </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>=&gt;
  </span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#DD1144'>'Remove bid'</span><span style='font-size:11.0pt;line-height:
  107%;font-family:Consolas;color:#333333'>,</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'#url' </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>=&gt;
  $url,</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'#attributes' </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>=&gt;
  [</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:30.2pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'class' </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>=&gt;
  [</span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#DD1144'>'use-ajax', 'button', 'button--small',</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'button--danger'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>],</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:30.2pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'data-dialog-type'
  </span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#333333'>=&gt; </span><span style='font-size:11.0pt;line-height:107%;
  font-family:Consolas;color:#DD1144'>'modal'</span><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>,</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:30.2pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'data-dialog-options'
  </span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#333333'>=&gt;</span></p>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:121%'><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\Drupal\Component\Serialization\Json::encode([</span><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#DD1144'>'title'
  </span><span style='font-size:11.0pt;line-height:121%;font-family:Consolas;
  color:#333333'>=&gt; t(</span><span style='font-size:11.0pt;line-height:121%;
  font-family:Consolas;color:#DD1144'>'Remove bid?'</span><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>),
  </span><span style='font-size:11.0pt;line-height:121%;font-family:Consolas;
  color:#DD1144'>'width' </span><span style='font-size:11.0pt;line-height:121%;
  font-family:Consolas;color:#333333'>=&gt; </span><span style='font-size:11.0pt;
  line-height:121%;font-family:Consolas;color:teal'>800</span><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>,]),</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>],</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>];</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$link =
  render($deleteLink);</span></p>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:2.1pt;
margin-left:-.25pt'>One last thing is that we need to make sure the core drupal
ajax wrappers are loaded as well. To <b>offer/offer.libraries.yml </b>we must
add the following dependencies to our platform library:</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:130.5pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
  height:130.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>platform:</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>css:</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:24.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>theme:</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:36.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>css/platform.css:
  {}</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>dependencies:</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:36.25pt;text-indent:-12.1pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#990073'>-<span
  style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>core/drupal.ajax</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:36.25pt;text-indent:-12.1pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#990073'>-<span
  style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>core/jquery</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:36.25pt;text-indent:-12.1pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#990073'>-<span
  style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>core/drupal</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>Now clear caches..When we now click ‘Remove bid’, we stay
on the same page and get this very nicely looking dialog:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:-1.7pt;margin-bottom:
24.25pt;margin-left:1.5pt;text-indent:0in;line-height:107%'><img border=0
width=602 height=228 id="Picture 17424"
src="Learning%20drupal%209%20as%20a%20framework_files/image105.jpg"></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>Again a nice example of where drupal does the heavy lifting
for us. The dialogs underlying architecture can change in the future, but will
still work because we make use of the API.<br clear=all style='page-break-before:
always'>
</p>

<h1 style='margin-left:-.25pt'><a name="_Toc247073">Part 5: Transitions,
Events, Caching and user registration</a></h1>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=600
 style='width:6.25in;border-collapse:collapse'>
 <tr style='height:73.5pt'>
  <td width=59 valign=top style='width:44.25pt;background:#6D9EEB;padding:14.6pt 5.75pt 0in 0in;
  height:73.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:14.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%'>&#128073;</span></p>
  </td>
  <td width=541 style='width:405.75pt;background:#6D9EEB;padding:14.6pt 5.75pt 0in 0in;
  height:73.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:2.15pt;margin-bottom:
  0in;margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%'>Now that we’ve built the main parts of our software
  we have the chance to start with <b>automated tasks </b>like sending emails
  and the expiration of a bid. But we’ll also discuss <b>caching </b>and how to
  handle <b>user registration</b>.</span></p>
  </td>
 </tr>
</table>

<h2 style='margin-top:0in;margin-right:0in;margin-bottom:3.35pt;margin-left:
-.25pt'><a name="_Toc247074">User notifications on transition events</a></h2>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>Drupal 8 has significantly decreased the number of <a
href="https://www.drupal.org/docs/creating-custom-modules/understanding-hooks"><i><span
style='color:#1155CC'>hooks</span></i></a><i><u><span style='color:#1155CC'> </span></u></i>it
uses. For a number of events it will use the <a
href="https://www.drupal.org/docs/creating-custom-modules/subscribe-to-and-dispatch-events"><span
style='color:#1155CC'>Event system</span></a><u><span style='color:#1155CC'> </span></u>with
Event Subscribers (more about them in the next sections).</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>Unfortunately there is no “Event” to subscribe to when an
entity switches its state. Therefore we have to use a hook for notifying when
an offer switches from “published” to “expired”.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:2.1pt;
margin-left:-.25pt'>I’ve quickly added a third code-only entity named
“notification” in a new module. It stores these values:</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=546
 style='width:409.15pt;margin-left:.4pt;border-collapse:collapse'>
 <tr style='height:28.0pt'>
  <td width=162 style='width:121.15pt;border:solid #BF9000 1.0pt;background:
  #BF9000;padding:0in 5.75pt 0in 6.4pt;height:28.0pt'>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%'>Key</span></p>
  </td>
  <td width=384 style='width:4.0in;border:solid #BF9000 1.0pt;border-left:none;
  background:#BF9000;padding:0in 5.75pt 0in 6.4pt;height:28.0pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:.4pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%'>Description</span></p>
  </td>
 </tr>
 <tr style='height:29.0pt'>
  <td width=162 style='width:121.15pt;border:solid #BF9000 1.0pt;border-top:
  none;background:#FFE599;padding:0in 5.75pt 0in 6.4pt;height:29.0pt'>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%'>offer_id</span></p>
  </td>
  <td width=384 style='width:4.0in;border-top:none;border-left:none;border-bottom:
  solid #BF9000 1.0pt;border-right:solid #BF9000 1.0pt;background:#FFE599;
  padding:0in 5.75pt 0in 6.4pt;height:29.0pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:.4pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%'>The offer the notification is about</span></p>
  </td>
 </tr>
 <tr style='height:29.0pt'>
  <td width=162 style='width:121.15pt;border:solid #BF9000 1.0pt;border-top:
  none;background:#FFE599;padding:0in 5.75pt 0in 6.4pt;height:29.0pt'>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%'>user_id</span></p>
  </td>
  <td width=384 style='width:4.0in;border-top:none;border-left:none;border-bottom:
  solid #BF9000 1.0pt;border-right:solid #BF9000 1.0pt;background:#FFE599;
  padding:0in 5.75pt 0in 6.4pt;height:29.0pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:.4pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%'>The user that has a bid on an offer</span></p>
  </td>
 </tr>
 <tr style='height:29.9pt'>
  <td width=162 style='width:121.15pt;border:solid #BF9000 1.0pt;border-top:
  none;background:#FFE599;padding:0in 5.75pt 0in 6.4pt;height:29.9pt'>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%'>type</span></p>
  </td>
  <td width=384 style='width:4.0in;border-top:none;border-left:none;border-bottom:
  solid #BF9000 1.0pt;border-right:solid #BF9000 1.0pt;background:#FFE599;
  padding:0in 5.75pt 0in 6.4pt;height:29.9pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:.4pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%'>The type of notification (f.e. “expired”)</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:2.1pt;
margin-left:-.25pt'>I’ve also added a handler for access and for views. This
way we can add a views page at url /notifications, to show the notifications
for this user.</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=600
 style='width:6.25in;border-collapse:collapse'>
 <tr style='height:129.0pt'>
  <td width=600 valign=top style='width:6.25in;background:#E2E3E5;padding:16.5pt 5.75pt 0in 14.25pt;
  height:129.0pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:30.0pt;text-indent:-30.0pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%'>&#128187; If you are following
  along, copy the notification module into your project and install. Building
  an entity is something that was covered already!</span></p>
  <table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=521
   style='width:390.75pt;margin-left:30.0pt;border-collapse:collapse'>
   <tr style='height:43.5pt'>
    <td width=521 style='width:390.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
    height:43.5pt'>
    <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:
    2.1pt;margin-left:0in;text-indent:0in;line-height:107%'><span
    style='font-family:Consolas;color:#333333'>bash$ drush en notification</span></p>
    <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
    style='font-family:Consolas;color:#38761D'>[success] </span><span
    style='font-family:Consolas;color:#333333'>Successfully enabled:
    notification</span></p>
    </td>
   </tr>
  </table>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:8.0pt;
  margin-left:0in;text-indent:0in;line-height:107%'></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:2.1pt;
margin-left:-.25pt'>We add a hook_entityType_update() function to <b>custom/offer/offer.module</b>:</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:489.0pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
  height:489.0pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:17.7pt;
  margin-left:0in;text-indent:0in;line-height:107%'><b><span style='font-family:
  Consolas;color:#333333'>use </span></b><b><span style='font-family:Consolas;
  color:#990000'>Drupal</span></b><span style='font-family:Consolas;color:#333333'>\</span><b><span
  style='font-family:Consolas;color:#990000'>notification</span></b><span
  style='font-family:Consolas;color:#333333'>\</span><b><span style='font-family:
  Consolas;color:#990000'>Entity</span></b><span style='font-family:Consolas;
  color:#333333'>\</span><b><span style='font-family:Consolas;color:#990000'>Notification</span></b><span
  style='font-family:Consolas;color:#333333'>;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:30.7pt;margin-bottom:
  0in;margin-left:0in;text-indent:0in;line-height:118%'><i><span
  style='font-family:Consolas;color:#999988'>/** * Implements
  hook_ENTITY_TYPE_update(). */ </span></i><b><span style='font-family:Consolas;
  color:#333333'>function </span></b><b><span style='font-family:Consolas;
  color:#990000'>offer_offer_update</span></b><span style='font-family:Consolas;
  color:#333333'>(Drupal\Core\Entity\EntityInterface</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:17.7pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>$entity) {</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:6.6pt;text-indent:0in;line-height:107%'><i><span
  style='font-family:Consolas;color:#999988'>// Current Moderation state</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:17.7pt;
  margin-left:6.6pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>$currentState = $entity-&gt;get(</span><span
  style='font-family:Consolas;color:#DD1144'>'moderation_state'</span><span
  style='font-family:Consolas;color:#333333'>)-&gt;getString();</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:6.6pt;text-indent:0in;line-height:107%'><i><span
  style='font-family:Consolas;color:#999988'>// Original Moderation state</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:6.6pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>$originalState =</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:17.7pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>$entity-&gt;original-&gt;get(</span><span
  style='font-family:Consolas;color:#DD1144'>'moderation_state'</span><span
  style='font-family:Consolas;color:#333333'>)-&gt;getString();</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:63.65pt;margin-bottom:
  0in;margin-left:6.6pt;text-indent:0in;line-height:119%'><i><span
  style='font-family:Consolas;color:#999988'>// Check if transition equals
  &quot;published&quot; -&gt; &quot;expired&quot; // Save a notification for
  all bidders </span></i><b><span style='font-family:Consolas;color:#333333'>if</span></b><span
  style='font-family:Consolas;color:#333333'>(($originalState == </span><span
  style='font-family:Consolas;color:#DD1144'>'published'</span><span
  style='font-family:Consolas;color:#333333'>) &amp;&amp; ($currentState ==</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:2.9in;margin-bottom:
  0in;margin-left:19.8pt;text-indent:-19.8pt;line-height:119%'><span
  style='font-family:Consolas;color:#DD1144'>'expired'</span><span
  style='font-family:Consolas;color:#333333'>)) { $bids =
  $entity-&gt;getOfferBids(); <b>foreach</b>($bids <b>as </b>$bid) {</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:222.0pt;margin-bottom:
  0in;margin-left:46.2pt;text-indent:-13.2pt;line-height:122%'><span
  style='font-family:Consolas;color:#333333'>Notification::create([ </span><span
  style='font-family:Consolas;color:#DD1144'>'type' </span><span
  style='font-family:Consolas;color:#333333'>=&gt; </span><span
  style='font-family:Consolas;color:#DD1144'>'expired'</span><span
  style='font-family:Consolas;color:#333333'>,</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.1pt;
  margin-left:46.2pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#DD1144'>'user_id' </span><span style='font-family:Consolas;
  color:#333333'>=&gt; [</span><span style='font-family:Consolas;color:#DD1144'>'target_id'
  </span><span style='font-family:Consolas;color:#333333'>=&gt;
  $bid-&gt;getOwnerId()],</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:30.7pt;margin-bottom:
  0in;margin-left:33.0pt;text-indent:13.2pt;line-height:116%'><span
  style='font-family:Consolas;color:#DD1144'>'offer_id' </span><span
  style='font-family:Consolas;color:#333333'>=&gt; [</span><span
  style='font-family:Consolas;color:#DD1144'>'target_id' </span><span
  style='font-family:Consolas;color:#333333'>=&gt; $entity-&gt;id()]
  ])-&gt;save();</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:19.8pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:6.6pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-family:Consolas;color:#333333'>}</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>What this snippet does is the following: it checks if the
offer goes from a ‘published’ to a ‘expired’ state. Then it will loop over all
the bids on the offer, and create notification entities for every bidder.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>Next I’ve added view support for notification entities,
just like we did for our offer entities.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>I’ve added a view and a menu-link for the <b>/notifications
</b>page, which will show the notifications, filtered on the current user.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:19.0pt;
margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:11.0pt;
line-height:107%'><img border=0 width=602 height=260
src="Learning%20drupal%209%20as%20a%20framework_files/image106.gif"></span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:16.6pt;
margin-left:-.25pt;line-height:110%'>In a custom views field in <b>custom/notification/src/Plugin/views/field/NotificationMessage.php
</b>the <i>render(ResultRow $values) </i>function looks like this:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:6.25pt;
margin-left:-.25pt'>// on top:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:247.35pt;margin-bottom:
8.4pt;margin-left:5.0pt;line-height:107%;background:#F8F8F8'><b><span
style='font-family:Consolas;color:#333333'>use </span></b><b><span
style='font-family:Consolas;color:#990000'>Drupal</span></b><span
style='font-family:Consolas;color:#333333'>\</span><b><span style='font-family:
Consolas;color:#990000'>offer</span></b><span style='font-family:Consolas;
color:#333333'>\</span><b><span style='font-family:Consolas;color:#990000'>Entity</span></b><span
style='font-family:Consolas;color:#333333'>\</span><b><span style='font-family:
Consolas;color:#990000'>Offer</span></b><span style='font-family:Consolas;
color:#333333'>; <b>use </b></span><b><span style='font-family:Consolas;
color:#990000'>Drupal</span></b><span style='font-family:Consolas;color:#333333'>\</span><b><span
style='font-family:Consolas;color:#990000'>Core</span></b><span
style='font-family:Consolas;color:#333333'>\</span><b><span style='font-family:
Consolas;color:#990000'>Url</span></b><span style='font-family:Consolas;
color:#333333'>; <b>use </b></span><b><span style='font-family:Consolas;
color:#990000'>Drupal</span></b><span style='font-family:Consolas;color:#333333'>\</span><b><span
style='font-family:Consolas;color:#990000'>Core</span></b><span
style='font-family:Consolas;color:#333333'>\</span><b><span style='font-family:
Consolas;color:#990000'>Link</span></b><span style='font-family:Consolas;
color:#333333'>;</span></p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:274.5pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
  height:274.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:109.85pt;margin-bottom:
  0in;margin-left:6.6pt;text-indent:-6.6pt;line-height:116%'><b><span
  style='font-family:Consolas;color:#333333'>public function </span></b><b><span
  style='font-family:Consolas;color:#990000'>render</span></b><span
  style='font-family:Consolas;color:#333333'>(ResultRow $values) { $entity =
  $values-&gt;_entity;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:6.6pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>$type = $entity-&gt;get(</span><span
  style='font-family:Consolas;color:#DD1144'>'type'</span><span
  style='font-family:Consolas;color:#333333'>)-&gt;getString();</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:103.25pt;margin-bottom:
  .45pt;margin-left:6.6pt;text-indent:0in;line-height:119%'><span
  style='font-family:Consolas;color:#333333'>$offer_id = $entity-&gt;get(</span><span
  style='font-family:Consolas;color:#DD1144'>'offer_id'</span><span
  style='font-family:Consolas;color:#333333'>)-&gt;getString(); $offer =
  Offer::load($offer_id); <b>if</b>($type == </span><span style='font-family:
  Consolas;color:#DD1144'>'expired'</span><span style='font-family:Consolas;
  color:#333333'>) {</span></p>
  <p class=MsoNormal align=center style='margin-top:0in;margin-right:0in;
  margin-bottom:1.2pt;margin-left:2.3pt;text-align:center;text-indent:0in;
  line-height:107%'><span style='font-family:Consolas;color:#333333'>$url =
  Url::fromRoute(</span><span style='font-family:Consolas;color:#DD1144'>'entity.offer.canonical'</span><span
  style='font-family:Consolas;color:#333333'>, <b>array</b>(</span><span
  style='font-family:Consolas;color:#DD1144'>'offer'</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>=&gt; $offer-&gt;id()));</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:19.8pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>$link = Link::fromTextAndUrl($offer-&gt;label(),</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.1pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>$url)-&gt;toRenderable();</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:19.8pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>$text = </span><span style='font-family:Consolas;
  color:#DD1144'>'Offer '</span><span style='font-family:Consolas;color:#333333'>.
  render($link) .</span><span style='font-family:Consolas;color:#DD1144'>' has
  expired.'</span><span style='font-family:Consolas;color:#333333'>;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:380.35pt;margin-bottom:
  0in;margin-left:6.6pt;text-indent:0in;line-height:122%'><span
  style='font-family:Consolas;color:#333333'>} <b>return </b>[</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:19.8pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#DD1144'>'#children' </span><span style='font-family:Consolas;
  color:#333333'>=&gt; $text</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:6.6pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>];</span></p>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-family:Consolas;color:#333333'>}</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>This result in the following notification for the bids that
I did:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:-1.7pt;margin-bottom:
24.25pt;margin-left:1.5pt;text-indent:0in;line-height:107%'><img border=0
width=602 height=232 id="Picture 17822"
src="Learning%20drupal%209%20as%20a%20framework_files/image107.jpg"></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:.8pt;
margin-left:-.25pt'>We’ve now shown how to create notifications based on
workflow states. It’s not hard to imagine the following possible features with
this:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:.95pt;
margin-left:.5in;text-indent:-.25in'><span style='font-family:"Arial",sans-serif'>&#9679;<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span>Send
email when someone bids higher than your bid</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:.95pt;
margin-left:.5in;text-indent:-.25in'><span style='font-family:"Arial",sans-serif'>&#9679;<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span>Send
email to all bidders when offer has expired</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:1.05pt;
margin-left:.5in;text-indent:-.25in'><span style='font-family:"Arial",sans-serif'>&#9679;<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span>Send
email when new offers are available</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:.5in;text-indent:-.25in'><span style='font-family:"Arial",sans-serif'>&#9679;<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span>….</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>To <b>custom/notification/notification.links.menu.yml </b>this
was added to get the link in the user menu:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:108.2pt;margin-bottom:
1.25pt;margin-left:8.4pt;line-height:111%;background:#F8F8F8'><span
style='font-size:11.0pt;line-height:111%;font-family:Consolas;color:#DD1144'>offer.account.notifications:</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:108.2pt;margin-bottom:
44.85pt;margin-left:8.4pt;line-height:111%;background:#F8F8F8'><span
style='font-size:11.0pt;line-height:111%;font-family:Consolas;color:#333333'>title:
</span><span style='font-size:11.0pt;line-height:111%;font-family:Consolas;
color:#DD1144'>'Notifications' </span><span style='font-size:11.0pt;line-height:
111%;font-family:Consolas;color:#333333'>menu_name: </span><span
style='font-size:11.0pt;line-height:111%;font-family:Consolas;color:#DD1144'>account
</span><span style='font-size:11.0pt;line-height:111%;font-family:Consolas;
color:#333333'>route_name: </span><span style='font-size:11.0pt;line-height:
111%;font-family:Consolas;color:#DD1144'>view.notifications.page_1 </span><span
style='font-size:11.0pt;line-height:111%;font-family:Consolas;color:#333333'>weight:
</span><span style='font-size:11.0pt;line-height:111%;font-family:Consolas;
color:#990073'>-40</span></p>

<h2 style='margin-left:-.25pt'><a name="_Toc247075">Update entire view with
custom ajax callback</a></h2>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=600
 style='width:6.25in;border-collapse:collapse'>
 <tr style='height:73.5pt'>
  <td width=59 valign=top style='width:44.25pt;background:#6D9EEB;padding:14.6pt 5.75pt 0in 0in;
  height:73.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:14.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%'>&#128073;</span></p>
  </td>
  <td width=541 style='width:405.75pt;background:#6D9EEB;padding:14.6pt 5.75pt 0in 0in;
  height:73.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:6.45pt;margin-bottom:
  0in;margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%'>In this chapter you will learn how to <b>update a
  view </b>with a <b>ajax callback. </b>At the end you will be able to
  delete/insert/update records, reload a view without leaving your page.</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>Ajax is a great technology to refresh parts of a page
without actually refreshing the full page. In general this enhances user
experience. The difference between just using javascript is a server-side
callback is included in the call where actual database operations can be done.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>For this project, we want to be able to delete
notifications in the notifications view. To start, we create a controller which
will be used to delete a notification. This is a regular controller, but
instead of visiting it, only our ajax call will be visiting the class.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.35pt;
margin-left:-.25pt;line-height:110%'>Create the routing file <b>custom/notification/notification.routing.yml:</b></p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:160.5pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
  height:160.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>notification.delete:</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:125.45pt;margin-bottom:
  0in;margin-left:6.05pt;text-indent:0in;line-height:115%'><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>path:
  </span><span style='font-size:11.0pt;line-height:115%;font-family:Consolas;
  color:#DD1144'>'/notification/delete/{method}/{id}' </span><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>defaults:</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>_controller:</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'\Drupal\notification\Controller\NotificationDeleteController::Render'</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:240.3pt;margin-bottom:
  0in;margin-left:6.05pt;text-indent:12.1pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>_title:
  </span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#DD1144'>'Delete notification?' </span><span style='font-size:11.0pt;
  line-height:107%;font-family:Consolas;color:#333333'>requirements: _access: </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'TRUE'
  </span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#333333'>id: </span><span style='font-size:11.0pt;line-height:107%;
  font-family:Consolas;color:#DD1144'>'\d+' </span><span style='font-size:11.0pt;
  line-height:107%;font-family:Consolas;color:#333333'>method: </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'nojs|ajax'</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>Check out the {method} slug. This can be either ‘nojs’ or
‘ajax’. In the actual link, we will use ‘nojs’. Drupal will use ajax if it has
detected javascript is enabled. This is good for accessibility. Further, we use
a regex for id to be sure it is numeric. Access checks are done in the
controller itself.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.35pt;
margin-left:-.25pt;line-height:110%'>To <b>custom/notification/src/Controller/NotificationDeleteController.php:</b></p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:295.5pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
  height:295.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:191.95pt;margin-bottom:
  0in;margin-left:0in;text-indent:0in;line-height:237%'><b><span
  style='font-size:11.0pt;line-height:237%;font-family:Consolas;color:#999999'>&lt;?php
  </span></b><b><span style='font-size:11.0pt;line-height:237%;font-family:
  Consolas;color:#333333'>namespace </span></b><b><span style='font-size:11.0pt;
  line-height:237%;font-family:Consolas;color:#990000'>Drupal</span></b><span
  style='font-size:11.0pt;line-height:237%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:237%;font-family:Consolas;color:#990000'>notification</span></b><span
  style='font-size:11.0pt;line-height:237%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:237%;font-family:Consolas;color:#990000'>Controller</span></b><span
  style='font-size:11.0pt;line-height:237%;font-family:Consolas;color:#333333'>;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:107.35pt;margin-bottom:
  14.2pt;margin-left:0in;text-indent:0in;line-height:121%'><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>use
  </span></b><b><span style='font-size:11.0pt;line-height:121%;font-family:
  Consolas;color:#990000'>Drupal</span></b><span style='font-size:11.0pt;
  line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>Core</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>Controller</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>ControllerBase</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>;
  <b>use </b></span><b><span style='font-size:11.0pt;line-height:121%;
  font-family:Consolas;color:#990000'>Drupal</span></b><span style='font-size:
  11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>notification</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>Ajax</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>DeleteNotificationCommand</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>;
  <b>use </b></span><b><span style='font-size:11.0pt;line-height:121%;
  font-family:Consolas;color:#990000'>Drupal</span></b><span style='font-size:
  11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>Core</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>Ajax</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>AjaxResponse</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>;
  <b>use </b></span><b><span style='font-size:11.0pt;line-height:121%;
  font-family:Consolas;color:#990000'>Drupal</span></b><span style='font-size:
  11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>notification</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>Entity</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>Notification</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>;
  <b>use </b></span><b><span style='font-size:11.0pt;line-height:121%;
  font-family:Consolas;color:#990000'>Drupal</span></b><span style='font-size:
  11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>Core</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>Access</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>AccessResult</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>;
  <b>use </b></span><b><span style='font-size:11.0pt;line-height:121%;
  font-family:Consolas;color:#990000'>Symfony</span></b><span style='font-size:
  11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>Component</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>HttpFoundation</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>RedirectResponse</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>;
  <b>use </b></span><b><span style='font-size:11.0pt;line-height:121%;
  font-family:Consolas;color:#990000'>Drupal</span></b><span style='font-size:
  11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>Core</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>Url</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><i><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>/**</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><i><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>* Class
  NotificationDeleteController.php.</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:83.15pt;margin-bottom:
  15.0pt;margin-left:0in;text-indent:0in;line-height:121%'><i><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#999988'>*/
  </span></i><b><span style='font-size:11.0pt;line-height:121%;font-family:
  Consolas;color:#333333'>class </span></b><b><span style='font-size:11.0pt;
  line-height:121%;font-family:Consolas;color:#445588'>NotificationDeleteController
  </span></b><b><span style='font-size:11.0pt;line-height:121%;font-family:
  Consolas;color:#333333'>extends </span></b><b><span style='font-size:11.0pt;
  line-height:121%;font-family:Consolas;color:#445588'>ControllerBase </span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>{</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>public
  function </span></b><b><span style='font-size:11.0pt;line-height:107%;
  font-family:Consolas;color:#990000'>Render</span></b><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>($id, $method) {</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>//
  Load the notification</span></i></p>
  </td>
 </tr>
 <tr style='height:415.5pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
  height:415.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:15.95pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$notification =
  Notification::load($id);</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:167.8pt;margin-bottom:
  0in;margin-left:18.15pt;text-indent:0in;line-height:118%'><i><span
  style='font-size:11.0pt;line-height:118%;font-family:Consolas;color:#999988'>//
  Send back users that do not have access </span></i><b><span style='font-size:
  11.0pt;line-height:118%;font-family:Consolas;color:#333333'>if</span></b><span
  style='font-size:11.0pt;line-height:118%;font-family:Consolas;color:#333333'>(!$notification)
  { <b>return </b>AccessResult::forbidden();</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:191.95pt;margin-bottom:
  0in;margin-left:18.15pt;text-indent:0in;line-height:118%'><span
  style='font-size:11.0pt;line-height:118%;font-family:Consolas;color:#333333'>}
  <b>if</b>(!$notification-&gt;access(</span><span style='font-size:11.0pt;
  line-height:118%;font-family:Consolas;color:#DD1144'>'delete'</span><span
  style='font-size:11.0pt;line-height:118%;font-family:Consolas;color:#333333'>))
  { <b>return </b>AccessResult::forbidden();</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:15.95pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:119.4pt;margin-bottom:
  15.8pt;margin-left:18.15pt;text-indent:0in;line-height:115%'><i><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#999988'>//
  Delete the notification </span></i><span style='font-size:11.0pt;line-height:
  115%;font-family:Consolas;color:#333333'>$notification-&gt;delete();</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>if</span></b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>($method
  == </span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#DD1144'>'ajax'</span><span style='font-size:11.0pt;line-height:107%;
  font-family:Consolas;color:#333333'>) {</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:30.2pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$response = <b>new
  </b>AjaxResponse();</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:30.2pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$response-&gt;addCommand(<b>new
  </b>DeleteNotificationCommand());</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>} <b>else </b>{</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:30.2pt;text-indent:0in;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>//
  no javascript: send back to page</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:30.2pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$path =
  Url::fromRoute(</span><span style='font-size:11.0pt;line-height:107%;
  font-family:Consolas;color:#DD1144'>'view.notifications.page_1'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>);</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:30.2pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$response = <b>new
  </b>RedirectResponse($path);</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:30.2pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$response-&gt;send();</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:16.8pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>return
  </span></b><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#333333'>$response;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:15.95pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>What stands out is that in this controller the notification
gets deleted (if owner) and our response is an AjaxResponse(). In fact a
“deleteNotificationCommand”, which is a custom one. If javascript is disabled,
it sends back a redirect to the view.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:21.05pt;
margin-left:-.25pt;line-height:110%'>Now let’s register the AjaxResponse. To <b>custom/offer/src/Ajax/DeleteNotificationCommand.php:</b></p>

<p class=MsoNormal style='margin-top:0in;margin-right:76.6pt;margin-bottom:
9.25pt;margin-left:11.8pt;line-height:160%;background:#F8F8F8'><b><span
style='font-size:11.0pt;line-height:160%;font-family:Consolas;color:#999999'>&lt;?php
</span></b><b><span style='font-size:11.0pt;line-height:160%;font-family:Consolas;
color:#333333'>namespace </span></b><b><span style='font-size:11.0pt;
line-height:160%;font-family:Consolas;color:#990000'>Drupal</span></b><span
style='font-size:11.0pt;line-height:160%;font-family:Consolas;color:#333333'>\</span><b><span
style='font-size:11.0pt;line-height:160%;font-family:Consolas;color:#990000'>notification</span></b><span
style='font-size:11.0pt;line-height:160%;font-family:Consolas;color:#333333'>\</span><b><span
style='font-size:11.0pt;line-height:160%;font-family:Consolas;color:#990000'>Ajax</span></b><span
style='font-size:11.0pt;line-height:160%;font-family:Consolas;color:#333333'>; <b>use
</b></span><b><span style='font-size:11.0pt;line-height:160%;font-family:Consolas;
color:#990000'>Drupal</span></b><span style='font-size:11.0pt;line-height:160%;
font-family:Consolas;color:#333333'>\</span><b><span style='font-size:11.0pt;
line-height:160%;font-family:Consolas;color:#990000'>Core</span></b><span
style='font-size:11.0pt;line-height:160%;font-family:Consolas;color:#333333'>\</span><b><span
style='font-size:11.0pt;line-height:160%;font-family:Consolas;color:#990000'>Ajax</span></b><span
style='font-size:11.0pt;line-height:160%;font-family:Consolas;color:#333333'>\</span><b><span
style='font-size:11.0pt;line-height:160%;font-family:Consolas;color:#990000'>CommandInterface</span></b><span
style='font-size:11.0pt;line-height:160%;font-family:Consolas;color:#333333'>; <b>class
</b></span><b><span style='font-size:11.0pt;line-height:160%;font-family:Consolas;
color:#445588'>DeleteNotificationCommand </span></b><b><span style='font-size:
11.0pt;line-height:160%;font-family:Consolas;color:#333333'>implements </span></b><b><span
style='font-size:11.0pt;line-height:160%;font-family:Consolas;color:#445588'>CommandInterface
</span></b><span style='font-size:11.0pt;line-height:160%;font-family:Consolas;
color:#333333'>{</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:76.6pt;margin-bottom:
1.0pt;margin-left:11.8pt;line-height:107%;background:#F8F8F8'><i><span
style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>//
Implements Drupal\Core\Ajax\CommandInterface:render().</span></i></p>

<p class=MsoNormal style='margin-top:0in;margin-right:76.6pt;margin-bottom:
.95pt;margin-left:11.8pt;line-height:110%;background:#F8F8F8'><b><span
style='font-size:11.0pt;line-height:110%;font-family:Consolas;color:#333333'>public
function </span></b><b><span style='font-size:11.0pt;line-height:110%;
font-family:Consolas;color:#990000'>render</span></b><span style='font-size:
11.0pt;line-height:110%;font-family:Consolas;color:#333333'>() {</span></p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:100.5pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
  height:100.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>return
  array</span></b><span style='font-size:11.0pt;line-height:107%;font-family:
  Consolas;color:#333333'>(</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:30.2pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'command' </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>=&gt;
  </span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#DD1144'>'DeleteNotification'</span><span style='font-size:11.0pt;
  line-height:107%;font-family:Consolas;color:#333333'>,</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:216.1pt;margin-bottom:
  0in;margin-left:18.15pt;text-indent:12.1pt;line-height:115%'><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#DD1144'>'selector'
  </span><span style='font-size:11.0pt;line-height:115%;font-family:Consolas;
  color:#333333'>=&gt; <b>$this</b>-&gt;selector, );</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>With this Command, the system knows what to send to
javascript. Not that it is also possible to send data in an extra key. If we
would need this, we would call New DeleteNoficiationCommand($extra) in <b>NotificationDeleteController.php.
</b>And then add ‘extra’ next to ‘command’ and ‘selector’ in our <b>DeleteNotificationCommand.
</b>In the javascript file we’re about to add, the ‘extra’ would be available
in the <i>response </i>argument. But we’ll do another handy trick: refreshing
the view after deletion.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:0in;
margin-left:-.25pt'>To <b>custom/notification/notification.libraries.yml </b>we
add a new library for our notification javascript file:</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:130.5pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
  height:130.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>notification:</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>js:</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>js/notification.js:
  {}</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>dependencies:</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:30.25pt;text-indent:-12.1pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#990073'>-<span
  style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>core/drupal.ajax</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:30.25pt;text-indent:-12.1pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#990073'>-<span
  style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>core/jquery</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:30.25pt;text-indent:-12.1pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#990073'>-<span
  style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>core/drupal</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:30.25pt;text-indent:-12.1pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#990073'>-<span
  style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>views/views.ajax</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.35pt;
margin-left:-.25pt;line-height:110%'>We add the javascript file <b>custom/notification/js/notification.js</b>:</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:175.5pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
  height:175.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:15.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>( <b>function </b>($)
  {</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>//
  Command to replace element.</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:40.85pt;margin-bottom:
  0in;margin-left:0in;text-indent:6.05pt;line-height:118%'><span
  style='font-size:11.0pt;line-height:118%;font-family:Consolas;color:#333333'>Drupal.AjaxCommands.prototype.DeleteNotification
  = <b>function</b>(ajax, response, status) { <b>if</b>(status === </span><span
  style='font-size:11.0pt;line-height:118%;font-family:Consolas;color:#DD1144'>'success'</span><span
  style='font-size:11.0pt;line-height:118%;font-family:Consolas;color:#333333'>)
  {</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:30.2pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$(</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'.view-id-notifications'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>).trigger(</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'RefreshView'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>);</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:15.95pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>})(jQuery);</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>This was the final bit. The DeleteNotification javascript
function gets called in the front-end to make a visible change to the users
page. Here, after a successful deletion call, we refresh the view using a
built-in trigger. Make sure the ‘use ajax’ option is set to ‘ON’ in your view
settings.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:2.1pt;
margin-left:-.25pt'>To start using it, we extend the <b>custom/offer/src/Plugin/views/field/NotificationMessage.php
</b><i>render() </i>function with a “Remove” link:</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:400.5pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
  height:400.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><i><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>/**</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><i><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>* {</span></i><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>@inheritdoc</span></i><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>}</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:179.85pt;margin-bottom:
  0in;margin-left:0in;text-indent:0in;line-height:118%'><i><span
  style='font-size:11.0pt;line-height:118%;font-family:Consolas;color:#999988'>*/
  </span></i><b><span style='font-size:11.0pt;line-height:118%;font-family:
  Consolas;color:#333333'>public function </span></b><b><span style='font-size:
  11.0pt;line-height:118%;font-family:Consolas;color:#990000'>render</span></b><span
  style='font-size:11.0pt;line-height:118%;font-family:Consolas;color:#333333'>(ResultRow
  $values) { $entity = $values-&gt;_entity;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:125.45pt;margin-bottom:
  0in;margin-left:6.05pt;text-indent:0in;line-height:115%'><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>$type
  = $entity-&gt;get(</span><span style='font-size:11.0pt;line-height:115%;
  font-family:Consolas;color:#DD1144'>'type'</span><span style='font-size:11.0pt;
  line-height:115%;font-family:Consolas;color:#333333'>)-&gt;getString();
  $offer_id = $entity-&gt;get(</span><span style='font-size:11.0pt;line-height:
  115%;font-family:Consolas;color:#DD1144'>'offer_id'</span><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>)-&gt;getString();</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:191.95pt;margin-bottom:
  0in;margin-left:6.05pt;text-indent:0in;line-height:121%'><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>$offer
  = Offer::load($offer_id); <b>if</b>($type == </span><span style='font-size:
  11.0pt;line-height:121%;font-family:Consolas;color:#DD1144'>'expired'</span><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>)
  {</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$url =
  Url::fromRoute(</span><span style='font-size:11.0pt;line-height:107%;
  font-family:Consolas;color:#DD1144'>'entity.offer.canonical'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>,
  <b>array</b>(</span><span style='font-size:11.0pt;line-height:107%;
  font-family:Consolas;color:#DD1144'>'offer' </span><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>=&gt;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$offer-&gt;id()));</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$link =
  Link::fromTextAndUrl($offer-&gt;label(), $url)-&gt;toRenderable();</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$text = </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'Offer
  '</span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#333333'>. render($link) .</span><span style='font-size:11.0pt;
  line-height:107%;font-family:Consolas;color:#DD1144'>' has expired.'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>//
  Add delete link for removing notifications</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$deleteUrl =
  Url::fromRoute(</span><span style='font-size:11.0pt;line-height:107%;
  font-family:Consolas;color:#DD1144'>'notification.delete'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>,
  [</span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#DD1144'>'method' </span><span style='font-size:11.0pt;line-height:
  107%;font-family:Consolas;color:#333333'>=&gt;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'nojs'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>,
  </span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#DD1144'>'id' </span><span style='font-size:11.0pt;line-height:107%;
  font-family:Consolas;color:#333333'>=&gt; $entity-&gt;id()]);</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$deleteLink =
  Link::fromTextAndUrl(</span><span style='font-size:11.0pt;line-height:107%;
  font-family:Consolas;color:#DD1144'>'Remove'</span><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>,</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$deleteUrl)-&gt;toRenderable();</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$deleteLink[</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'#attributes'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>]
  = [</span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#DD1144'>'class' </span><span style='font-size:11.0pt;line-height:107%;
  font-family:Consolas;color:#333333'>=&gt; </span><span style='font-size:11.0pt;
  line-height:107%;font-family:Consolas;color:#DD1144'>'use-ajax'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>];</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$deleteText =
  render($deleteLink);</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$output = $text .
  </span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#DD1144'>' ' </span><span style='font-size:11.0pt;line-height:107%;
  font-family:Consolas;color:#333333'>. $deleteText;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:385.35pt;margin-bottom:
  0in;margin-left:6.05pt;text-indent:0in;line-height:121%'><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>}
  <b>return </b>[</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'#children' </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>=&gt;
  $output</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>];</span></p>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:.05in;
margin-left:-.25pt'>Note we just have to add the ‘use-ajax’ class to trigger
the ajax call. We’re done!</p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:1.5pt;text-indent:0in;line-height:107%'><img border=0 width=576
height=130 id="Picture 18340"
src="Learning%20drupal%209%20as%20a%20framework_files/image108.jpg"></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:22.9pt;
margin-left:-.25pt'>If we now remove a notification, our view gets updated
automatically while staying in the page.</p>

<h2 style='margin-left:-.25pt'><a name="_Toc247076">OO in practice: deletion of
bid and notification entities when an offer gets deleted</a></h2>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=600
 style='width:6.25in;border-collapse:collapse'>
 <tr style='height:58.5pt'>
  <td width=59 valign=top style='width:44.25pt;background:#6D9EEB;padding:14.6pt 5.75pt 0in 0in;
  height:58.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:14.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%'>&#128073;</span></p>
  </td>
  <td width=541 style='width:405.75pt;background:#6D9EEB;padding:14.6pt 5.75pt 0in 0in;
  height:58.5pt'>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%'>In this chapter we will teach how
  you can remove entities that are linked to other entities using the <b>preDelete()
  </b>functions on the entity.</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:.75pt;
margin-left:-.25pt'>We should think through all of the necessary use-cases of
our software: what happens to bids when somebody deletes his offer? This is a
relevant question. The following entities rely on an offer:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:.95pt;
margin-left:.5in;text-indent:-.25in'><span style='font-family:"Arial",sans-serif'>&#9679;<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span>The
bids to the offer</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:.5in;text-indent:-.25in'><span style='font-family:"Arial",sans-serif'>&#9679;<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span>The
notifications about the offer</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>We must make sure these are deleted as well, when deleting
an offer.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:21.9pt;
margin-left:-.25pt;line-height:110%'>Remember the following line in <b>custom/offer/src/Entity/Offer.php</b>:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:23.7pt;
margin-left:5.25pt;text-indent:0in;line-height:107%;background:#F8F8F8'><b><span
style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>class
</span></b><b><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
color:#445588'>Offer </span></b><b><span style='font-size:11.0pt;line-height:
107%;font-family:Consolas;color:#333333'>extends </span></b><b><span
style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#445588'>EditorialContentEntityBase</span></b></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:.95pt;
margin-left:-.25pt'>Let’s drill down how the inheritance goes:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:.95pt;
margin-left:.5in;text-indent:-.25in'><span style='font-family:"Arial",sans-serif'>&#9679;<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span>EditorialContentEntityBase
extends ContentEntityBase</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:.5in;text-indent:-.25in'><span style='font-family:"Arial",sans-serif'>&#9679;<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span>ContentEntityBase
extends EntityBase</p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.35pt;
margin-left:-.25pt;line-height:110%'>In <b>Core/Entity/EntityBase.php </b>on <b>line
401 </b>we see this line:</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:160.5pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
  height:160.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><i><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>/**</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><i><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>* {</span></i><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>@inheritdoc</span></i><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>}</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:282.6pt;margin-bottom:
  0in;margin-left:0in;text-indent:0in;line-height:121%'><i><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#999988'>*/
  </span></i><b><span style='font-size:11.0pt;line-height:121%;font-family:
  Consolas;color:#333333'>public function </span></b><b><span style='font-size:
  11.0pt;line-height:121%;font-family:Consolas;color:#990000'>delete</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>()
  {</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:15.95pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>if
  </span></b><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#333333'>(!<b>$this</b>-&gt;isNew()) {</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:4.6pt;margin-bottom:
  0in;margin-left:0in;text-indent:0in;line-height:118%'><b><span
  style='font-size:11.0pt;line-height:118%;font-family:Consolas;color:#333333'>$this</span></b><span
  style='font-size:11.0pt;line-height:118%;font-family:Consolas;color:#333333'>-&gt;entityTypeManager()-&gt;getStorage(<b>$this</b>-&gt;entityTypeId)-&gt;delete([<b>$th
  is</b>-&gt;id() =&gt; <b>$this</b>]); }</span></p>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>Thanks to these lines, we are able to use
$offer-&gt;delete() to delete an offer.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:20.9pt;
margin-left:-.25pt'>On <b>line 463 </b>we find this function:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:16.95pt;margin-bottom:
1.0pt;margin-left:5.0pt;line-height:107%;background:#F8F8F8'><i><span
style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>/**</span></i></p>

<p class=MsoNormal style='margin-top:0in;margin-right:16.95pt;margin-bottom:
1.75pt;margin-left:5.0pt;line-height:107%;background:#F8F8F8'><i><span
style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*
{</span></i><i><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
color:#DD1144'>@inheritdoc</span></i><i><span style='font-size:11.0pt;
line-height:107%;font-family:Consolas;color:#999988'>}</span></i></p>

<p class=MsoNormal style='margin-top:0in;margin-right:16.95pt;margin-bottom:
.8pt;margin-left:5.0pt;line-height:111%;background:#F8F8F8'><i><span
style='font-size:11.0pt;line-height:111%;font-family:Consolas;color:#999988'>*/
</span></i><b><span style='font-size:11.0pt;line-height:111%;font-family:Consolas;
color:#333333'>public static function </span></b><b><span style='font-size:
11.0pt;line-height:111%;font-family:Consolas;color:#990000'>preDelete</span></b><span
style='font-size:11.0pt;line-height:111%;font-family:Consolas;color:#333333'>(EntityStorageInterface
$storage, array</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:16.95pt;margin-bottom:
.8pt;margin-left:5.0pt;line-height:111%;background:#F8F8F8'><span
style='font-size:11.0pt;line-height:111%;font-family:Consolas;color:#333333'>$entities)
{</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:16.95pt;margin-bottom:
24.05pt;margin-left:5.0pt;line-height:111%;background:#F8F8F8'><span
style='font-size:11.0pt;line-height:111%;font-family:Consolas;color:#333333'>}</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:2.1pt;
margin-left:-.25pt'>An empty function that gets called right before deletion of
an entity. This is the guy we need! Let’s add this one to our <b>custom/offer/src/Entity/Offer.php</b>,
below the <i>preCreate() </i>function:</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:475.5pt'>
  <td width=601 valign=top style='width:450.75pt;background:#F8F8F8;padding:
  0in 5.75pt 0in 5.25pt;height:475.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><i><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>/**</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><i><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>* {</span></i><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>@inheritdoc</span></i><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>}</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:10.65pt;margin-bottom:
  0in;margin-left:0in;text-indent:0in;line-height:121%'><i><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#999988'>*/
  </span></i><b><span style='font-size:11.0pt;line-height:121%;font-family:
  Consolas;color:#333333'>public static function </span></b><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>preDelete</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>(EntityStorageInterface
  $storage, array</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:2.75in;margin-bottom:
  15.8pt;margin-left:6.05pt;text-indent:-6.05pt;line-height:115%'><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>$entities)
  { <b>parent</b>::preDelete($storage, $entities);</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:6.05pt;text-indent:0in;line-height:121%'><i><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#999988'>//
  Delete all bids and notifications of the offer that will be deleted </span></i><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>foreach
  </span></b><span style='font-size:11.0pt;line-height:121%;font-family:Consolas;
  color:#333333'>($entities <b>as </b>$entity) {</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$entity-&gt;deleteAllLinkedBids();</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:173.8pt;margin-bottom:
  0in;margin-left:6.05pt;text-indent:12.1pt;line-height:115%'><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>$entity-&gt;deleteAllLinkedNotifications();
  }</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:15.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><i><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>/**</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:12.1pt;text-indent:-12.1pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>Deletes
  all bids linked to the offer.</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:12.1pt;text-indent:-12.1pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>@param
  </span></i><i><span style='font-size:11.0pt;line-height:107%;font-family:
  Consolas;color:#999988'>bool $delete</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:12.1pt;text-indent:-12.1pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>@throws
  </span></i><i><span style='font-size:11.0pt;line-height:107%;font-family:
  Consolas;color:#999988'>\Drupal\Core\Entity\EntityStorageException</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:113.4pt;margin-bottom:
  0in;margin-left:0in;text-indent:0in;line-height:121%'><i><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#999988'>*/
  </span></i><b><span style='font-size:11.0pt;line-height:121%;font-family:
  Consolas;color:#333333'>public function </span></b><b><span style='font-size:
  11.0pt;line-height:121%;font-family:Consolas;color:#990000'>deleteAllLinkedBids</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>($delete
  = FALSE) {</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:15.95pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$id = <b>$this</b>-&gt;id();</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:204.05pt;margin-bottom:
  0in;margin-left:6.05pt;text-indent:0in;line-height:117%'><span
  style='font-size:11.0pt;line-height:117%;font-family:Consolas;color:#333333'>$query
  = \Drupal::entityQuery(</span><span style='font-size:11.0pt;line-height:117%;
  font-family:Consolas;color:#DD1144'>'bid'</span><span style='font-size:11.0pt;
  line-height:117%;font-family:Consolas;color:#333333'>) -&gt;condition(</span><span
  style='font-size:11.0pt;line-height:117%;font-family:Consolas;color:#DD1144'>'offer_id'</span><span
  style='font-size:11.0pt;line-height:117%;font-family:Consolas;color:#333333'>,
  $id); $bidIds = $query-&gt;execute(); <b>foreach</b>($bidIds <b>as </b>$id) {</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$bid =
  Bid::load($id);</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$bid-&gt;delete();</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  </td>
 </tr>
 <tr style='height:250.5pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
  height:250.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><i><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>/**</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:12.1pt;text-indent:-12.1pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>Deletes
  all notifications linked to the offer.</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:12.1pt;text-indent:-12.1pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>@param
  </span></i><i><span style='font-size:11.0pt;line-height:107%;font-family:
  Consolas;color:#999988'>bool $delete</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:12.1pt;text-indent:-12.1pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>@throws
  </span></i><i><span style='font-size:11.0pt;line-height:107%;font-family:
  Consolas;color:#999988'>\Drupal\Core\Entity\EntityStorageException</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:59.0pt;margin-bottom:
  0in;margin-left:0in;text-indent:0in;line-height:121%'><i><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#999988'>*/
  </span></i><b><span style='font-size:11.0pt;line-height:121%;font-family:
  Consolas;color:#333333'>public function </span></b><b><span style='font-size:
  11.0pt;line-height:121%;font-family:Consolas;color:#990000'>deleteAllLinkedNotifications</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>($delete
  = FALSE) {</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:15.95pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$id = <b>$this</b>-&gt;id();</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:149.65pt;margin-bottom:
  0in;margin-left:6.05pt;text-indent:0in;line-height:117%'><span
  style='font-size:11.0pt;line-height:117%;font-family:Consolas;color:#333333'>$query
  = \Drupal::entityQuery(</span><span style='font-size:11.0pt;line-height:117%;
  font-family:Consolas;color:#DD1144'>'notification'</span><span
  style='font-size:11.0pt;line-height:117%;font-family:Consolas;color:#333333'>)
  -&gt;condition(</span><span style='font-size:11.0pt;line-height:117%;
  font-family:Consolas;color:#DD1144'>'offer_id'</span><span style='font-size:
  11.0pt;line-height:117%;font-family:Consolas;color:#333333'>, $id);
  $notificationIds = $query-&gt;execute(); <b>foreach</b>($notificationIds <b>as
  </b>$id) {</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$notification =
  Notification::load($id);</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$notification-&gt;delete();</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:8.35pt;margin-bottom:
.9pt;margin-left:7.25pt;line-height:110%;background:#FFD966'><span
style='font-size:11.0pt;line-height:110%'>Now, when a user deletes an offer in
the UI, all linked dataparts get removed as well.</span></p>

<p class=MsoNormal align=center style='margin-top:0in;margin-right:8.35pt;
margin-bottom:26.85pt;margin-left:7.25pt;text-align:center;line-height:163%;
background:#FFD966'><span style='font-size:11.0pt;line-height:163%'>This keeps
our database clean and prevents orphan entities which could lead to errors.</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>A good example of the power of Object Oriented programming
(OO): we inherited the <i>preDelete() </i>function and use it in our offer
entities. Make sure you take a look at all the other methods that can be used
in <i>EntityBase </i>as well.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:21.7pt;
margin-left:-.25pt'>As an extra we could add a new notification type to inform
the user that an offer he had done a bid on was deleted, but this would lead us
too far away for this course.</p>

<h2 style='margin-top:0in;margin-right:0in;margin-bottom:3.55pt;margin-left:
-.25pt'><a name="_Toc247077">Caching in-depth</a></h2>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=600
 style='width:6.25in;border-collapse:collapse'>
 <tr style='height:69.0pt'>
  <td width=59 valign=top style='width:44.25pt;background:#6D9EEB;padding:14.6pt 5.75pt 0in 0in;
  height:69.0pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:14.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%'>&#128073;</span></p>
  </td>
  <td width=541 style='width:405.75pt;background:#6D9EEB;padding:14.6pt 5.75pt 0in 0in;
  height:69.0pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:7.0pt;margin-bottom:
  0in;margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%'>In this important chapter we dig deeper on the
  powerful <b>drupal caching API</b>. After this chapter you will be able to <b>implement
  complex caching mechanisms </b>on entities, views and controllers.</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>Caching is an important aspect that was improved
drastically when the drupal community built drupal 8 from scratch (it was a
complete rewrite of drupal 7). More specifically it added great control over <i>which
</i>portions of your page you would like to have cached and <i>how.</i></p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=600
 style='width:6.25in;margin-left:.4pt;border-collapse:collapse'>
 <tr style='height:38.5pt'>
  <td width=107 style='width:80.15pt;border:solid #BF9000 1.0pt;border-top:
  none;background:#BF9000;padding:9.55pt 5.75pt 0in 0in;height:38.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:6.4pt;text-indent:0in;line-height:107%'><b><span
  style='font-size:10.0pt;line-height:107%'>Cache API types</span></b></p>
  </td>
  <td width=125 valign=top style='width:94.0pt;border-top:none;border-left:
  none;border-bottom:solid #BF9000 1.0pt;border-right:solid #BF9000 1.0pt;
  background:#BF9000;padding:9.55pt 5.75pt 0in 0in;height:38.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:6.5pt;text-indent:0in;line-height:107%'><b><span
  style='font-size:10.0pt;line-height:107%'>What</span></b></p>
  </td>
  <td width=145 valign=top style='width:109.0pt;border-top:none;border-left:
  none;border-bottom:solid #BF9000 1.0pt;border-right:solid #BF9000 1.0pt;
  background:#BF9000;padding:9.55pt 5.75pt 0in 0in;height:38.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:7.0pt;text-indent:0in;line-height:107%'><b><span
  style='font-size:10.0pt;line-height:107%'>Example</span></b></p>
  </td>
  <td width=223 colspan=2 valign=top style='width:166.9pt;border-top:none;
  border-left:none;border-bottom:solid #BF9000 1.0pt;border-right:solid #BF9000 1.0pt;
  background:#BF9000;padding:9.55pt 5.75pt 0in 0in;height:38.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:6.75pt;text-indent:0in;line-height:107%'><b><span
  style='font-size:10.0pt;line-height:107%'>Example code</span></b></p>
  </td>
 </tr>
 <tr style='height:89.0pt'>
  <td width=107 valign=top style='width:80.15pt;border:solid #BF9000 1.0pt;
  border-top:none;background:#FFE599;padding:9.55pt 5.75pt 0in 0in;height:89.0pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:6.4pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%'>Cache tags</span></p>
  </td>
  <td width=125 style='width:94.0pt;border-top:none;border-left:none;
  border-bottom:solid #BF9000 1.0pt;border-right:solid #BF9000 1.0pt;
  background:#FFE599;padding:9.55pt 5.75pt 0in 0in;height:89.0pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:1.3pt;margin-bottom:
  0in;margin-left:6.5pt;text-indent:0in;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%'>For dependencies on data like
  entities and configuration</span></p>
  </td>
  <td width=145 style='width:109.0pt;border-top:none;border-left:none;
  border-bottom:solid #BF9000 1.0pt;border-right:solid #BF9000 1.0pt;
  background:#FFE599;padding:9.55pt 5.75pt 0in 0in;height:89.0pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:7.0pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%'>A block that needs to be refreshed when a node
  entity with id 68 is changed.</span></p>
  </td>
  <td width=223 colspan=2 style='width:166.9pt;border-top:none;border-left:
  none;border-bottom:solid #BF9000 1.0pt;border-right:solid #BF9000 1.0pt;
  background:#F8F8F8;padding:9.55pt 5.75pt 0in 0in;height:89.0pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:6.75pt;text-indent:0in;line-height:118%'><b><span
  style='font-size:11.0pt;line-height:118%;font-family:Consolas;color:#333333'>public
  function </span></b><b><span style='font-size:11.0pt;line-height:118%;
  font-family:Consolas;color:#990000'>getCacheTags</span></b><span
  style='font-size:11.0pt;line-height:118%;font-family:Consolas;color:#333333'>()
  { <b>return </b>Cache::mergeTags(<b>parent</b>::</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:6.75pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>getCacheTags(), <b>array</b>(</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'node:68'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>));
  }</span></p>
  </td>
 </tr>
 <tr style='height:128.0pt'>
  <td width=107 valign=top style='width:80.15pt;border:solid #BF9000 1.0pt;
  border-top:none;background:#FFE599;padding:9.55pt 5.75pt 0in 0in;height:128.0pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:6.4pt;text-indent:0in;line-height:107%'>Cache contexts</p>
  </td>
  <td width=125 valign=top style='width:94.0pt;border-top:none;border-left:
  none;border-bottom:solid #BF9000 1.0pt;border-right:solid #BF9000 1.0pt;
  background:#FFE599;padding:9.55pt 5.75pt 0in 0in;height:128.0pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:6.5pt;text-indent:0in;line-height:107%'>For variations,</p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:6.5pt;text-indent:0in;line-height:107%'>i.e.</p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:6.5pt;text-indent:0in;line-height:107%'>dependencies on the
  request context</p>
  </td>
  <td width=145 style='width:109.0pt;border-top:none;border-left:none;
  border-bottom:solid #BF9000 1.0pt;border-right:solid #BF9000 1.0pt;
  background:#FFE599;padding:9.55pt 5.75pt 0in 0in;height:128.0pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:28.5pt;
  margin-left:7.0pt;text-indent:0in;line-height:97%'>Cache a block differently
  on every path.</p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:7.0pt;text-indent:0in;line-height:107%'>Or cache a block
  differently for every user.</p>
  </td>
  <td width=223 colspan=2 valign=top style='width:166.9pt;border-top:none;
  border-left:none;border-bottom:solid #BF9000 1.0pt;border-right:solid #BF9000 1.0pt;
  background:#F8F8F8;padding:9.55pt 5.75pt 0in 0in;height:128.0pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:15.4pt;
  margin-left:6.75pt;text-indent:0in;line-height:118%'><b><span
  style='font-size:11.0pt;line-height:118%;font-family:Consolas;color:#333333'>public
  function </span></b><b><span style='font-size:11.0pt;line-height:118%;
  font-family:Consolas;color:#990000'>getCacheContexts</span></b><span
  style='font-size:11.0pt;line-height:118%;font-family:Consolas;color:#333333'>()
  { <b>return </b>[</span><span style='font-size:11.0pt;line-height:118%;
  font-family:Consolas;color:#DD1144'>'url.path'</span><span style='font-size:
  11.0pt;line-height:118%;font-family:Consolas;color:#333333'>]; }</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:6.75pt;text-indent:0in;line-height:107%'><b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>public
  function </span></b><b><span style='font-size:11.0pt;line-height:107%;
  font-family:Consolas;color:#990000'>getCacheContexts</span></b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>()
  { <b>return </b>[</span><span style='font-size:11.0pt;line-height:107%;
  font-family:Consolas;color:#DD1144'>'user'</span><span style='font-size:11.0pt;
  line-height:107%;font-family:Consolas;color:#333333'>]; }</span></p>
  </td>
 </tr>
 <tr style='height:119.9pt'>
  <td width=107 valign=top style='width:80.15pt;border:solid #BF9000 1.0pt;
  border-top:none;background:#FFE599;padding:9.55pt 5.75pt 0in 0in;height:119.9pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:6.4pt;text-indent:0in;line-height:107%'>Cache max-age</p>
  </td>
  <td width=125 valign=top style='width:94.0pt;border-top:none;border-left:
  none;border-bottom:solid #BF9000 1.0pt;border-right:solid #BF9000 1.0pt;
  background:#FFE599;padding:9.55pt 5.75pt 0in 0in;height:119.9pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:6.5pt;text-indent:0in;line-height:107%'>For time-sensitive
  caching, i.e. time dependencies</p>
  </td>
  <td width=145 style='width:109.0pt;border-top:none;border-left:none;
  border-bottom:solid #BF9000 1.0pt;border-right:solid #BF9000 1.0pt;
  background:#FFE599;padding:9.55pt 5.75pt 0in 0in;height:119.9pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:42.75pt;
  margin-left:7.0pt;text-indent:0in;line-height:97%'>Never cache this block.</p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:7.0pt;text-indent:0in;line-height:107%'>Cache 1 day, then renew
  each day</p>
  </td>
  <td width=162 style='width:121.6pt;border:none;border-bottom:solid #BF9000 1.0pt;
  background:#F8F8F8;padding:9.55pt 5.75pt 0in 0in;height:119.9pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:6.75pt;text-indent:0in;line-height:115%'><b><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>public
  function </span></b><b><span style='font-size:11.0pt;line-height:115%;
  font-family:Consolas;color:#990000'>getCacheMaxAge</span></b><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>()
  {</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:16.8pt;
  margin-left:6.75pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:teal'>0</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>;
  }</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:6.75pt;text-indent:0in;line-height:115%'><b><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>public
  function </span></b><b><span style='font-size:11.0pt;line-height:115%;
  font-family:Consolas;color:#990000'>getCacheMaxAge</span></b><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>()
  {</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:6.75pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:teal'>86400</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>;
  }</span></p>
  </td>
  <td width=60 style='width:45.3pt;border-top:none;border-left:none;border-bottom:
  solid #BF9000 1.0pt;border-right:solid #BF9000 1.0pt;background:#F8F8F8;
  padding:9.55pt 5.75pt 0in 0in;height:119.9pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:45.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><b><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>return</span></b></p>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>return</span></b></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>Certainly interesting to check out <a
href="https://www.drupal.org/docs/drupal-apis/cache-api"><span
style='color:#1155CC'>https://www.drupal.org/docs/drupal-apis/cache-api</span></a><u><span
style='color:#1155CC'> </span></u>to see all contexts, available tags etc.</p>

<h3 style='margin-left:-.25pt'><a name="_Toc247078">Caching of views pages</a></h3>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=600
 style='width:6.25in;border-collapse:collapse'>
 <tr style='height:42.0pt'>
  <td width=59 style='width:44.25pt;background:#6D9EEB;padding:0in 5.75pt 0in 0in;
  height:42.0pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:14.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%'>&#128073;</span></p>
  </td>
  <td width=541 style='width:405.75pt;background:#6D9EEB;padding:0in 5.75pt 0in 0in;
  height:42.0pt'>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%'>This short and theoretical chapter
  explains how caching works on view listings.</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>For our offering platform, let’s start with the <u>/offer </u>page.
This is a views page. It has caching support in the settings. On the right
bottom corner of <b>/admin/structure/views/view/offer</b>:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:24.25pt;
margin-left:1.5pt;text-indent:0in;line-height:107%'><img border=0 width=546
height=394 id="Picture 18907"
src="Learning%20drupal%209%20as%20a%20framework_files/image109.jpg"></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:2.1pt;
margin-left:-.25pt'>Set “Caching”  to “Tag based”. Because this view only looks
for entities of type ‘offer’, it will automatically invalidate when new offers
are added.</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=600
 style='width:6.25in;border-collapse:collapse'>
 <tr style='height:258.0pt'>
  <td width=59 valign=top style='width:44.25pt;background:#E2E3E5;padding:14.6pt 5.75pt 0in 0in;
  height:258.0pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:14.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%'>&#128187;</span></p>
  </td>
  <td width=541 valign=top style='width:405.75pt;background:#E2E3E5;padding:
  14.6pt 5.75pt 0in 0in;height:258.0pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:3.7pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%'>I can check this in the “headers” tab of the network
  profile in my developer tools:</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:21.8pt;
  margin-left:1.5pt;text-indent:0in;line-height:107%'><img border=0 width=204
  height=46 id="Picture 18909"
  src="Learning%20drupal%209%20as%20a%20framework_files/image110.jpg"></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:5.45pt;margin-bottom:
  2.45pt;margin-left:0in;text-indent:0in;line-height:117%'><span
  style='font-size:11.0pt;line-height:117%'>X-Drupal-Dynamic-Cache: HIT means
  I’ve got myself a cached page. If I add a new offer, this is what I get the
  first time I render the page:</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:21.8pt;
  margin-left:1.5pt;text-indent:0in;line-height:107%'><img border=0 width=200
  height=46 id="Picture 18911"
  src="Learning%20drupal%209%20as%20a%20framework_files/image111.jpg"></p>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%'>So, the first time this views page
  gets rendered it goes in the cache until a new offer is added. This way I’m
  sure the page will be loaded very quickly.</span></p>
  </td>
 </tr>
</table>

<h3 style='margin-left:-.25pt'><a name="_Toc247079">Caching of custom entity
pages</a></h3>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=600
 style='width:6.25in;border-collapse:collapse'>
 <tr style='height:55.5pt'>
  <td width=59 valign=top style='width:44.25pt;background:#6D9EEB;padding:14.6pt 5.75pt 0in 0in;
  height:55.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:14.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%'>&#128073;</span></p>
  </td>
  <td width=541 style='width:405.75pt;background:#6D9EEB;padding:14.6pt 5.75pt 0in 0in;
  height:55.5pt'>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%'>In this chapter we explore <b>the
  caching mechanisms </b>behind the <b>detail page </b>of an <b>entity</b>.</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:2.1pt;
margin-left:-.25pt'>Great news for our custom entity detail pages. Drupal 8 has
an automatic caching system by default that is pretty amazing, which makes it
possible to provide caching without any configuration.</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=600
 style='width:6.25in;border-collapse:collapse'>
 <tr style='height:55.5pt'>
  <td width=600 style='width:6.25in;background:#E2E3E5;padding:0in 5.75pt 0in 14.25pt;
  height:55.5pt'>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%'>&#128187; Make sure the core module
  “Internal dynamic page caching”</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:30.0pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%'>(dynamic_page_cache) is enabled to properly cache
  your entities.</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:3.4pt;
margin-left:-.25pt'>But be sure to check this. It is why in an earlier chapter
I advised to keep forms in blocks instead of trying to render them IN your
entity. If I had added the form in my preprocess() functions I would have got
this header:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:24.25pt;
margin-left:1.5pt;text-indent:0in;line-height:107%'><img border=0 width=241
height=30 id="Picture 18964"
src="Learning%20drupal%209%20as%20a%20framework_files/image112.jpg"></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:21.45pt;
margin-left:-.25pt'>The X-Drupal-Dynamic-Cache: UNCACHEABLE response header
says our page is definitely not cached. A useful help is to add the following
(development) setting to your <b>services.yml </b>file:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:24.05pt;
margin-left:5.75pt;line-height:111%;background:#F8F8F8'><span style='font-size:
11.0pt;line-height:111%;font-family:Consolas;color:#DD1144'>http.response.debug_cacheability_headers:
</span><span style='font-size:11.0pt;line-height:111%;font-family:Consolas;
color:teal'>true</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:3.5pt;
margin-left:-.25pt'>Refreshing the page resulted in the following response
headers (with my form inside my entity):</p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:24.25pt;
margin-left:1.5pt;text-indent:0in;line-height:107%'><img border=0 width=486
height=147 id="Picture 18966"
src="Learning%20drupal%209%20as%20a%20framework_files/image113.jpg"></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>The nice part about this is we get more information about
all the cache contexts and cache tags of our page. The drupal entity cache <i>should
work </i>by default so when I use the block to show my form I get the desired
result:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:24.25pt;
margin-left:1.5pt;text-indent:0in;line-height:107%'><img border=0 width=184
height=39 id="Picture 19047"
src="Learning%20drupal%209%20as%20a%20framework_files/image114.jpg"></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:30.4pt;
margin-left:-.25pt'>I have my cached entity again. This works pretty smart. Any
update on the entity will clear the caches for it. For our form and bidding
table, we need to use more advanced caching techniques like contexts and cache
tags.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:15.1pt;margin-bottom:
64.2pt;margin-left:14.0pt;line-height:110%;background:#FFD966'><span
style='font-size:11.0pt;line-height:110%'>Caching was a pain-point in drupal 7,
in drupal 8 and later it is definitely one of the strengths!</span></p>

<h3 style='margin-left:-.25pt'><a name="_Toc247080">Use of cache contexts and
cache tags for caching custom blocks</a></h3>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=600
 style='width:6.25in;border-collapse:collapse'>
 <tr style='height:55.5pt'>
  <td width=59 valign=top style='width:44.25pt;background:#6D9EEB;padding:14.6pt 5.75pt 0in 0in;
  height:55.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:14.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%'>&#128073;</span></p>
  </td>
  <td width=541 style='width:405.75pt;background:#6D9EEB;padding:14.6pt 5.75pt 0in 0in;
  height:55.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:2.2pt;margin-bottom:
  0in;margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%'>This chapter digs deeper on <b>cache tags </b>and <b>how
  to invalidate caches </b>on a custom block, when something happens like an
  entity update.</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:.95pt;
margin-left:-.25pt'>How can we properly cache our bid table for our users? We
want two things:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:.8pt;
margin-left:.5in;text-indent:-.25in'><span style='font-family:"Arial",sans-serif'>&#9679;<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span>A
table cached uniquely for our page (i.e. based on the entity we are looking at)</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:.5in;text-indent:-.25in'><span style='font-family:"Arial",sans-serif'>&#9679;<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span>A
table that gets updated when a new bid is added</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:22.55pt;
margin-left:-.25pt'>To make it uniquely for our page, remove the max-age:0
based caching that was currently set in <b>custom/offer/src/Plugin/Block/OfferBiddingTableBlock.php
</b>and add:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:10.6pt;margin-bottom:
26.65pt;margin-left:5.0pt;line-height:112%;background:#F8F8F8'><b><span
style='font-family:Consolas;color:#333333'>use </span></b><b><span
style='font-family:Consolas;color:#990000'>Drupal</span></b><span
style='font-family:Consolas;color:#333333'>\</span><b><span style='font-family:
Consolas;color:#990000'>Core</span></b><span style='font-family:Consolas;
color:#333333'>\</span><b><span style='font-family:Consolas;color:#990000'>Cache</span></b><span
style='font-family:Consolas;color:#333333'>\</span><b><span style='font-family:
Consolas;color:#990000'>Cache</span></b><span style='font-family:Consolas;
color:#333333'>; // on top of file</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.0pt;
margin-left:5.0pt;line-height:107%;background:#F8F8F8'><i><span
style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>/**</span></i></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.0pt;
margin-left:5.0pt;line-height:107%;background:#F8F8F8'><i><span
style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*
Cache per page</span></i></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:5.0pt;line-height:121%;background:#F8F8F8'><i><span
style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#999988'>*/
</span></i><b><span style='font-size:11.0pt;line-height:121%;font-family:Consolas;
color:#333333'>public function </span></b><b><span style='font-size:11.0pt;
line-height:121%;font-family:Consolas;color:#990000'>getCacheContexts</span></b><span
style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>()
{</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.25pt;
margin-left:5.0pt;line-height:111%;background:#F8F8F8'><b><span
style='font-size:11.0pt;line-height:111%;font-family:Consolas;color:#333333'>return
</span></b><span style='font-size:11.0pt;line-height:111%;font-family:Consolas;
color:#333333'>[</span><span style='font-size:11.0pt;line-height:111%;
font-family:Consolas;color:#DD1144'>'url.path'</span><span style='font-size:
11.0pt;line-height:111%;font-family:Consolas;color:#333333'>];</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:24.05pt;
margin-left:5.0pt;line-height:111%;background:#F8F8F8'><span style='font-size:
11.0pt;line-height:111%;font-family:Consolas;color:#333333'>}</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>This way we are sure we cache a bidding table that is
different per page. But of course we need to have it changed once there are new
bids.</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:145.5pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
  height:145.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><i><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>/**</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*
  Invalidate caches when there are new bids</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:246.35pt;margin-bottom:
  0in;margin-left:0in;text-indent:6.05pt;line-height:121%'><i><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#999988'>*/
  </span></i><b><span style='font-size:11.0pt;line-height:121%;font-family:
  Consolas;color:#333333'>public function </span></b><b><span style='font-size:
  11.0pt;line-height:121%;font-family:Consolas;color:#990000'>getCacheTags</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>()
  {</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$offer = <b>$this</b>-&gt;requestStack-&gt;getCurrentRequest()-&gt;get(</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'offer'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>);</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:143.6pt;margin-bottom:
  0in;margin-left:12.1pt;text-indent:0in;line-height:121%'><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>$offerId
  = $offer-&gt;id(); <b>return </b>Cache::mergeTags(<b>parent</b>::getCacheTags(),</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><b><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>array</span></b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>(</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'offer:'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>.$offerId));</span></p>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:15.1pt;margin-bottom:
32.35pt;margin-left:14.0pt;line-height:110%;background:#FFD966'><span
style='font-size:11.0pt;line-height:110%'>While this will update the table when
our offer entity gets updated, this won’t update the table when there is a new
bid, yet.</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:.8pt;
margin-left:-.25pt'>We add an <i>invalidateTags() </i>command on the offer
whenever there is a new bid on the offer. This way we have two nice advantages:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:.8pt;
margin-left:.5in;text-indent:-.25in'><span style='font-family:"Arial",sans-serif'>&#9679;<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span>We
automatically update offer teasers to show an update on the amount of bids</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:.5in;text-indent:-.25in'><span style='font-family:"Arial",sans-serif'>&#9679;<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span>We
automatically invalidate caches of the OfferBiddingTableBlock, to show the
latest bids</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:22.55pt;
margin-left:-.25pt'>We go back to our <b>custom/offer/src/Plugin/Form/OfferBiddingForm.php</b>.
More specifically in the <i>submitForm() </i>method we add the <i>invalidateCacheTags()
</i>command on the current offer:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:10.6pt;margin-bottom:
7.8pt;margin-left:5.0pt;line-height:112%;background:#F8F8F8'><b><span
style='font-family:Consolas;color:#333333'>use </span></b><b><span
style='font-family:Consolas;color:#990000'>Drupal</span></b><span
style='font-family:Consolas;color:#333333'>\</span><b><span style='font-family:
Consolas;color:#990000'>Core</span></b><span style='font-family:Consolas;
color:#333333'>\</span><b><span style='font-family:Consolas;color:#990000'>Cache</span></b><span
style='font-family:Consolas;color:#333333'>\</span><b><span style='font-family:
Consolas;color:#990000'>Cache</span></b><span style='font-family:Consolas;
color:#333333'>; // on top of file</span></p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:130.5pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 22.45pt 0in 5.25pt;
  height:130.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><b><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>if</span></b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>($validation
  === </span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:teal'>0</span><span style='font-size:11.0pt;line-height:107%;
  font-family:Consolas;color:#333333'>) {</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$bid-&gt;save();</span></p>
  <table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=371
   style='width:278.0pt;margin-left:12.1pt;border-collapse:collapse'>
   <tr style='height:13.2pt'>
    <td width=371 valign=top style='width:278.0pt;background:yellow;padding:
    2.4pt 0in 0in 0in;height:13.2pt'>
    <p class=MsoNormal style='margin:0in;text-align:justify;text-justify:inter-ideograph;
    text-indent:0in;line-height:107%'><b><span style='font-size:11.0pt;
    line-height:107%;font-family:Consolas;color:#333333'>Cache::invalidateTags($offer-&gt;getCacheTags());</span></b></p>
    </td>
   </tr>
  </table>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.8pt;
  margin-left:0in;text-align:justify;text-justify:inter-ideograph;text-indent:
  12.1pt;line-height:115%'><span style='font-size:11.0pt;line-height:115%;
  font-family:Consolas;color:#333333'>\Drupal::messenger()-&gt;addMessage(<b>$this</b>-&gt;t(</span><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#DD1144'>'Your
  bid was successfully submitted.'</span><span style='font-size:11.0pt;
  line-height:115%;font-family:Consolas;color:#333333'>));</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>} <b>else </b>{</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:24.15pt;margin-bottom:
  0in;margin-left:0in;text-align:justify;text-justify:inter-ideograph;
  text-indent:12.1pt;line-height:107%'><span style='font-size:11.0pt;
  line-height:107%;font-family:Consolas;color:#333333'>\Drupal::messenger()-&gt;addWarning($violations[</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:teal'>0</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>]-&gt;getMessage());
  }</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:15.1pt;margin-bottom:
32.35pt;margin-left:14.0pt;line-height:110%;background:#FFD966'><span
style='font-size:11.0pt;line-height:110%'>With rather easy commands, we are now
able to have custom-tailored caching working!</span></p>

<h3 style='margin-left:-.25pt'><a name="_Toc247081">Use of cacheable
dependencies in render arrays</a></h3>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=600
 style='width:6.25in;border-collapse:collapse'>
 <tr style='height:69.0pt'>
  <td width=59 valign=top style='width:44.25pt;background:#6D9EEB;padding:14.6pt 5.75pt 0in 0in;
  height:69.0pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:14.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%'>&#128073;</span></p>
  </td>
  <td width=541 style='width:405.75pt;background:#6D9EEB;padding:14.6pt 5.75pt 0in 0in;
  height:69.0pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:.3pt;margin-bottom:
  0in;margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%'>This chapter will expand your knowledge on caching a
  little more. More specifically <b>Cacheable Dependencies</b>. With this API
  we can add caching <i>dependent </i>of certain situations.</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>To make dealing with cacheability metadata (cache tags,
cache contexts and max-age) easier, Drupal 8 has <a
href="https://www.drupal.org/docs/8/api/cache-api/cacheabledependencyinterface-friends"><span
style='color:#1155CC'>CacheableDependencyInterface</span></a>. It is
implemented by a majority of objects you interact with while writing Drupal 8
code!</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>Because not only controllers or blocks need to have
caching, also access results, menu links, context plugins, condition plugins,
and so on.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:21.9pt;
margin-left:-.25pt'>You might remember the following from our <u><span
style='color:#1155CC'>chapter on access</span></u>:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:10.6pt;margin-bottom:
23.05pt;margin-left:5.0pt;line-height:112%;background:#F8F8F8'><span
style='font-family:Consolas;color:#333333'>$access =
AccessResult::allowedIf($account-&gt;id() ==
$entity-&gt;getOwnerId())-&gt;cachePerUser()<b>-&gt;addCacheableDependency($en
tity)</b></span><span style='font-size:11.0pt;line-height:112%;font-family:
Consolas;color:#333333'>;</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>This means that access to the entity gets cached for each
user and this will be invalidated when the entity changes. That’s why we get
access to an offer as soon its workflow state changes from draft to published.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>We’ll use this in the following example. Remember our <u><span
style='color:#1155CC'>form with global configuration </span></u>from the
chapter on configuration management? Let’s extend it with a textarea field. We
want to create a “About” page with the content of that textarea field. I only
want the caches to invalidate when the content of the textarea (which is
config) is changed.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:21.95pt;
margin-left:-.25pt;line-height:110%'>To <b>custom/offer/src/Form/OfferSettingsForm
</b>we add to the <i>buildForm() </i>method:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.8pt;
margin-left:11.05pt;line-height:111%;background:#F8F8F8'><span
style='font-size:11.0pt;line-height:111%;font-family:Consolas;color:#333333'>$form[</span><span
style='font-size:11.0pt;line-height:111%;font-family:Consolas;color:#DD1144'>'content'</span><span
style='font-size:11.0pt;line-height:111%;font-family:Consolas;color:#333333'>]
= <b>array</b>(</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.25pt;
margin-left:11.05pt;line-height:111%;background:#F8F8F8'><span
style='font-size:11.0pt;line-height:111%;font-family:Consolas;color:#DD1144'>'#type'
</span><span style='font-size:11.0pt;line-height:111%;font-family:Consolas;
color:#333333'>=&gt; </span><span style='font-size:11.0pt;line-height:111%;
font-family:Consolas;color:#DD1144'>'details'</span><span style='font-size:
11.0pt;line-height:111%;font-family:Consolas;color:#333333'>,</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.25pt;
margin-left:11.05pt;line-height:111%;background:#F8F8F8'><span
style='font-size:11.0pt;line-height:111%;font-family:Consolas;color:#DD1144'>'#title'
</span><span style='font-size:11.0pt;line-height:111%;font-family:Consolas;
color:#333333'>=&gt; <b>$this</b>-&gt;t(</span><span style='font-size:11.0pt;
line-height:111%;font-family:Consolas;color:#DD1144'>'Content'</span><span
style='font-size:11.0pt;line-height:111%;font-family:Consolas;color:#333333'>),</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.25pt;
margin-left:11.05pt;line-height:111%;background:#F8F8F8'><span
style='font-size:11.0pt;line-height:111%;font-family:Consolas;color:#DD1144'>'#open'
</span><span style='font-size:11.0pt;line-height:111%;font-family:Consolas;
color:#333333'>=&gt; <b>TRUE</b>,</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.8pt;
margin-left:11.05pt;line-height:111%;background:#F8F8F8'><span
style='font-size:11.0pt;line-height:111%;font-family:Consolas;color:#333333'>);</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.25pt;
margin-left:11.05pt;line-height:111%;background:#F8F8F8'><span
style='font-size:11.0pt;line-height:111%;font-family:Consolas;color:#333333'>$form[</span><span
style='font-size:11.0pt;line-height:111%;font-family:Consolas;color:#DD1144'>'content'</span><span
style='font-size:11.0pt;line-height:111%;font-family:Consolas;color:#333333'>][</span><span
style='font-size:11.0pt;line-height:111%;font-family:Consolas;color:#DD1144'>'about'</span><span
style='font-size:11.0pt;line-height:111%;font-family:Consolas;color:#333333'>]
= [</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.25pt;
margin-left:11.05pt;line-height:111%;background:#F8F8F8'><span
style='font-size:11.0pt;line-height:111%;font-family:Consolas;color:#DD1144'>'#type'
</span><span style='font-size:11.0pt;line-height:111%;font-family:Consolas;
color:#333333'>=&gt; </span><span style='font-size:11.0pt;line-height:111%;
font-family:Consolas;color:#DD1144'>'text_format'</span><span style='font-size:
11.0pt;line-height:111%;font-family:Consolas;color:#333333'>,</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.25pt;
margin-left:11.05pt;line-height:111%;background:#F8F8F8'><span
style='font-size:11.0pt;line-height:111%;font-family:Consolas;color:#DD1144'>'#title'
</span><span style='font-size:11.0pt;line-height:111%;font-family:Consolas;
color:#333333'>=&gt; <b>$this</b>-&gt;t(</span><span style='font-size:11.0pt;
line-height:111%;font-family:Consolas;color:#DD1144'>'About page'</span><span
style='font-size:11.0pt;line-height:111%;font-family:Consolas;color:#333333'>),</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.25pt;
margin-left:11.05pt;line-height:111%;background:#F8F8F8'><span
style='font-size:11.0pt;line-height:111%;font-family:Consolas;color:#DD1144'>'#default_value'
</span><span style='font-size:11.0pt;line-height:111%;font-family:Consolas;
color:#333333'>=&gt; $config-&gt;get(</span><span style='font-size:11.0pt;
line-height:111%;font-family:Consolas;color:#DD1144'>'about'</span><span
style='font-size:11.0pt;line-height:111%;font-family:Consolas;color:#333333'>),</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.25pt;
margin-left:11.05pt;line-height:111%;background:#F8F8F8'><span
style='font-size:11.0pt;line-height:111%;font-family:Consolas;color:#DD1144'>'#maxlength'
</span><span style='font-size:11.0pt;line-height:111%;font-family:Consolas;
color:#333333'>=&gt; <b>NULL</b>,</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:24.05pt;
margin-left:11.05pt;line-height:111%;background:#F8F8F8'><span
style='font-size:11.0pt;line-height:111%;font-family:Consolas;color:#333333'>];</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:20.9pt;
margin-left:-.25pt'>Extend the <i>submitForm </i>method:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:76.6pt;margin-bottom:
1.25pt;margin-left:11.8pt;line-height:111%;background:#F8F8F8'><b><span
style='font-size:11.0pt;line-height:111%;font-family:Consolas;color:#333333'>$this</span></b><span
style='font-size:11.0pt;line-height:111%;font-family:Consolas;color:#333333'>-&gt;config(</span><span
style='font-size:11.0pt;line-height:111%;font-family:Consolas;color:#DD1144'>'offer.customconfig'</span><span
style='font-size:11.0pt;line-height:111%;font-family:Consolas;color:#333333'>)</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:76.6pt;margin-bottom:
.8pt;margin-left:11.8pt;line-height:111%;background:#F8F8F8'><span
style='font-size:11.0pt;line-height:111%;font-family:Consolas;color:#333333'>-&gt;set(</span><span
style='font-size:11.0pt;line-height:111%;font-family:Consolas;color:#DD1144'>'tagmanager'</span><span
style='font-size:11.0pt;line-height:111%;font-family:Consolas;color:#333333'>,
$form_state-&gt;getValue(</span><span style='font-size:11.0pt;line-height:111%;
font-family:Consolas;color:#DD1144'>'tagmanager'</span><span style='font-size:
11.0pt;line-height:111%;font-family:Consolas;color:#333333'>))</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:76.6pt;margin-bottom:
23.9pt;margin-left:11.8pt;line-height:111%;background:#F8F8F8'><span
style='font-size:11.0pt;line-height:111%;font-family:Consolas;color:#333333'>-&gt;set(</span><span
style='font-size:11.0pt;line-height:111%;font-family:Consolas;color:#DD1144'>'about'</span><span
style='font-size:11.0pt;line-height:111%;font-family:Consolas;color:#333333'>,
$form_state-&gt;getValue(</span><span style='font-size:11.0pt;line-height:111%;
font-family:Consolas;color:#DD1144'>'about'</span><span style='font-size:11.0pt;
line-height:111%;font-family:Consolas;color:#333333'>)[</span><span
style='font-size:11.0pt;line-height:111%;font-family:Consolas;color:#DD1144'>'value'</span><span
style='font-size:11.0pt;line-height:111%;font-family:Consolas;color:#333333'>])
-&gt;save();</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:3.4pt;
margin-left:-.25pt'>Notice the use of ‘text_format’ instead of textarea. This
makes my textarea render with a ckeditor wysiwyg overlay at <u>/admin/config/offer/adminsettings</u>.
I add some text to it and save:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:-1.7pt;margin-bottom:
24.25pt;margin-left:1.5pt;text-indent:0in;line-height:107%'><img border=0
width=602 height=293 id="Picture 19394"
src="Learning%20drupal%209%20as%20a%20framework_files/image115.jpg"></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>Okay, I move on with adding a controller.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:2.1pt;
margin-left:-.25pt'>First, the route and the access to <b>custom/offer/offer.routing.yml</b>:</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:115.5pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
  height:115.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:337.0pt;margin-bottom:
  .4pt;margin-left:6.05pt;text-indent:-6.05pt;line-height:118%'><span
  style='font-size:11.0pt;line-height:118%;font-family:Consolas;color:#DD1144'>offer.about:
  </span><span style='font-size:11.0pt;line-height:118%;font-family:Consolas;
  color:#333333'>path: </span><span style='font-size:11.0pt;line-height:118%;
  font-family:Consolas;color:#DD1144'>'/about' </span><span style='font-size:
  11.0pt;line-height:118%;font-family:Consolas;color:#333333'>defaults:</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:18.15pt;text-indent:0in;line-height:121%'><span style='font-size:
  11.0pt;line-height:121%;font-family:Consolas;color:#333333'>_controller: </span><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#DD1144'>'\Drupal\offer\Controller\AboutPageController::Render'
  </span><span style='font-size:11.0pt;line-height:121%;font-family:Consolas;
  color:#333333'>title: </span><span style='font-size:11.0pt;line-height:121%;
  font-family:Consolas;color:#DD1144'>'About us'</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>requirements:</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>_access: </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'TRUE'</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:2.1pt;
margin-left:-.25pt'>The page will be accessible for all users, hence the
_access: ‘True’ parameter. Next, I add <b>custom/offer/src/Controller/AboutPageController.php</b>:</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:370.5pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
  height:370.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:185.9pt;margin-bottom:
  0in;margin-left:0in;text-indent:0in;line-height:237%'><b><span
  style='font-size:11.0pt;line-height:237%;font-family:Consolas;color:#999999'>&lt;?php
  </span></b><b><span style='font-size:11.0pt;line-height:237%;font-family:
  Consolas;color:#333333'>namespace </span></b><b><span style='font-size:11.0pt;
  line-height:237%;font-family:Consolas;color:#990000'>Drupal</span></b><span
  style='font-size:11.0pt;line-height:237%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:237%;font-family:Consolas;color:#990000'>offer</span></b><span
  style='font-size:11.0pt;line-height:237%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:237%;font-family:Consolas;color:#990000'>Controller</span></b><span
  style='font-size:11.0pt;line-height:237%;font-family:Consolas;color:#333333'>;
  <b>use </b></span><b><span style='font-size:11.0pt;line-height:237%;
  font-family:Consolas;color:#990000'>Drupal</span></b><span style='font-size:
  11.0pt;line-height:237%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:237%;font-family:Consolas;color:#990000'>Core</span></b><span
  style='font-size:11.0pt;line-height:237%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:237%;font-family:Consolas;color:#990000'>Controller</span></b><span
  style='font-size:11.0pt;line-height:237%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:237%;font-family:Consolas;color:#990000'>ControllerBase</span></b><span
  style='font-size:11.0pt;line-height:237%;font-family:Consolas;color:#333333'>;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><i><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>/**</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><i><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>* Class
  AboutPageController</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:137.55pt;margin-bottom:
  15.0pt;margin-left:0in;text-indent:0in;line-height:121%'><i><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#999988'>*/
  </span></i><b><span style='font-size:11.0pt;line-height:121%;font-family:
  Consolas;color:#333333'>class </span></b><b><span style='font-size:11.0pt;
  line-height:121%;font-family:Consolas;color:#445588'>AboutPageController </span></b><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>extends
  </span></b><b><span style='font-size:11.0pt;line-height:121%;font-family:
  Consolas;color:#445588'>ControllerBase </span></b><span style='font-size:
  11.0pt;line-height:121%;font-family:Consolas;color:#333333'>{</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>public
  function </span></b><b><span style='font-size:11.0pt;line-height:107%;
  font-family:Consolas;color:#990000'>Render</span></b><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>() {</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:15.95pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$config =
  \Drupal::config(</span><span style='font-size:11.0pt;line-height:107%;
  font-family:Consolas;color:#DD1144'>'offer.customconfig'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>);</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$build = [</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:30.2pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'#markup' </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>=&gt;
  $config-&gt;get(</span><span style='font-size:11.0pt;line-height:107%;
  font-family:Consolas;color:#DD1144'>'about'</span><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>),</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:15.95pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>];</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:15.8pt;
  margin-left:18.15pt;text-indent:0in;line-height:115%'><span style='font-size:
  11.0pt;line-height:115%;font-family:Consolas;color:#333333'>$renderer =
  \Drupal::service(</span><span style='font-size:11.0pt;line-height:115%;
  font-family:Consolas;color:#DD1144'>'renderer'</span><span style='font-size:
  11.0pt;line-height:115%;font-family:Consolas;color:#333333'>); $renderer-&gt;addCacheableDependency($build,
  $config);</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>return
  </span></b><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#333333'>$build;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:20.9pt;
margin-left:-.25pt'>Add the menu item to the menu at <b>offer.links.menu.yml</b>:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:301.0pt;margin-bottom:
23.8pt;margin-left:11.3pt;text-indent:-6.05pt;line-height:111%;background:#F8F8F8'><span
style='font-size:11.0pt;line-height:111%;font-family:Consolas;color:#DD1144'>offer.main.about:
</span><span style='font-size:11.0pt;line-height:111%;font-family:Consolas;
color:#333333'>title: </span><span style='font-size:11.0pt;line-height:111%;
font-family:Consolas;color:#DD1144'>'About' </span><span style='font-size:11.0pt;
line-height:111%;font-family:Consolas;color:#333333'>menu_name: </span><span
style='font-size:11.0pt;line-height:111%;font-family:Consolas;color:#DD1144'>main
</span><span style='font-size:11.0pt;line-height:111%;font-family:Consolas;
color:#333333'>route_name: </span><span style='font-size:11.0pt;line-height:
111%;font-family:Consolas;color:#DD1144'>offer.about </span><span
style='font-size:11.0pt;line-height:111%;font-family:Consolas;color:#333333'>weight:
</span><span style='font-size:11.0pt;line-height:111%;font-family:Consolas;
color:teal'>80</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:3.35pt;
margin-left:-.25pt'>Clear caches and visit your page. Like always, the very
first time this page ever gets visited it goes into the cache. Next time,
everyone gets a correctly caches page:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:24.25pt;
margin-left:1.5pt;text-indent:0in;line-height:107%'><img border=0 width=194
height=24 id="Picture 241884"
src="Learning%20drupal%209%20as%20a%20framework_files/image116.gif"></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>But when I add a new line of text to the About
configuration textarea and save:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:38.3pt;
margin-left:1.5pt;text-indent:0in;line-height:107%'><img border=0 width=192
height=26 id="Picture 19609"
src="Learning%20drupal%209%20as%20a%20framework_files/image117.jpg"></p>

<p class=MsoNormal style='margin-top:0in;margin-right:15.1pt;margin-bottom:
17.65pt;margin-left:14.0pt;line-height:110%;background:#FFD966'><span
style='font-size:11.0pt;line-height:110%'>Very nice. Again we controlled
precisely when and where the caches needed to be emptied.</span></p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=600
 style='width:6.25in;border-collapse:collapse'>
 <tr style='height:58.5pt'>
  <td width=59 valign=top style='width:44.25pt;background:#E2E3E5;padding:14.6pt 5.75pt 0in 0in;
  height:58.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:14.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%'>&#128187;</span></p>
  </td>
  <td width=541 style='width:405.75pt;background:#E2E3E5;padding:14.6pt 5.75pt 0in 0in;
  height:58.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:9.6pt;margin-bottom:
  0in;margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%'>We’ve now learned that we can use cacheable
  dependencies for every renderable object we use in our drupal installation.</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:18.6pt;
margin-left:-.25pt'>Cache menu items with a custom cache tag</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=600
 style='width:6.25in;border-collapse:collapse'>
 <tr style='height:69.0pt'>
  <td width=59 valign=top style='width:44.25pt;background:#6D9EEB;padding:14.6pt 5.75pt 0in 0in;
  height:69.0pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:14.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%'>&#128073;</span></p>
  </td>
  <td width=541 style='width:405.75pt;background:#6D9EEB;padding:14.6pt 5.75pt 0in 0in;
  height:69.0pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:8.85pt;margin-bottom:
  0in;margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%'>This chapter is about how to add <b>caching
  mechanisms </b>to <b>plugins</b>. At the end you will be able to provide your
  system with a menu item with a counter, that is cached the way you want it.</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>Remember the section about custom menu links. We added a
menu link with a counter, to show the amount of offers this user has. This is a
query for this user only. One strategy could be to never cache this. But doing
a custom query on every page load is not good practice.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:2.1pt;
margin-left:-.25pt'>This is where custom cache tags come into play. Let’s head
back to the <b>custom/offer/src/Plugin/Menu/MyOffers.php </b>and we remove the <i>getCacheMaxAge()
</i>function. Instead we add:</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:145.5pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
  height:145.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:15.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><b><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>use </span></b><b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#990000'>Drupal</span></b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#990000'>Core</span></b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#990000'>Cache</span></b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#990000'>Cache</span></b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>;
  </span><i><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#999988'>// on top of file</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><i><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>/**</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><i><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>* {</span></i><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>@inheritdoc</span></i><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>}</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:246.35pt;margin-bottom:
  0in;margin-left:0in;text-indent:0in;line-height:121%'><i><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#999988'>*/
  </span></i><b><span style='font-size:11.0pt;line-height:121%;font-family:
  Consolas;color:#333333'>public function </span></b><b><span style='font-size:
  11.0pt;line-height:121%;font-family:Consolas;color:#990000'>getCacheTags</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>()
  {</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>return
  </span></b><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#333333'>Cache::mergeTags(<b>parent</b>::getCacheTags(),</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:95.25pt;margin-bottom:
  0in;margin-left:0in;text-indent:0in;line-height:107%'><b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>array</span></b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>(</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'my_offers_user_'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>.
  \Drupal::currentUser()-&gt;id())); }</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>This is a unique cache tag for this user only. The menu
item will only get queried again when this specific cache tag gets invalidated.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:.9pt;
margin-left:-.25pt'>We must make sure to invalidate this whenever:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:.9pt;
margin-left:.5in;text-indent:-.25in'>A)<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;
</span>A new offer is added</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:.5in;text-indent:-.25in'>B)<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;
</span>A new offer is deleted</p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:21.85pt;
margin-left:-.25pt;line-height:110%'>We need to add <i>postCreate() </i>and <i>postDelete()
</i>methods in <b>custom/offer/src/Entity/offer.php</b>:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:76.6pt;margin-bottom:
9.0pt;margin-left:5.0pt;line-height:111%;background:#F8F8F8'><b><span
style='font-size:11.0pt;line-height:111%;font-family:Consolas;color:#333333'>use
</span></b><b><span style='font-size:11.0pt;line-height:111%;font-family:Consolas;
color:#990000'>Drupal</span></b><span style='font-size:11.0pt;line-height:111%;
font-family:Consolas;color:#333333'>\</span><b><span style='font-size:11.0pt;
line-height:111%;font-family:Consolas;color:#990000'>Core</span></b><span
style='font-size:11.0pt;line-height:111%;font-family:Consolas;color:#333333'>\</span><b><span
style='font-size:11.0pt;line-height:111%;font-family:Consolas;color:#990000'>Cache</span></b><span
style='font-size:11.0pt;line-height:111%;font-family:Consolas;color:#333333'>\</span><b><span
style='font-size:11.0pt;line-height:111%;font-family:Consolas;color:#990000'>Cache</span></b><span
style='font-size:11.0pt;line-height:111%;font-family:Consolas;color:#333333'>;
// on top of file</span></p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:355.5pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
  height:355.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>/**</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:30.25pt;text-indent:-12.1pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>{</span></i><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>@inheritdoc</span></i><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>}</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:59.0pt;margin-bottom:
  0in;margin-left:12.1pt;text-indent:6.05pt;line-height:121%'><i><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#999988'>*/
  </span></i><b><span style='font-size:11.0pt;line-height:121%;font-family:
  Consolas;color:#333333'>public function </span></b><b><span style='font-size:
  11.0pt;line-height:121%;font-family:Consolas;color:#990000'>postCreate</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>(EntityStorageInterface
  $storage) {</span></p>
  <p class=MsoNormal align=center style='margin-top:0in;margin-right:4.6pt;
  margin-bottom:.95pt;margin-left:0in;text-align:center;text-indent:0in;
  line-height:107%'><span style='font-size:11.0pt;line-height:107%;font-family:
  Consolas;color:#333333'>Cache::invalidateTags([</span><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'my_offers_user_'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>.
  <b>$this</b>-&gt;getOwnerId()]);</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:15.95pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>/**</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:30.25pt;text-indent:-12.1pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>{</span></i><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>@inheritdoc</span></i><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>}</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:28.75pt;margin-bottom:
  0in;margin-left:12.1pt;text-indent:6.05pt;line-height:121%'><i><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#999988'>*/
  </span></i><b><span style='font-size:11.0pt;line-height:121%;font-family:
  Consolas;color:#333333'>public static function </span></b><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>postDelete</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>(EntityStorageInterface
  $storage,</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:167.75pt;margin-bottom:
  15.8pt;margin-left:24.15pt;text-indent:-24.15pt;line-height:115%'><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>array
  $entities) { <b>parent</b>::preDelete($storage, $entities);</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:40.85pt;margin-bottom:
  0in;margin-left:0in;text-indent:24.15pt;line-height:118%'><i><span
  style='font-size:11.0pt;line-height:118%;font-family:Consolas;color:#999988'>//
  Delete all bids and notifications of the offer that will be deleted </span></i><b><span
  style='font-size:11.0pt;line-height:118%;font-family:Consolas;color:#333333'>foreach
  </span></b><span style='font-size:11.0pt;line-height:118%;font-family:Consolas;
  color:#333333'>($entities <b>as </b>$entity) {</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:36.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$entity-&gt;deleteAllLinkedBids();</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:36.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$entity-&gt;deleteAllLinkedNotifications();</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:36.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>Cache::invalidateTags([</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'my_offers_user_'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>.
  $entity-&gt;getOwnerId()]);</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:15.95pt;
  margin-left:24.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>That’s it! Whenever an offer is added or deleted, the
custom cache tag for this user gets invalidated. Again, another example of the
power of Object oriented coding and the great caching system of drupal.</p>

<h3 style='margin-left:-.25pt'><a name="_Toc247082">Invalidate cache of another
entity after saving</a></h3>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=600
 style='width:6.25in;border-collapse:collapse'>
 <tr style='height:42.0pt'>
  <td width=59 style='width:44.25pt;background:#6D9EEB;padding:0in 5.75pt 0in 0in;
  height:42.0pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:14.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%'>&#128073;</span></p>
  </td>
  <td width=541 style='width:405.75pt;background:#6D9EEB;padding:0in 5.75pt 0in 0in;
  height:42.0pt'>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%'>In this chapter more about <b>invalidating
  caches of an entity dependent on other</b></span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:13.65pt;margin-bottom:
30.8pt;margin-left:44.75pt;line-height:114%;background:#6D9EEB'><b><span
style='font-size:11.0pt;line-height:114%'>linked entities</span></b><span
style='font-size:11.0pt;line-height:114%'>.</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>On building the platform, I stumbled upon the following.
Whenever I added bids to an offer, the teaser kept saying ‘0 offers so far’.
This makes sense, because my offer did not know about new bids. Bids are just
entities being stored in its own table.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:21.7pt;
margin-left:-.25pt'>To solve this issue I inherit the <i>postSave() </i>and <i>postDelete()
</i>method from <i>ContentEntityBase() </i>to my bid entity. To <b>custom/offer/src/Entity/bid.php
</b>add the following:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:247.35pt;margin-bottom:
8.4pt;margin-left:5.0pt;line-height:107%;background:#F8F8F8'><i><span
style='font-family:Consolas;color:#999988'>// Add this on top of the file </span></i><b><span
style='font-family:Consolas;color:#333333'>use </span></b><b><span
style='font-family:Consolas;color:#990000'>Drupal</span></b><span
style='font-family:Consolas;color:#333333'>\</span><b><span style='font-family:
Consolas;color:#990000'>Core</span></b><span style='font-family:Consolas;
color:#333333'>\</span><b><span style='font-family:Consolas;color:#990000'>Cache</span></b><span
style='font-family:Consolas;color:#333333'>\</span><b><span style='font-family:
Consolas;color:#990000'>Cache</span></b><span style='font-family:Consolas;
color:#333333'>; <b>use </b></span><b><span style='font-family:Consolas;
color:#990000'>Drupal</span></b><span style='font-family:Consolas;color:#333333'>\</span><b><span
style='font-family:Consolas;color:#990000'>offer</span></b><span
style='font-family:Consolas;color:#333333'>\</span><b><span style='font-family:
Consolas;color:#990000'>Entity</span></b><span style='font-family:Consolas;
color:#333333'>\</span><b><span style='font-family:Consolas;color:#990000'>Offer</span></b><span
style='font-family:Consolas;color:#333333'>;</span></p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:406.5pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 10.05pt 0in 5.25pt;
  height:406.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:316.7pt;margin-bottom:
  0in;margin-left:19.8pt;text-indent:-6.6pt;line-height:116%'><i><span
  style='font-family:Consolas;color:#999988'>/** * {</span></i><i><span
  style='font-family:Consolas;color:#DD1144'>@inheritdoc</span></i><i><span
  style='font-family:Consolas;color:#999988'>}</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:46.2pt;margin-bottom:
  0in;margin-left:13.2pt;text-indent:6.6pt;line-height:122%'><i><span
  style='font-family:Consolas;color:#999988'>*/ </span></i><b><span
  style='font-family:Consolas;color:#333333'>public function </span></b><b><span
  style='font-family:Consolas;color:#990000'>postSave</span></b><span
  style='font-family:Consolas;color:#333333'>(EntityStorageInterface $storage,</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:.55in;margin-bottom:
  0in;margin-left:26.4pt;text-indent:-26.4pt;line-height:116%'><span
  style='font-family:Consolas;color:#333333'>$update = TRUE) { <b>parent</b>::postSave($storage,
  $update); $offer = Offer::load(<b>$this</b>-&gt;get(</span><span
  style='font-family:Consolas;color:#DD1144'>'offer_id'</span><span
  style='font-family:Consolas;color:#333333'>)-&gt;target_id);</span></p>
  <p class=MsoNormal align=center style='margin-top:0in;margin-right:0in;
  margin-bottom:1.2pt;margin-left:0in;text-align:center;text-indent:0in;
  line-height:107%'><span style='font-family:Consolas;color:#333333'>Cache::invalidateTags($offer-&gt;getCacheTagsToInvalidate());</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:17.7pt;
  margin-left:13.2pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:316.7pt;margin-bottom:
  0in;margin-left:19.8pt;text-indent:-6.6pt;line-height:116%'><i><span
  style='font-family:Consolas;color:#999988'>/** * {</span></i><i><span
  style='font-family:Consolas;color:#DD1144'>@inheritdoc</span></i><i><span
  style='font-family:Consolas;color:#999988'>}</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:52.8pt;margin-bottom:
  0in;margin-left:13.2pt;text-indent:6.6pt;line-height:122%'><i><span
  style='font-family:Consolas;color:#999988'>*/ </span></i><b><span
  style='font-family:Consolas;color:#333333'>public static function </span></b><b><span
  style='font-family:Consolas;color:#990000'>postDelete</span></b><span
  style='font-family:Consolas;color:#333333'>(EntityStorageInterface</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:72.55pt;margin-bottom:
  .9pt;margin-left:26.4pt;text-indent:-26.4pt;line-height:116%'><span
  style='font-family:Consolas;color:#333333'>$storage, array $entities) { <b>parent</b>::preDelete($storage,
  $entities);</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:26.4pt;text-indent:0in;line-height:122%'><i><span
  style='font-family:Consolas;color:#999988'>// Invalidate all caches of offers
  whenever bids are deleted </span></i><b><span style='font-family:Consolas;
  color:#333333'>foreach </span></b><span style='font-family:Consolas;
  color:#333333'>($entities <b>as </b>$entity) {</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:.55in;text-indent:0in;line-height:116%'><span style='font-family:
  Consolas;color:#333333'>$offer = Offer::load($entity-&gt;get(</span><span
  style='font-family:Consolas;color:#DD1144'>'offer_id'</span><span
  style='font-family:Consolas;color:#333333'>)-&gt;target_id); <b>if</b>($offer)
  {</span></p>
  <p class=MsoNormal align=right style='margin-top:0in;margin-right:0in;
  margin-bottom:1.2pt;margin-left:0in;text-align:right;text-indent:0in;
  line-height:107%'><span style='font-family:Consolas;color:#333333'>Cache::invalidateTags($offer-&gt;getCacheTagsToInvalidate());</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:.55in;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.2pt;
  margin-left:26.4pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:13.2pt;text-indent:0in;line-height:107%'><span style='font-family:
  Consolas;color:#333333'>}</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:30.4pt;
margin-left:-.25pt'>With these changes, after a bid gets saved or deleted it
will invalidate the caches of the offer the bid is for. This way, our offer
teaser gets updated wherever it is visible in the system whether it is on the
entity detail page or in a views listing.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:15.1pt;margin-bottom:
32.35pt;margin-left:14.0pt;line-height:110%;background:#FFD966'><span
style='font-size:11.0pt;line-height:110%'>We got an insight into the various
possibilities of caching in drupal 9. I dare to say the caching system is one
of the most advanced out there. Once you get comfortable, it is set up very
rapidly.</span></p>

<h2 style='margin-top:0in;margin-right:0in;margin-bottom:20.05pt;margin-left:
-.25pt'><a name="_Toc247083">Dispatch custom Events with an EventSubscriber to
redirect users</a></h2>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=600
 style='width:6.25in;border-collapse:collapse'>
 <tr style='height:82.5pt'>
  <td width=59 valign=top style='width:44.25pt;background:#6D9EEB;padding:14.6pt 5.75pt 0in 0in;
  height:82.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:14.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%'>&#128073;</span></p>
  </td>
  <td width=541 style='width:405.75pt;background:#6D9EEB;padding:14.6pt 5.75pt 0in 0in;
  height:82.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:3.4pt;margin-bottom:
  0in;margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%'>In this chapter more about the <b>Event </b>system
  in drupal. Moreover you get an insight into how to add an EventSubscriber and
  how to <i>dispatch the event</i>. At the end you will be able to define and
  catch certain events and attach actions to them.</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>There are still a few things left unfinished about our
software. Our homepage still redirects to our users page. We set the standard
homepage to our offer page at <u>/admin/config/system/site-information</u>.
Fill in “/offer” at the default front page textfield. This way, we get the
overview with the offers as our frontpage.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>We’ve told earlier that drupal is moving away (slowly) from
the hook system. We will learn how to redirect users on login with an
EventSubscriber.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:30.65pt;
margin-left:-.25pt'>From the symfony documentation:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.2in;margin-bottom:32.15pt;
margin-left:14.25pt;text-indent:0in;line-height:114%;background:#FFD966'><i><span
style='font-size:11.0pt;line-height:114%'>Symfony triggers several events
related to the kernel while processing the HTTP Request. Third-party bundles
may also dispatch events, and you can even dispatch custom events from your own
code.</span></i></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>For dispatching own events, we have to add an Event and an
EventSubscriber service to our module.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:21.15pt;
margin-left:-.25pt;line-height:110%'>We start with adding an Event at <b>custom/offer/src/Event/UserLoginEvent.php</b>:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:5.25pt;text-indent:0in;line-height:107%;background:#F8F8F8'><b><span
style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999999'>&lt;?php</span></b></p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:475.5pt'>
  <td width=601 valign=bottom style='width:450.75pt;background:#F8F8F8;
  padding:0in 5.75pt 6.95pt 5.25pt;height:475.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:16.8pt;
  margin-left:0in;text-indent:0in;line-height:107%'><b><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>namespace </span></b><b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#990000'>Drupal</span></b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#990000'>offer</span></b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#990000'>Event</span></b><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:173.8pt;margin-bottom:
  14.2pt;margin-left:0in;text-indent:0in;line-height:121%'><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>use
  </span></b><b><span style='font-size:11.0pt;line-height:121%;font-family:
  Consolas;color:#990000'>Drupal</span></b><span style='font-size:11.0pt;
  line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>user</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>UserInterface</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>;
  <b>use </b></span><b><span style='font-size:11.0pt;line-height:121%;
  font-family:Consolas;color:#990000'>Symfony</span></b><span style='font-size:
  11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>Contracts</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>EventDispatcher</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>Event</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><i><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>/**</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>Event
  fired when a user logs in.</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:2.75in;margin-bottom:
  6.7pt;margin-left:0in;text-indent:6.05pt;line-height:179%'><i><span
  style='font-size:11.0pt;line-height:179%;font-family:Consolas;color:#999988'>*/
  </span></i><b><span style='font-size:11.0pt;line-height:179%;font-family:
  Consolas;color:#333333'>class </span></b><b><span style='font-size:11.0pt;
  line-height:179%;font-family:Consolas;color:#445588'>UserLoginEvent </span></b><b><span
  style='font-size:11.0pt;line-height:179%;font-family:Consolas;color:#333333'>extends
  </span></b><b><span style='font-size:11.0pt;line-height:179%;font-family:
  Consolas;color:#445588'>Event </span></b><span style='font-size:11.0pt;
  line-height:179%;font-family:Consolas;color:#333333'>{ <b>const </b>EVENT_NAME
  = </span><span style='font-size:11.0pt;line-height:179%;font-family:Consolas;
  color:#DD1144'>'offer_user_login'</span><span style='font-size:11.0pt;
  line-height:179%;font-family:Consolas;color:#333333'>;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>/**</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>The
  user account.</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>@var
  </span></i><i><span style='font-size:11.0pt;line-height:107%;font-family:
  Consolas;color:#999988'>\Drupal\user\UserInterface</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:330.95pt;margin-bottom:
  14.2pt;margin-left:12.1pt;text-indent:6.05pt;line-height:121%'><i><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#999988'>*/
  </span></i><b><span style='font-size:11.0pt;line-height:121%;font-family:
  Consolas;color:#333333'>public </span></b><span style='font-size:11.0pt;
  line-height:121%;font-family:Consolas;color:#333333'>$account;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>/**</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>Constructs
  the object.</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:18.15pt;text-indent:0in;line-height:115%'><span style='font-size:
  11.0pt;line-height:115%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#DD1144'>@param
  </span></i><i><span style='font-size:11.0pt;line-height:115%;font-family:
  Consolas;color:#999988'>\Drupal\user\UserInterface $account *   The account
  of the user logged in.</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:107.35pt;margin-bottom:
  0in;margin-left:12.1pt;text-indent:6.05pt;line-height:118%'><i><span
  style='font-size:11.0pt;line-height:118%;font-family:Consolas;color:#999988'>*/
  </span></i><b><span style='font-size:11.0pt;line-height:118%;font-family:
  Consolas;color:#333333'>public function </span></b><b><span style='font-size:
  11.0pt;line-height:118%;font-family:Consolas;color:#990000'>__construct</span></b><span
  style='font-size:11.0pt;line-height:118%;font-family:Consolas;color:#333333'>(UserInterface
  $account) { <b>$this</b>-&gt;account = $account;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:15.95pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>This is simply telling our system this event exists (in the
same way we added files to the Ajax directory). Next we have to add a
‘subscriber’ which handles the aftermath of when the event is triggered, like a
redirection or a log:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:2.1pt;
margin-left:-.25pt'>To a new file <b>offer.services.yml </b>we add:</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:100.5pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
  height:100.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>services:</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>offer_login.event_subscriber:</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:83.15pt;margin-bottom:
  .4pt;margin-left:24.15pt;text-indent:0in;line-height:118%'><span
  style='font-size:11.0pt;line-height:118%;font-family:Consolas;color:#333333'>class:
  </span><span style='font-size:11.0pt;line-height:118%;font-family:Consolas;
  color:#DD1144'>Drupal\offer\EventSubscriber\UserLoginSubscriber </span><span
  style='font-size:11.0pt;line-height:118%;font-family:Consolas;color:#333333'>arguments:
  </span><span style='font-size:11.0pt;line-height:118%;font-family:Consolas;
  color:#DD1144'>[ '@path.matcher', '@current_user' ] </span><span
  style='font-size:11.0pt;line-height:118%;font-family:Consolas;color:#333333'>tags:</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:36.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#990073'>- </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>{
  </span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#333333'>name: </span><span style='font-size:11.0pt;line-height:107%;
  font-family:Consolas;color:#DD1144'>event_subscriber }</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.35pt;
margin-left:-.25pt;line-height:110%'>To a new folder we add <b>custom/offer/src/EventSubscriber/UserLoginSubscriber.php</b>:</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:625.5pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
  height:625.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:204.05pt;margin-bottom:
  0in;margin-left:0in;text-indent:0in;line-height:237%'><b><span
  style='font-size:11.0pt;line-height:237%;font-family:Consolas;color:#999999'>&lt;?php
  </span></b><b><span style='font-size:11.0pt;line-height:237%;font-family:
  Consolas;color:#333333'>namespace </span></b><b><span style='font-size:11.0pt;
  line-height:237%;font-family:Consolas;color:#990000'>Drupal</span></b><span
  style='font-size:11.0pt;line-height:237%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:237%;font-family:Consolas;color:#990000'>offer</span></b><span
  style='font-size:11.0pt;line-height:237%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:237%;font-family:Consolas;color:#990000'>EventSubscriber</span></b><span
  style='font-size:11.0pt;line-height:237%;font-family:Consolas;color:#333333'>;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:59.0pt;margin-bottom:
  14.2pt;margin-left:0in;text-indent:0in;line-height:121%'><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>use
  </span></b><b><span style='font-size:11.0pt;line-height:121%;font-family:
  Consolas;color:#990000'>Drupal</span></b><span style='font-size:11.0pt;
  line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>offer</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>Event</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>UserLoginEvent</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>;
  <b>use </b></span><b><span style='font-size:11.0pt;line-height:121%;
  font-family:Consolas;color:#990000'>Symfony</span></b><span style='font-size:
  11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>Component</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>EventDispatcher</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>EventSubscriberInterface</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>;
  <b>use </b></span><b><span style='font-size:11.0pt;line-height:121%;
  font-family:Consolas;color:#990000'>Symfony</span></b><span style='font-size:
  11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>Component</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>HttpFoundation</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>RedirectResponse</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><i><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>/**</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>Class
  UserLoginSubscriber.</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>@package
  </span></i><i><span style='font-size:11.0pt;line-height:107%;font-family:
  Consolas;color:#999988'>Drupal\custom_events\EventSubscriber</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:71.1pt;margin-bottom:
  0in;margin-left:0in;text-indent:6.05pt;line-height:121%'><i><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#999988'>*/
  </span></i><b><span style='font-size:11.0pt;line-height:121%;font-family:
  Consolas;color:#333333'>class </span></b><b><span style='font-size:11.0pt;
  line-height:121%;font-family:Consolas;color:#445588'>UserLoginSubscriber </span></b><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>implements
  </span></b><b><span style='font-size:11.0pt;line-height:121%;font-family:
  Consolas;color:#445588'>EventSubscriberInterface</span></b></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>{</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>/**</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>{</span></i><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>@inheritdoc</span></i><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>}</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:161.75pt;margin-bottom:
  0in;margin-left:12.1pt;text-indent:6.05pt;line-height:121%'><i><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#999988'>*/
  </span></i><b><span style='font-size:11.0pt;line-height:121%;font-family:
  Consolas;color:#333333'>public static function </span></b><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>getSubscribedEvents</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>()</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:5.1in;margin-bottom:
  0in;margin-left:24.2pt;text-indent:-12.1pt;line-height:121%'><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>{
  <b>return </b>[</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:95.25pt;margin-bottom:
  15.0pt;margin-left:24.15pt;text-indent:12.1pt;line-height:115%'><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>UserLoginEvent::EVENT_NAME
  =&gt; [</span><span style='font-size:11.0pt;line-height:115%;font-family:
  Consolas;color:#DD1144'>'onUserLogin', 29] </span><span style='font-size:
  11.0pt;line-height:115%;font-family:Consolas;color:#333333'>];</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:15.95pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>/**</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>Subscribe
  to the user login event dispatched.</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:18.15pt;text-indent:0in;line-height:115%'><span style='font-size:
  11.0pt;line-height:115%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#DD1144'>@param
  </span></i><i><span style='font-size:11.0pt;line-height:115%;font-family:
  Consolas;color:#999988'>\Drupal\custom_events\Event\UserLoginEvent $event *  
  Dat event object yo.</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:125.45pt;margin-bottom:
  0in;margin-left:12.1pt;text-indent:6.05pt;line-height:121%'><i><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#999988'>*/
  </span></i><b><span style='font-size:11.0pt;line-height:121%;font-family:
  Consolas;color:#333333'>public function </span></b><b><span style='font-size:
  11.0pt;line-height:121%;font-family:Consolas;color:#990000'>onUserLogin</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>(UserLoginEvent
  $event)</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>{</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:24.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$username =
  \Drupal::currentUser()-&gt;getDisplayName();</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:24.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>\Drupal::messenger()-&gt;addStatus(t(</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'Welcome
  %name, happy bidding!'</span><span style='font-size:11.0pt;line-height:107%;
  font-family:Consolas;color:#333333'>, [</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:36.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'%name' </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>=&gt;
  $username,</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:24.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>]));</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:24.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$response = <b>new
  </b>RedirectResponse(</span><span style='font-size:11.0pt;line-height:107%;
  font-family:Consolas;color:#DD1144'>&quot;/&quot;</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>);</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:24.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$response-&gt;send();</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:76.6pt;margin-bottom:
24.05pt;margin-left:5.0pt;line-height:111%;background:#F8F8F8'><span
style='font-size:11.0pt;line-height:111%;font-family:Consolas;color:#333333'>}</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:.8pt;
margin-left:-.25pt'>An event subscriber is a PHP class that’s able to tell the
dispatcher exactly which events it should subscribe to. It implements the</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>Symfony\Component\EventDispatcher\EventSubscriberInterface
interface, which requires a single static method called <a
href="https://github.com/symfony/symfony/blob/5.2/src/Symfony/Component/EventDispatcher/EventSubscriberInterface.php"><span
style='color:#1155CC'>getSubscribedEvents()</span></a><u><span
style='color:#1155CC'> </span></u>which shows the priority of each listener
method. The higher the number, the earlier the method is called. Note that we
added a higher number than dynamic page cache, otherwise the system could miss
the event!</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:2.1pt;
margin-left:-.25pt'>The last thing we need to do is telling the system <i>when </i>to
dispatch the event. In our case it is when a user logs in. Therefore we hook
into the user login form in <b>custom/offer/offer.module</b>:</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:175.5pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 10.35pt 0in 5.25pt;
  height:175.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><i><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>/*</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><i><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>* Implements
  hook_user_login()</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:211.5pt;margin-bottom:
  .4pt;margin-left:0in;text-indent:0in;line-height:118%'><i><span
  style='font-size:11.0pt;line-height:118%;font-family:Consolas;color:#999988'>*/
  </span></i><b><span style='font-size:11.0pt;line-height:118%;font-family:
  Consolas;color:#333333'>function </span></b><b><span style='font-size:11.0pt;
  line-height:118%;font-family:Consolas;color:#990000'>offer_user_login</span></b><span
  style='font-size:11.0pt;line-height:118%;font-family:Consolas;color:#333333'>($account)
  { </span><i><span style='font-size:11.0pt;line-height:118%;font-family:Consolas;
  color:#999988'>// Instantiate our event.</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$event = <b>new </b>UserLoginEvent($account);</span></p>
  <p class=MsoNormal style='margin:0in;text-align:justify;text-justify:inter-ideograph;
  text-indent:12.1pt;line-height:115%'><i><span style='font-size:11.0pt;
  line-height:115%;font-family:Consolas;color:#999988'>// Get the
  event_dispatcher service and dispatch the event to fire the event.</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$event_dispatcher
  = \Drupal::service(</span><span style='font-size:11.0pt;line-height:107%;
  font-family:Consolas;color:#DD1144'>'event_dispatcher'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>);</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:30.2pt;margin-bottom:
  0in;margin-left:0in;text-align:justify;text-justify:inter-ideograph;
  text-indent:12.1pt;line-height:107%'><span style='font-size:11.0pt;
  line-height:107%;font-family:Consolas;color:#333333'>$event_dispatcher-&gt;dispatch(UserLoginEvent::EVENT_NAME,
  $event); }</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:.35pt;
margin-left:-.25pt'>Make sure to clear caches the first time to make sure
everything is registered correctly. Next time you login, we get redirected to
the frontpage and get a welcoming message:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:24.25pt;
margin-left:1.5pt;text-indent:0in;line-height:107%'><img border=0 width=412
height=116 id="Picture 20285"
src="Learning%20drupal%209%20as%20a%20framework_files/image118.jpg"></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>We learned to create custom Events and how to subscribe to
them. The nice thing about custom events is that we can fire them whenever we
would like to. In this case an event on logging in, but we could also fire
logging events or e-mail events on multiple occasions. A very powerful feature
of drupal 9, with as special thanks to symfony!</p>

<h2 style='margin-top:0in;margin-right:0in;margin-bottom:19.7pt;margin-left:
-.25pt'><a name="_Toc247084">Customize the user registration process with a
RouteSubscriber</a></h2>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>With all the things we learned so far, it is interesting to
take a look at the core user module. You’ll find out that users are nothing
more than an entity. The core registration, login and password forms are entity
forms with a bit of custom logic attached.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:.05in;
margin-left:-.25pt'>The core user register form looks like this:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:-1.7pt;margin-bottom:
0in;margin-left:1.5pt;text-indent:0in;line-height:107%'><img border=0
width=602 height=623 id="Picture 20311"
src="Learning%20drupal%209%20as%20a%20framework_files/image119.jpg"></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>This form is not exactly what we wanted. We’d like a
registration with name, e-mail address and password only. I want to on-board
users more rapidly and worry about verification later. How do we change this?</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>Using a typical drupal hook <i>hook_form_alter() </i>could
do the job, but is tricky in my opinion because we do not have control on how
the default form will evolve in the future. Well, it’s not <i>that </i>tricky I
guess but I prefer to keep control in code. Thus, a safer option would be to
show a different form on this page.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:3.35pt;
margin-left:-.25pt'>At <u>/admin/config/people/accounts/form-display </u>we can
change the entity forms display. A view mode for ‘register’ (the registration
page) is present. Check the box and save. This way, we can build the
registration form.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:7.75pt;
margin-left:1.5pt;text-indent:0in;line-height:107%'><img border=0 width=466
height=233 id="Picture 20346"
src="Learning%20drupal%209%20as%20a%20framework_files/image120.jpg"></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:.15pt;
margin-left:-.25pt'>This results in the following form settings at</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.7pt;margin-bottom:1.05pt;
margin-left:-.25pt;line-height:111%'><u>/admin/config/people/accounts/form-display/register</u>:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:-1.7pt;margin-bottom:
24.25pt;margin-left:1.5pt;text-indent:0in;line-height:107%'><img border=0
width=602 height=659 id="Picture 20373"
src="Learning%20drupal%209%20as%20a%20framework_files/image121.jpg"></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>Drupal core combines User name and password in one form
field, and what we want is a form that asks first for an e-mail and then
automatically offers access to the platform. We want to grant a 1-hour access
before the user has to validate it’s address.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:20.8pt;
margin-left:-.25pt'>Seems like something to do with a custom form instead of an
entityform. We add <b>custom/offer/src/Form/RegistrationForm.php:</b></p>

<p class=MsoNormal style='margin-top:0in;margin-right:276.8pt;margin-bottom:
23.0pt;margin-left:5.0pt;line-height:121%;background:#F8F8F8'><b><span
style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#999999'>&lt;?php
</span></b><b><span style='font-size:11.0pt;line-height:121%;font-family:Consolas;
color:#333333'>namespace </span></b><b><span style='font-size:11.0pt;
line-height:121%;font-family:Consolas;color:#990000'>Drupal</span></b><span
style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>offer</span></b><span
style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>Form</span></b><span
style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>;</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.55pt;margin-bottom:0in;
margin-left:-1.0in;text-indent:0in;line-height:107%'>&nbsp;</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:685.5pt'>
  <td width=601 valign=bottom style='width:450.75pt;background:#F8F8F8;
  padding:0in 5.75pt 6.95pt 5.25pt;height:685.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:191.95pt;margin-bottom:
  10.45pt;margin-left:0in;text-indent:0in;line-height:150%'><b><span
  style='font-size:11.0pt;line-height:150%;font-family:Consolas;color:#333333'>use
  </span></b><b><span style='font-size:11.0pt;line-height:150%;font-family:
  Consolas;color:#990000'>Drupal</span></b><span style='font-size:11.0pt;
  line-height:150%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:150%;font-family:Consolas;color:#990000'>Core</span></b><span
  style='font-size:11.0pt;line-height:150%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:150%;font-family:Consolas;color:#990000'>Form</span></b><span
  style='font-size:11.0pt;line-height:150%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:150%;font-family:Consolas;color:#990000'>FormBase</span></b><span
  style='font-size:11.0pt;line-height:150%;font-family:Consolas;color:#333333'>;
  <b>use </b></span><b><span style='font-size:11.0pt;line-height:150%;
  font-family:Consolas;color:#990000'>Drupal</span></b><span style='font-size:
  11.0pt;line-height:150%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:150%;font-family:Consolas;color:#990000'>Core</span></b><span
  style='font-size:11.0pt;line-height:150%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:150%;font-family:Consolas;color:#990000'>Form</span></b><span
  style='font-size:11.0pt;line-height:150%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:150%;font-family:Consolas;color:#990000'>FormStateInterface</span></b><span
  style='font-size:11.0pt;line-height:150%;font-family:Consolas;color:#333333'>;
  <b>use </b></span><b><span style='font-size:11.0pt;line-height:150%;
  font-family:Consolas;color:#990000'>Drupal</span></b><span style='font-size:
  11.0pt;line-height:150%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:150%;font-family:Consolas;color:#990000'>user</span></b><span
  style='font-size:11.0pt;line-height:150%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:150%;font-family:Consolas;color:#990000'>Entity</span></b><span
  style='font-size:11.0pt;line-height:150%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:150%;font-family:Consolas;color:#990000'>User</span></b><span
  style='font-size:11.0pt;line-height:150%;font-family:Consolas;color:#333333'>;
  <b>use </b></span><b><span style='font-size:11.0pt;line-height:150%;
  font-family:Consolas;color:#990000'>Drupal</span></b><span style='font-size:
  11.0pt;line-height:150%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:150%;font-family:Consolas;color:#990000'>Component</span></b><span
  style='font-size:11.0pt;line-height:150%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:150%;font-family:Consolas;color:#990000'>Utility</span></b><span
  style='font-size:11.0pt;line-height:150%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:150%;font-family:Consolas;color:#990000'>Xss</span></b><span
  style='font-size:11.0pt;line-height:150%;font-family:Consolas;color:#333333'>;
  <b>class </b></span><b><span style='font-size:11.0pt;line-height:150%;
  font-family:Consolas;color:#445588'>RegistrationForm </span></b><b><span
  style='font-size:11.0pt;line-height:150%;font-family:Consolas;color:#333333'>extends
  </span></b><b><span style='font-size:11.0pt;line-height:150%;font-family:
  Consolas;color:#445588'>FormBase </span></b><span style='font-size:11.0pt;
  line-height:150%;font-family:Consolas;color:#333333'>{</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>/**</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>@return
  </span></i><i><span style='font-size:11.0pt;line-height:107%;font-family:
  Consolas;color:#999988'>string</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>The
  unique string identifying the form.</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:216.1pt;margin-bottom:
  0in;margin-left:12.1pt;text-indent:6.05pt;line-height:121%'><i><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#999988'>*/
  </span></i><b><span style='font-size:11.0pt;line-height:121%;font-family:
  Consolas;color:#333333'>public function </span></b><b><span style='font-size:
  11.0pt;line-height:121%;font-family:Consolas;color:#990000'>getFormId</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>()
  { <b>return </b></span><span style='font-size:11.0pt;line-height:121%;
  font-family:Consolas;color:#DD1144'>'offer_registration_form'</span><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:15.95pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>/**</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>Form
  constructor.</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>@param
  </span></i><i><span style='font-size:11.0pt;line-height:107%;font-family:
  Consolas;color:#999988'>array $form</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.4pt;
  margin-left:18.15pt;text-indent:0in;line-height:118%'><span style='font-size:
  11.0pt;line-height:118%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:118%;font-family:Consolas;color:#999988'>An
  associative array containing the structure of the form. * </span></i><i><span
  style='font-size:11.0pt;line-height:118%;font-family:Consolas;color:#DD1144'>@param
  </span></i><i><span style='font-size:11.0pt;line-height:118%;font-family:
  Consolas;color:#999988'>\Drupal\Core\Form\FormStateInterface $form_state *  
  The current state of the form.</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>@param
  </span></i><i><span style='font-size:11.0pt;line-height:107%;font-family:
  Consolas;color:#999988'>\Drupal\offer\Entity\Offer $offer</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>The
  offer entity we're viewing</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>@return
  </span></i><i><span style='font-size:11.0pt;line-height:107%;font-family:
  Consolas;color:#999988'>array</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>The
  form structure.</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:4.6pt;margin-bottom:
  0in;margin-left:12.1pt;text-indent:6.05pt;line-height:121%'><i><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#999988'>*/
  </span></i><b><span style='font-size:11.0pt;line-height:121%;font-family:
  Consolas;color:#333333'>public function </span></b><b><span style='font-size:
  11.0pt;line-height:121%;font-family:Consolas;color:#990000'>buildForm</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>(array
  $form, FormStateInterface $form_state,</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:15.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$offer = NULL) {</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:24.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$form[</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'email'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>]
  = [</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:36.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'#type' </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>=&gt;
  </span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#DD1144'>'email'</span><span style='font-size:11.0pt;line-height:107%;
  font-family:Consolas;color:#333333'>,</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:36.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'#attributes' </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>=&gt;
  <b>array</b>(</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:48.35pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>' type' </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>=&gt;
  </span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#DD1144'>'email'</span><span style='font-size:11.0pt;line-height:107%;
  font-family:Consolas;color:#333333'>, </span><i><span style='font-size:11.0pt;
  line-height:107%;font-family:Consolas;color:#999988'>// note the space before
  attribute name</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:36.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>),</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:36.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'#title' </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>=&gt;
  <b>$this</b>-&gt;t(</span><span style='font-size:11.0pt;line-height:107%;
  font-family:Consolas;color:#DD1144'>'Your email address'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>),</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:36.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'#required' </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>=&gt;
  <b>TRUE</b>,</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:15.95pt;
  margin-left:24.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>];</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:24.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$form[</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'username'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>]
  = [</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:36.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'#type' </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>=&gt;
  </span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#DD1144'>'textfield'</span><span style='font-size:11.0pt;line-height:
  107%;font-family:Consolas;color:#333333'>,</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:36.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'#attributes' </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>=&gt;
  <b>array</b>(</span></p>
  <p class=MsoNormal align=center style='margin-top:0in;margin-right:0in;
  margin-bottom:0in;margin-left:7.5pt;text-align:center;text-indent:0in;
  line-height:107%'><span style='font-size:11.0pt;line-height:107%;font-family:
  Consolas;color:#DD1144'>' minlength' </span><span style='font-size:11.0pt;
  line-height:107%;font-family:Consolas;color:#333333'>=&gt; </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:teal'>2</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>,
  </span><i><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#999988'>// note the space before attribute name</span></i></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.55pt;margin-bottom:0in;
margin-left:-1.0in;text-indent:0in;line-height:107%'>&nbsp;</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:685.5pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 16.4pt 0in 5.25pt;
  height:685.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:36.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>),</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:36.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'#title' </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>=&gt;
  <b>$this</b>-&gt;t(</span><span style='font-size:11.0pt;line-height:107%;
  font-family:Consolas;color:#DD1144'>'Your name'</span><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>),</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:36.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'#required' </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>=&gt;
  <b>TRUE</b>,</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:15.95pt;
  margin-left:24.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>];</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:24.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$form[</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'password'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>]
  = [</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:36.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'#type' </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>=&gt;
  </span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#DD1144'>'password'</span><span style='font-size:11.0pt;line-height:
  107%;font-family:Consolas;color:#333333'>,</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:36.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'#attributes' </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>=&gt;
  <b>array</b>(</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:48.35pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>' type' </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>=&gt;
  </span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#DD1144'>'password'</span><span style='font-size:11.0pt;line-height:
  107%;font-family:Consolas;color:#333333'>, </span><i><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>// note the space
  before attribute name</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:48.35pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>' minlength' </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>=&gt;
  </span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:teal'>8</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:36.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>),</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:36.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'#title' </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>=&gt;
  <b>$this</b>-&gt;t(</span><span style='font-size:11.0pt;line-height:107%;
  font-family:Consolas;color:#DD1144'>'Your password'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>),</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:36.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'#description' </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>=&gt;
  <b>$this</b>-&gt;t(</span><span style='font-size:11.0pt;line-height:107%;
  font-family:Consolas;color:#DD1144'>'Should be minimum 8 characters.'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>),</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:36.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'#required' </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>=&gt;
  <b>TRUE</b>,</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:16.8pt;
  margin-left:24.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>];</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:24.15pt;text-indent:0in;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>//
  Group submit handlers in an actions element with a key of</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:0in;text-indent:0in;line-height:107%'><i><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>&quot;actions&quot;
  so</span></i></p>
  <p class=MsoNormal style='margin:0in;text-align:justify;text-justify:inter-ideograph;
  text-indent:24.15pt;line-height:115%'><i><span style='font-size:11.0pt;
  line-height:115%;font-family:Consolas;color:#999988'>// that it gets styled
  correctly, and so that other modules may add actions</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:24.15pt;text-indent:0in;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>//
  to the form. This is not required, but is convention.</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:24.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$form[</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'actions'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>]
  = [</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:36.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'#type' </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>=&gt;
  </span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#DD1144'>'actions'</span><span style='font-size:11.0pt;line-height:
  107%;font-family:Consolas;color:#333333'>,</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:15.95pt;
  margin-left:24.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>];</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:24.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$form[</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'actions'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>][</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'submit'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>]
  = [</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:36.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'#type' </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>=&gt;
  </span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#DD1144'>'submit'</span><span style='font-size:11.0pt;line-height:107%;
  font-family:Consolas;color:#333333'>,</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:36.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'#value' </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>=&gt;
  <b>$this</b>-&gt;t(</span><span style='font-size:11.0pt;line-height:107%;
  font-family:Consolas;color:#DD1144'>'Register'</span><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>),</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:326.35pt;margin-bottom:
  0in;margin-left:24.15pt;text-indent:0in;line-height:237%'><span
  style='font-size:11.0pt;line-height:237%;font-family:Consolas;color:#333333'>];
  <b>return </b>$form;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:15.95pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>/**</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:30.25pt;text-indent:-12.1pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>Validate
  the input values of the form</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:30.25pt;text-indent:-12.1pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>@param
  </span></i><i><span style='font-size:11.0pt;line-height:107%;font-family:
  Consolas;color:#999988'>array $form</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:30.25pt;text-indent:-12.1pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>@param
  </span></i><i><span style='font-size:11.0pt;line-height:107%;font-family:
  Consolas;color:#999988'>\Drupal\Core\Form\FormStateInterface $form_state</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:48.35pt;margin-bottom:
  0in;margin-left:12.1pt;text-indent:6.05pt;line-height:121%'><i><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#999988'>*/
  </span></i><b><span style='font-size:11.0pt;line-height:121%;font-family:
  Consolas;color:#333333'>public function </span></b><b><span style='font-size:
  11.0pt;line-height:121%;font-family:Consolas;color:#990000'>validateForm</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>(array
  &amp;$form, FormStateInterface</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$form_state)</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:157.15pt;margin-bottom:
  0in;margin-left:24.2pt;text-indent:-12.1pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>{
  <b>parent</b>::validateForm($form, $form_state);</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.55pt;margin-bottom:0in;
margin-left:-1.0in;text-indent:0in;line-height:107%'>&nbsp;</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:685.5pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
  height:685.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:191.95pt;margin-bottom:
  0in;margin-left:24.15pt;text-indent:0in;line-height:115%'><i><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#999988'>//
  Server side validation for email </span></i><b><span style='font-size:11.0pt;
  line-height:115%;font-family:Consolas;color:#333333'>if</span></b></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.8pt;
  margin-left:0in;text-indent:0in;line-height:115%'><span style='font-size:
  11.0pt;line-height:115%;font-family:Consolas;color:#333333'>(!\Drupal::service(</span><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#DD1144'>'email.validator'</span><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>)-&gt;isValid($form_state-&gt;getValues()[
  </span><span style='font-size:11.0pt;line-height:115%;font-family:Consolas;
  color:#DD1144'>'email'</span><span style='font-size:11.0pt;line-height:115%;
  font-family:Consolas;color:#333333'>])) {</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:4.6pt;margin-bottom:
  0in;margin-left:0in;text-indent:36.25pt;line-height:115%'><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>$form_state-&gt;setErrorByName(</span><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#DD1144'>'Email'</span><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>,
  <b>$this</b>-&gt;t(</span><span style='font-size:11.0pt;line-height:115%;
  font-family:Consolas;color:#DD1144'>'Email address is not a valid.'</span><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>));</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:15.95pt;
  margin-left:24.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:24.15pt;text-indent:0in;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>//
  Check if username exists</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.8pt;
  margin-left:0in;text-indent:24.15pt;line-height:115%'><span style='font-size:
  11.0pt;line-height:115%;font-family:Consolas;color:#333333'>$user_exists =
  user_load_by_name(Xss::filter($form_state-&gt;getValues()[</span><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#DD1144'>'username'</span><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>]));
  <b>if</b>(!<b>empty</b>($user_exists)) {</span></p>
  <p class=MsoNormal style='margin:0in;text-indent:36.25pt;line-height:115%'><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>$form_state-&gt;setErrorByName(</span><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#DD1144'>'username'</span><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>,
  <b>$this</b>-&gt;t(</span><span style='font-size:11.0pt;line-height:115%;
  font-family:Consolas;color:#DD1144'>'An account with this username already
  exists.'</span><span style='font-size:11.0pt;line-height:115%;font-family:
  Consolas;color:#333333'>));</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:15.95pt;
  margin-left:24.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:24.15pt;text-indent:0in;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>//
  Check if email exists</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:24.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$ids =
  \Drupal::entityQuery(</span><span style='font-size:11.0pt;line-height:107%;
  font-family:Consolas;color:#DD1144'>'user'</span><span style='font-size:11.0pt;
  line-height:107%;font-family:Consolas;color:#333333'>)</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:36.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>-&gt;condition(</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'mail'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>,</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>Xss::filter($form_state-&gt;getValues()[</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'email'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>]))</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:36.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>-&gt;range(</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:teal'>0</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>,
  </span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:teal'>1</span><span style='font-size:11.0pt;line-height:107%;
  font-family:Consolas;color:#333333'>)</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:228.2pt;margin-bottom:
  .8pt;margin-left:24.15pt;text-indent:12.1pt;line-height:115%'><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>-&gt;execute();
  <b>if</b>(!<b>empty</b>($ids)){</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:4.6pt;margin-bottom:
  0in;margin-left:0in;text-indent:36.25pt;line-height:115%'><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>$form_state-&gt;setErrorByName(</span><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#DD1144'>'email'</span><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>,
  <b>$this</b>-&gt;t(</span><span style='font-size:11.0pt;line-height:115%;
  font-family:Consolas;color:#DD1144'>'An account with this email address
  already exists.'</span><span style='font-size:11.0pt;line-height:115%;
  font-family:Consolas;color:#333333'>));</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:15.95pt;
  margin-left:24.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:24.15pt;text-indent:0in;line-height:121%'><i><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#999988'>//
  check if pass = minimum 8 characters server-side </span></i><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>if</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>(strlen($form_state-&gt;getValues()[</span><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#DD1144'>'password'</span><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>])
  &lt; </span><span style='font-size:11.0pt;line-height:121%;font-family:Consolas;
  color:teal'>8</span><span style='font-size:11.0pt;line-height:121%;
  font-family:Consolas;color:#333333'>) {</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:16.7pt;margin-bottom:
  15.0pt;margin-left:0in;text-indent:36.25pt;line-height:115%'><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>$form_state-&gt;setErrorByName(</span><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#DD1144'>'password'</span><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>,
  <b>$this</b>-&gt;t(</span><span style='font-size:11.0pt;line-height:115%;
  font-family:Consolas;color:#DD1144'>'Minimum length of password needs to be 8
  characters.'</span><span style='font-size:11.0pt;line-height:115%;font-family:
  Consolas;color:#333333'>)); }</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:15.95pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:12.1pt;text-indent:0in;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>/**</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>Form
  submission handler.</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>@param
  </span></i><i><span style='font-size:11.0pt;line-height:107%;font-family:
  Consolas;color:#999988'>array $form</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:18.15pt;text-indent:0in;line-height:118%'><span style='font-size:
  11.0pt;line-height:118%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:118%;font-family:Consolas;color:#999988'>An
  associative array containing the structure of the form. * </span></i><i><span
  style='font-size:11.0pt;line-height:118%;font-family:Consolas;color:#DD1144'>@param
  </span></i><i><span style='font-size:11.0pt;line-height:118%;font-family:
  Consolas;color:#999988'>\Drupal\Core\Form\FormStateInterface $form_state *  
  The current state of the form.</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:71.1pt;margin-bottom:
  0in;margin-left:12.1pt;text-indent:6.05pt;line-height:121%'><i><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#999988'>*/
  </span></i><b><span style='font-size:11.0pt;line-height:121%;font-family:
  Consolas;color:#333333'>public function </span></b><b><span style='font-size:
  11.0pt;line-height:121%;font-family:Consolas;color:#990000'>submitForm</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>(array
  &amp;$form, FormStateInterface</span></p>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$form_state)
  {</span></p>
  </td>
 </tr>
 <tr style='height:220.5pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
  height:220.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:24.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$user =
  User::create();</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:24.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$user-&gt;enforceIsNew();</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:24.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$user-&gt;setEmail($form_state-&gt;getValues()[</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'email'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>]);</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:14.2pt;
  margin-left:0in;text-indent:24.15pt;line-height:121%'><span style='font-size:
  11.0pt;line-height:121%;font-family:Consolas;color:#333333'>$user-&gt;setUsername($form_state-&gt;getValues()[</span><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#DD1144'>'email'</span><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>]);
  </span><i><span style='font-size:11.0pt;line-height:121%;font-family:Consolas;
  color:#999988'>//This username must be unique and accept only a-Z,0-9, - _ @
  .</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$user-&gt;setPassword(Xss::filter($form_state-&gt;getValues()[</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'password'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>]));</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:89.2pt;margin-bottom:
  0in;margin-left:24.15pt;text-indent:0in;line-height:118%'><span
  style='font-size:11.0pt;line-height:118%;font-family:Consolas;color:#333333'>$user-&gt;activate();
  $user-&gt;save(); user_login_finalize($user); </span><i><span
  style='font-size:11.0pt;line-height:118%;font-family:Consolas;color:#999988'>//
  logs a new session etc.</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:161.75pt;margin-bottom:
  15.0pt;margin-left:12.1pt;text-indent:12.1pt;line-height:115%'><i><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#999988'>//
  This will redirect with UserLoginEvent </span></i><span style='font-size:
  11.0pt;line-height:115%;font-family:Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:30.5pt;
margin-left:-.25pt'>This form asks for a name, mailing address and password and
then creates the user and automatically logs the user in.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:15.1pt;margin-bottom:
32.35pt;margin-left:14.0pt;line-height:110%;background:#FFD966'><span
style='font-size:11.0pt;line-height:110%'>Note: on a production website we
would have to verify the email of the user and probably add a reCaptcha spam
detection. We will skip this in this course.</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>But how do we get this form at the core <u>/user/register </u>place?
We can dispatch a <a
href="https://www.drupal.org/docs/drupal-apis/routing-system/altering-existing-routes-and-adding-new-routes-based-on-dynamic-ones"><span
style='color:#1155CC'>RouteSubscriber</span></a><u><span style='color:#1155CC'>
</span></u>event for this. It allows custom code to listen for dynamic routing
events.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>Any route - whether statically defined in a YAML file, as
seen in the introductory example, or a dynamic route as described in Providing
dynamic routes - can be altered. You can do so by modifying a RouteCollection
using an EventSubscriber triggered by the RoutingEvents::ALTER event.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:-.25pt;line-height:110%'>We add a new service to <b>custom/offer/offer.services.yml:</b></p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:100.5pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
  height:100.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:0in;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>services:</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:113.4pt;margin-bottom:
  .8pt;margin-left:12.1pt;text-indent:0in;line-height:115%'><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#DD1144'>...
  // already </span><span style='font-size:11.0pt;line-height:115%;font-family:
  Consolas;color:teal'>1 </span><span style='font-size:11.0pt;line-height:115%;
  font-family:Consolas;color:#DD1144'>service here offer.route_subscriber:</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:125.45pt;margin-bottom:
  .8pt;margin-left:24.15pt;text-indent:0in;line-height:115%'><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>class:
  </span><span style='font-size:11.0pt;line-height:115%;font-family:Consolas;
  color:#DD1144'>Drupal\offer\Routing\RouteSubscriber </span><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>tags:</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:36.25pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#990073'>- </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>{
  </span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#333333'>name: </span><span style='font-size:11.0pt;line-height:107%;
  font-family:Consolas;color:#DD1144'>event_subscriber }</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:2.35pt;
margin-left:-.25pt;line-height:110%'>Now, add the file <b>RouteSubscriber.php </b>to
<b>custom/offer/src/Routing:</b></p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=601
 style='width:450.75pt;border-collapse:collapse'>
 <tr style='height:400.5pt'>
  <td width=601 style='width:450.75pt;background:#F8F8F8;padding:0in 5.75pt 0in 5.25pt;
  height:400.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:252.4pt;margin-bottom:
  15.0pt;margin-left:0in;text-indent:0in;line-height:121%'><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#999999'>&lt;?php
  </span></b><b><span style='font-size:11.0pt;line-height:121%;font-family:
  Consolas;color:#333333'>namespace </span></b><b><span style='font-size:11.0pt;
  line-height:121%;font-family:Consolas;color:#990000'>Drupal</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>offer</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>Routing</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:155.7pt;margin-bottom:
  14.2pt;margin-left:0in;text-indent:0in;line-height:121%'><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>use
  </span></b><b><span style='font-size:11.0pt;line-height:121%;font-family:
  Consolas;color:#990000'>Drupal</span></b><span style='font-size:11.0pt;
  line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>Core</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>Routing</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>RouteSubscriberBase</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>;
  <b>use </b></span><b><span style='font-size:11.0pt;line-height:121%;
  font-family:Consolas;color:#990000'>Symfony</span></b><span style='font-size:
  11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>Component</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>Routing</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>\</span><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>RouteCollection</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>;</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><i><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#999988'>/**</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:18.15pt;text-indent:-12.1pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>Listens
  to the dynamic route events.</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:131.5pt;margin-bottom:
  14.2pt;margin-left:0in;text-indent:0in;line-height:121%'><i><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#999988'>*/
  </span></i><b><span style='font-size:11.0pt;line-height:121%;font-family:
  Consolas;color:#333333'>class </span></b><b><span style='font-size:11.0pt;
  line-height:121%;font-family:Consolas;color:#445588'>RouteSubscriber </span></b><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>extends
  </span></b><b><span style='font-size:11.0pt;line-height:121%;font-family:
  Consolas;color:#445588'>RouteSubscriberBase </span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>{</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>/**</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:18.15pt;text-indent:-12.1pt;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>*<span
  style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>{</span></i><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>@inheritdoc</span></i><i><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#999988'>}</span></i></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:65.05pt;margin-bottom:
  14.2pt;margin-left:6.05pt;text-indent:6.05pt;line-height:121%'><i><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#999988'>*/
  </span></i><b><span style='font-size:11.0pt;line-height:121%;font-family:
  Consolas;color:#333333'>protected function </span></b><b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#990000'>alterRoutes</span></b><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>(RouteCollection
  $collection) {</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:16.7pt;margin-bottom:
  0in;margin-left:18.15pt;text-indent:0in;line-height:121%'><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>$entityUserRegisterFormRoute
  = $collection-&gt;get(</span><span style='font-size:11.0pt;line-height:121%;
  font-family:Consolas;color:#DD1144'>'user.register'</span><span
  style='font-size:11.0pt;line-height:121%;font-family:Consolas;color:#333333'>);
  <b>if </b>($entityUserRegisterFormRoute) {</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:30.2pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>$entityUserRegisterFormRoute-&gt;setDefaults([</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:1.8pt;
  margin-left:42.3pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#DD1144'>'_form' </span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>=&gt;
  </span><span style='font-size:11.0pt;line-height:107%;font-family:Consolas;
  color:#DD1144'>'\Drupal\offer\Form\RegistrationForm'</span><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>,</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:83.15pt;margin-bottom:
  0in;margin-left:30.2pt;text-indent:12.1pt;line-height:115%'><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#DD1144'>'_title'
  </span><span style='font-size:11.0pt;line-height:115%;font-family:Consolas;
  color:#333333'>=&gt; </span><span style='font-size:11.0pt;line-height:115%;
  font-family:Consolas;color:#DD1144'>'Create your offer platform account'</span><span
  style='font-size:11.0pt;line-height:115%;font-family:Consolas;color:#333333'>,
  ]);</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:15.95pt;
  margin-left:18.15pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.95pt;
  margin-left:6.05pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'><span
  style='font-size:11.0pt;line-height:107%;font-family:Consolas;color:#333333'>}</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:0in;
margin-left:-.25pt'>If we clear caches, our custom form appears on the <u>/user/register
</u>route:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:-1.7pt;margin-bottom:
24.25pt;margin-left:1.5pt;text-indent:0in;line-height:107%'><img border=0
width=602 height=641 id="Picture 21193"
src="Learning%20drupal%209%20as%20a%20framework_files/image122.jpg"></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>This is powerful stuff. With this routeSubscriber we can
basically override <i>any </i>of the default routes in drupal core. We
basically changed the behaviour of registered routes in drupal.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>The <i>validateForm() </i>and <i>submitForm() </i>methods
guard our input and make sure the user does not exist yet. Because we already
listen to the login event (remember this from a previous tutorial), the new
user gets redirected to the homepage automatically.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>For our platform, this 1-step log in will on-board many
more users than the core user register form.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:15.1pt;margin-bottom:
31.05pt;margin-left:14.0pt;line-height:110%;background:#FFD966'><span
style='font-size:11.0pt;line-height:110%'>We could attach an Event to send out
an email for verifications and so forth. This leads us too far for this course
but is something you would do on a software in production. In the meantime you
could let users have a bid and put an <i>unverified </i>label to their profile.</span></p>

<h2 style='margin-top:0in;margin-right:0in;margin-bottom:3.35pt;margin-left:
-.25pt'><a name="_Toc247085">Finishing up the platform</a></h2>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>This course was quite a ride. While this stays just a
course and the software is not ready for production use I added the following
stuff that isn’t covered because it is either repetitive stuff from earlier
chapters or it leads too far:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:.65pt;
margin-left:.5in;text-indent:-.25in'><span style='font-family:"Arial",sans-serif'>&#9679;<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span>I
added a <i>RedirectProfilePageToProfileSubscriber </i><b>Event Subscriber to
redirect the profile page to the edit page of the user</b>. You’ll find out you
need this quite a lot! Note: for this platform, user profiles wouldn’t be a bad
thing though not the focus of this course. Tip: to make this page a bit more
production-ready, remove unnecessary fields at <u>/admin/config/people/accounts/form-display</u></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:.45pt;
margin-left:.5in;text-indent:-.25in'><span style='font-family:"Arial",sans-serif'>&#9679;<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span>I
added an <b>OfferExpiredController </b>just like the <i>OfferPublishController</i>.
This is used to set the moderation state from published to expired. Affected
files are offer.routing.yml to add a new route, OfferDynamicOperationLInks
plugin to add the link. Result is this:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:7.75pt;
margin-left:37.5pt;text-indent:0in;line-height:107%'><img border=0 width=212
height=136 id="Picture 21262"
src="Learning%20drupal%209%20as%20a%20framework_files/image123.jpg"></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:.55pt;
margin-left:.5in;text-indent:-.25in'><span style='font-family:"Arial",sans-serif'>&#9679;<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span><b>I’ve
created a view mode ‘compact’ for the users</b>, added a profile image and
added them to the offer teaser and full template, and to the bid table. A good
example on how to render a custom entity. I spiced it up a little with css.
Take a look at <b>offer.module </b>and <b>user--compact.html.twig </b>to see
how I did it. The trick was to alter the template suggestion so that we could
override the twig of the user module. Last step was to edit the <b>OfferBiddingTable
</b>to add the user teasers. This is how the integration looks:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:37.5pt;text-indent:0in;line-height:107%'><img border=0 width=545
height=108 id="Picture 21264"
src="Learning%20drupal%209%20as%20a%20framework_files/image124.jpg"></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:5.1pt;
margin-left:.5in;text-indent:-.25in'><span style='font-family:"Arial",sans-serif'>&#9679;<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span>Copy
the <b>SeedDataGenerator.php </b>from the final platform code to yours. It is
extended with some extra users and offers. Remove your own test users, offers
(drush entity:delete offer) with drush and create your offers and users like in
the <u><span style='color:#1155CC'>Seed Data chapter</span></u>:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:10.6pt;margin-bottom:
6.65pt;margin-left:43.25pt;line-height:112%;background:#F8F8F8'><span
style='font-family:Consolas;color:#333333'>drush offer-create-seeds</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:0in;
margin-left:36.5pt'>Log in with username “test” and password “test” and add a
profile image. Place a bid on an offer and it will look like this:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:-37.7pt;margin-bottom:
24.25pt;margin-left:37.5pt;text-indent:0in;line-height:107%'><img border=0
width=602 height=185 id="Picture 21319"
src="Learning%20drupal%209%20as%20a%20framework_files/image125.jpg"></p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:17.3pt;
margin-left:-.25pt'>These things were left unfinished:</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:.7pt;
margin-left:.5in;text-indent:-.25in'><span style='font-family:"Arial",sans-serif'>&#9679;<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span>Every
modern platform should have a responsive lay-out with a mobile-first approach.
This was far from the purpose of this course. We stayed away from theming.
Maybe I’ll create a course about this later! Personally I like building custom
themes with Tailwind css.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:.65pt;
margin-left:.5in;text-indent:-.25in'><span style='font-family:"Arial",sans-serif'>&#9679;<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span>The
registration form should contain some sort of spam prevention. Take a look at
some ReCaptcha modules on drupal.org to do the trick.</p>

<p class=MsoNormal style='margin-top:0in;margin-right:.75pt;margin-bottom:18.6pt;
margin-left:.5in;text-indent:-.25in'><span style='font-family:"Arial",sans-serif'>&#9679;<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span>On
a production platform we’d use cron jobs to do some tasks (and automated drupal
cleanup tasks). hook_cron() is used for this.</p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=600
 style='width:6.25in;border-collapse:collapse'>
 <tr style='height:127.5pt'>
  <td width=48 valign=top style='width:.5in;background:#E2E3E5;padding:14.6pt 5.75pt 0in 8.25pt;
  height:127.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
  margin-left:6.0pt;text-indent:0in;line-height:107%'><span style='font-size:
  11.0pt;line-height:107%'>&#128187;</span></p>
  </td>
  <td width=552 style='width:5.75in;background:#E2E3E5;padding:14.6pt 5.75pt 0in 8.25pt;
  height:127.5pt'>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:.7pt;
  margin-left:0in;text-indent:0in;line-height:107%'>Download the latest project
  files here:</p>
  <p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:17.95pt;
  margin-left:0in;text-indent:0in;line-height:107%'><a
  href="https://stefvanlooveren.me/download/8cb8b68a0242ac130003?i=g"><span
  style='color:#1155CC'>https://stefvanlooveren.me/download/8cb8b68a0242ac130003?i=g</span></a></p>
  <p class=MsoNormal style='margin:0in;text-indent:0in;line-height:107%'>Also,
  check out the changelog and subscribe to the mailing list at <a
  href="https://stefvanlooveren.me/courses/drupal-9-framework"><span
  style='color:#1155CC'>https://stefvanlooveren.me/courses/drupal-9-framework</span></a><u><span
  style='color:#1155CC'> </span></u>to stay updated about changes and new
  chapters in the future.</p>
  </td>
 </tr>
</table>

<p class=MsoNormal>&nbsp;</p>

</div>

</body>

</html>
